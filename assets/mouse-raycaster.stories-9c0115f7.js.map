{"version":3,"file":"mouse-raycaster.stories-9c0115f7.js","sources":["../../src/components/mouse-raycaster/index.ts"],"sourcesContent":["import {\n  type Object3D,\n  type OrthographicCamera,\n  type PerspectiveCamera,\n  type Scene,\n  type WebGLRenderer,\n  Raycaster,\n  Vector2,\n  EventDispatcher,\n  Event,\n  EventListener,\n} from 'three'\n\ntype Events = 'click' | 'move'\n\nexport class MouseRaycaster extends EventDispatcher {\n  camera: PerspectiveCamera | OrthographicCamera\n  \n  raycaster: Raycaster\n  objects: Object3D[] = []\n  pointerDown = new Vector2()\n  pointerUp = new Vector2()\n  pointerMove = new Vector2()\n  recursive = true\n\n  renderer: WebGLRenderer\n  #events = { click: 0, move: 0 }\n\n  constructor (props: {\n    scene?: Scene\n    camera: PerspectiveCamera | OrthographicCamera\n    renderer: WebGLRenderer\n    raycaster?: Raycaster\n    objects?: Object3D[]\n    recursive?: boolean\n  }) {\n    super()\n    this.camera = props.camera\n    this.renderer = props.renderer\n    this.raycaster = props.raycaster ?? new Raycaster()\n    this.objects = props.objects ?? (props.scene ? [props.scene] : [])\n    this.recursive = props.recursive ?? true\n  }\n\n  on(type: Events, listener: EventListener<Event, Events, this>): void {\n    super.addEventListener<Events>(type, listener)\n\n    const canvas = this.renderer.domElement\n\n    if (type === 'move' && this.#events.move === 0) {\n      canvas.addEventListener('pointermove', this.onPointerMove, { passive: true })\n    } else if (type === 'click' && this.#events.click === 0) {\n      canvas.addEventListener('pointerdown', this.onPointerDown, { passive: true })\n      canvas.addEventListener('pointerup', this.onPointerUp, { passive: true })\n    }\n\n    this.#events[type] += 1\n  }\n\n  off(type: Events, listener: EventListener<Event, Events, this>): void {\n    super.removeEventListener<Events>(type, listener)\n\n    const canvas = this.renderer.domElement\n\n    this.#events[type] -= 1\n\n    if (type === 'move' && this.#events.move <= 0) {\n      canvas.removeEventListener('pointermove', this.onPointerMove)\n    } else if (type === 'click' && this.#events.click <= 0) {\n      canvas.addEventListener('pointerdown', this.onPointerDown, { passive: true })\n      canvas.addEventListener('pointerup', this.onPointerUp, { passive: true })\n    }\n  }\n\n  getNormalizedCoordinates (event: PointerEvent, vec: Vector2) {\n    const canvas = this.renderer.domElement\n    const rect = canvas.getBoundingClientRect()\n\n    /*\n     * Calculate pointer position in normalized device coordinates\n     * (-1 to +1) for both components\n     */\n    vec.x = (((event.clientX - rect.x) / canvas.clientWidth) * 2) - 1\n    vec.y = -(((event.clientY - rect.y) / canvas.clientHeight) * 2) + 1\n  }\n\n  onPointerDown = (event: PointerEvent) => {\n    this.getNormalizedCoordinates(event, this.pointerDown)\n  }\n\n  onPointerUp = (event: PointerEvent) => {\n    this.getNormalizedCoordinates(event, this.pointerUp)\n\n    if (this.pointerDown.sub(this.pointerUp).lengthSq() > 0.001) {\n      return\n    }\n\n    // Update the picking ray with the camera and pointer position\n    this.raycaster.setFromCamera(this.pointerUp, this.camera)\n\n    const intersections = this.raycaster.intersectObjects(this.objects, this.recursive)\n\n    this.dispatchEvent({ type: 'click', intersections })\n  }\n\n  onPointerMove = (event: PointerEvent) => {\n    this.getNormalizedCoordinates(event, this.pointerMove)\n\n    this.raycaster.setFromCamera(this.pointerMove, this.camera)\n\n    const intersections = this.raycaster.intersectObjects(this.objects, this.recursive)\n\n    this.dispatchEvent({ type: 'move', intersections })\n  }\n\n  dispose () {\n    const canvas = this.renderer.domElement\n\n    canvas.removeEventListener('pointerdown', this.onPointerDown)\n    canvas.removeEventListener('pointerup', this.onPointerUp)\n    canvas.removeEventListener('pointermove', this.onPointerMove)\n  }\n}\n"],"names":["MouseRaycaster","EventDispatcher","props","__publicField","Vector2","__privateAdd","_events","event","intersections","Raycaster","type","listener","canvas","__privateGet","vec","rect"],"mappings":"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"}