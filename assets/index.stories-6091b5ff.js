import{p as b,q as y,t as E,r as T}from"./teleport-9b1daae2.js";import{s as _}from"./lib-dfb91133.js";const f={allowed:"Enter VR",not_allowed:"VR is not allowed",not_secure:"VR requires HTTPS",not_supported:"VR not supported"},q=(n,d,u)=>{navigator.xr===void 0||/WebXRViewer\//ui.test(navigator.userAgent)||navigator.xr.addEventListener("sessiongranted",()=>{c.sessionGranted=!0});let t;const c={sessionGranted:!1},s=b(n,d,u),r={},a=(e,o)=>{r[e]??(r[e]=[]),r[e].push(o)},i=e=>{const o=r[e];if(o!==void 0)for(let v=0,h=o.length;v<h;v+=1)o[v]()},p=async()=>{if(navigator.xr===void 0)return"not_supported";if(!window.isSecureContext)return"not_secure";try{return await navigator.xr.isSessionSupported("immersive-vr")?"allowed":"not_supported"}catch{return"not_allowed"}},x=async()=>{if(navigator.xr===void 0)throw new Error("navigator.xr is undefined!");t=await navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}),t.addEventListener("end",()=>i("end")),t.addEventListener("exit",()=>i("exit")),await n.xr.setSession(t),i("enter")},m={state:c,supportStateMessages:f,createButton:async()=>{const e=await p(),o=document.createElement("button");return o.textContent=f[e],e==="allowed"&&o.addEventListener("click",x),o},requestSessionSupport:p,requestSession:x,endSession:()=>{if(t===void 0)throw new Error("Tried to end undefined session!");t.end()},addControllers:()=>(y(n,d),m),enableTeleport:(...e)=>(s.enable(...e),m),disableTeleport:()=>{s.disable()},on:a,update:e=>{s.update(e)}};return m},C=`import { three, xr } from '.'

const { renderer, scene, camera } = three()
const vr = xr(renderer, scene, camera)

document.body.append(await vr.createButton())

const support = await vr.requestSessionSupport()
`,X={title:"XR",parameters:{docs:{description:{component:""},source:{code:C}}}},R=()=>{const n=document.createElement("div");n.style.cssText="width:100%;height:420px;";const{canvas:d,camera:u,scene:t,renderer:c,update:s}=E();n.append(d),c.xr.enabled=!0;const r=q(c,t,u.current);r.createButton().then(i=>n.append(i)),r.addControllers(),r.enableTeleport(),_({canvas:d,camera:u,scene:t,update:s,controls:!0});const a=T(void 0,30,30);return a.position.y=-4.5,a.rotation.x=-Math.PI/2,a.rotation.z=Math.PI/4,t.add(a),s((i,p)=>r.update(p)),n},l={render:R};var w,S,g;l.parameters={...l.parameters,docs:{...(w=l.parameters)==null?void 0:w.docs,source:{originalSource:`{
  render
}`,...(g=(S=l.parameters)==null?void 0:S.docs)==null?void 0:g.source}}};const z=["Primary"];export{l as Primary,z as __namedExportsOrder,X as default};
//# sourceMappingURL=index.stories-6091b5ff.js.map
