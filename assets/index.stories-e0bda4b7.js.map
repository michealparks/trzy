{"version":3,"file":"index.stories-e0bda4b7.js","sources":["../../src/components/controls/keyboard.ts","../../src/stories/keyboard/code.js?raw"],"sourcesContent":["const pressedKeys = new Set<string>()\n\nlet initialized = false\nlet preventDefault = false\n\nconst keyboard = {\n  keys: {} as Record<string, boolean>,\n  controlling: false,\n  shift: 0,\n  space: 0,\n  r: 0,\n  x: 0,\n  y: 0,\n}\n\nconst handleKey = (key: string, pressed: number): void => {\n  const lowerkey = key.toLowerCase()\n\n  switch (lowerkey) {\n  case 's':\n  case 'arrowdown':\n    keyboard.y = -1 * pressed\n    break\n  case 'w':\n  case 'arrowup':\n    keyboard.y = +1 * pressed\n    break\n  case 'a':\n  case 'arrowleft':\n    keyboard.x = -1 * pressed\n    break\n  case 'd':\n  case 'arrowright':\n    keyboard.x = +1 * pressed\n    break\n  case ' ':\n    keyboard.space = +1 * pressed\n    break\n  case 'q':\n    keyboard.r = +1 * pressed\n    break\n  case 'e':\n    keyboard.r = -1 * pressed\n    break\n  case 'shift':\n    keyboard.shift = +1 * pressed\n    break\n  default:\n    break\n  }\n\n  if (pressed === 1) {\n    keyboard.keys[lowerkey] = true\n  } else {\n    delete keyboard.keys[lowerkey]\n  }\n}\n\nconst handleKeyDown = (event: KeyboardEvent): void => {\n  if (preventDefault) {\n    event.preventDefault()\n    event.stopImmediatePropagation()\n  }\n\n  const key = event.key.toLowerCase()\n  keyboard.controlling = true\n\n  pressedKeys.add(key)\n\n  for (const pressedKey of pressedKeys) {\n    handleKey(pressedKey, 1)\n  }\n}\n\nconst handleKeyUp = (event: KeyboardEvent): void => {\n  if (preventDefault) {\n    event.preventDefault()\n    event.stopImmediatePropagation()\n  }\n  \n  const key = event.key.toLowerCase()\n  pressedKeys.delete(key)\n\n  handleKey(key, 0)\n\n  for (const pressedKey of pressedKeys) {\n    handleKey(pressedKey, 1)\n  }\n\n  if (pressedKeys.size === 0) {\n    keyboard.controlling = false\n  }\n}  \n\nconst handleBlur = (): void => {\n  for (const pressedKey of pressedKeys) {\n    handleKey(pressedKey, 0)\n  }\n  pressedKeys.clear()\n}\n\nconst disposeKeyboard = (): void => {\n  window.removeEventListener('keydown', handleKeyDown)\n  window.removeEventListener('keyup', handleKeyUp)\n  window.addEventListener('blur', handleBlur)\n  initialized = false\n}\n\n/**\n * \n * @param options\n * @param options.preventDefault If true, prevents default on every keyup / keydown. Default is true.\n */\nexport const useKeyboard = (options: { preventDefault?: boolean } = {}): {\n  keyboard: typeof keyboard,\n  disposeKeyboard: () => void\n} => {\n  preventDefault = options.preventDefault ?? false\n\n  if (!initialized) {\n    window.addEventListener('keydown', handleKeyDown)\n    window.addEventListener('keyup', handleKeyUp)\n    window.addEventListener('blur', handleBlur)\n  }\n\n  return { keyboard, disposeKeyboard }\n}\n","export default \"import { useKeyboard } from 'trzy'\\n\\nconst { keyboard, disposeKeyboard } = useKeyboard({ preventDefault: true })\\n\\n// later\\ndisposeKeyboard()\\n\""],"names":["pressedKeys","initialized","preventDefault","keyboard","handleKey","key","pressed","lowerkey","handleKeyDown","event","pressedKey","handleKeyUp","handleBlur","disposeKeyboard","useKeyboard","options","code"],"mappings":"2CAAA,MAAMA,MAAkB,IAExB,IAAIC,EAAc,GACdC,EAAiB,GAErB,MAAMC,EAAW,CACf,KAAM,CAAC,EACP,YAAa,GACb,MAAO,EACP,MAAO,EACP,EAAG,EACH,EAAG,EACH,EAAG,CACL,EAEMC,EAAY,CAACC,EAAaC,IAA0B,CAClD,MAAAC,EAAWF,EAAI,cAErB,OAAQE,EAAU,CAClB,IAAK,IACL,IAAK,YACHJ,EAAS,EAAI,GAAKG,EAClB,MACF,IAAK,IACL,IAAK,UACHH,EAAS,EAAI,EAAKG,EAClB,MACF,IAAK,IACL,IAAK,YACHH,EAAS,EAAI,GAAKG,EAClB,MACF,IAAK,IACL,IAAK,aACHH,EAAS,EAAI,EAAKG,EAClB,MACF,IAAK,IACHH,EAAS,MAAQ,EAAKG,EACtB,MACF,IAAK,IACHH,EAAS,EAAI,EAAKG,EAClB,MACF,IAAK,IACHH,EAAS,EAAI,GAAKG,EAClB,MACF,IAAK,QACHH,EAAS,MAAQ,EAAKG,EACtB,KAGF,CAEIA,IAAY,EACLH,EAAA,KAAKI,CAAQ,EAAI,GAEnB,OAAAJ,EAAS,KAAKI,CAAQ,CAEjC,EAEMC,EAAiBC,GAA+B,CAChDP,IACFO,EAAM,eAAe,EACrBA,EAAM,yBAAyB,GAG3B,MAAAJ,EAAMI,EAAM,IAAI,YAAY,EAClCN,EAAS,YAAc,GAEvBH,EAAY,IAAIK,CAAG,EAEnB,UAAWK,KAAcV,EACvBI,EAAUM,EAAY,CAAC,CAE3B,EAEMC,EAAeF,GAA+B,CAC9CP,IACFO,EAAM,eAAe,EACrBA,EAAM,yBAAyB,GAG3B,MAAAJ,EAAMI,EAAM,IAAI,YAAY,EAClCT,EAAY,OAAOK,CAAG,EAEtBD,EAAUC,EAAK,CAAC,EAEhB,UAAWK,KAAcV,EACvBI,EAAUM,EAAY,CAAC,EAGrBV,EAAY,OAAS,IACvBG,EAAS,YAAc,GAE3B,EAEMS,EAAa,IAAY,CAC7B,UAAWF,KAAcV,EACvBI,EAAUM,EAAY,CAAC,EAEzBV,EAAY,MAAM,CACpB,EAEMa,EAAkB,IAAY,CAC3B,OAAA,oBAAoB,UAAWL,CAAa,EAC5C,OAAA,oBAAoB,QAASG,CAAW,EACxC,OAAA,iBAAiB,OAAQC,CAAU,EAC5BX,EAAA,EAChB,EAOaa,EAAc,CAACC,EAAwC,MAIlEb,EAAiBa,EAAQ,gBAAkB,GAEtCd,IACI,OAAA,iBAAiB,UAAWO,CAAa,EACzC,OAAA,iBAAiB,QAASG,CAAW,EACrC,OAAA,iBAAiB,OAAQC,CAAU,GAGrC,CAAE,SAAAT,EAAU,gBAAAU,IC7HNG,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;"}