var Id=Object.defineProperty;var Sd=(m,a,t)=>a in m?Id(m,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[a]=t;var S=(m,a,t)=>(Sd(m,typeof a!="symbol"?a+"":a,t),t);import{h as is,C as Yt,e as ge,B as zd,s as Rd,u as pr,v as Wa,w as Qa,x as Vd,y as Jo,z as er,J as Ja,K as io,p as xn,N as Ds,Q as Vt,V as Ne,I as Dd,O as Ct,U as Od,d as Ro,W as Nd,X as ur,Y as vr,Z as so,_ as tr,$ as el,a0 as ii,a1 as mr,a as ts,D as gr,a2 as jd,l as nr,a3 as Fd,M as Fs,a4 as Hd,a5 as tl,a6 as Bd,a7 as nl,a8 as no,a9 as il,b as Kd,aa as br,ab as Ud,ac as sl,ad as Gd,ae as $d,P as qd,S as ol,af as Yd,ag as Xd,ah as Zd,ai as ir,aj as rl,ak as Dn,al,am as ll,an as cl,ao as dl,ap as hl,aq as pl,ar as Wd,F as ul,as as Qd,at as Jd,au as ha,av as eh,j as th,g as nh,aw as ih,o as sh,c as vl,ax as $t,ay as qt,az as oo,aA as oh,R as ml,E as fr,aB as gl,aC as rh,aD as ah,aE as bl,aF as lh,aG as ch,aH as dh,aI as hh,aJ as ph,aK as uh,aL as vh,aM as pa,i as fl,aN as mh,aO as gh,aP as bh,aQ as Vo,aR as Do,aS as fh,aT as _h,aU as wh,aV as xh,aW as yh,aX as Ch,aY as Eh,aZ as Ph,a_ as kh,a$ as Ah,b0 as Mh,b1 as Th,b2 as Lh,b3 as Ih,b4 as Sh,b5 as zh,b6 as Rh,b7 as Vh,b8 as Dh,b9 as Oh,ba as Nh,bb as jh,bc as Fh,bd as Hh,be as Bh,bf as Kh,bg as Uh,G as Gh,t as $h,bh as qh}from"./teleport-77ede96c.js";const Yh=(m,a=1024,t=-1e-4)=>{m.shadow!==void 0&&(m.shadow.bias=t,m.shadow.mapSize.set(a,a),m.shadow.dispose(),m.shadow.map=null,m.shadow.needsUpdate=!0)},_l=(m,a=1024,t=-1e-4)=>{m.isLight===!0&&m.isAmbientLight!==!0&&m.isRectAreaLight!==!0?(m.castShadow=!0,Yh(m,a,t)):m.isMesh&&(m.castShadow=!0,m.receiveShadow=!0);const i=m.children;if(i.length!==0)for(let l=0,h=i.length;l<h;l+=1)_l(i[l],a,t)};function co(m,a){for(var t=0;t<a.length;t++){const i=a[t];if(typeof i!="string"&&!Array.isArray(i)){for(const l in i)if(l!=="default"&&!(l in m)){const h=Object.getOwnPropertyDescriptor(i,l);h&&Object.defineProperty(m,l,h.get?h:{enumerable:!0,get:()=>i[l]})}}}return Object.freeze(Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}))}var Hs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ho(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var sr={exports:{}};/*! Tweakpane 3.1.9 (c) 2016 cocopon, licensed under the MIT license. */(function(m,a){(function(t,i){i(a)})(Hs,function(t){class i{constructor(e){const[n,r]=e.split("-"),_=n.split(".");this.major=parseInt(_[0],10),this.minor=parseInt(_[1],10),this.patch=parseInt(_[2],10),this.prerelease=r??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}class l{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class h{constructor(e){this.target=e}}class p extends h{constructor(e,n,r,_){super(e),this.value=n,this.presetKey=r,this.last=_??!0}}class g extends h{constructor(e,n,r){super(e),this.value=n,this.presetKey=r}}class f extends h{constructor(e,n){super(e),this.expanded=n}}class x extends h{constructor(e,n){super(e),this.index=n}}function E(s){return s==null}function A(s,e){if(s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(s[n]!==e[n])return!1;return!0}function I(s,e){let n=s;do{const r=Object.getOwnPropertyDescriptor(n,e);if(r&&(r.set!==void 0||r.writable===!0))return!0;n=Object.getPrototypeOf(n)}while(n!==null);return!1}const V={alreadydisposed:()=>"View has been already disposed",invalidparams:s=>`Invalid parameters for '${s.name}'`,nomatchingcontroller:s=>`No matching controller for '${s.key}'`,nomatchingview:s=>`No matching view for '${JSON.stringify(s.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:s=>`Property '${s.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class O{static alreadyDisposed(){return new O({type:"alreadydisposed"})}static notBindable(){return new O({type:"notbindable"})}static propertyNotFound(e){return new O({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new O({type:"shouldneverhappen"})}constructor(e){var n;this.message=(n=V[e.type](e.context))!==null&&n!==void 0?n:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}}class G{constructor(e,n,r){this.obj_=e,this.key_=n,this.presetKey_=r??n}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,n){const r=this.read();if(!G.isBindable(r))throw O.notBindable();if(!(e in r))throw O.propertyNotFound(e);r[e]=n}}class F extends l{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return(e=this.controller_.valueController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,n){const r=n.bind(this);return this.controller_.valueController.emitter.on(e,()=>{r(new h(this))}),this}}class R{constructor(){this.observers_={}}on(e,n){let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:n}),this}off(e,n){const r=this.observers_[e];return r&&(this.observers_[e]=r.filter(_=>_.handler!==n)),this}emit(e,n){const r=this.observers_[e];r&&r.forEach(_=>{_.handler(n)})}}const K="tp";function U(s){return(e,n)=>[K,"-",s,"v",e?`_${e}`:"",n?`-${n}`:""].join("")}function le(s,e){return n=>e(s(n))}function N(s){return s.rawValue}function z(s,e){s.emitter.on("change",le(N,e)),e(s.rawValue)}function H(s,e,n){z(s.value(e),n)}function J(s,e,n){n?s.classList.add(e):s.classList.remove(e)}function X(s,e){return n=>{J(s,e,n)}}function oe(s,e){z(s,n=>{e.textContent=n??""})}const me=U("btn");class ze{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(me()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("button");r.classList.add(me("b")),n.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const _=e.createElement("div");_.classList.add(me("t")),oe(n.props.value("title"),_),this.buttonElement.appendChild(_)}}class ue{constructor(e,n){this.emitter=new R,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new ze(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ae{constructor(e,n){var r;this.constraint_=n==null?void 0:n.constraint,this.equals_=(r=n==null?void 0:n.equals)!==null&&r!==void 0?r:(_,k)=>_===k,this.emitter=new R,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,n){const r=n??{forceEmit:!1,last:!0},_=this.constraint_?this.constraint_.constrain(e):e,k=this.rawValue_;this.equals_(k,_)&&!r.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=_,this.emitter.emit("change",{options:r,previousRawValue:k,rawValue:_,sender:this}))}}class we{constructor(e){this.emitter=new R,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,n){const r=n??{forceEmit:!1,last:!0},_=this.value_;_===e&&!r.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:r,previousRawValue:_,rawValue:this.value_,sender:this}))}}function ce(s,e){const n=e==null?void 0:e.constraint,r=e==null?void 0:e.equals;return!n&&!r?new we(s):new Ae(s,e)}class ie{constructor(e){this.emitter=new R,this.valMap_=e;for(const n in this.valMap_)this.valMap_[n].emitter.on("change",()=>{this.emitter.emit("change",{key:n,sender:this})})}static createCore(e){return Object.keys(e).reduce((n,r)=>Object.assign(n,{[r]:ce(e[r])}),{})}static fromObject(e){const n=this.createCore(e);return new ie(n)}get(e){return this.valMap_[e].rawValue}set(e,n){this.valMap_[e].rawValue=n}value(e){return this.valMap_[e]}}function Xt(s,e){return Object.keys(e).reduce((r,_)=>{if(r===void 0)return;const k=e[_],L=k(s[_]);return L.succeeded?Object.assign(Object.assign({},r),{[_]:L.value}):void 0},{})}function Zt(s,e){return s.reduce((n,r)=>{if(n===void 0)return;const _=e(r);if(!(!_.succeeded||_.value===void 0))return[...n,_.value]},[])}function yn(s){return s===null?!1:typeof s=="object"}function We(s){return e=>n=>{if(!e&&n===void 0)return{succeeded:!1,value:void 0};if(e&&n===void 0)return{succeeded:!0,value:void 0};const r=s(n);return r!==void 0?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function nt(s){return{custom:e=>We(e)(s),boolean:We(e=>typeof e=="boolean"?e:void 0)(s),number:We(e=>typeof e=="number"?e:void 0)(s),string:We(e=>typeof e=="string"?e:void 0)(s),function:We(e=>typeof e=="function"?e:void 0)(s),constant:e=>We(n=>n===e?e:void 0)(s),raw:We(e=>e)(s),object:e=>We(n=>{if(yn(n))return Xt(n,e)})(s),array:e=>We(n=>{if(Array.isArray(n))return Zt(n,e)})(s)}}const be={optional:nt(!0),required:nt(!1)};function Ee(s,e){const n=be.required.object(e)(s);return n.succeeded?n.value:void 0}function bt(s){console.warn([`Missing '${s.key}' of ${s.target} in ${s.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function Dt(s){return s&&s.parentElement&&s.parentElement.removeChild(s),null}class je{constructor(e){this.value_=e}static create(e){return[new je(e),(n,r)=>{e.setRawValue(n,r)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Ot=U("");function Nt(s,e){return X(s,Ot(void 0,e))}class Ue extends ie{constructor(e){var n;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=je.create(ce(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(n=this.get("parent"))===null||n===void 0||n.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var n,r,_;const k=e??{};return new Ue(ie.createCore({disabled:(n=k.disabled)!==null&&n!==void 0?n:!1,disposed:!1,hidden:(r=k.hidden)!==null&&r!==void 0?r:!1,parent:(_=k.parent)!==null&&_!==void 0?_:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){z(this.globalDisabled_,Nt(e,"disabled")),H(this,"hidden",Nt(e,"hidden"))}bindDisabled(e){z(this.globalDisabled_,n=>{e.disabled=n})}bindTabIndex(e){z(this.globalDisabled_,n=>{e.tabIndex=n?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",n=>{n&&e()})}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var n;const r=e.previousRawValue;r==null||r.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(n=this.get("parent"))===null||n===void 0||n.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function pt(){return["veryfirst","first","last","verylast"]}const cn=U(""),Qe={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ut{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const n=this.view.element;this.blade.value("positions").emitter.on("change",()=>{pt().forEach(r=>{n.classList.remove(cn(void 0,Qe[r]))}),this.blade.get("positions").forEach(r=>{n.classList.add(cn(void 0,Qe[r]))})}),this.viewProps.handleDispose(()=>{Dt(n)})}get parent(){return this.parent_}set parent(e){if(this.parent_=e,!("parent"in this.viewProps.valMap_)){bt({key:"parent",target:Ue.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const Le="http://www.w3.org/2000/svg";function Re(s){s.offsetHeight}function Cn(s,e){const n=s.style.transition;s.style.transition="none",e(),s.style.transition=n}function Et(s){return s.ontouchstart!==void 0}function Wt(){return globalThis}function Pt(){return Wt().document}function dn(s){const e=s.ownerDocument.defaultView;return e&&"document"in e?s.getContext("2d",{willReadFrequently:!0}):null}const En={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function vt(s,e){const n=s.createElementNS(Le,"svg");return n.innerHTML=En[e],n}function kt(s,e,n){s.insertBefore(e,s.children[n])}function hn(s){s.parentElement&&s.parentElement.removeChild(s)}function jt(s){for(;s.children.length>0;)s.removeChild(s.children[0])}function ft(s){for(;s.childNodes.length>0;)s.removeChild(s.childNodes[0])}function y(s){return s.relatedTarget?s.relatedTarget:"explicitOriginalTarget"in s?s.explicitOriginalTarget:null}const B=U("lbl");function se(s,e){const n=s.createDocumentFragment();return e.split(`
`).map(r=>s.createTextNode(r)).forEach((r,_)=>{_>0&&n.appendChild(s.createElement("br")),n.appendChild(r)}),n}class re{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(B()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(B("l")),H(n.props,"label",k=>{E(k)?this.element.classList.add(B(void 0,"nol")):(this.element.classList.remove(B(void 0,"nol")),ft(r),r.appendChild(se(e,k)))}),this.element.appendChild(r),this.labelElement=r;const _=e.createElement("div");_.classList.add(B("v")),this.element.appendChild(_),this.valueElement=_}}class xe extends ut{constructor(e,n){const r=n.valueController.viewProps;super(Object.assign(Object.assign({},n),{view:new re(e,{props:n.props,viewProps:r}),viewProps:r})),this.props=n.props,this.valueController=n.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const it={id:"button",type:"blade",accept(s){const e=be,n=Ee(s,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return n?{params:n}:null},controller(s){return new xe(s.document,{blade:s.blade,props:ie.fromObject({label:s.params.label}),valueController:new ue(s.document,{props:ie.fromObject({title:s.params.title}),viewProps:s.viewProps})})},api(s){return!(s.controller instanceof xe)||!(s.controller.valueController instanceof ue)?null:new F(s.controller)}};class Ve extends ut{constructor(e){super(e),this.value=e.value}}function _t(){return new ie({positions:ce([],{equals:A})})}class Fe extends ie{constructor(e){super(e)}static create(e){const n={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},r=ie.createCore(n);return new Fe(r)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!E(e)?`${e}px`:"auto"}bindExpandedClass(e,n){const r=()=>{this.styleExpanded?e.classList.add(n):e.classList.remove(n)};H(this,"expanded",r),H(this,"temporaryExpanded",r)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Ie(s,e){let n=0;return Cn(e,()=>{s.set("expandedHeight",null),s.set("temporaryExpanded",!0),Re(e),n=e.clientHeight,s.set("temporaryExpanded",null),Re(e)}),n}function st(s,e){e.style.height=s.styleHeight}function si(s,e){s.value("expanded").emitter.on("beforechange",()=>{if(s.set("completed",!1),E(s.get("expandedHeight"))){const n=Ie(s,e);n>0&&s.set("expandedHeight",n)}s.set("shouldFixHeight",!0),Re(e)}),s.emitter.on("change",()=>{st(s,e)}),st(s,e),e.addEventListener("transitionend",n=>{n.propertyName==="height"&&s.cleanUpTransition()})}class On extends l{constructor(e,n){super(e),this.rackApi_=n}}function Nn(s,e){return s.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function oi(s,e){return s.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function os(s,e){const n=e??{};return s.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}function ri(s,e){return s.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}class Qt{constructor(e){this.emitter=new R,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const n of this.allItems())if(e(n))return n;return null}includes(e){return this.cache_.has(e)}add(e,n){if(this.includes(e))throw O.shouldNeverHappen();const r=n!==void 0?n:this.items_.length;this.items_.splice(r,0,e),this.cache_.add(e);const _=this.extract_(e);_&&(_.emitter.on("add",this.onSubListAdd_),_.emitter.on("remove",this.onSubListRemove_),_.allItems().forEach(k=>{this.cache_.add(k)})),this.emitter.emit("add",{index:r,item:e,root:this,target:this})}remove(e){const n=this.items_.indexOf(e);if(n<0)return;this.items_.splice(n,1),this.cache_.delete(e);const r=this.extract_(e);r&&(r.emitter.off("add",this.onSubListAdd_),r.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:n,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class Pn extends l{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new R,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const n=e.sender.target.read();this.emitter_.emit("change",{event:new p(this,n,this.controller_.binding.target.presetKey,e.options.last)})}}class Me extends xe{constructor(e,n){super(e,n),this.binding=n.binding}}class ai extends l{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new R,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const n=e.sender.target.read();this.emitter_.emit("update",{event:new g(this,n,this.controller_.binding.target.presetKey)})}}class Se extends xe{constructor(e,n){super(e,n),this.binding=n.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Si(s){return s instanceof wt?s.apiSet_:s instanceof On?s.rackApi_.apiSet_:null}function kn(s,e){const n=s.find(r=>r.controller_===e);if(!n)throw O.shouldNeverHappen();return n}function li(s,e,n){if(!G.isBindable(s))throw O.notBindable();return new G(s,e,n)}class wt extends l{constructor(e,n){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new R,this.apiSet_=new Qt(Si),this.pool_=n;const r=this.controller_.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),r.emitter.on("inputchange",this.onRackInputChange_),r.emitter.on("monitorupdate",this.onRackMonitorUpdate_),r.children.forEach(_=>{this.setUpApi_(_)})}get children(){return this.controller_.rack.children.map(e=>kn(this.apiSet_,e))}addInput(e,n,r){const _=r??{},k=this.controller_.view.element.ownerDocument,L=this.pool_.createInput(k,li(e,n,_.presetKey),_),q=new Pn(L);return this.add(q,_.index)}addMonitor(e,n,r){const _=r??{},k=this.controller_.view.element.ownerDocument,L=this.pool_.createMonitor(k,li(e,n),_),q=new ai(L);return this.add(q,_.index)}addFolder(e){return oi(this,e)}addButton(e){return Nn(this,e)}addSeparator(e){return os(this,e)}addTab(e){return ri(this,e)}add(e,n){this.controller_.rack.add(e.controller_,n);const r=this.apiSet_.find(_=>_.controller_===e.controller_);return r&&this.apiSet_.remove(r),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const n=this.controller_.view.element.ownerDocument,r=this.pool_.createBlade(n,e),_=this.pool_.createBladeApi(r);return this.add(_,e.index)}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}setUpApi_(e){this.apiSet_.find(n=>n.controller_===e)||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const n=kn(this.apiSet_,e.bladeController);this.apiSet_.remove(n)}}onRackInputChange_(e){const n=e.bladeController;if(n instanceof Me){const r=kn(this.apiSet_,n),_=n.binding;this.emitter_.emit("change",{event:new p(r,_.target.read(),_.target.presetKey,e.options.last)})}else if(n instanceof Ve){const r=kn(this.apiSet_,n);this.emitter_.emit("change",{event:new p(r,n.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof Se))throw O.shouldNeverHappen();const n=kn(this.apiSet_,e.bladeController),r=e.bladeController.binding;this.emitter_.emit("update",{event:new g(n,r.target.read(),r.target.presetKey)})}}class pn extends On{constructor(e,n){super(e,new wt(e.rackController,n)),this.emitter_=new R,this.controller_.foldable.value("expanded").emitter.on("change",r=>{this.emitter_.emit("fold",{event:new f(this,r.sender.rawValue)})}),this.rackApi_.on("change",r=>{this.emitter_.emit("change",{event:r})}),this.rackApi_.on("update",r=>{this.emitter_.emit("update",{event:r})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,n,r){return this.rackApi_.addInput(e,n,r)}addMonitor(e,n,r){return this.rackApi_.addMonitor(e,n,r)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,n){return this.rackApi_.add(e,n)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}}class jn extends ut{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class rs{constructor(e,n){const r=U(n.viewName);this.element=e.createElement("div"),this.element.classList.add(r()),n.viewProps.bindClassModifiers(this.element)}}function as(s,e){for(let n=0;n<s.length;n++){const r=s[n];if(r instanceof Me&&r.binding===e)return r}return null}function ls(s,e){for(let n=0;n<s.length;n++){const r=s[n];if(r instanceof Se&&r.binding===e)return r}return null}function zi(s,e){for(let n=0;n<s.length;n++){const r=s[n];if(r instanceof Ve&&r.value===e)return r}return null}function Fn(s){return s instanceof At?s.rack:s instanceof jn?s.rackController.rack:null}function cs(s){const e=Fn(s);return e?e.bcSet_:null}class ds{constructor(e){var n,r;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new R,this.blade_=(n=e.blade)!==null&&n!==void 0?n:null,(r=this.blade_)===null||r===void 0||r.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new Qt(cs),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,n){var r;(r=e.parent)===null||r===void 0||r.remove(e),I(e,"parent")?e.parent=this:(e.parent_=this,bt({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(e,n)}remove(e){I(e,"parent")?e.parent=null:(e.parent_=null,bt({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(n=>n instanceof e)}onSetAdd_(e){this.updatePositions_();const n=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:n,sender:this}),!n)return;const r=e.item;if(r.viewProps.emitter.on("change",this.onChildViewPropsChange_),r.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),r.viewProps.handleDispose(this.onChildDispose_),r instanceof Me)r.binding.emitter.on("change",this.onChildInputChange_);else if(r instanceof Se)r.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(r instanceof Ve)r.value.emitter.on("change",this.onChildValueChange_);else{const _=Fn(r);if(_){const k=_.emitter;k.on("layout",this.onDescendantLayout_),k.on("inputchange",this.onDescendantInputChange_),k.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const n=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:n,sender:this}),!n)return;const r=e.item;if(r instanceof Me)r.binding.emitter.off("change",this.onChildInputChange_);else if(r instanceof Se)r.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(r instanceof Ve)r.value.emitter.off("change",this.onChildValueChange_);else{const _=Fn(r);if(_){const k=_.emitter;k.off("layout",this.onDescendantLayout_),k.off("inputchange",this.onDescendantInputChange_),k.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter(_=>!_.viewProps.get("hidden")),n=e[0],r=e[e.length-1];this.bcSet_.items.forEach(_=>{const k=[];_===n&&(k.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&k.push("veryfirst")),_===r&&(k.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&k.push("verylast")),_.blade.set("positions",k)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(e=>e.viewProps.get("disposed")).forEach(e=>{this.bcSet_.remove(e)})}onChildInputChange_(e){const n=as(this.find(Me),e.sender);if(!n)throw O.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:n,options:e.options,sender:this})}onChildMonitorUpdate_(e){const n=ls(this.find(Se),e.sender);if(!n)throw O.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:n,sender:this})}onChildValueChange_(e){const n=zi(this.find(Ve),e.sender);if(!n)throw O.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:n,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class At extends ut{constructor(e,n){super(Object.assign(Object.assign({},n),{view:new rs(e,{viewName:"brk",viewProps:n.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=new ds({blade:n.root?void 0:n.blade,viewProps:n.viewProps});r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.rack=r,this.viewProps.handleDispose(()=>{for(let _=this.rack.children.length-1;_>=0;_--)this.rack.children[_].viewProps.set("disposed",!0)})}onRackAdd_(e){e.isRoot&&kt(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.isRoot&&hn(e.bladeController.view.element)}}const Mt=U("cnt");class he{constructor(e,n){var r;this.className_=U((r=n.viewName)!==null&&r!==void 0?r:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Mt()),n.viewProps.bindClassModifiers(this.element),this.foldable_=n.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),H(this.foldable_,"completed",X(this.element,this.className_(void 0,"cpl")));const _=e.createElement("button");_.classList.add(this.className_("b")),H(n.props,"title",ne=>{E(ne)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),n.viewProps.bindDisabled(_),this.element.appendChild(_),this.buttonElement=_;const k=e.createElement("div");k.classList.add(this.className_("i")),this.element.appendChild(k);const L=e.createElement("div");L.classList.add(this.className_("t")),oe(n.props.value("title"),L),this.buttonElement.appendChild(L),this.titleElement=L;const q=e.createElement("div");q.classList.add(this.className_("m")),this.buttonElement.appendChild(q);const ee=n.containerElement;ee.classList.add(this.className_("c")),this.element.appendChild(ee),this.containerElement=ee}}class An extends jn{constructor(e,n){var r;const _=Fe.create((r=n.expanded)!==null&&r!==void 0?r:!0),k=new At(e,{blade:n.blade,root:n.root,viewProps:n.viewProps});super(Object.assign(Object.assign({},n),{rackController:k,view:new he(e,{containerElement:k.view.element,foldable:_,props:n.props,viewName:n.root?"rot":void 0,viewProps:n.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=n.props,this.foldable=_,si(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Pe={id:"folder",type:"blade",accept(s){const e=be,n=Ee(s,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return n?{params:n}:null},controller(s){return new An(s.document,{blade:s.blade,expanded:s.params.expanded,props:ie.fromObject({title:s.params.title}),viewProps:s.viewProps})},api(s){return s.controller instanceof An?new pn(s.controller,s.pool):null}};class ae extends Ve{constructor(e,n){const r=n.valueController.viewProps;super(Object.assign(Object.assign({},n),{value:n.valueController.value,view:new re(e,{props:n.props,viewProps:r}),viewProps:r})),this.props=n.props,this.valueController=n.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class qe extends l{}const un=U("spr");class te{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(un()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("hr");r.classList.add(un("r")),this.element.appendChild(r)}}class xt extends ut{constructor(e,n){super(Object.assign(Object.assign({},n),{view:new te(e,{viewProps:n.viewProps})}))}}const hs={id:"separator",type:"blade",accept(s){const e=Ee(s,{view:be.required.constant("separator")});return e?{params:e}:null},controller(s){return new xt(s.document,{blade:s.blade,viewProps:s.viewProps})},api(s){return s.controller instanceof xt?new qe(s.controller):null}},Je=U("tbi");class Jt{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(Je()),n.viewProps.bindClassModifiers(this.element),H(n.props,"selected",k=>{k?this.element.classList.add(Je(void 0,"sel")):this.element.classList.remove(Je(void 0,"sel"))});const r=e.createElement("button");r.classList.add(Je("b")),n.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const _=e.createElement("div");_.classList.add(Je("t")),oe(n.props.value("title"),_),this.buttonElement.appendChild(_),this.titleElement=_}}class en{constructor(e,n){this.emitter=new R,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new Jt(e,{props:n.props,viewProps:n.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ci{constructor(e,n){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new en(e,{props:n.itemProps,viewProps:Ue.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new At(e,{blade:_t(),viewProps:Ue.create()}),this.props=n.props,H(this.props,"selected",r=>{this.itemController.props.set("selected",r),this.contentController.viewProps.set("hidden",!r)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class di{constructor(e,n){this.controller_=e,this.rackApi_=n}get title(){var e;return(e=this.controller_.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,n){this.rackApi_.add(e,n)}remove(e){this.rackApi_.remove(e)}addInput(e,n,r){return this.rackApi_.addInput(e,n,r)}addMonitor(e,n,r){return this.rackApi_.addMonitor(e,n,r)}addBlade(e){return this.rackApi_.addBlade(e)}}class hi extends On{constructor(e,n){super(e,new wt(e.rackController,n)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new R,this.pageApiMap_=new Map,this.rackApi_.on("change",r=>{this.emitter_.emit("change",{event:r})}),this.rackApi_.on("update",r=>{this.emitter_.emit("update",{event:r})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(r=>{this.setUpPageApi_(r)})}get pages(){return this.controller_.pageSet.items.map(e=>{const n=this.pageApiMap_.get(e);if(!n)throw O.shouldNeverHappen();return n})}addPage(e){const n=this.controller_.view.element.ownerDocument,r=new ci(n,{itemProps:ie.fromObject({selected:!1,title:e.title}),props:ie.fromObject({selected:!1})});this.controller_.add(r,e.index);const _=this.pageApiMap_.get(r);if(!_)throw O.shouldNeverHappen();return _}removePage(e){this.controller_.remove(e)}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}setUpPageApi_(e){const n=this.rackApi_.apiSet_.find(_=>_.controller_===e.contentController);if(!n)throw O.shouldNeverHappen();const r=new di(e,n);this.pageApiMap_.set(e,r)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw O.shouldNeverHappen();this.pageApiMap_.delete(e.item)}onSelect_(e){this.emitter_.emit("select",{event:new x(this,e.rawValue)})}}const Hn=-1;class tn{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ce(!0),this.selectedIndex=ce(Hn),this.items_=[]}add(e,n){const r=n??this.items_.length;this.items_.splice(r,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const n=this.items_.indexOf(e);n<0||(this.items_.splice(n,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Hn,this.empty.rawValue=!0;return}const e=this.items_.findIndex(n=>n.rawValue);e<0?(this.items_.forEach((n,r)=>{n.rawValue=r===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((n,r)=>{n.rawValue=r===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const n=this.items_.findIndex(r=>r===e.sender);this.items_.forEach((r,_)=>{r.rawValue=_===n}),this.selectedIndex.rawValue=n}else this.keepSelection_()}}const Tt=U("tab");class pi{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(Tt(),Mt()),n.viewProps.bindClassModifiers(this.element),z(n.empty,X(this.element,Tt(void 0,"nop")));const r=e.createElement("div");r.classList.add(Tt("t")),this.element.appendChild(r),this.itemsElement=r;const _=e.createElement("div");_.classList.add(Tt("i")),this.element.appendChild(_);const k=n.contentsElement;k.classList.add(Tt("c")),this.element.appendChild(k),this.contentsElement=k}}class nn extends jn{constructor(e,n){const r=new At(e,{blade:n.blade,viewProps:n.viewProps}),_=new tn;super({blade:n.blade,rackController:r,view:new pi(e,{contentsElement:r.view.element,empty:_.empty,viewProps:n.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new Qt(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=_}get pageSet(){return this.pageSet_}add(e,n){this.pageSet_.add(e,n)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}onPageAdd_(e){const n=e.item;kt(this.view.itemsElement,n.itemController.view.element,e.index),n.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(n.contentController,e.index),this.tab.add(n.props.value("selected"))}onPageRemove_(e){const n=e.item;hn(n.itemController.view.element),n.itemController.viewProps.set("parent",null),this.rackController.rack.remove(n.contentController),this.tab.remove(n.props.value("selected"))}}const ui={id:"tab",type:"blade",accept(s){const e=be,n=Ee(s,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return!n||n.pages.length===0?null:{params:n}},controller(s){const e=new nn(s.document,{blade:s.blade,viewProps:s.viewProps});return s.params.pages.forEach(n=>{const r=new ci(s.document,{itemProps:ie.fromObject({selected:!1,title:n.title}),props:ie.fromObject({selected:!1})});e.add(r)}),e},api(s){return s.controller instanceof nn?new hi(s.controller,s.pool):null}};function Bn(s,e){const n=s.accept(e.params);if(!n)return null;const r=be.optional.boolean(e.params.disabled).value,_=be.optional.boolean(e.params.hidden).value;return s.controller({blade:_t(),document:e.document,params:Object.assign(Object.assign({},n.params),{disabled:r,hidden:_}),viewProps:Ue.create({disabled:r,hidden:_})})}class Kn{constructor(){this.disabled=!1,this.emitter=new R}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class He{constructor(e,n){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new R,this.interval_=n,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Lt{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new R,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();e!==void 0&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function vn(s,e){for(;s.length<e;)s.push(void 0)}function at(s){const e=[];return vn(e,s),ce(e)}function ps(s){const e=s.indexOf(void 0);return e<0?s:s.slice(0,e)}function us(s,e){const n=[...ps(s),e];return n.length>s.length?n.splice(0,n.length-s.length):vn(n,s.length),n}class vi{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new R,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(e===void 0)return;const n=this.value.rawValue,r=this.reader_(e);this.value.rawValue=us(n,r),this.emitter.emit("update",{rawValue:r,sender:this})}onTick_(e){this.read()}}class Mn{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((n,r)=>r.constrain(n),e)}}function It(s,e){if(s instanceof e)return s;if(s instanceof Mn){const n=s.constraints.reduce((r,_)=>r||(_ instanceof e?_:null),null);if(n)return n}return null}class sn{constructor(e){this.values=ie.fromObject({max:e.max,min:e.min})}constrain(e){const n=this.values.get("max"),r=this.values.get("min");return Math.min(Math.max(e,r),n)}}class Tn{constructor(e){this.values=ie.fromObject({options:e})}get options(){return this.values.get("options")}constrain(e){const n=this.values.get("options");return n.length===0||n.filter(r=>r.value===e).length>0?e:n[0].value}}class mi{constructor(e){this.values=ie.fromObject({max:e.max,min:e.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(e){const n=this.values.get("max"),r=this.values.get("min");let _=e;return E(r)||(_=Math.max(_,r)),E(n)||(_=Math.min(_,n)),_}}class yt{constructor(e,n=0){this.step=e,this.origin=n}constrain(e){const n=this.origin%this.step,r=Math.round((e-n)/this.step);return n+r*this.step}}const gi=U("lst");class vs{constructor(e,n){this.onValueChange_=this.onValueChange_.bind(this),this.props_=n.props,this.element=e.createElement("div"),this.element.classList.add(gi()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("select");r.classList.add(gi("s")),H(this.props_,"options",k=>{jt(r),k.forEach((L,q)=>{const ee=e.createElement("option");ee.dataset.index=String(q),ee.textContent=L.text,ee.value=String(L.value),r.appendChild(ee)})}),n.viewProps.bindDisabled(r),this.element.appendChild(r),this.selectElement=r;const _=e.createElement("div");_.classList.add(gi("m")),_.appendChild(vt(e,"dropdown")),this.element.appendChild(_),n.value.emitter.on("change",this.onValueChange_),this.value_=n.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ft{constructor(e,n){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new vs(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const n=e.currentTarget.selectedOptions.item(0);if(!n)return;const r=Number(n.dataset.index);this.value.rawValue=this.props.get("options")[r].value}}const Ri=U("pop");class ms{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(Ri()),n.viewProps.bindClassModifiers(this.element),z(n.shows,X(this.element,Ri(void 0,"v")))}}class Vi{constructor(e,n){this.shows=ce(!1),this.viewProps=n.viewProps,this.view=new ms(e,{shows:this.shows,viewProps:this.viewProps})}}const St=U("txt");class gs{constructor(e,n){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(St()),n.viewProps.bindClassModifiers(this.element),this.props_=n.props,this.props_.emitter.on("change",this.onChange_);const r=e.createElement("input");r.classList.add(St("i")),r.type="text",n.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,n.value.emitter.on("change",this.onChange_),this.value_=n.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class mn{constructor(e,n){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=n.parser,this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new gs(e,{props:n.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=e.currentTarget.value,r=this.parser_(n);E(r)||(this.value.rawValue=r),this.view.refresh()}}function bi(s){return String(s)}function Ht(s){return s==="false"?!1:!!s}function Ln(s){return bi(s)}class Di{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const bs={"**":(s,e)=>Math.pow(s,e),"*":(s,e)=>s*e,"/":(s,e)=>s/e,"%":(s,e)=>s%e,"+":(s,e)=>s+e,"-":(s,e)=>s-e,"<<":(s,e)=>s<<e,">>":(s,e)=>s>>e,">>>":(s,e)=>s>>>e,"&":(s,e)=>s&e,"^":(s,e)=>s^e,"|":(s,e)=>s|e};class fs{constructor(e,n,r){this.left=n,this.operator=e,this.right=r}evaluate(){const e=bs[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const zt={"+":s=>s,"-":s=>-s,"~":s=>~s};class Oi{constructor(e,n){this.operator=e,this.expression=n}evaluate(){const e=zt[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function gn(s){return(e,n)=>{for(let r=0;r<s.length;r++){const _=s[r](e,n);if(_!=="")return _}return""}}function on(s,e){var n;const r=s.substr(e).match(/^\s+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function Ni(s,e){const n=s.substr(e,1);return n.match(/^[1-9]$/)?n:""}function bn(s,e){var n;const r=s.substr(e).match(/^[0-9]+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function w(s,e){const n=bn(s,e);if(n!=="")return n;const r=s.substr(e,1);if(e+=1,r!=="-"&&r!=="+")return"";const _=bn(s,e);return _===""?"":r+_}function c(s,e){const n=s.substr(e,1);if(e+=1,n.toLowerCase()!=="e")return"";const r=w(s,e);return r===""?"":n+r}function v(s,e){const n=s.substr(e,1);if(n==="0")return n;const r=Ni(s,e);return e+=r.length,r===""?"":r+bn(s,e)}function C(s,e){const n=v(s,e);if(e+=n.length,n==="")return"";const r=s.substr(e,1);if(e+=r.length,r!==".")return"";const _=bn(s,e);return e+=_.length,n+r+_+c(s,e)}function M(s,e){const n=s.substr(e,1);if(e+=n.length,n!==".")return"";const r=bn(s,e);return e+=r.length,r===""?"":n+r+c(s,e)}function D(s,e){const n=v(s,e);return e+=n.length,n===""?"":n+c(s,e)}const $=gn([C,M,D]);function W(s,e){var n;const r=s.substr(e).match(/^[01]+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function Z(s,e){const n=s.substr(e,2);if(e+=n.length,n.toLowerCase()!=="0b")return"";const r=W(s,e);return r===""?"":n+r}function Q(s,e){var n;const r=s.substr(e).match(/^[0-7]+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function pe(s,e){const n=s.substr(e,2);if(e+=n.length,n.toLowerCase()!=="0o")return"";const r=Q(s,e);return r===""?"":n+r}function Ce(s,e){var n;const r=s.substr(e).match(/^[0-9a-f]+/i);return(n=r&&r[0])!==null&&n!==void 0?n:""}function Be(s,e){const n=s.substr(e,2);if(e+=n.length,n.toLowerCase()!=="0x")return"";const r=Ce(s,e);return r===""?"":n+r}const De=gn([Z,pe,Be]),Xe=gn([De,$]);function mt(s,e){const n=Xe(s,e);return e+=n.length,n===""?null:{evaluable:new Di(n),cursor:e}}function ye(s,e){const n=s.substr(e,1);if(e+=n.length,n!=="(")return null;const r=_s(s,e);if(!r)return null;e=r.cursor,e+=on(s,e).length;const _=s.substr(e,1);return e+=_.length,_!==")"?null:{evaluable:r.evaluable,cursor:e}}function In(s,e){var n;return(n=mt(s,e))!==null&&n!==void 0?n:ye(s,e)}function rn(s,e){const n=In(s,e);if(n)return n;const r=s.substr(e,1);if(e+=r.length,r!=="+"&&r!=="-"&&r!=="~")return null;const _=rn(s,e);return _?(e=_.cursor,{cursor:e,evaluable:new Oi(r,_.evaluable)}):null}function po(s,e,n){n+=on(e,n).length;const r=s.filter(_=>e.startsWith(_,n))[0];return r?(n+=r.length,n+=on(e,n).length,{cursor:n,operator:r}):null}function Bs(s,e){return(n,r)=>{const _=s(n,r);if(!_)return null;r=_.cursor;let k=_.evaluable;for(;;){const L=po(e,n,r);if(!L)break;r=L.cursor;const q=s(n,r);if(!q)return null;r=q.cursor,k=new fs(L.operator,k,q.evaluable)}return k?{cursor:r,evaluable:k}:null}}const Ks=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((s,e)=>Bs(s,e),rn);function _s(s,e){return e+=on(s,e).length,Ks(s,e)}function Us(s){const e=_s(s,0);return!e||e.cursor+on(s,e.cursor).length!==s.length?null:e.evaluable}function lt(s){var e;const n=Us(s);return(e=n==null?void 0:n.evaluate())!==null&&e!==void 0?e:null}function ws(s){if(typeof s=="number")return s;if(typeof s=="string"){const e=lt(s);if(!E(e))return e}return 0}function xs(s){return String(s)}function Ze(s){return e=>e.toFixed(Math.max(Math.min(s,20),0))}const Gs=Ze(0);function fi(s){return Gs(s)+"%"}function ji(s){return String(s)}function ys(s){return s}function _i({primary:s,secondary:e,forward:n,backward:r}){let _=!1;function k(L){_||(_=!0,L(),_=!1)}s.emitter.on("change",L=>{k(()=>{e.setRawValue(n(s,e),L.options)})}),e.emitter.on("change",L=>{k(()=>{s.setRawValue(r(s,e),L.options)}),k(()=>{e.setRawValue(n(s,e),L.options)})}),k(()=>{e.setRawValue(n(s,e),{forceEmit:!1,last:!0})})}function ot(s,e){const n=s*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function Un(s){return{altKey:s.altKey,downKey:s.key==="ArrowDown",shiftKey:s.shiftKey,upKey:s.key==="ArrowUp"}}function Bt(s){return{altKey:s.altKey,downKey:s.key==="ArrowLeft",shiftKey:s.shiftKey,upKey:s.key==="ArrowRight"}}function wi(s){return s==="ArrowUp"||s==="ArrowDown"}function Cs(s){return wi(s)||s==="ArrowLeft"||s==="ArrowRight"}function xi(s,e){var n,r;const _=e.ownerDocument.defaultView,k=e.getBoundingClientRect();return{x:s.pageX-(((n=_&&_.scrollX)!==null&&n!==void 0?n:0)+k.left),y:s.pageY-(((r=_&&_.scrollY)!==null&&r!==void 0?r:0)+k.top)}}class Sn{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new R,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const n=this.elem_.getBoundingClientRect();return{bounds:{width:n.width,height:n.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var n;e.preventDefault(),(n=e.currentTarget)===null||n===void 0||n.focus();const r=this.elem_.ownerDocument;r.addEventListener("mousemove",this.onDocumentMouseMove_),r.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(xi(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(xi(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const n=this.elem_.ownerDocument;n.removeEventListener("mousemove",this.onDocumentMouseMove_),n.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(xi(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const n=e.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=n}onTouchMove_(e){const n=e.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=n}onTouchEnd_(e){var n;const r=(n=e.targetTouches.item(0))!==null&&n!==void 0?n:this.lastTouch_,_=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(r?{x:r.clientX-_.left,y:r.clientY-_.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Te(s,e,n,r,_){const k=(s-e)/(n-e);return r+k*(_-r)}function ct(s){return String(s.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ke(s,e,n){return Math.min(Math.max(s,e),n)}function Fi(s,e){return(s%e+e)%e}const dt=U("txt");class $s{constructor(e,n){this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(dt(),dt(void 0,"num")),n.arrayPosition&&this.element.classList.add(dt(void 0,n.arrayPosition)),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("input");r.classList.add(dt("i")),r.type="text",n.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=n.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(dt()),this.inputElement.classList.add(dt("i"));const _=e.createElement("div");_.classList.add(dt("k")),this.element.appendChild(_),this.knobElement=_;const k=e.createElementNS(Le,"svg");k.classList.add(dt("g")),this.knobElement.appendChild(k);const L=e.createElementNS(Le,"path");L.classList.add(dt("gb")),k.appendChild(L),this.guideBodyElem_=L;const q=e.createElementNS(Le,"path");q.classList.add(dt("gh")),k.appendChild(q),this.guideHeadElem_=q;const ee=e.createElement("div");ee.classList.add(U("tt")()),this.knobElement.appendChild(ee),this.tooltipElem_=ee,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(dt(void 0,"drg"));return}this.element.classList.add(dt(void 0,"drg"));const n=e.rawValue/this.props_.get("draggingScale"),r=n+(n>0?-1:n<0?1:0),_=Ke(-r,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${r+_},0 L${r},4 L${r+_},8`,`M ${n},-1 L${n},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${n},4`);const k=this.props_.get("formatter");this.tooltipElem_.textContent=k(this.value.rawValue),this.tooltipElem_.style.left=`${n}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Rt{constructor(e,n){var r;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=n.baseStep,this.parser_=n.parser,this.props=n.props,this.sliderProps_=(r=n.sliderProps)!==null&&r!==void 0?r:null,this.value=n.value,this.viewProps=n.viewProps,this.dragging_=ce(null),this.view=new $s(e,{arrayPosition:n.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const _=new Sn(this.view.knobElement);_.emitter.on("down",this.onPointerDown_),_.emitter.on("move",this.onPointerMove_),_.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var n,r;const _=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("minValue"),k=(r=this.sliderProps_)===null||r===void 0?void 0:r.get("maxValue");let L=e;return _!==void 0&&(L=Math.max(L,_)),k!==void 0&&(L=Math.min(L,k)),L}onInputChange_(e){const n=e.currentTarget.value,r=this.parser_(n);E(r)||(this.value.rawValue=this.constrainValue_(r)),this.view.refresh()}onInputKeyDown_(e){const n=ot(this.baseStep_,Un(e));n!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+n),{forceEmit:!1,last:!1})}onInputKeyUp_(e){ot(this.baseStep_,Un(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const n=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+n*this.props.get("draggingScale"))}onPointerMove_(e){const n=this.computeDraggingValue_(e.data);n!==null&&(this.value.setRawValue(n,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const n=this.computeDraggingValue_(e.data);n!==null&&(this.value.setRawValue(n,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Hi=U("sld");class qs{constructor(e,n){this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Hi()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(Hi("t")),n.viewProps.bindTabIndex(r),this.element.appendChild(r),this.trackElement=r;const _=e.createElement("div");_.classList.add(Hi("k")),this.trackElement.appendChild(_),this.knobElement=_,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.update_()}update_(){const e=Ke(Te(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Ys{constructor(e,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=n.baseStep,this.value=n.value,this.viewProps=n.viewProps,this.props=n.props,this.view=new qs(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,n){e.point&&this.value.setRawValue(Te(Ke(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),n)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const n=ot(this.baseStep_,Bt(e));n!==0&&this.value.setRawValue(this.value.rawValue+n,{forceEmit:!1,last:!1})}onKeyUp_(e){ot(this.baseStep_,Bt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Es=U("sldtxt");class uo{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(Es());const r=e.createElement("div");r.classList.add(Es("s")),this.sliderView_=n.sliderView,r.appendChild(this.sliderView_.element),this.element.appendChild(r);const _=e.createElement("div");_.classList.add(Es("t")),this.textView_=n.textView,_.appendChild(this.textView_.element),this.element.appendChild(_)}}class Ps{constructor(e,n){this.value=n.value,this.viewProps=n.viewProps,this.sliderC_=new Ys(e,{baseStep:n.baseStep,props:n.sliderProps,value:n.value,viewProps:this.viewProps}),this.textC_=new Rt(e,{baseStep:n.baseStep,parser:n.parser,props:n.textProps,sliderProps:n.sliderProps,value:n.value,viewProps:n.viewProps}),this.view=new uo(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function yi(s,e){s.write(e)}function Ci(s){const e=be;if(Array.isArray(s))return e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(s).value;if(typeof s=="object")return e.required.raw(s).value}function ks(s){if(s==="inline"||s==="popup")return s}function an(s){const e=be;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(s).value}function Gn(s){if(Array.isArray(s))return s;const e=[];return Object.keys(s).forEach(n=>{e.push({text:n,value:s[n]})}),e}function Bi(s){return E(s)?null:new Tn(Gn(s))}function Xs(s){const e=s?It(s,yt):null;return e?e.step:null}function zn(s,e){const n=s&&It(s,yt);return n?ct(n.step):Math.max(ct(e),2)}function $n(s){return Xs(s)??1}function fn(s,e){var n;const r=s&&It(s,yt),_=Math.abs((n=r==null?void 0:r.step)!==null&&n!==void 0?n:e);return _===0?.1:Math.pow(10,Math.floor(Math.log10(_))-1)}const Ki=U("ckb");class vo{constructor(e,n){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ki()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("label");r.classList.add(Ki("l")),this.element.appendChild(r);const _=e.createElement("input");_.classList.add(Ki("i")),_.type="checkbox",r.appendChild(_),this.inputElement=_,n.viewProps.bindDisabled(this.inputElement);const k=e.createElement("div");k.classList.add(Ki("w")),r.appendChild(k);const L=vt(e,"check");k.appendChild(L),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class mo{constructor(e,n){this.onInputChange_=this.onInputChange_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new vo(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=e.currentTarget;this.value.rawValue=n.checked}}function go(s){const e=[],n=Bi(s.options);return n&&e.push(n),new Mn(e)}const u={id:"input-bool",type:"input",accept:(s,e)=>{if(typeof s!="boolean")return null;const n=Ee(e,{options:be.optional.custom(Ci)});return n?{initialValue:s,params:n}:null},binding:{reader:s=>Ht,constraint:s=>go(s.params),writer:s=>yi},controller:s=>{const e=s.document,n=s.value,r=s.constraint,_=r&&It(r,Tn);return _?new Ft(e,{props:new ie({options:_.values.value("options")}),value:n,viewProps:s.viewProps}):new mo(e,{value:n,viewProps:s.viewProps})}},o=U("col");class d{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(o()),n.foldable.bindExpandedClass(this.element,o(void 0,"expanded")),H(n.foldable,"completed",X(this.element,o(void 0,"cpl")));const r=e.createElement("div");r.classList.add(o("h")),this.element.appendChild(r);const _=e.createElement("div");_.classList.add(o("s")),r.appendChild(_),this.swatchElement=_;const k=e.createElement("div");if(k.classList.add(o("t")),r.appendChild(k),this.textElement=k,n.pickerLayout==="inline"){const L=e.createElement("div");L.classList.add(o("p")),this.element.appendChild(L),this.pickerElement=L}else this.pickerElement=null}}function b(s,e,n){const r=Ke(s/255,0,1),_=Ke(e/255,0,1),k=Ke(n/255,0,1),L=Math.max(r,_,k),q=Math.min(r,_,k),ee=L-q;let ne=0,_e=0;const ke=(q+L)/2;return ee!==0&&(_e=ee/(1-Math.abs(L+q-1)),r===L?ne=(_-k)/ee:_===L?ne=2+(k-r)/ee:ne=4+(r-_)/ee,ne=ne/6+(ne<0?1:0)),[ne*360,_e*100,ke*100]}function P(s,e,n){const r=(s%360+360)%360,_=Ke(e/100,0,1),k=Ke(n/100,0,1),L=(1-Math.abs(2*k-1))*_,q=L*(1-Math.abs(r/60%2-1)),ee=k-L/2;let ne,_e,ke;return r>=0&&r<60?[ne,_e,ke]=[L,q,0]:r>=60&&r<120?[ne,_e,ke]=[q,L,0]:r>=120&&r<180?[ne,_e,ke]=[0,L,q]:r>=180&&r<240?[ne,_e,ke]=[0,q,L]:r>=240&&r<300?[ne,_e,ke]=[q,0,L]:[ne,_e,ke]=[L,0,q],[(ne+ee)*255,(_e+ee)*255,(ke+ee)*255]}function T(s,e,n){const r=Ke(s/255,0,1),_=Ke(e/255,0,1),k=Ke(n/255,0,1),L=Math.max(r,_,k),q=Math.min(r,_,k),ee=L-q;let ne;ee===0?ne=0:L===r?ne=60*(((_-k)/ee%6+6)%6):L===_?ne=60*((k-r)/ee+2):ne=60*((r-_)/ee+4);const _e=L===0?0:ee/L,ke=L;return[ne,_e*100,ke*100]}function j(s,e,n){const r=Fi(s,360),_=Ke(e/100,0,1),k=Ke(n/100,0,1),L=k*_,q=L*(1-Math.abs(r/60%2-1)),ee=k-L;let ne,_e,ke;return r>=0&&r<60?[ne,_e,ke]=[L,q,0]:r>=60&&r<120?[ne,_e,ke]=[q,L,0]:r>=120&&r<180?[ne,_e,ke]=[0,L,q]:r>=180&&r<240?[ne,_e,ke]=[0,q,L]:r>=240&&r<300?[ne,_e,ke]=[q,0,L]:[ne,_e,ke]=[L,0,q],[(ne+ee)*255,(_e+ee)*255,(ke+ee)*255]}function Y(s,e,n){const r=n+e*(100-Math.abs(2*n-100))/200;return[s,r!==0?e*(100-Math.abs(2*n-100))/r:0,n+e*(100-Math.abs(2*n-100))/(2*100)]}function fe(s,e,n){const r=100-Math.abs(n*(200-e)/100-100);return[s,r!==0?e*n/r:0,n*(200-e)/(2*100)]}function Ye(s){return[s[0],s[1],s[2]]}function Kt(s,e){return[s[0],s[1],s[2],e]}const As={hsl:{hsl:(s,e,n)=>[s,e,n],hsv:Y,rgb:P},hsv:{hsl:fe,hsv:(s,e,n)=>[s,e,n],rgb:j},rgb:{hsl:b,hsv:T,rgb:(s,e,n)=>[s,e,n]}};function Ui(s,e){return[e==="float"?1:s==="rgb"?255:360,e==="float"?1:s==="rgb"?255:100,e==="float"?1:s==="rgb"?255:100]}function bo(s,e){return s===e?e:Fi(s,e)}function Ol(s,e,n){var r;const _=Ui(e,n);return[e==="rgb"?Ke(s[0],0,_[0]):bo(s[0],_[0]),Ke(s[1],0,_[1]),Ke(s[2],0,_[2]),Ke((r=s[3])!==null&&r!==void 0?r:1,0,1)]}function kr(s,e,n,r){const _=Ui(e,n),k=Ui(e,r);return s.map((L,q)=>L/_[q]*k[q])}function Nl(s,e,n){const r=kr(s,e.mode,e.type,"int"),_=As[e.mode][n.mode](...r);return kr(_,n.mode,"int",n.type)}function Zs(s,e){return typeof s!="object"||E(s)?!1:e in s&&typeof s[e]=="number"}class de{static black(e="int"){return new de([0,0,0],"rgb",e)}static fromObject(e,n="int"){const r="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new de(r,"rgb",n)}static toRgbaObject(e,n="int"){return e.toRgbaObject(n)}static isRgbColorObject(e){return Zs(e,"r")&&Zs(e,"g")&&Zs(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&Zs(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,n){if(e.mode!==n.mode)return!1;const r=e.comps_,_=n.comps_;for(let k=0;k<r.length;k++)if(r[k]!==_[k])return!1;return!0}constructor(e,n,r="int"){this.mode=n,this.type=r,this.comps_=Ol(e,n,r)}getComponents(e,n="int"){return Kt(Nl(Ye(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:n}),this.comps_[3])}toRgbaObject(e="int"){const n=this.getComponents("rgb",e);return{r:n[0],g:n[1],b:n[2],a:n[3]}}}const qn=U("colp");class jl{constructor(e,n){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(qn()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(qn("hsv"));const _=e.createElement("div");_.classList.add(qn("sv")),this.svPaletteView_=n.svPaletteView,_.appendChild(this.svPaletteView_.element),r.appendChild(_);const k=e.createElement("div");k.classList.add(qn("h")),this.hPaletteView_=n.hPaletteView,k.appendChild(this.hPaletteView_.element),r.appendChild(k),this.element.appendChild(r);const L=e.createElement("div");if(L.classList.add(qn("rgb")),this.textView_=n.textView,L.appendChild(this.textView_.element),this.element.appendChild(L),n.alphaViews){this.alphaViews_={palette:n.alphaViews.palette,text:n.alphaViews.text};const q=e.createElement("div");q.classList.add(qn("a"));const ee=e.createElement("div");ee.classList.add(qn("ap")),ee.appendChild(this.alphaViews_.palette.element),q.appendChild(ee);const ne=e.createElement("div");ne.classList.add(qn("at")),ne.appendChild(this.alphaViews_.text.element),q.appendChild(ne),this.element.appendChild(q)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(n=>n.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Fl(s){return s==="int"?"int":s==="float"?"float":void 0}function fo(s){const e=be;return Ee(s,{alpha:e.optional.boolean,color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Fl)}),expanded:e.optional.boolean,picker:e.optional.custom(ks)})}function Ei(s){return s?.1:1}function Pi(s){var e;return(e=s.color)===null||e===void 0?void 0:e.type}function Hl(s,e){return s.alpha===e.alpha&&s.mode===e.mode&&s.notation===e.notation&&s.type===e.type}function Ut(s,e){const n=s.match(/^(.+)%$/);return Math.min(n?parseFloat(n[1])*.01*e:parseFloat(s),e)}const Bl={deg:s=>s,grad:s=>s*360/400,rad:s=>s*360/(2*Math.PI),turn:s=>s*360};function Ar(s){const e=s.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(s);const n=parseFloat(e[1]),r=e[2];return Bl[r](n)}function Mr(s){const e=s.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Ut(e[1],255),Ut(e[2],255),Ut(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Tr(s){return e=>{const n=Mr(e);return n?new de(n,"rgb",s):null}}function Lr(s){const e=s.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Ut(e[1],255),Ut(e[2],255),Ut(e[3],255),Ut(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Ir(s){return e=>{const n=Lr(e);return n?new de(n,"rgb",s):null}}function Sr(s){const e=s.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Ar(e[1]),Ut(e[2],100),Ut(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function zr(s){return e=>{const n=Sr(e);return n?new de(n,"hsl",s):null}}function Rr(s){const e=s.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Ar(e[1]),Ut(e[2],100),Ut(e[3],100),Ut(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Vr(s){return e=>{const n=Rr(e);return n?new de(n,"hsl",s):null}}function Dr(s){const e=s.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const n=s.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function Kl(s){const e=Dr(s);return e?new de(e,"rgb","int"):null}function Or(s){const e=s.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Te(parseInt(e[4]+e[4],16),0,255,0,1)];const n=s.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Te(parseInt(n[4],16),0,255,0,1)]:null}function Ul(s){const e=Or(s);return e?new de(e,"rgb","int"):null}function Nr(s){const e=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function jr(s){return e=>{const n=Nr(e);return n?new de(n,"rgb",s):null}}function Fr(s){const e=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Hr(s){return e=>{const n=Fr(e);return n?new de(n,"rgb",s):null}}const Gl=[{parser:Dr,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Or,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Mr,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Lr,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Sr,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Rr,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Nr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Fr,result:{alpha:!0,mode:"rgb",notation:"object"}}];function $l(s){return Gl.reduce((e,{parser:n,result:r})=>e||(n(s)?r:null),null)}function _o(s,e="int"){const n=$l(s);return n?n.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},n),{type:"int"}):n.notation==="func"?Object.assign(Object.assign({},n),{type:e}):null:null}const Br={int:[Kl,Ul,Tr("int"),Ir("int"),zr("int"),Vr("int"),jr("int"),Hr("int")],float:[Tr("float"),Ir("float"),zr("float"),Vr("float"),jr("float"),Hr("float")]};function ql(s){const e=Br[s];return n=>typeof n!="string"?de.black(s):e.reduce((_,k)=>_||k(n),null)??de.black(s)}function wo(s){const e=Br[s];return n=>e.reduce((r,_)=>r||_(n),null)}function Kr(s){const e=Ke(Math.floor(s),0,255).toString(16);return e.length===1?`0${e}`:e}function Ur(s,e="#"){const n=Ye(s.getComponents("rgb")).map(Kr).join("");return`${e}${n}`}function xo(s,e="#"){const n=s.getComponents("rgb"),r=[n[0],n[1],n[2],n[3]*255].map(Kr).join("");return`${e}${r}`}function Gr(s,e){const n=Ze(e==="float"?2:0);return`rgb(${Ye(s.getComponents("rgb",e)).map(r=>n(r)).join(", ")})`}function Yl(s){return e=>Gr(e,s)}function Ws(s,e){const n=Ze(2),r=Ze(e==="float"?2:0);return`rgba(${s.getComponents("rgb",e).map((_,k)=>(k===3?n:r)(_)).join(", ")})`}function Xl(s){return e=>Ws(e,s)}function Zl(s){const e=[Ze(0),fi,fi];return`hsl(${Ye(s.getComponents("hsl")).map((n,r)=>e[r](n)).join(", ")})`}function Wl(s){const e=[Ze(0),fi,fi,Ze(2)];return`hsla(${s.getComponents("hsl").map((n,r)=>e[r](n)).join(", ")})`}function $r(s,e){const n=Ze(e==="float"?2:0),r=["r","g","b"];return`{${Ye(s.getComponents("rgb",e)).map((_,k)=>`${r[k]}: ${n(_)}`).join(", ")}}`}function Ql(s){return e=>$r(e,s)}function qr(s,e){const n=Ze(2),r=Ze(e==="float"?2:0),_=["r","g","b","a"];return`{${s.getComponents("rgb",e).map((k,L)=>{const q=L===3?n:r;return`${_[L]}: ${q(k)}`}).join(", ")}}`}function Jl(s){return e=>qr(e,s)}const ec=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Ur},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:xo},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Zl},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Wl},...["int","float"].reduce((s,e)=>[...s,{format:{alpha:!1,mode:"rgb",notation:"func",type:e},stringifier:Yl(e)},{format:{alpha:!0,mode:"rgb",notation:"func",type:e},stringifier:Xl(e)},{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Ql(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Jl(e)}],[])];function yo(s){return ec.reduce((e,n)=>e||(Hl(n.format,s)?n.stringifier:null),null)}const Ms=U("apl");class tc{constructor(e,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ms()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);const r=e.createElement("div");r.classList.add(Ms("b")),this.element.appendChild(r);const _=e.createElement("div");_.classList.add(Ms("c")),r.appendChild(_),this.colorElem_=_;const k=e.createElement("div");k.classList.add(Ms("m")),this.element.appendChild(k),this.markerElem_=k;const L=e.createElement("div");L.classList.add(Ms("p")),this.markerElem_.appendChild(L),this.previewElem_=L,this.update_()}update_(){const e=this.value.rawValue,n=e.getComponents("rgb"),r=new de([n[0],n[1],n[2],0],"rgb"),_=new de([n[0],n[1],n[2],255],"rgb"),k=["to right",Ws(r),Ws(_)];this.colorElem_.style.background=`linear-gradient(${k.join(",")})`,this.previewElem_.style.backgroundColor=Ws(e);const L=Te(n[3],0,1,0,100);this.markerElem_.style.left=`${L}%`}onValueChange_(){this.update_()}}class nc{constructor(e,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new tc(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,n){if(!e.point)return;const r=e.point.x/e.bounds.width,_=this.value.rawValue,[k,L,q]=_.getComponents("hsv");this.value.setRawValue(new de([k,L,q,r],"hsv"),n)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const n=ot(Ei(!0),Bt(e));if(n===0)return;const r=this.value.rawValue,[_,k,L,q]=r.getComponents("hsv");this.value.setRawValue(new de([_,k,L,q+n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){ot(Ei(!0),Bt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Gi=U("coltxt");function ic(s){const e=s.createElement("select"),n=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return e.appendChild(n.reduce((r,_)=>{const k=s.createElement("option");return k.textContent=_.text,k.value=_.value,r.appendChild(k),r},s.createDocumentFragment())),e}class sc{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add(Gi()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(Gi("m")),this.modeElem_=ic(e),this.modeElem_.classList.add(Gi("ms")),r.appendChild(this.modeSelectElement),n.viewProps.bindDisabled(this.modeElem_);const _=e.createElement("div");_.classList.add(Gi("mm")),_.appendChild(vt(e,"dropdown")),r.appendChild(_),this.element.appendChild(r);const k=e.createElement("div");k.classList.add(Gi("w")),this.element.appendChild(k),this.textsElem_=k,this.textViews_=n.textViews,this.applyTextViews_(),z(n.colorMode,L=>{this.modeElem_.value=L})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){jt(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach(n=>{const r=e.createElement("div");r.classList.add(Gi("c")),r.appendChild(n.element),this.textsElem_.appendChild(r)})}}function oc(s){return Ze(s==="float"?2:0)}function rc(s,e,n){const r=Ui(s,e)[n];return new sn({min:0,max:r})}function Co(s,e,n){return new Rt(s,{arrayPosition:n===0?"fst":n===3-1?"lst":"mid",baseStep:Ei(!1),parser:e.parser,props:ie.fromObject({draggingScale:e.colorType==="float"?.01:1,formatter:oc(e.colorType)}),value:ce(0,{constraint:rc(e.colorMode,e.colorType,n)}),viewProps:e.viewProps})}class ac{constructor(e,n){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=n.colorType,this.parser_=n.parser,this.value=n.value,this.viewProps=n.viewProps,this.colorMode=ce(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new sc(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const n={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},r=[Co(e,n,0),Co(e,n,1),Co(e,n,2)];return r.forEach((_,k)=>{_i({primary:this.value,secondary:_.value,forward:L=>L.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[k],backward:(L,q)=>{const ee=this.colorMode.rawValue,ne=L.rawValue.getComponents(ee,this.colorType_);return ne[k]=q.rawValue,new de(Kt(Ye(ne),ne[3]),ee,this.colorType_)}})}),r}onModeSelectChange_(e){const n=e.currentTarget;this.colorMode.rawValue=n.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Eo=U("hpl");class lc{constructor(e,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Eo()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);const r=e.createElement("div");r.classList.add(Eo("c")),this.element.appendChild(r);const _=e.createElement("div");_.classList.add(Eo("m")),this.element.appendChild(_),this.markerElem_=_,this.update_()}update_(){const e=this.value.rawValue,[n]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=Gr(new de([n,100,100],"hsv"));const r=Te(n,0,360,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class cc{constructor(e,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new lc(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,n){if(!e.point)return;const r=Te(Ke(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),_=this.value.rawValue,[,k,L,q]=_.getComponents("hsv");this.value.setRawValue(new de([r,k,L,q],"hsv"),n)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const n=ot(Ei(!1),Bt(e));if(n===0)return;const r=this.value.rawValue,[_,k,L,q]=r.getComponents("hsv");this.value.setRawValue(new de([_+n,k,L,q],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){ot(Ei(!1),Bt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Po=U("svp"),Yr=64;class dc{constructor(e,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Po()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);const r=e.createElement("canvas");r.height=Yr,r.width=Yr,r.classList.add(Po("c")),this.element.appendChild(r),this.canvasElement=r;const _=e.createElement("div");_.classList.add(Po("m")),this.element.appendChild(_),this.markerElem_=_,this.update_()}update_(){const e=dn(this.canvasElement);if(!e)return;const n=this.value.rawValue.getComponents("hsv"),r=this.canvasElement.width,_=this.canvasElement.height,k=e.getImageData(0,0,r,_),L=k.data;for(let ne=0;ne<_;ne++)for(let _e=0;_e<r;_e++){const ke=Te(_e,0,r,0,100),ki=Te(ne,0,_,100,0),Ai=j(n[0],ke,ki),Xi=(ne*r+_e)*4;L[Xi]=Ai[0],L[Xi+1]=Ai[1],L[Xi+2]=Ai[2],L[Xi+3]=255}e.putImageData(k,0,0);const q=Te(n[1],0,100,0,100);this.markerElem_.style.left=`${q}%`;const ee=Te(n[2],0,100,100,0);this.markerElem_.style.top=`${ee}%`}onValueChange_(){this.update_()}}class hc{constructor(e,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new dc(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,n){if(!e.point)return;const r=Te(e.point.x,0,e.bounds.width,0,100),_=Te(e.point.y,0,e.bounds.height,100,0),[k,,,L]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new de([k,r,_,L],"hsv"),n)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Cs(e.key)&&e.preventDefault();const[n,r,_,k]=this.value.rawValue.getComponents("hsv"),L=Ei(!1),q=ot(L,Bt(e)),ee=ot(L,Un(e));q===0&&ee===0||this.value.setRawValue(new de([n,r+q,_+ee,k],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const n=Ei(!1),r=ot(n,Bt(e)),_=ot(n,Un(e));r===0&&_===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class pc{constructor(e,n){this.value=n.value,this.viewProps=n.viewProps,this.hPaletteC_=new cc(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new hc(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=n.supportsAlpha?{palette:new nc(e,{value:this.value,viewProps:this.viewProps}),text:new Rt(e,{parser:lt,baseStep:.1,props:ie.fromObject({draggingScale:.01,formatter:Ze(2)}),value:ce(0,{constraint:new sn({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&_i({primary:this.value,secondary:this.alphaIcs_.text.value,forward:r=>r.rawValue.getComponents()[3],backward:(r,_)=>{const k=r.rawValue.getComponents();return k[3]=_.rawValue,new de(k,r.rawValue.mode)}}),this.textC_=new ac(e,{colorType:n.colorType,parser:lt,value:this.value,viewProps:this.viewProps}),this.view=new jl(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:n.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const ko=U("colsw");class uc{constructor(e,n){this.onValueChange_=this.onValueChange_.bind(this),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.element=e.createElement("div"),this.element.classList.add(ko()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(ko("sw")),this.element.appendChild(r),this.swatchElem_=r;const _=e.createElement("button");_.classList.add(ko("b")),n.viewProps.bindDisabled(_),this.element.appendChild(_),this.buttonElement=_,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=xo(e)}onValueChange_(){this.update_()}}class vc{constructor(e,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new uc(e,{value:this.value,viewProps:this.viewProps})}}class Ao{constructor(e,n){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Fe.create(n.expanded),this.swatchC_=new vc(e,{value:this.value,viewProps:this.viewProps});const r=this.swatchC_.view.buttonElement;r.addEventListener("blur",this.onButtonBlur_),r.addEventListener("click",this.onButtonClick_),this.textC_=new mn(e,{parser:n.parser,props:ie.fromObject({formatter:n.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new d(e,{foldable:this.foldable_,pickerLayout:n.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=n.pickerLayout==="popup"?new Vi(e,{viewProps:this.viewProps}):null;const _=new pc(e,{colorType:n.colorType,supportsAlpha:n.supportsAlpha,value:this.value,viewProps:this.viewProps});_.view.allFocusableElements.forEach(k=>{k.addEventListener("blur",this.onPopupChildBlur_),k.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=_,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(_.view.element),_i({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:k=>k.rawValue,backward:(k,L)=>L.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),si(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const n=this.view.element,r=e.relatedTarget;(!r||!n.contains(r))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const n=this.popC_.view.element,r=y(e);r&&n.contains(r)||r&&r===this.swatchC_.view.buttonElement&&!Et(n.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function mc(s,e){return de.isColorObject(s)?de.fromObject(s,e):de.black(e)}function gc(s){return Ye(s.getComponents("rgb")).reduce((e,n)=>e<<8|Math.floor(n)&255,0)}function bc(s){return s.getComponents("rgb").reduce((e,n,r)=>{const _=Math.floor(r===3?n*255:n)&255;return e<<8|_},0)>>>0}function fc(s){return new de([s>>16&255,s>>8&255,s&255],"rgb")}function _c(s){return new de([s>>24&255,s>>16&255,s>>8&255,Te(s&255,0,255,0,1)],"rgb")}function wc(s){return typeof s!="number"?de.black():fc(s)}function xc(s){return typeof s!="number"?de.black():_c(s)}function yc(s){const e=yo(s);return e?(n,r)=>{yi(n,e(r))}:null}function Cc(s){const e=s?bc:gc;return(n,r)=>{yi(n,e(r))}}function Ec(s,e,n){const r=e.toRgbaObject(n);s.writeProperty("r",r.r),s.writeProperty("g",r.g),s.writeProperty("b",r.b),s.writeProperty("a",r.a)}function Pc(s,e,n){const r=e.toRgbaObject(n);s.writeProperty("r",r.r),s.writeProperty("g",r.g),s.writeProperty("b",r.b)}function kc(s,e){return(n,r)=>{s?Ec(n,r,e):Pc(n,r,e)}}function Mo(s){var e;return!!(s!=null&&s.alpha||!((e=s==null?void 0:s.color)===null||e===void 0)&&e.alpha)}function Ac(s){return s?e=>xo(e,"0x"):e=>Ur(e,"0x")}function Mc(s){return"color"in s||"view"in s&&s.view==="color"}const Tc={id:"input-color-number",type:"input",accept:(s,e)=>{if(typeof s!="number"||!Mc(e))return null;const n=fo(e);return n?{initialValue:s,params:n}:null},binding:{reader:s=>Mo(s.params)?xc:wc,equals:de.equals,writer:s=>Cc(Mo(s.params))},controller:s=>{const e=Mo(s.params),n="expanded"in s.params?s.params.expanded:void 0,r="picker"in s.params?s.params.picker:void 0;return new Ao(s.document,{colorType:"int",expanded:n??!1,formatter:Ac(e),parser:wo("int"),pickerLayout:r??"popup",supportsAlpha:e,value:s.value,viewProps:s.viewProps})}};function Lc(s){return de.isRgbaColorObject(s)}function Ic(s){return e=>mc(e,s)}function Sc(s,e){return n=>s?qr(n,e):$r(n,e)}const zc={id:"input-color-object",type:"input",accept:(s,e)=>{if(!de.isColorObject(s))return null;const n=fo(e);return n?{initialValue:s,params:n}:null},binding:{reader:s=>Ic(Pi(s.params)),equals:de.equals,writer:s=>kc(Lc(s.initialValue),Pi(s.params))},controller:s=>{var e;const n=de.isRgbaColorObject(s.initialValue),r="expanded"in s.params?s.params.expanded:void 0,_="picker"in s.params?s.params.picker:void 0,k=(e=Pi(s.params))!==null&&e!==void 0?e:"int";return new Ao(s.document,{colorType:k,expanded:r??!1,formatter:Sc(n,k),parser:wo(k),pickerLayout:_??"popup",supportsAlpha:n,value:s.value,viewProps:s.viewProps})}},Rc={id:"input-color-string",type:"input",accept:(s,e)=>{if(typeof s!="string"||"view"in e&&e.view==="text")return null;const n=_o(s,Pi(e));if(!n||!yo(n))return null;const r=fo(e);return r?{initialValue:s,params:r}:null},binding:{reader:s=>{var e;return ql((e=Pi(s.params))!==null&&e!==void 0?e:"int")},equals:de.equals,writer:s=>{const e=_o(s.initialValue,Pi(s.params));if(!e)throw O.shouldNeverHappen();const n=yc(e);if(!n)throw O.notBindable();return n}},controller:s=>{const e=_o(s.initialValue,Pi(s.params));if(!e)throw O.shouldNeverHappen();const n=yo(e);if(!n)throw O.shouldNeverHappen();const r="expanded"in s.params?s.params.expanded:void 0,_="picker"in s.params?s.params.picker:void 0;return new Ao(s.document,{colorType:e.type,expanded:r??!1,formatter:n,parser:wo(e.type),pickerLayout:_??"popup",supportsAlpha:e.alpha,value:s.value,viewProps:s.viewProps})}};class Yn{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const n=this.asm_.toComponents(e).map((r,_)=>{var k,L;return(L=(k=this.components[_])===null||k===void 0?void 0:k.constrain(r))!==null&&L!==void 0?L:r});return this.asm_.fromComponents(n)}}const Xr=U("pndtxt");class Vc{constructor(e,n){this.textViews=n.textViews,this.element=e.createElement("div"),this.element.classList.add(Xr()),this.textViews.forEach(r=>{const _=e.createElement("div");_.classList.add(Xr("a")),_.appendChild(r.element),this.element.appendChild(_)})}}function Dc(s,e,n){return new Rt(s,{arrayPosition:n===0?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,parser:e.parser,props:e.axes[n].textProps,value:ce(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}class To{constructor(e,n){this.value=n.value,this.viewProps=n.viewProps,this.acs_=n.axes.map((r,_)=>Dc(e,n,_)),this.acs_.forEach((r,_)=>{_i({primary:this.value,secondary:r.value,forward:k=>n.assembly.toComponents(k.rawValue)[_],backward:(k,L)=>{const q=n.assembly.toComponents(k.rawValue);return q[_]=L.rawValue,n.assembly.fromComponents(q)}})}),this.view=new Vc(e,{textViews:this.acs_.map(r=>r.view)})}}function Zr(s,e){return"step"in s&&!E(s.step)?new yt(s.step,e):null}function Wr(s){return!E(s.max)&&!E(s.min)?new sn({max:s.max,min:s.min}):!E(s.max)||!E(s.min)?new mi({max:s.max,min:s.min}):null}function Oc(s){const e=It(s,sn);if(e)return[e.values.get("min"),e.values.get("max")];const n=It(s,mi);return n?[n.minValue,n.maxValue]:[void 0,void 0]}function Nc(s,e){const n=[],r=Zr(s,e);r&&n.push(r);const _=Wr(s);_&&n.push(_);const k=Bi(s.options);return k&&n.push(k),new Mn(n)}const jc={id:"input-number",type:"input",accept:(s,e)=>{if(typeof s!="number")return null;const n=be,r=Ee(e,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(Ci),step:n.optional.number});return r?{initialValue:s,params:r}:null},binding:{reader:s=>ws,constraint:s=>Nc(s.params,s.initialValue),writer:s=>yi},controller:s=>{var e;const n=s.value,r=s.constraint,_=r&&It(r,Tn);if(_)return new Ft(s.document,{props:new ie({options:_.values.value("options")}),value:n,viewProps:s.viewProps});const k=(e="format"in s.params?s.params.format:void 0)!==null&&e!==void 0?e:Ze(zn(r,n.rawValue)),L=r&&It(r,sn);return L?new Ps(s.document,{baseStep:$n(r),parser:lt,sliderProps:new ie({maxValue:L.values.value("max"),minValue:L.values.value("min")}),textProps:ie.fromObject({draggingScale:fn(r,n.rawValue),formatter:k}),value:n,viewProps:s.viewProps}):new Rt(s.document,{baseStep:$n(r),parser:lt,props:ie.fromObject({draggingScale:fn(r,n.rawValue),formatter:k}),value:n,viewProps:s.viewProps})}};class Xn{constructor(e=0,n=0){this.x=e,this.y=n}getComponents(){return[this.x,this.y]}static isObject(e){if(E(e))return!1;const n=e.x,r=e.y;return!(typeof n!="number"||typeof r!="number")}static equals(e,n){return e.x===n.x&&e.y===n.y}toObject(){return{x:this.x,y:this.y}}}const Qr={toComponents:s=>s.getComponents(),fromComponents:s=>new Xn(...s)},$i=U("p2d");class Fc{constructor(e,n){this.element=e.createElement("div"),this.element.classList.add($i()),n.viewProps.bindClassModifiers(this.element),z(n.expanded,X(this.element,$i(void 0,"expanded")));const r=e.createElement("div");r.classList.add($i("h")),this.element.appendChild(r);const _=e.createElement("button");_.classList.add($i("b")),_.appendChild(vt(e,"p2dpad")),n.viewProps.bindDisabled(_),r.appendChild(_),this.buttonElement=_;const k=e.createElement("div");if(k.classList.add($i("t")),r.appendChild(k),this.textElement=k,n.pickerLayout==="inline"){const L=e.createElement("div");L.classList.add($i("p")),this.element.appendChild(L),this.pickerElement=L}else this.pickerElement=null}}const Zn=U("p2dp");class Hc{constructor(e,n){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=n.invertsY,this.maxValue_=n.maxValue,this.element=e.createElement("div"),this.element.classList.add(Zn()),n.layout==="popup"&&this.element.classList.add(Zn(void 0,"p")),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(Zn("p")),n.viewProps.bindTabIndex(r),this.element.appendChild(r),this.padElement=r;const _=e.createElementNS(Le,"svg");_.classList.add(Zn("g")),this.padElement.appendChild(_),this.svgElem_=_;const k=e.createElementNS(Le,"line");k.classList.add(Zn("ax")),k.setAttributeNS(null,"x1","0"),k.setAttributeNS(null,"y1","50%"),k.setAttributeNS(null,"x2","100%"),k.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(k);const L=e.createElementNS(Le,"line");L.classList.add(Zn("ax")),L.setAttributeNS(null,"x1","50%"),L.setAttributeNS(null,"y1","0"),L.setAttributeNS(null,"x2","50%"),L.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(L);const q=e.createElementNS(Le,"line");q.classList.add(Zn("l")),q.setAttributeNS(null,"x1","50%"),q.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(q),this.lineElem_=q;const ee=e.createElement("div");ee.classList.add(Zn("m")),this.padElement.appendChild(ee),this.markerElem_=ee,n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,n]=this.value.rawValue.getComponents(),r=this.maxValue_,_=Te(e,-r,+r,0,100),k=Te(n,-r,+r,0,100),L=this.invertsY_?100-k:k;this.lineElem_.setAttributeNS(null,"x2",`${_}%`),this.lineElem_.setAttributeNS(null,"y2",`${L}%`),this.markerElem_.style.left=`${_}%`,this.markerElem_.style.top=`${L}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Jr(s,e,n){return[ot(e[0],Bt(s)),ot(e[1],Un(s))*(n?1:-1)]}class Bc{constructor(e,n){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.baseSteps_=n.baseSteps,this.maxValue_=n.maxValue,this.invertsY_=n.invertsY,this.view=new Hc(e,{invertsY:this.invertsY_,layout:n.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,n){if(!e.point)return;const r=this.maxValue_,_=Te(e.point.x,0,e.bounds.width,-r,+r),k=Te(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-r,+r);this.value.setRawValue(new Xn(_,k),n)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Cs(e.key)&&e.preventDefault();const[n,r]=Jr(e,this.baseSteps_,this.invertsY_);n===0&&r===0||this.value.setRawValue(new Xn(this.value.rawValue.x+n,this.value.rawValue.y+r),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[n,r]=Jr(e,this.baseSteps_,this.invertsY_);n===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Kc{constructor(e,n){var r,_;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Fe.create(n.expanded),this.popC_=n.pickerLayout==="popup"?new Vi(e,{viewProps:this.viewProps}):null;const k=new Bc(e,{baseSteps:[n.axes[0].baseStep,n.axes[1].baseStep],invertsY:n.invertsY,layout:n.pickerLayout,maxValue:n.maxValue,value:this.value,viewProps:this.viewProps});k.view.allFocusableElements.forEach(L=>{L.addEventListener("blur",this.onPopupChildBlur_),L.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=k,this.textC_=new To(e,{assembly:Qr,axes:n.axes,parser:n.parser,value:this.value,viewProps:this.viewProps}),this.view=new Fc(e,{expanded:this.foldable_.value("expanded"),pickerLayout:n.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(r=this.view.buttonElement)===null||r===void 0||r.addEventListener("blur",this.onPadButtonBlur_),(_=this.view.buttonElement)===null||_===void 0||_.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),_i({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:L=>L.rawValue,backward:(L,q)=>q.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),si(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const n=this.view.element,r=e.relatedTarget;(!r||!n.contains(r))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const n=this.popC_.view.element,r=y(e);r&&n.contains(r)||r&&r===this.view.buttonElement&&!Et(n.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}class qi{constructor(e=0,n=0,r=0){this.x=e,this.y=n,this.z=r}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(E(e))return!1;const n=e.x,r=e.y,_=e.z;return!(typeof n!="number"||typeof r!="number"||typeof _!="number")}static equals(e,n){return e.x===n.x&&e.y===n.y&&e.z===n.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const ea={toComponents:s=>s.getComponents(),fromComponents:s=>new qi(...s)};function Uc(s){return qi.isObject(s)?new qi(s.x,s.y,s.z):new qi}function Gc(s,e){s.writeProperty("x",e.x),s.writeProperty("y",e.y),s.writeProperty("z",e.z)}function $c(s,e){return new Yn({assembly:ea,components:[Rn("x"in s?s.x:void 0,e.x),Rn("y"in s?s.y:void 0,e.y),Rn("z"in s?s.z:void 0,e.z)]})}function Lo(s,e){return{baseStep:$n(e),constraint:e,textProps:ie.fromObject({draggingScale:fn(e,s),formatter:Ze(zn(e,s))})}}const qc={id:"input-point3d",type:"input",accept:(s,e)=>{if(!qi.isObject(s))return null;const n=be,r=Ee(e,{x:n.optional.custom(an),y:n.optional.custom(an),z:n.optional.custom(an)});return r?{initialValue:s,params:r}:null},binding:{reader:s=>Uc,constraint:s=>$c(s.params,s.initialValue),equals:qi.equals,writer:s=>Gc},controller:s=>{const e=s.value,n=s.constraint;if(!(n instanceof Yn))throw O.shouldNeverHappen();return new To(s.document,{assembly:ea,axes:[Lo(e.rawValue.x,n.components[0]),Lo(e.rawValue.y,n.components[1]),Lo(e.rawValue.z,n.components[2])],parser:lt,value:e,viewProps:s.viewProps})}};class Yi{constructor(e=0,n=0,r=0,_=0){this.x=e,this.y=n,this.z=r,this.w=_}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(E(e))return!1;const n=e.x,r=e.y,_=e.z,k=e.w;return!(typeof n!="number"||typeof r!="number"||typeof _!="number"||typeof k!="number")}static equals(e,n){return e.x===n.x&&e.y===n.y&&e.z===n.z&&e.w===n.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const ta={toComponents:s=>s.getComponents(),fromComponents:s=>new Yi(...s)};function Yc(s){return Yi.isObject(s)?new Yi(s.x,s.y,s.z,s.w):new Yi}function Xc(s,e){s.writeProperty("x",e.x),s.writeProperty("y",e.y),s.writeProperty("z",e.z),s.writeProperty("w",e.w)}function Zc(s,e){return new Yn({assembly:ta,components:[Rn("x"in s?s.x:void 0,e.x),Rn("y"in s?s.y:void 0,e.y),Rn("z"in s?s.z:void 0,e.z),Rn("w"in s?s.w:void 0,e.w)]})}function Wc(s,e){return{baseStep:$n(e),constraint:e,textProps:ie.fromObject({draggingScale:fn(e,s),formatter:Ze(zn(e,s))})}}const Qc={id:"input-point4d",type:"input",accept:(s,e)=>{if(!Yi.isObject(s))return null;const n=be,r=Ee(e,{x:n.optional.custom(an),y:n.optional.custom(an),z:n.optional.custom(an),w:n.optional.custom(an)});return r?{initialValue:s,params:r}:null},binding:{reader:s=>Yc,constraint:s=>Zc(s.params,s.initialValue),equals:Yi.equals,writer:s=>Xc},controller:s=>{const e=s.value,n=s.constraint;if(!(n instanceof Yn))throw O.shouldNeverHappen();return new To(s.document,{assembly:ta,axes:e.rawValue.getComponents().map((r,_)=>Wc(r,n.components[_])),parser:lt,value:e,viewProps:s.viewProps})}};function Jc(s){const e=[],n=Bi(s.options);return n&&e.push(n),new Mn(e)}const ed={id:"input-string",type:"input",accept:(s,e)=>{if(typeof s!="string")return null;const n=Ee(e,{options:be.optional.custom(Ci)});return n?{initialValue:s,params:n}:null},binding:{reader:s=>ji,constraint:s=>Jc(s.params),writer:s=>yi},controller:s=>{const e=s.document,n=s.value,r=s.constraint,_=r&&It(r,Tn);return _?new Ft(e,{props:new ie({options:_.values.value("options")}),value:n,viewProps:s.viewProps}):new mn(e,{parser:k=>k,props:ie.fromObject({formatter:ys}),value:n,viewProps:s.viewProps})}},Ts={monitor:{defaultInterval:200,defaultLineCount:3}},na=U("mll");class td{constructor(e,n){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=e.createElement("div"),this.element.classList.add(na()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("textarea");r.classList.add(na("i")),r.style.height=`calc(var(--bld-us) * ${n.lineCount})`,r.readOnly=!0,n.viewProps.bindDisabled(r),this.element.appendChild(r),this.textareaElem_=r,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}update_(){const e=this.textareaElem_,n=e.scrollTop===e.scrollHeight-e.clientHeight,r=[];this.value.rawValue.forEach(_=>{_!==void 0&&r.push(this.formatter_(_))}),e.textContent=r.join(`
`),n&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class Io{constructor(e,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new td(e,{formatter:n.formatter,lineCount:n.lineCount,value:this.value,viewProps:this.viewProps})}}const ia=U("sgl");class nd{constructor(e,n){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=e.createElement("div"),this.element.classList.add(ia()),n.viewProps.bindClassModifiers(this.element);const r=e.createElement("input");r.classList.add(ia("i")),r.readOnly=!0,r.type="text",n.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}update_(){const e=this.value.rawValue,n=e[e.length-1];this.inputElement.value=n!==void 0?this.formatter_(n):""}onValueUpdate_(){this.update_()}}class So{constructor(e,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new nd(e,{formatter:n.formatter,value:this.value,viewProps:this.viewProps})}}const id={id:"monitor-bool",type:"monitor",accept:(s,e)=>{if(typeof s!="boolean")return null;const n=Ee(e,{lineCount:be.optional.number});return n?{initialValue:s,params:n}:null},binding:{reader:s=>Ht},controller:s=>{var e;return s.value.rawValue.length===1?new So(s.document,{formatter:Ln,value:s.value,viewProps:s.viewProps}):new Io(s.document,{formatter:Ln,lineCount:(e=s.params.lineCount)!==null&&e!==void 0?e:Ts.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}},Wn=U("grl");class sd{constructor(e,n){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Wn()),n.viewProps.bindClassModifiers(this.element),this.formatter_=n.formatter,this.props_=n.props,this.cursor_=n.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const r=e.createElementNS(Le,"svg");r.classList.add(Wn("g")),r.style.height=`calc(var(--bld-us) * ${n.lineCount})`,this.element.appendChild(r),this.svgElem_=r;const _=e.createElementNS(Le,"polyline");this.svgElem_.appendChild(_),this.lineElem_=_;const k=e.createElement("div");k.classList.add(Wn("t"),U("tt")()),this.element.appendChild(k),this.tooltipElem_=k,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),n=this.value.rawValue.length-1,r=this.props_.get("minValue"),_=this.props_.get("maxValue"),k=[];this.value.rawValue.forEach((_e,ke)=>{if(_e===void 0)return;const ki=Te(ke,0,n,0,e.width),Ai=Te(_e,r,_,e.height,0);k.push([ki,Ai].join(","))}),this.lineElem_.setAttributeNS(null,"points",k.join(" "));const L=this.tooltipElem_,q=this.value.rawValue[this.cursor_.rawValue];if(q===void 0){L.classList.remove(Wn("t","a"));return}const ee=Te(this.cursor_.rawValue,0,n,0,e.width),ne=Te(q,r,_,e.height,0);L.style.left=`${ee}px`,L.style.top=`${ne}px`,L.textContent=`${this.formatter_(q)}`,L.classList.contains(Wn("t","a"))||(L.classList.add(Wn("t","a"),Wn("t","in")),Re(L),L.classList.remove(Wn("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class od{constructor(e,n){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=n.props,this.value=n.value,this.viewProps=n.viewProps,this.cursor_=ce(-1),this.view=new sd(e,{cursor:this.cursor_,formatter:n.formatter,lineCount:n.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!Et(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const r=new Sn(this.view.element);r.emitter.on("down",this.onGraphPointerDown_),r.emitter.on("move",this.onGraphPointerMove_),r.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const n=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Te(e.offsetX,0,n.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Te(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function zo(s){return"format"in s&&!E(s.format)?s.format:Ze(2)}function rd(s){var e;return s.value.rawValue.length===1?new So(s.document,{formatter:zo(s.params),value:s.value,viewProps:s.viewProps}):new Io(s.document,{formatter:zo(s.params),lineCount:(e=s.params.lineCount)!==null&&e!==void 0?e:Ts.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}function ad(s){var e,n,r;return new od(s.document,{formatter:zo(s.params),lineCount:(e=s.params.lineCount)!==null&&e!==void 0?e:Ts.monitor.defaultLineCount,props:ie.fromObject({maxValue:(n="max"in s.params?s.params.max:null)!==null&&n!==void 0?n:100,minValue:(r="min"in s.params?s.params.min:null)!==null&&r!==void 0?r:0}),value:s.value,viewProps:s.viewProps})}function sa(s){return"view"in s&&s.view==="graph"}const ld={id:"monitor-number",type:"monitor",accept:(s,e)=>{if(typeof s!="number")return null;const n=be,r=Ee(e,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return r?{initialValue:s,params:r}:null},binding:{defaultBufferSize:s=>sa(s)?64:1,reader:s=>ws},controller:s=>sa(s.params)?ad(s):rd(s)},cd={id:"monitor-string",type:"monitor",accept:(s,e)=>{if(typeof s!="string")return null;const n=be,r=Ee(e,{lineCount:n.optional.number,multiline:n.optional.boolean});return r?{initialValue:s,params:r}:null},binding:{reader:s=>ji},controller:s=>{var e;const n=s.value;return n.rawValue.length>1||"multiline"in s.params&&s.params.multiline?new Io(s.document,{formatter:ys,lineCount:(e=s.params.lineCount)!==null&&e!==void 0?e:Ts.monitor.defaultLineCount,value:n,viewProps:s.viewProps}):new So(s.document,{formatter:ys,value:n,viewProps:s.viewProps})}};function dd(s,e){var n;const r=s.accept(e.target.read(),e.params);if(E(r))return null;const _=be,k={target:e.target,initialValue:r.initialValue,params:r.params},L=s.binding.reader(k),q=s.binding.constraint?s.binding.constraint(k):void 0,ee=ce(L(r.initialValue),{constraint:q,equals:s.binding.equals}),ne=new Lt({reader:L,target:e.target,value:ee,writer:s.binding.writer(k)}),_e=_.optional.boolean(e.params.disabled).value,ke=_.optional.boolean(e.params.hidden).value,ki=s.controller({constraint:q,document:e.document,initialValue:r.initialValue,params:r.params,value:ne.value,viewProps:Ue.create({disabled:_e,hidden:ke})});return new Me(e.document,{binding:ne,blade:_t(),props:ie.fromObject({label:"label"in e.params?(n=_.optional.string(e.params.label).value)!==null&&n!==void 0?n:null:e.target.key}),valueController:ki})}function hd(s,e){return e===0?new Kn:new He(s,e??Ts.monitor.defaultInterval)}function pd(s,e){var n,r,_;const k=be,L=s.accept(e.target.read(),e.params);if(E(L))return null;const q={target:e.target,initialValue:L.initialValue,params:L.params},ee=s.binding.reader(q),ne=(r=(n=k.optional.number(e.params.bufferSize).value)!==null&&n!==void 0?n:s.binding.defaultBufferSize&&s.binding.defaultBufferSize(L.params))!==null&&r!==void 0?r:1,_e=k.optional.number(e.params.interval).value,ke=new vi({reader:ee,target:e.target,ticker:hd(e.document,_e),value:at(ne)}),ki=k.optional.boolean(e.params.disabled).value,Ai=k.optional.boolean(e.params.hidden).value,Xi=s.controller({document:e.document,params:L.params,value:ke.value,viewProps:Ue.create({disabled:ki,hidden:Ai})});return new Se(e.document,{binding:ke,blade:_t(),props:ie.fromObject({label:"label"in e.params?(_=k.optional.string(e.params.label).value)!==null&&_!==void 0?_:null:e.target.key}),valueController:Xi})}class ud{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){e.type==="blade"?this.pluginsMap_.blades.unshift(e):e.type==="input"?this.pluginsMap_.inputs.unshift(e):e.type==="monitor"&&this.pluginsMap_.monitors.unshift(e)}createInput(e,n,r){const _=n.read();if(E(_))throw new O({context:{key:n.key},type:"nomatchingcontroller"});const k=this.pluginsMap_.inputs.reduce((L,q)=>L??dd(q,{document:e,target:n,params:r}),null);if(k)return k;throw new O({context:{key:n.key},type:"nomatchingcontroller"})}createMonitor(e,n,r){const _=this.pluginsMap_.monitors.reduce((k,L)=>k??pd(L,{document:e,params:r,target:n}),null);if(_)return _;throw new O({context:{key:n.key},type:"nomatchingcontroller"})}createBlade(e,n){const r=this.pluginsMap_.blades.reduce((_,k)=>_??Bn(k,{document:e,params:n}),null);if(!r)throw new O({type:"nomatchingview",context:{params:n}});return r}createBladeApi(e){if(e instanceof Me)return new Pn(e);if(e instanceof Se)return new ai(e);if(e instanceof At)return new wt(e,this);const n=this.pluginsMap_.blades.reduce((r,_)=>r??_.api({controller:e,pool:this}),null);if(!n)throw O.shouldNeverHappen();return n}}function vd(){const s=new ud;return[wd,qc,Qc,ed,jc,Rc,zc,Tc,u,id,cd,ld,it,Pe,hs,ui].forEach(e=>{s.register(e)}),s}function md(s){return Xn.isObject(s)?new Xn(s.x,s.y):new Xn}function gd(s,e){s.writeProperty("x",e.x),s.writeProperty("y",e.y)}function Rn(s,e){if(!s)return;const n=[],r=Zr(s,e);r&&n.push(r);const _=Wr(s);return _&&n.push(_),new Mn(n)}function bd(s,e){return new Yn({assembly:Qr,components:[Rn("x"in s?s.x:void 0,e.x),Rn("y"in s?s.y:void 0,e.y)]})}function oa(s,e){const[n,r]=s?Oc(s):[];if(!E(n)||!E(r))return Math.max(Math.abs(n??0),Math.abs(r??0));const _=$n(s);return Math.max(Math.abs(_)*10,Math.abs(e)*10)}function fd(s,e){const n=e instanceof Yn?e.components[0]:void 0,r=e instanceof Yn?e.components[1]:void 0,_=oa(n,s.x),k=oa(r,s.y);return Math.max(_,k)}function ra(s,e){return{baseStep:$n(e),constraint:e,textProps:ie.fromObject({draggingScale:fn(e,s),formatter:Ze(zn(e,s))})}}function _d(s){if(!("y"in s))return!1;const e=s.y;return e&&"inverted"in e?!!e.inverted:!1}const wd={id:"input-point2d",type:"input",accept:(s,e)=>{if(!Xn.isObject(s))return null;const n=be,r=Ee(e,{expanded:n.optional.boolean,picker:n.optional.custom(ks),x:n.optional.custom(an),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return r?{initialValue:s,params:r}:null},binding:{reader:s=>md,constraint:s=>bd(s.params,s.initialValue),equals:Xn.equals,writer:s=>gd},controller:s=>{const e=s.document,n=s.value,r=s.constraint;if(!(r instanceof Yn))throw O.shouldNeverHappen();const _="expanded"in s.params?s.params.expanded:void 0,k="picker"in s.params?s.params.picker:void 0;return new Kc(e,{axes:[ra(n.rawValue.x,r.components[0]),ra(n.rawValue.y,r.components[1])],expanded:_??!1,invertsY:_d(s.params),maxValue:fd(n.rawValue,r),parser:lt,pickerLayout:k??"popup",value:n,viewProps:s.viewProps})}};class aa extends l{constructor(e){super(e),this.emitter_=new R,this.controller_.valueController.value.emitter.on("change",n=>{this.emitter_.emit("change",{event:new p(this,n.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}}class la extends l{constructor(e){super(e),this.emitter_=new R,this.controller_.valueController.value.emitter.on("change",n=>{this.emitter_.emit("change",{event:new p(this,n.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}}class ca extends l{constructor(e){super(e),this.emitter_=new R,this.controller_.valueController.value.emitter.on("change",n=>{this.emitter_.emit("change",{event:new p(this,n.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,n){const r=n.bind(this);return this.emitter_.on(e,_=>{r(_.event)}),this}}const xd=function(){return{id:"list",type:"blade",accept(s){const e=be,n=Ee(s,{options:e.required.custom(Ci),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return n?{params:n}:null},controller(s){const e=new Tn(Gn(s.params.options)),n=ce(s.params.value,{constraint:e}),r=new Ft(s.document,{props:new ie({options:e.values.value("options")}),value:n,viewProps:s.viewProps});return new ae(s.document,{blade:s.blade,props:ie.fromObject({label:s.params.label}),valueController:r})},api(s){return!(s.controller instanceof ae)||!(s.controller.valueController instanceof Ft)?null:new aa(s.controller)}}}();function yd(s){return s.reduce((e,n)=>Object.assign(e,{[n.presetKey]:n.read()}),{})}function Cd(s,e){s.forEach(n=>{const r=e[n.target.presetKey];r!==void 0&&n.writer(n.target,n.reader(r))})}class Ed extends pn{constructor(e,n){super(e,n)}get element(){return this.controller_.view.element}importPreset(e){const n=this.controller_.rackController.rack.find(Me).map(r=>r.binding);Cd(n,e),this.refresh()}exportPreset(){const e=this.controller_.rackController.rack.find(Me).map(n=>n.binding.target);return yd(e)}refresh(){this.controller_.rackController.rack.find(Me).forEach(e=>{e.binding.read()}),this.controller_.rackController.rack.find(Se).forEach(e=>{e.binding.read()})}}class Pd extends An{constructor(e,n){super(e,{expanded:n.expanded,blade:n.blade,props:n.props,root:!0,viewProps:n.viewProps})}}const kd={id:"slider",type:"blade",accept(s){const e=be,n=Ee(s,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return n?{params:n}:null},controller(s){var e,n;const r=(e=s.params.value)!==null&&e!==void 0?e:0,_=new sn({max:s.params.max,min:s.params.min}),k=new Ps(s.document,{baseStep:1,parser:lt,sliderProps:new ie({maxValue:_.values.value("max"),minValue:_.values.value("min")}),textProps:ie.fromObject({draggingScale:fn(void 0,r),formatter:(n=s.params.format)!==null&&n!==void 0?n:xs}),value:ce(r,{constraint:_}),viewProps:s.viewProps});return new ae(s.document,{blade:s.blade,props:ie.fromObject({label:s.params.label}),valueController:k})},api(s){return!(s.controller instanceof ae)||!(s.controller.valueController instanceof Ps)?null:new la(s.controller)}},Ad=function(){return{id:"text",type:"blade",accept(s){const e=be,n=Ee(s,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return n?{params:n}:null},controller(s){var e;const n=new mn(s.document,{parser:s.params.parse,props:ie.fromObject({formatter:(e=s.params.format)!==null&&e!==void 0?e:r=>String(r)}),value:ce(s.params.value),viewProps:s.viewProps});return new ae(s.document,{blade:s.blade,props:ie.fromObject({label:s.params.label}),valueController:n})},api(s){return!(s.controller instanceof ae)||!(s.controller.valueController instanceof mn)?null:new ca(s.controller)}}}();function Md(s){const e=s.createElement("div");return e.classList.add(U("dfw")()),s.body&&s.body.appendChild(e),e}function da(s,e,n){if(s.querySelector(`style[data-tp-style=${e}]`))return;const r=s.createElement("style");r.dataset.tpStyle=e,r.textContent=n,s.head.appendChild(r)}class Td extends Ed{constructor(e){var n,r;const _=e??{},k=(n=_.document)!==null&&n!==void 0?n:Pt(),L=vd(),q=new Pd(k,{expanded:_.expanded,blade:_t(),props:ie.fromObject({title:_.title}),viewProps:Ue.create()});super(q,L),this.pool_=L,this.containerElem_=(r=_.container)!==null&&r!==void 0?r:Md(k),this.containerElem_.appendChild(this.element),this.doc_=k,this.usesDefaultWrapper_=!_.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw O.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw O.alreadyDisposed();if(this.usesDefaultWrapper_){const n=e.parentElement;n&&n.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(n=>{this.pool_.register(n),this.embedPluginStyle_(n)})}embedPluginStyle_(e){e.css&&da(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){da(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(e=>{this.embedPluginStyle_(e)}),this.registerPlugin({plugins:[kd,xd,ui,Ad]})}}const Ld=new i("3.1.9");t.BladeApi=l,t.ButtonApi=F,t.FolderApi=pn,t.InputBindingApi=Pn,t.ListApi=aa,t.MonitorBindingApi=ai,t.Pane=Td,t.SeparatorApi=qe,t.SliderApi=la,t.TabApi=hi,t.TabPageApi=di,t.TextApi=ca,t.TpChangeEvent=p,t.VERSION=Ld,Object.defineProperty(t,"__esModule",{value:!0})})})(sr,sr.exports);var ss=sr.exports;function ua(m,a){if(a===Zd)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),m;if(a===ir||a===rl){let t=m.getIndex();if(t===null){const p=[],g=m.getAttribute("position");if(g!==void 0){for(let f=0;f<g.count;f++)p.push(f);m.setIndex(p),t=m.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),m}const i=t.count-2,l=[];if(a===ir)for(let p=1;p<=i;p++)l.push(t.getX(0)),l.push(t.getX(p)),l.push(t.getX(p+1));else for(let p=0;p<i;p++)p%2===0?(l.push(t.getX(p)),l.push(t.getX(p+1)),l.push(t.getX(p+2))):(l.push(t.getX(p+2)),l.push(t.getX(p+1)),l.push(t.getX(p)));l.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const h=m.clone();return h.setIndex(l),h.clearGroups(),h}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",a),m}class wl extends Vd{constructor(a){super(a),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Jh(t)}),this.register(function(t){return new ap(t)}),this.register(function(t){return new lp(t)}),this.register(function(t){return new cp(t)}),this.register(function(t){return new tp(t)}),this.register(function(t){return new np(t)}),this.register(function(t){return new ip(t)}),this.register(function(t){return new sp(t)}),this.register(function(t){return new Qh(t)}),this.register(function(t){return new op(t)}),this.register(function(t){return new ep(t)}),this.register(function(t){return new rp(t)}),this.register(function(t){return new Zh(t)}),this.register(function(t){return new dp(t)}),this.register(function(t){return new hp(t)})}load(a,t,i,l){const h=this;let p;this.resourcePath!==""?p=this.resourcePath:this.path!==""?p=this.path:p=Jo.extractUrlBase(a),this.manager.itemStart(a);const g=function(x){l?l(x):console.error(x),h.manager.itemError(a),h.manager.itemEnd(a)},f=new pr(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(a,function(x){try{h.parse(x,p,function(E){t(E),h.manager.itemEnd(a)},g)}catch(E){g(E)}},i,g)}setDRACOLoader(a){return this.dracoLoader=a,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(a){return this.ktx2Loader=a,this}setMeshoptDecoder(a){return this.meshoptDecoder=a,this}register(a){return this.pluginCallbacks.indexOf(a)===-1&&this.pluginCallbacks.push(a),this}unregister(a){return this.pluginCallbacks.indexOf(a)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(a),1),this}parse(a,t,i,l){let h;const p={},g={},f=new TextDecoder;if(typeof a=="string")h=JSON.parse(a);else if(a instanceof ArrayBuffer)if(f.decode(new Uint8Array(a,0,4))===xl){try{p[ve.KHR_BINARY_GLTF]=new pp(a)}catch(E){l&&l(E);return}h=JSON.parse(p[ve.KHR_BINARY_GLTF].content)}else h=JSON.parse(f.decode(a));else h=a;if(h.asset===void 0||h.asset.version[0]<2){l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const x=new Pp(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});x.fileLoader.setRequestHeader(this.requestHeader);for(let E=0;E<this.pluginCallbacks.length;E++){const A=this.pluginCallbacks[E](x);g[A.name]=A,p[A.name]=!0}if(h.extensionsUsed)for(let E=0;E<h.extensionsUsed.length;++E){const A=h.extensionsUsed[E],I=h.extensionsRequired||[];switch(A){case ve.KHR_MATERIALS_UNLIT:p[A]=new Wh;break;case ve.KHR_DRACO_MESH_COMPRESSION:p[A]=new up(h,this.dracoLoader);break;case ve.KHR_TEXTURE_TRANSFORM:p[A]=new vp;break;case ve.KHR_MESH_QUANTIZATION:p[A]=new mp;break;default:I.indexOf(A)>=0&&g[A]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+A+'".')}}x.setExtensions(p),x.setPlugins(g),x.parse(i,l)}parseAsync(a,t){const i=this;return new Promise(function(l,h){i.parse(a,t,l,h)})}}function Xh(){let m={};return{get:function(a){return m[a]},add:function(a,t){m[a]=t},remove:function(a){delete m[a]},removeAll:function(){m={}}}}const ve={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Zh{constructor(a){this.parser=a,this.name=ve.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const a=this.parser,t=this.parser.json.nodes||[];for(let i=0,l=t.length;i<l;i++){const h=t[i];h.extensions&&h.extensions[this.name]&&h.extensions[this.name].light!==void 0&&a._addNodeRef(this.cache,h.extensions[this.name].light)}}_loadLight(a){const t=this.parser,i="light:"+a;let l=t.cache.get(i);if(l)return l;const h=t.json,p=((h.extensions&&h.extensions[this.name]||{}).lights||[])[a];let g;const f=new Yt(16777215);p.color!==void 0&&f.fromArray(p.color);const x=p.range!==void 0?p.range:0;switch(p.type){case"directional":g=new io(f),g.target.position.set(0,0,-1),g.add(g.target);break;case"point":g=new Ja(f),g.distance=x;break;case"spot":g=new er(f),g.distance=x,p.spot=p.spot||{},p.spot.innerConeAngle=p.spot.innerConeAngle!==void 0?p.spot.innerConeAngle:0,p.spot.outerConeAngle=p.spot.outerConeAngle!==void 0?p.spot.outerConeAngle:Math.PI/4,g.angle=p.spot.outerConeAngle,g.penumbra=1-p.spot.innerConeAngle/p.spot.outerConeAngle,g.target.position.set(0,0,-1),g.add(g.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+p.type)}return g.position.set(0,0,0),g.decay=2,ti(g,p),p.intensity!==void 0&&(g.intensity=p.intensity),g.name=t.createUniqueName(p.name||"light_"+a),l=Promise.resolve(g),t.cache.add(i,l),l}getDependency(a,t){if(a==="light")return this._loadLight(t)}createNodeAttachment(a){const t=this,i=this.parser,l=i.json.nodes[a],h=(l.extensions&&l.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(p){return i._getNodeRef(t.cache,h,p)})}}class Wh{constructor(){this.name=ve.KHR_MATERIALS_UNLIT}getMaterialType(){return xn}extendParams(a,t,i){const l=[];a.color=new Yt(1,1,1),a.opacity=1;const h=t.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const p=h.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}h.baseColorTexture!==void 0&&l.push(i.assignTexture(a,"map",h.baseColorTexture,Ds))}return Promise.all(l)}}class Qh{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(a,t){const i=this.parser.json.materials[a];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const l=i.extensions[this.name].emissiveStrength;return l!==void 0&&(t.emissiveIntensity=l),Promise.resolve()}}class Jh{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_CLEARCOAT}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser,l=i.json.materials[a];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],p=l.extensions[this.name];if(p.clearcoatFactor!==void 0&&(t.clearcoat=p.clearcoatFactor),p.clearcoatTexture!==void 0&&h.push(i.assignTexture(t,"clearcoatMap",p.clearcoatTexture)),p.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=p.clearcoatRoughnessFactor),p.clearcoatRoughnessTexture!==void 0&&h.push(i.assignTexture(t,"clearcoatRoughnessMap",p.clearcoatRoughnessTexture)),p.clearcoatNormalTexture!==void 0&&(h.push(i.assignTexture(t,"clearcoatNormalMap",p.clearcoatNormalTexture)),p.clearcoatNormalTexture.scale!==void 0)){const g=p.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ne(g,g)}return Promise.all(h)}}class ep{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_IRIDESCENCE}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser,l=i.json.materials[a];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],p=l.extensions[this.name];return p.iridescenceFactor!==void 0&&(t.iridescence=p.iridescenceFactor),p.iridescenceTexture!==void 0&&h.push(i.assignTexture(t,"iridescenceMap",p.iridescenceTexture)),p.iridescenceIor!==void 0&&(t.iridescenceIOR=p.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),p.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=p.iridescenceThicknessMinimum),p.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=p.iridescenceThicknessMaximum),p.iridescenceThicknessTexture!==void 0&&h.push(i.assignTexture(t,"iridescenceThicknessMap",p.iridescenceThicknessTexture)),Promise.all(h)}}class tp{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_SHEEN}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser,l=i.json.materials[a];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[];t.sheenColor=new Yt(0,0,0),t.sheenRoughness=0,t.sheen=1;const p=l.extensions[this.name];return p.sheenColorFactor!==void 0&&t.sheenColor.fromArray(p.sheenColorFactor),p.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=p.sheenRoughnessFactor),p.sheenColorTexture!==void 0&&h.push(i.assignTexture(t,"sheenColorMap",p.sheenColorTexture,Ds)),p.sheenRoughnessTexture!==void 0&&h.push(i.assignTexture(t,"sheenRoughnessMap",p.sheenRoughnessTexture)),Promise.all(h)}}class np{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_TRANSMISSION}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser,l=i.json.materials[a];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],p=l.extensions[this.name];return p.transmissionFactor!==void 0&&(t.transmission=p.transmissionFactor),p.transmissionTexture!==void 0&&h.push(i.assignTexture(t,"transmissionMap",p.transmissionTexture)),Promise.all(h)}}class ip{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_VOLUME}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser,l=i.json.materials[a];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],p=l.extensions[this.name];t.thickness=p.thicknessFactor!==void 0?p.thicknessFactor:0,p.thicknessTexture!==void 0&&h.push(i.assignTexture(t,"thicknessMap",p.thicknessTexture)),t.attenuationDistance=p.attenuationDistance||1/0;const g=p.attenuationColor||[1,1,1];return t.attenuationColor=new Yt(g[0],g[1],g[2]),Promise.all(h)}}class sp{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_IOR}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser.json.materials[a];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const l=i.extensions[this.name];return t.ior=l.ior!==void 0?l.ior:1.5,Promise.resolve()}}class op{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_SPECULAR}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser,l=i.json.materials[a];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],p=l.extensions[this.name];t.specularIntensity=p.specularFactor!==void 0?p.specularFactor:1,p.specularTexture!==void 0&&h.push(i.assignTexture(t,"specularIntensityMap",p.specularTexture));const g=p.specularColorFactor||[1,1,1];return t.specularColor=new Yt(g[0],g[1],g[2]),p.specularColorTexture!==void 0&&h.push(i.assignTexture(t,"specularColorMap",p.specularColorTexture,Ds)),Promise.all(h)}}class rp{constructor(a){this.parser=a,this.name=ve.KHR_MATERIALS_ANISOTROPY}getMaterialType(a){const t=this.parser.json.materials[a];return!t.extensions||!t.extensions[this.name]?null:Vt}extendMaterialParams(a,t){const i=this.parser,l=i.json.materials[a];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],p=l.extensions[this.name];return p.anisotropyStrength!==void 0&&(t.anisotropy=p.anisotropyStrength),p.anisotropyRotation!==void 0&&(t.anisotropyRotation=p.anisotropyRotation),p.anisotropyTexture!==void 0&&h.push(i.assignTexture(t,"anisotropyMap",p.anisotropyTexture)),Promise.all(h)}}class ap{constructor(a){this.parser=a,this.name=ve.KHR_TEXTURE_BASISU}loadTexture(a){const t=this.parser,i=t.json,l=i.textures[a];if(!l.extensions||!l.extensions[this.name])return null;const h=l.extensions[this.name],p=t.options.ktx2Loader;if(!p){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(a,h.source,p)}}class lp{constructor(a){this.parser=a,this.name=ve.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(a){const t=this.name,i=this.parser,l=i.json,h=l.textures[a];if(!h.extensions||!h.extensions[t])return null;const p=h.extensions[t],g=l.images[p.source];let f=i.textureLoader;if(g.uri){const x=i.options.manager.getHandler(g.uri);x!==null&&(f=x)}return this.detectSupport().then(function(x){if(x)return i.loadTextureImage(a,p.source,f);if(l.extensionsRequired&&l.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(a)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(a){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){a(t.height===1)}})),this.isSupported}}class cp{constructor(a){this.parser=a,this.name=ve.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(a){const t=this.name,i=this.parser,l=i.json,h=l.textures[a];if(!h.extensions||!h.extensions[t])return null;const p=h.extensions[t],g=l.images[p.source];let f=i.textureLoader;if(g.uri){const x=i.options.manager.getHandler(g.uri);x!==null&&(f=x)}return this.detectSupport().then(function(x){if(x)return i.loadTextureImage(a,p.source,f);if(l.extensionsRequired&&l.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(a)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(a){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){a(t.height===1)}})),this.isSupported}}class dp{constructor(a){this.name=ve.EXT_MESHOPT_COMPRESSION,this.parser=a}loadBufferView(a){const t=this.parser.json,i=t.bufferViews[a];if(i.extensions&&i.extensions[this.name]){const l=i.extensions[this.name],h=this.parser.getDependency("buffer",l.buffer),p=this.parser.options.meshoptDecoder;if(!p||!p.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return h.then(function(g){const f=l.byteOffset||0,x=l.byteLength||0,E=l.count,A=l.byteStride,I=new Uint8Array(g,f,x);return p.decodeGltfBufferAsync?p.decodeGltfBufferAsync(E,A,I,l.mode,l.filter).then(function(V){return V.buffer}):p.ready.then(function(){const V=new ArrayBuffer(E*A);return p.decodeGltfBuffer(new Uint8Array(V),E,A,I,l.mode,l.filter),V})})}else return null}}class hp{constructor(a){this.name=ve.EXT_MESH_GPU_INSTANCING,this.parser=a}createNodeMesh(a){const t=this.parser.json,i=t.nodes[a];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const l=t.meshes[i.mesh];for(const f of l.primitives)if(f.mode!==Gt.TRIANGLES&&f.mode!==Gt.TRIANGLE_STRIP&&f.mode!==Gt.TRIANGLE_FAN&&f.mode!==void 0)return null;const h=i.extensions[this.name].attributes,p=[],g={};for(const f in h)p.push(this.parser.getDependency("accessor",h[f]).then(x=>(g[f]=x,g[f])));return p.length<1?null:(p.push(this.parser.createNodeMesh(a)),Promise.all(p).then(f=>{const x=f.pop(),E=x.isGroup?x.children:[x],A=f[0].count,I=[];for(const V of E){const O=new is,G=new ge,F=new Dn,R=new ge(1,1,1),K=new Dd(V.geometry,V.material,A);for(let U=0;U<A;U++)g.TRANSLATION&&G.fromBufferAttribute(g.TRANSLATION,U),g.ROTATION&&F.fromBufferAttribute(g.ROTATION,U),g.SCALE&&R.fromBufferAttribute(g.SCALE,U),K.setMatrixAt(U,O.compose(G,F,R));for(const U in g)U!=="TRANSLATION"&&U!=="ROTATION"&&U!=="SCALE"&&V.geometry.setAttribute(U,g[U]);Ct.prototype.copy.call(K,V),this.parser.assignFinalMaterial(K),I.push(K)}return x.isGroup?(x.clear(),x.add(...I),x):I[0]}))}}const xl="glTF",Ls=12,va={JSON:1313821514,BIN:5130562};class pp{constructor(a){this.name=ve.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(a,0,Ls),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(a.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==xl)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const l=this.header.length-Ls,h=new DataView(a,Ls);let p=0;for(;p<l;){const g=h.getUint32(p,!0);p+=4;const f=h.getUint32(p,!0);if(p+=4,f===va.JSON){const x=new Uint8Array(a,Ls+p,g);this.content=i.decode(x)}else if(f===va.BIN){const x=Ls+p;this.body=a.slice(x,x+g)}p+=g}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class up{constructor(a,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ve.KHR_DRACO_MESH_COMPRESSION,this.json=a,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(a,t){const i=this.json,l=this.dracoLoader,h=a.extensions[this.name].bufferView,p=a.extensions[this.name].attributes,g={},f={},x={};for(const E in p){const A=or[E]||E.toLowerCase();g[A]=p[E]}for(const E in a.attributes){const A=or[E]||E.toLowerCase();if(p[E]!==void 0){const I=i.accessors[a.attributes[E]],V=ns[I.componentType];x[A]=V.name,f[A]=I.normalized===!0}}return t.getDependency("bufferView",h).then(function(E){return new Promise(function(A){l.decodeDracoFile(E,function(I){for(const V in I.attributes){const O=I.attributes[V],G=f[V];G!==void 0&&(O.normalized=G)}A(I)},g,x)})})}}class vp{constructor(){this.name=ve.KHR_TEXTURE_TRANSFORM}extendTexture(a,t){return(t.texCoord===void 0||t.texCoord===a.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(a=a.clone(),t.texCoord!==void 0&&(a.channel=t.texCoord),t.offset!==void 0&&a.offset.fromArray(t.offset),t.rotation!==void 0&&(a.rotation=t.rotation),t.scale!==void 0&&a.repeat.fromArray(t.scale),a.needsUpdate=!0),a}}class mp{constructor(){this.name=ve.KHR_MESH_QUANTIZATION}}class yl extends ih{constructor(a,t,i,l){super(a,t,i,l)}copySampleValue_(a){const t=this.resultBuffer,i=this.sampleValues,l=this.valueSize,h=a*l*3+l;for(let p=0;p!==l;p++)t[p]=i[h+p];return t}interpolate_(a,t,i,l){const h=this.resultBuffer,p=this.sampleValues,g=this.valueSize,f=g*2,x=g*3,E=l-t,A=(i-t)/E,I=A*A,V=I*A,O=a*x,G=O-x,F=-2*V+3*I,R=V-I,K=1-F,U=R-I+A;for(let le=0;le!==g;le++){const N=p[G+le+g],z=p[G+le+f]*E,H=p[O+le+g],J=p[O+le]*E;h[le]=K*N+U*z+F*H+R*J}return h}}const gp=new Dn;class bp extends yl{interpolate_(a,t,i,l){const h=super.interpolate_(a,t,i,l);return gp.fromArray(h).normalize().toArray(h),h}}const Gt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ns={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ma={9728:al,9729:ur,9984:ll,9985:cl,9986:dl,9987:vr},ga={33071:hl,33648:pl,10497:so},Oo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},or={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Qn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fp={CUBICSPLINE:void 0,LINEAR:sl,STEP:Wd},No={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function _p(m){return m.DefaultMaterial===void 0&&(m.DefaultMaterial=new ts({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ul})),m.DefaultMaterial}function Mi(m,a,t){for(const i in t.extensions)m[i]===void 0&&(a.userData.gltfExtensions=a.userData.gltfExtensions||{},a.userData.gltfExtensions[i]=t.extensions[i])}function ti(m,a){a.extras!==void 0&&(typeof a.extras=="object"?Object.assign(m.userData,a.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+a.extras))}function wp(m,a,t){let i=!1,l=!1,h=!1;for(let x=0,E=a.length;x<E;x++){const A=a[x];if(A.POSITION!==void 0&&(i=!0),A.NORMAL!==void 0&&(l=!0),A.COLOR_0!==void 0&&(h=!0),i&&l&&h)break}if(!i&&!l&&!h)return Promise.resolve(m);const p=[],g=[],f=[];for(let x=0,E=a.length;x<E;x++){const A=a[x];if(i){const I=A.POSITION!==void 0?t.getDependency("accessor",A.POSITION):m.attributes.position;p.push(I)}if(l){const I=A.NORMAL!==void 0?t.getDependency("accessor",A.NORMAL):m.attributes.normal;g.push(I)}if(h){const I=A.COLOR_0!==void 0?t.getDependency("accessor",A.COLOR_0):m.attributes.color;f.push(I)}}return Promise.all([Promise.all(p),Promise.all(g),Promise.all(f)]).then(function(x){const E=x[0],A=x[1],I=x[2];return i&&(m.morphAttributes.position=E),l&&(m.morphAttributes.normal=A),h&&(m.morphAttributes.color=I),m.morphTargetsRelative=!0,m})}function xp(m,a){if(m.updateMorphTargets(),a.weights!==void 0)for(let t=0,i=a.weights.length;t<i;t++)m.morphTargetInfluences[t]=a.weights[t];if(a.extras&&Array.isArray(a.extras.targetNames)){const t=a.extras.targetNames;if(m.morphTargetInfluences.length===t.length){m.morphTargetDictionary={};for(let i=0,l=t.length;i<l;i++)m.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function yp(m){let a;const t=m.extensions&&m.extensions[ve.KHR_DRACO_MESH_COMPRESSION];if(t?a="draco:"+t.bufferView+":"+t.indices+":"+jo(t.attributes):a=m.indices+":"+jo(m.attributes)+":"+m.mode,m.targets!==void 0)for(let i=0,l=m.targets.length;i<l;i++)a+=":"+jo(m.targets[i]);return a}function jo(m){let a="";const t=Object.keys(m).sort();for(let i=0,l=t.length;i<l;i++)a+=t[i]+":"+m[t[i]]+";";return a}function rr(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Cp(m){return m.search(/\.jpe?g($|\?)/i)>0||m.search(/^data\:image\/jpeg/)===0?"image/jpeg":m.search(/\.webp($|\?)/i)>0||m.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ep=new is;class Pp{constructor(a={},t={}){this.json=a,this.extensions={},this.plugins={},this.options=t,this.cache=new Xh,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,l=!1,h=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,l=navigator.userAgent.indexOf("Firefox")>-1,h=l?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||l&&h<98?this.textureLoader=new Wa(this.options.manager):this.textureLoader=new Od(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new pr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(a){this.extensions=a}setPlugins(a){this.plugins=a}parse(a,t){const i=this,l=this.json,h=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(p){return p._markDefs&&p._markDefs()}),Promise.all(this._invokeAll(function(p){return p.beforeRoot&&p.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(p){const g={scene:p[0][l.scene||0],scenes:p[0],animations:p[1],cameras:p[2],asset:l.asset,parser:i,userData:{}};Mi(h,g,l),ti(g,l),Promise.all(i._invokeAll(function(f){return f.afterRoot&&f.afterRoot(g)})).then(function(){a(g)})}).catch(t)}_markDefs(){const a=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let l=0,h=t.length;l<h;l++){const p=t[l].joints;for(let g=0,f=p.length;g<f;g++)a[p[g]].isBone=!0}for(let l=0,h=a.length;l<h;l++){const p=a[l];p.mesh!==void 0&&(this._addNodeRef(this.meshCache,p.mesh),p.skin!==void 0&&(i[p.mesh].isSkinnedMesh=!0)),p.camera!==void 0&&this._addNodeRef(this.cameraCache,p.camera)}}_addNodeRef(a,t){t!==void 0&&(a.refs[t]===void 0&&(a.refs[t]=a.uses[t]=0),a.refs[t]++)}_getNodeRef(a,t,i){if(a.refs[t]<=1)return i;const l=i.clone(),h=(p,g)=>{const f=this.associations.get(p);f!=null&&this.associations.set(g,f);for(const[x,E]of p.children.entries())h(E,g.children[x])};return h(i,l),l.name+="_instance_"+a.uses[t]++,l}_invokeOne(a){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const l=a(t[i]);if(l)return l}return null}_invokeAll(a){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let l=0;l<t.length;l++){const h=a(t[l]);h&&i.push(h)}return i}getDependency(a,t){const i=a+":"+t;let l=this.cache.get(i);if(!l){switch(a){case"scene":l=this.loadScene(t);break;case"node":l=this._invokeOne(function(h){return h.loadNode&&h.loadNode(t)});break;case"mesh":l=this._invokeOne(function(h){return h.loadMesh&&h.loadMesh(t)});break;case"accessor":l=this.loadAccessor(t);break;case"bufferView":l=this._invokeOne(function(h){return h.loadBufferView&&h.loadBufferView(t)});break;case"buffer":l=this.loadBuffer(t);break;case"material":l=this._invokeOne(function(h){return h.loadMaterial&&h.loadMaterial(t)});break;case"texture":l=this._invokeOne(function(h){return h.loadTexture&&h.loadTexture(t)});break;case"skin":l=this.loadSkin(t);break;case"animation":l=this._invokeOne(function(h){return h.loadAnimation&&h.loadAnimation(t)});break;case"camera":l=this.loadCamera(t);break;default:if(l=this._invokeOne(function(h){return h!=this&&h.getDependency&&h.getDependency(a,t)}),!l)throw new Error("Unknown type: "+a);break}this.cache.add(i,l)}return l}getDependencies(a){let t=this.cache.get(a);if(!t){const i=this,l=this.json[a+(a==="mesh"?"es":"s")]||[];t=Promise.all(l.map(function(h,p){return i.getDependency(a,p)})),this.cache.add(a,t)}return t}loadBuffer(a){const t=this.json.buffers[a],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&a===0)return Promise.resolve(this.extensions[ve.KHR_BINARY_GLTF].body);const l=this.options;return new Promise(function(h,p){i.load(Jo.resolveURL(t.uri,l.path),h,void 0,function(){p(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(a){const t=this.json.bufferViews[a];return this.getDependency("buffer",t.buffer).then(function(i){const l=t.byteLength||0,h=t.byteOffset||0;return i.slice(h,h+l)})}loadAccessor(a){const t=this,i=this.json,l=this.json.accessors[a];if(l.bufferView===void 0&&l.sparse===void 0){const p=Oo[l.type],g=ns[l.componentType],f=l.normalized===!0,x=new g(l.count*p);return Promise.resolve(new Ro(x,p,f))}const h=[];return l.bufferView!==void 0?h.push(this.getDependency("bufferView",l.bufferView)):h.push(null),l.sparse!==void 0&&(h.push(this.getDependency("bufferView",l.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",l.sparse.values.bufferView))),Promise.all(h).then(function(p){const g=p[0],f=Oo[l.type],x=ns[l.componentType],E=x.BYTES_PER_ELEMENT,A=E*f,I=l.byteOffset||0,V=l.bufferView!==void 0?i.bufferViews[l.bufferView].byteStride:void 0,O=l.normalized===!0;let G,F;if(V&&V!==A){const R=Math.floor(I/V),K="InterleavedBuffer:"+l.bufferView+":"+l.componentType+":"+R+":"+l.count;let U=t.cache.get(K);U||(G=new x(g,R*V,l.count*V/E),U=new Nd(G,V/E),t.cache.add(K,U)),F=new Qd(U,f,I%V/E,O)}else g===null?G=new x(l.count*f):G=new x(g,I,l.count*f),F=new Ro(G,f,O);if(l.sparse!==void 0){const R=Oo.SCALAR,K=ns[l.sparse.indices.componentType],U=l.sparse.indices.byteOffset||0,le=l.sparse.values.byteOffset||0,N=new K(p[1],U,l.sparse.count*R),z=new x(p[2],le,l.sparse.count*f);g!==null&&(F=new Ro(F.array.slice(),F.itemSize,F.normalized));for(let H=0,J=N.length;H<J;H++){const X=N[H];if(F.setX(X,z[H*f]),f>=2&&F.setY(X,z[H*f+1]),f>=3&&F.setZ(X,z[H*f+2]),f>=4&&F.setW(X,z[H*f+3]),f>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return F})}loadTexture(a){const t=this.json,i=this.options,l=t.textures[a].source,h=t.images[l];let p=this.textureLoader;if(h.uri){const g=i.manager.getHandler(h.uri);g!==null&&(p=g)}return this.loadTextureImage(a,l,p)}loadTextureImage(a,t,i){const l=this,h=this.json,p=h.textures[a],g=h.images[t],f=(g.uri||g.bufferView)+":"+p.sampler;if(this.textureCache[f])return this.textureCache[f];const x=this.loadImageSource(t,i).then(function(E){E.flipY=!1,E.name=p.name||g.name||"",E.name===""&&typeof g.uri=="string"&&g.uri.startsWith("data:image/")===!1&&(E.name=g.uri);const A=(h.samplers||{})[p.sampler]||{};return E.magFilter=ma[A.magFilter]||ur,E.minFilter=ma[A.minFilter]||vr,E.wrapS=ga[A.wrapS]||so,E.wrapT=ga[A.wrapT]||so,l.associations.set(E,{textures:a}),E}).catch(function(){return null});return this.textureCache[f]=x,x}loadImageSource(a,t){const i=this,l=this.json,h=this.options;if(this.sourceCache[a]!==void 0)return this.sourceCache[a].then(A=>A.clone());const p=l.images[a],g=self.URL||self.webkitURL;let f=p.uri||"",x=!1;if(p.bufferView!==void 0)f=i.getDependency("bufferView",p.bufferView).then(function(A){x=!0;const I=new Blob([A],{type:p.mimeType});return f=g.createObjectURL(I),f});else if(p.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+a+" is missing URI and bufferView");const E=Promise.resolve(f).then(function(A){return new Promise(function(I,V){let O=I;t.isImageBitmapLoader===!0&&(O=function(G){const F=new tr(G);F.needsUpdate=!0,I(F)}),t.load(Jo.resolveURL(A,h.path),O,void 0,V)})}).then(function(A){return x===!0&&g.revokeObjectURL(f),A.userData.mimeType=p.mimeType||Cp(p.uri),A}).catch(function(A){throw console.error("THREE.GLTFLoader: Couldn't load texture",f),A});return this.sourceCache[a]=E,E}assignTexture(a,t,i,l){const h=this;return this.getDependency("texture",i.index).then(function(p){if(!p)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(p=p.clone(),p.channel=i.texCoord),h.extensions[ve.KHR_TEXTURE_TRANSFORM]){const g=i.extensions!==void 0?i.extensions[ve.KHR_TEXTURE_TRANSFORM]:void 0;if(g){const f=h.associations.get(p);p=h.extensions[ve.KHR_TEXTURE_TRANSFORM].extendTexture(p,g),h.associations.set(p,f)}}return l!==void 0&&(p.colorSpace=l),a[t]=p,p})}assignFinalMaterial(a){const t=a.geometry;let i=a.material;const l=t.attributes.tangent===void 0,h=t.attributes.color!==void 0,p=t.attributes.normal===void 0;if(a.isPoints){const g="PointsMaterial:"+i.uuid;let f=this.cache.get(g);f||(f=new el,ii.prototype.copy.call(f,i),f.color.copy(i.color),f.map=i.map,f.sizeAttenuation=!1,this.cache.add(g,f)),i=f}else if(a.isLine){const g="LineBasicMaterial:"+i.uuid;let f=this.cache.get(g);f||(f=new mr,ii.prototype.copy.call(f,i),f.color.copy(i.color),f.map=i.map,this.cache.add(g,f)),i=f}if(l||h||p){let g="ClonedMaterial:"+i.uuid+":";l&&(g+="derivative-tangents:"),h&&(g+="vertex-colors:"),p&&(g+="flat-shading:");let f=this.cache.get(g);f||(f=i.clone(),h&&(f.vertexColors=!0),p&&(f.flatShading=!0),l&&(f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(g,f),this.associations.set(f,this.associations.get(i))),i=f}a.material=i}getMaterialType(){return ts}loadMaterial(a){const t=this,i=this.json,l=this.extensions,h=i.materials[a];let p;const g={},f=h.extensions||{},x=[];if(f[ve.KHR_MATERIALS_UNLIT]){const A=l[ve.KHR_MATERIALS_UNLIT];p=A.getMaterialType(),x.push(A.extendParams(g,h,t))}else{const A=h.pbrMetallicRoughness||{};if(g.color=new Yt(1,1,1),g.opacity=1,Array.isArray(A.baseColorFactor)){const I=A.baseColorFactor;g.color.fromArray(I),g.opacity=I[3]}A.baseColorTexture!==void 0&&x.push(t.assignTexture(g,"map",A.baseColorTexture,Ds)),g.metalness=A.metallicFactor!==void 0?A.metallicFactor:1,g.roughness=A.roughnessFactor!==void 0?A.roughnessFactor:1,A.metallicRoughnessTexture!==void 0&&(x.push(t.assignTexture(g,"metalnessMap",A.metallicRoughnessTexture)),x.push(t.assignTexture(g,"roughnessMap",A.metallicRoughnessTexture))),p=this._invokeOne(function(I){return I.getMaterialType&&I.getMaterialType(a)}),x.push(Promise.all(this._invokeAll(function(I){return I.extendMaterialParams&&I.extendMaterialParams(a,g)})))}h.doubleSided===!0&&(g.side=gr);const E=h.alphaMode||No.OPAQUE;if(E===No.BLEND?(g.transparent=!0,g.depthWrite=!1):(g.transparent=!1,E===No.MASK&&(g.alphaTest=h.alphaCutoff!==void 0?h.alphaCutoff:.5)),h.normalTexture!==void 0&&p!==xn&&(x.push(t.assignTexture(g,"normalMap",h.normalTexture)),g.normalScale=new Ne(1,1),h.normalTexture.scale!==void 0)){const A=h.normalTexture.scale;g.normalScale.set(A,A)}return h.occlusionTexture!==void 0&&p!==xn&&(x.push(t.assignTexture(g,"aoMap",h.occlusionTexture)),h.occlusionTexture.strength!==void 0&&(g.aoMapIntensity=h.occlusionTexture.strength)),h.emissiveFactor!==void 0&&p!==xn&&(g.emissive=new Yt().fromArray(h.emissiveFactor)),h.emissiveTexture!==void 0&&p!==xn&&x.push(t.assignTexture(g,"emissiveMap",h.emissiveTexture,Ds)),Promise.all(x).then(function(){const A=new p(g);return h.name&&(A.name=h.name),ti(A,h),t.associations.set(A,{materials:a}),h.extensions&&Mi(l,A,h),A})}createUniqueName(a){const t=jd.sanitizeNodeName(a||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(a){const t=this,i=this.extensions,l=this.primitiveCache;function h(g){return i[ve.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(g,t).then(function(f){return ba(f,g,t)})}const p=[];for(let g=0,f=a.length;g<f;g++){const x=a[g],E=yp(x),A=l[E];if(A)p.push(A.promise);else{let I;x.extensions&&x.extensions[ve.KHR_DRACO_MESH_COMPRESSION]?I=h(x):I=ba(new nr,x,t),l[E]={primitive:x,promise:I},p.push(I)}}return Promise.all(p)}loadMesh(a){const t=this,i=this.json,l=this.extensions,h=i.meshes[a],p=h.primitives,g=[];for(let f=0,x=p.length;f<x;f++){const E=p[f].material===void 0?_p(this.cache):this.getDependency("material",p[f].material);g.push(E)}return g.push(t.loadGeometries(p)),Promise.all(g).then(function(f){const x=f.slice(0,f.length-1),E=f[f.length-1],A=[];for(let V=0,O=E.length;V<O;V++){const G=E[V],F=p[V];let R;const K=x[V];if(F.mode===Gt.TRIANGLES||F.mode===Gt.TRIANGLE_STRIP||F.mode===Gt.TRIANGLE_FAN||F.mode===void 0)R=h.isSkinnedMesh===!0?new Fd(G,K):new Fs(G,K),R.isSkinnedMesh===!0&&R.normalizeSkinWeights(),F.mode===Gt.TRIANGLE_STRIP?R.geometry=ua(R.geometry,rl):F.mode===Gt.TRIANGLE_FAN&&(R.geometry=ua(R.geometry,ir));else if(F.mode===Gt.LINES)R=new Hd(G,K);else if(F.mode===Gt.LINE_STRIP)R=new tl(G,K);else if(F.mode===Gt.LINE_LOOP)R=new Bd(G,K);else if(F.mode===Gt.POINTS)R=new nl(G,K);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+F.mode);Object.keys(R.geometry.morphAttributes).length>0&&xp(R,h),R.name=t.createUniqueName(h.name||"mesh_"+a),ti(R,h),F.extensions&&Mi(l,R,F),t.assignFinalMaterial(R),A.push(R)}for(let V=0,O=A.length;V<O;V++)t.associations.set(A[V],{meshes:a,primitives:V});if(A.length===1)return h.extensions&&Mi(l,A[0],h),A[0];const I=new no;h.extensions&&Mi(l,I,h),t.associations.set(I,{meshes:a});for(let V=0,O=A.length;V<O;V++)I.add(A[V]);return I})}loadCamera(a){let t;const i=this.json.cameras[a],l=i[i.type];if(!l){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new il(Kd.radToDeg(l.yfov),l.aspectRatio||1,l.znear||1,l.zfar||2e6):i.type==="orthographic"&&(t=new br(-l.xmag,l.xmag,l.ymag,-l.ymag,l.znear,l.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ti(t,i),Promise.resolve(t)}loadSkin(a){const t=this.json.skins[a],i=[];for(let l=0,h=t.joints.length;l<h;l++)i.push(this._loadNodeShallow(t.joints[l]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(l){const h=l.pop(),p=l,g=[],f=[];for(let x=0,E=p.length;x<E;x++){const A=p[x];if(A){g.push(A);const I=new is;h!==null&&I.fromArray(h.array,x*16),f.push(I)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[x])}return new Ud(g,f)})}loadAnimation(a){const t=this.json.animations[a],i=t.name?t.name:"animation_"+a,l=[],h=[],p=[],g=[],f=[];for(let x=0,E=t.channels.length;x<E;x++){const A=t.channels[x],I=t.samplers[A.sampler],V=A.target,O=V.node,G=t.parameters!==void 0?t.parameters[I.input]:I.input,F=t.parameters!==void 0?t.parameters[I.output]:I.output;V.node!==void 0&&(l.push(this.getDependency("node",O)),h.push(this.getDependency("accessor",G)),p.push(this.getDependency("accessor",F)),g.push(I),f.push(V))}return Promise.all([Promise.all(l),Promise.all(h),Promise.all(p),Promise.all(g),Promise.all(f)]).then(function(x){const E=x[0],A=x[1],I=x[2],V=x[3],O=x[4],G=[];for(let F=0,R=E.length;F<R;F++){const K=E[F],U=A[F],le=I[F],N=V[F],z=O[F];if(K===void 0)continue;K.updateMatrix();let H;switch(Qn[z.path]){case Qn.weights:H=eh;break;case Qn.rotation:H=ha;break;case Qn.position:case Qn.scale:default:H=Jd;break}const J=K.name?K.name:K.uuid,X=N.interpolation!==void 0?fp[N.interpolation]:sl,oe=[];Qn[z.path]===Qn.weights?K.traverse(function(ze){ze.morphTargetInfluences&&oe.push(ze.name?ze.name:ze.uuid)}):oe.push(J);let me=le.array;if(le.normalized){const ze=rr(me.constructor),ue=new Float32Array(me.length);for(let Ae=0,we=me.length;Ae<we;Ae++)ue[Ae]=me[Ae]*ze;me=ue}for(let ze=0,ue=oe.length;ze<ue;ze++){const Ae=new H(oe[ze]+"."+Qn[z.path],U.array,me,X);N.interpolation==="CUBICSPLINE"&&(Ae.createInterpolant=function(we){const ce=this instanceof ha?bp:yl;return new ce(this.times,this.values,this.getValueSize()/3,we)},Ae.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),G.push(Ae)}}return new Gd(i,void 0,G)})}createNodeMesh(a){const t=this.json,i=this,l=t.nodes[a];return l.mesh===void 0?null:i.getDependency("mesh",l.mesh).then(function(h){const p=i._getNodeRef(i.meshCache,l.mesh,h);return l.weights!==void 0&&p.traverse(function(g){if(g.isMesh)for(let f=0,x=l.weights.length;f<x;f++)g.morphTargetInfluences[f]=l.weights[f]}),p})}loadNode(a){const t=this.json,i=this,l=t.nodes[a],h=i._loadNodeShallow(a),p=[],g=l.children||[];for(let x=0,E=g.length;x<E;x++)p.push(i.getDependency("node",g[x]));const f=l.skin===void 0?Promise.resolve(null):i.getDependency("skin",l.skin);return Promise.all([h,Promise.all(p),f]).then(function(x){const E=x[0],A=x[1],I=x[2];I!==null&&E.traverse(function(V){V.isSkinnedMesh&&V.bind(I,Ep)});for(let V=0,O=A.length;V<O;V++)E.add(A[V]);return E})}_loadNodeShallow(a){const t=this.json,i=this.extensions,l=this;if(this.nodeCache[a]!==void 0)return this.nodeCache[a];const h=t.nodes[a],p=h.name?l.createUniqueName(h.name):"",g=[],f=l._invokeOne(function(x){return x.createNodeMesh&&x.createNodeMesh(a)});return f&&g.push(f),h.camera!==void 0&&g.push(l.getDependency("camera",h.camera).then(function(x){return l._getNodeRef(l.cameraCache,h.camera,x)})),l._invokeAll(function(x){return x.createNodeAttachment&&x.createNodeAttachment(a)}).forEach(function(x){g.push(x)}),this.nodeCache[a]=Promise.all(g).then(function(x){let E;if(h.isBone===!0?E=new $d:x.length>1?E=new no:x.length===1?E=x[0]:E=new Ct,E!==x[0])for(let A=0,I=x.length;A<I;A++)E.add(x[A]);if(h.name&&(E.userData.name=h.name,E.name=p),ti(E,h),h.extensions&&Mi(i,E,h),h.matrix!==void 0){const A=new is;A.fromArray(h.matrix),E.applyMatrix4(A)}else h.translation!==void 0&&E.position.fromArray(h.translation),h.rotation!==void 0&&E.quaternion.fromArray(h.rotation),h.scale!==void 0&&E.scale.fromArray(h.scale);return l.associations.has(E)||l.associations.set(E,{}),l.associations.get(E).nodes=a,E}),this.nodeCache[a]}loadScene(a){const t=this.extensions,i=this.json.scenes[a],l=this,h=new no;i.name&&(h.name=l.createUniqueName(i.name)),ti(h,i),i.extensions&&Mi(t,h,i);const p=i.nodes||[],g=[];for(let f=0,x=p.length;f<x;f++)g.push(l.getDependency("node",p[f]));return Promise.all(g).then(function(f){for(let E=0,A=f.length;E<A;E++)h.add(f[E]);const x=E=>{const A=new Map;for(const[I,V]of l.associations)(I instanceof ii||I instanceof tr)&&A.set(I,V);return E.traverse(I=>{const V=l.associations.get(I);V!=null&&A.set(I,V)}),A};return l.associations=x(h),h})}}function kp(m,a,t){const i=a.attributes,l=new th;if(i.POSITION!==void 0){const g=t.json.accessors[i.POSITION],f=g.min,x=g.max;if(f!==void 0&&x!==void 0){if(l.set(new ge(f[0],f[1],f[2]),new ge(x[0],x[1],x[2])),g.normalized){const E=rr(ns[g.componentType]);l.min.multiplyScalar(E),l.max.multiplyScalar(E)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const h=a.targets;if(h!==void 0){const g=new ge,f=new ge;for(let x=0,E=h.length;x<E;x++){const A=h[x];if(A.POSITION!==void 0){const I=t.json.accessors[A.POSITION],V=I.min,O=I.max;if(V!==void 0&&O!==void 0){if(f.setX(Math.max(Math.abs(V[0]),Math.abs(O[0]))),f.setY(Math.max(Math.abs(V[1]),Math.abs(O[1]))),f.setZ(Math.max(Math.abs(V[2]),Math.abs(O[2]))),I.normalized){const G=rr(ns[I.componentType]);f.multiplyScalar(G)}g.max(f)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}l.expandByVector(g)}m.boundingBox=l;const p=new nh;l.getCenter(p.center),p.radius=l.min.distanceTo(l.max)/2,m.boundingSphere=p}function ba(m,a,t){const i=a.attributes,l=[];function h(p,g){return t.getDependency("accessor",p).then(function(f){m.setAttribute(g,f)})}for(const p in i){const g=or[p]||p.toLowerCase();g in m.attributes||l.push(h(i[p],g))}if(a.indices!==void 0&&!m.index){const p=t.getDependency("accessor",a.indices).then(function(g){m.setIndex(g)});l.push(p)}return ti(m,a),kp(m,a,t),Promise.all(l).then(function(){return a.targets!==void 0?wp(m,a.targets,t):m})}const $e={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Cl(m){const a=await fetch(m);if(a.ok)return a.json();throw new Error(a.statusText)}async function Ap(m){if(!m)throw new Error("No basePath supplied");return await Cl(`${m}/profilesList.json`)}async function Mp(m,a,t=null,i=!0){if(!m)throw new Error("No xrInputSource supplied");if(!a)throw new Error("No basePath supplied");const l=await Ap(a);let h;if(m.profiles.some(f=>{const x=l[f];return x&&(h={profileId:f,profilePath:`${a}/${x.path}`,deprecated:!!x.deprecated}),!!h}),!h){if(!t)throw new Error("No matching profile name found");const f=l[t];if(!f)throw new Error(`No matching profile name found and default profile "${t}" missing.`);h={profileId:t,profilePath:`${a}/${f.path}`,deprecated:!!f.deprecated}}const p=await Cl(h.profilePath);let g;if(i){let f;if(m.handedness==="any"?f=p.layouts[Object.keys(p.layouts)[0]]:f=p.layouts[m.handedness],!f)throw new Error(`No matching handedness, ${m.handedness}, in profile ${h.profileId}`);f.assetPath&&(g=h.profilePath.replace("profile.json",f.assetPath))}return{profile:p,assetPath:g}}const Tp={xAxis:0,yAxis:0,button:0,state:$e.ComponentState.DEFAULT};function Lp(m=0,a=0){let t=m,i=a;if(Math.sqrt(m*m+a*a)>1){const l=Math.atan2(a,m);t=Math.cos(l),i=Math.sin(l)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class Ip{constructor(a){this.componentProperty=a.componentProperty,this.states=a.states,this.valueNodeName=a.valueNodeName,this.valueNodeProperty=a.valueNodeProperty,this.valueNodeProperty===$e.VisualResponseProperty.TRANSFORM&&(this.minNodeName=a.minNodeName,this.maxNodeName=a.maxNodeName),this.value=0,this.updateFromComponent(Tp)}updateFromComponent({xAxis:a,yAxis:t,button:i,state:l}){const{normalizedXAxis:h,normalizedYAxis:p}=Lp(a,t);switch(this.componentProperty){case $e.ComponentProperty.X_AXIS:this.value=this.states.includes(l)?h:.5;break;case $e.ComponentProperty.Y_AXIS:this.value=this.states.includes(l)?p:.5;break;case $e.ComponentProperty.BUTTON:this.value=this.states.includes(l)?i:0;break;case $e.ComponentProperty.STATE:this.valueNodeProperty===$e.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(l):this.value=this.states.includes(l)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Sp{constructor(a,t){if(!a||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=a,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const l=new Ip(t.visualResponses[i]);this.visualResponses[i]=l}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:$e.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(a){if(this.values.state=$e.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&a.buttons.length>this.gamepadIndices.button){const t=a.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=$e.ComponentState.PRESSED:(t.touched||this.values.button>$e.ButtonTouchThreshold)&&(this.values.state=$e.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&a.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=a.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===$e.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>$e.AxisTouchThreshold&&(this.values.state=$e.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&a.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=a.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===$e.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>$e.AxisTouchThreshold&&(this.values.state=$e.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class zp{constructor(a,t,i){if(!a)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=a,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[a.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(l=>{const h=this.layoutDescription.components[l];this.components[l]=new Sp(l,h)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const a=[];return Object.values(this.components).forEach(t=>{a.push(t.data)}),a}updateFromGamepad(){Object.values(this.components).forEach(a=>{a.updateFromGamepad(this.xrInputSource.gamepad)})}}const Rp="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Vp="generic-trigger";class Dp extends Ct{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(a){return this.envMap==a?this:(this.envMap=a,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(a){super.updateMatrixWorld(a),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:l,minNode:h,maxNode:p,value:g,valueNodeProperty:f}=i;l&&(f===$e.VisualResponseProperty.VISIBILITY?l.visible=g:f===$e.VisualResponseProperty.TRANSFORM&&(l.quaternion.slerpQuaternions(h.quaternion,p.quaternion,g),l.position.lerpVectors(h.position,p.position,g)))})}))}}function Op(m,a){Object.values(m.components).forEach(t=>{const{type:i,touchPointNodeName:l,visualResponses:h}=t;if(i===$e.ComponentType.TOUCHPAD)if(t.touchPointNode=a.getObjectByName(l),t.touchPointNode){const p=new sh(.001),g=new xn({color:255}),f=new Fs(p,g);t.touchPointNode.add(f)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(h).forEach(p=>{const{valueNodeName:g,minNodeName:f,maxNodeName:x,valueNodeProperty:E}=p;if(E===$e.VisualResponseProperty.TRANSFORM){if(p.minNode=a.getObjectByName(f),p.maxNode=a.getObjectByName(x),!p.minNode){console.warn(`Could not find ${f} in the model`);return}if(!p.maxNode){console.warn(`Could not find ${x} in the model`);return}}p.valueNode=a.getObjectByName(g),p.valueNode||console.warn(`Could not find ${g} in the model`)})})}function fa(m,a){Op(m.motionController,a),m.envMap&&a.traverse(t=>{t.isMesh&&(t.material.envMap=m.envMap,t.material.needsUpdate=!0)}),m.add(a)}class Np{constructor(a=null){this.gltfLoader=a,this.path=Rp,this._assetCache={},this.gltfLoader||(this.gltfLoader=new wl)}createControllerModel(a){const t=new Dp;let i=null;return a.addEventListener("connected",l=>{const h=l.data;h.targetRayMode!=="tracked-pointer"||!h.gamepad||Mp(h,this.path,Vp).then(({profile:p,assetPath:g})=>{t.motionController=new zp(h,p,g);const f=this._assetCache[t.motionController.assetUrl];if(f)i=f.scene.clone(),fa(t,i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,x=>{this._assetCache[t.motionController.assetUrl]=x,i=x.scene.clone(),fa(t,i)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(p=>{console.warn(p)})}),a.addEventListener("disconnected",()=>{t.motionController=null,t.remove(i),i=null}),t}}new Yt;var jp=`varying vec3 worldPosition;

uniform float uDistance;

void main() {
  vec3 pos = position.xzy * uDistance;
  pos.xz += cameraPosition.xz;

  worldPosition = pos;

  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
}`,Fp=`varying vec3 worldPosition;

uniform float uCellSize;
uniform float uLargeCellSize;
uniform vec3 uColor;
uniform float uDistance;

float getGrid(float size) {
  vec2 r = worldPosition.xz / size;
  vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
  float line = min(grid.x, grid.y);

  return 1.0 - min(line, 1.0);
}

void main() {
  float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);

  float g1 = getGrid(uCellSize);
  float g2 = getGrid(uLargeCellSize);

  gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, 3.0));
  gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2);

  if (gl_FragColor.a <= 0.0) discard;
}`;class Hp extends Fs{constructor(t=1,i=10,l="white",h=8e3){const p=new qd,g=new ol({side:gr,uniforms:{uCellSize:{value:t},uLargeCellSize:{value:i},uColor:{value:new Yt(l)},uDistance:{value:h}},transparent:!0,vertexShader:jp,fragmentShader:Fp,extensions:{derivatives:!0}});super(p,g);S(this,"frustumCulled",!1);S(this,"material");this.material=g}get cellSize(){return this.material.uniforms.uCellSize.value}set cellSize(t){this.material.uniforms.uCellSize.value=t}get largeCellSize(){return this.material.uniforms.uLargeCellSize.value}set largeCellSize(t){this.material.uniforms.uLargeCellSize.value=t}get color(){return this.material.uniforms.uColor.value}set color(t){this.material.uniforms.uColor.value=t}get distance(){return this.material.uniforms.uDistance.value}set distance(t){this.material.uniforms.uDistance.value=t}}new ge;const _r=(m,a)=>{if(a===0)return m;const t=m.replace("#","");let i=Number.parseInt(t.substring(0,2),16),l=Number.parseInt(t.substring(2,4),16),h=Number.parseInt(t.substring(4,6),16);i=Math.round(i*(1-a/100)),l=Math.round(l*(1-a/100)),h=Math.round(h*(1-a/100)),i=i<0?0:i>255?255:i,l=l<0?0:l>255?255:l,h=h<0?0:h>255?255:h;const p=`${i<16?"0":""}${i.toString(16)}`,g=`${l<16?"0":""}${l.toString(16)}`,f=`${h<16?"0":""}${h.toString(16)}`;return`#${p}${g}${f}`},Qi="#ff3653",Ji="#8adb00",es="#2c8fff",_a=_r(Qi,50),wa=_r(Ji,50),xa=_r(es,50),Qs=128*window.devicePixelRatio,Bp=3*Math.PI,Js=new Dn,Fo=new Dn,Kp=new zd(.8,.05,.05).translate(.4,0,0),Vs=64,El=m=>{const{context:a,text:t}=m.userData;a.beginPath(),a.arc(Vs/2,Vs/2,Vs/4,0,2*Math.PI),a.closePath(),a.fillStyle=m.userData.color,a.fill(),t!==""&&(a.font="bold 23px system-ui",a.textAlign="center",a.fillStyle="#000000",a.fillText(t,32,41)),m.material.needsUpdate=!0,m.material.map.needsUpdate=!0},Ho=m=>{const a=new xn({color:m,toneMapped:!1});return new Fs(Kp,a)},Zi=(m,a="")=>{const t=document.createElement("canvas");t.width=Vs,t.height=Vs;const i=t.getContext("2d"),l=new rh(t),h=new ah({map:l,toneMapped:!1}),p=new gl(h);return p.userData.color=m,p.userData.text=a,p.userData.context=i,El(p),p};class Up extends Ct{constructor(t,i){super();S(this,"isViewHelper",!0);S(this,"animating",!1);S(this,"center",new ge);S(this,"point",new ge);S(this,"viewport",new oh);S(this,"targetQuaternion",new Dn);S(this,"radius",0);S(this,"orthoCamera",new br(-2,2,2,-2,-4,4));S(this,"axes");S(this,"btns");S(this,"camera");S(this,"renderer");S(this,"render",t=>{if(this.animating){const p=t*Bp/1e3;Js.rotateTowards(Fo,p),this.camera.position.set(0,0,1).applyQuaternion(Js).multiplyScalar(this.radius).add(this.center),this.camera.quaternion.rotateTowards(this.targetQuaternion,p),Js.angleTo(Fo)===0&&(this.animating=!1)}this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld();const{x:i,y:l,z:h}=this.point.set(0,0,1).applyQuaternion(this.camera.quaternion);this.btns[0].userData.color=i>=0?Qi:_a,this.btns[1].userData.color=l>=0?Ji:wa,this.btns[2].userData.color=h>=0?es:xa,this.btns[3].userData.color=i<0?Qi:_a,this.btns[4].userData.color=l<0?Ji:wa,this.btns[5].userData.color=h<0?es:xa;for(const p of this.btns)El(p);console.log(this.btns[0].userData);{const p=this.renderer.domElement.offsetWidth*window.devicePixelRatio-Qs,g=this.renderer.domElement.offsetHeight*window.devicePixelRatio-Qs,{autoClear:f,outputColorSpace:x}=this.renderer;this.renderer.autoClear=!1,this.renderer.outputColorSpace="srgb-linear",this.renderer.getViewport(this.viewport),this.renderer.setViewport(p,g,Qs,Qs),this.renderer.render(this,this.orthoCamera),this.renderer.setViewport(this.viewport),this.renderer.autoClear=f,this.renderer.outputColorSpace=x}});S(this,"dispose",()=>{var t;for(let i of[...this.axes,...this.btns])i instanceof gl&&((t=i.material.map)==null||t.dispose()),i.material instanceof ii&&i.material.dispose()});this.camera=t,this.renderer=i;const l=new Ne,h=new Ct;this.orthoCamera.position.set(0,0,2),this.axes=[Ho(Qi),Ho(Ji),Ho(es)],this.btns=[Zi(Qi,"X"),Zi(Ji,"Y"),Zi(es,"Z"),Zi(Qi),Zi(Ji),Zi(es)],this.axes[1].rotation.z=Math.PI/2,this.axes[2].rotation.y=-Math.PI/2,this.btns[0].position.x=1,this.btns[1].position.y=1,this.btns[2].position.z=1,this.btns[3].position.x=-1,this.btns[4].position.y=-1,this.btns[5].position.z=-1,this.btns[3].scale.setScalar(.8),this.btns[4].scale.setScalar(.8),this.btns[5].scale.setScalar(.8),this.add(...this.axes,...this.btns);const p=[...this.btns],g=new ge,f=new ml,x=I=>{if(this.animating===!0)return!1;const{domElement:V}=i,O=V.getBoundingClientRect();l.x=I.clientX-O.left-O.width+128,l.y=I.clientY-O.top,l.x=l.x/128*2-1,l.y=l.y/128*2-1,f.setFromCamera(l,this.orthoCamera);const G=f.intersectObjects(p),[F]=G;if(console.log(F),F){const R=F.object;return A(R,this.center),this.animating=!0,!0}else return!1};i.domElement.addEventListener("click",x);const E=new fr,A=(I,V)=>{I.position.x===1?(g.set(1,0,0),this.targetQuaternion.setFromEuler(E.set(0,Math.PI*.5,0))):I.position.y===1?(g.set(0,1,0),this.targetQuaternion.setFromEuler(E.set(-Math.PI*.5,0,0))):I.position.z===1?(g.set(0,0,1),this.targetQuaternion.setFromEuler(E.set(0,0,0))):I.position.x===-1?(g.set(-1,0,0),this.targetQuaternion.setFromEuler(E.set(0,-Math.PI*.5,0))):I.position.y===-1?(g.set(0,-1,0),this.targetQuaternion.setFromEuler(E.set(Math.PI*.5,0,0))):I.position.z===-1&&(g.set(0,0,-1),this.targetQuaternion.setFromEuler(E.set(0,Math.PI,0))),this.radius=t.position.distanceTo(V),g.multiplyScalar(this.radius).add(V),h.position.copy(V),h.lookAt(t.position),Js.copy(h.quaternion),h.lookAt(g),Fo.copy(h.quaternion)}}}new ge,new ge,new ge;performance.now();performance.now();Yd.enabled=!0;Xd.enabled=!0;new Rd;new pr;new wl;new Wa;const ln=(m,a)=>localStorage.setItem(m,JSON.stringify(a)),wn=m=>{try{return JSON.parse(localStorage.getItem(m)??"null")}catch{return null}};new Np;new is;const Gp=ss.FolderApi.prototype.addFolder,$p=ss.FolderApi.prototype.dispose;ss.FolderApi.prototype.addFolder=function(m){const a=`${String(m.index??-1)}.${m.title}`,t=Gp.call(this,{expanded:wn(`pane.${a}`)!==null,...m});return t.element.id=a,t.on("fold",i=>{const l=`pane.${a}`;i.expanded?ln(l,!0):ln(l,null)}),t};ss.FolderApi.prototype.dispose=function(){$p.call(this)};const ya={type:"change"},Bo={type:"start"},Ca={type:"end"};class qp extends vl{constructor(a,t){super(),this.object=a,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new ge,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$t.ROTATE,MIDDLE:$t.DOLLY,RIGHT:$t.PAN},this.touches={ONE:qt.ROTATE,TWO:qt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(y){y.addEventListener("keydown",Pt),this._domElementKeyEvents=y},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Pt),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(ya),i.update(),h=l.NONE},this.update=function(){const y=new ge,B=new Dn().setFromUnitVectors(a.up,new ge(0,1,0)),se=B.clone().invert(),re=new ge,xe=new Dn,it=new ge,Ve=2*Math.PI;return function(){const _t=i.object.position;y.copy(_t).sub(i.target),y.applyQuaternion(B),g.setFromVector3(y),i.autoRotate&&h===l.NONE&&X(H()),i.enableDamping?(g.theta+=f.theta*i.dampingFactor,g.phi+=f.phi*i.dampingFactor):(g.theta+=f.theta,g.phi+=f.phi);let Fe=i.minAzimuthAngle,Ie=i.maxAzimuthAngle;return isFinite(Fe)&&isFinite(Ie)&&(Fe<-Math.PI?Fe+=Ve:Fe>Math.PI&&(Fe-=Ve),Ie<-Math.PI?Ie+=Ve:Ie>Math.PI&&(Ie-=Ve),Fe<=Ie?g.theta=Math.max(Fe,Math.min(Ie,g.theta)):g.theta=g.theta>(Fe+Ie)/2?Math.max(Fe,g.theta):Math.min(Ie,g.theta)),g.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=x,g.radius=Math.max(i.minDistance,Math.min(i.maxDistance,g.radius)),i.enableDamping===!0?i.target.addScaledVector(E,i.dampingFactor):i.target.add(E),y.setFromSpherical(g),y.applyQuaternion(se),_t.copy(i.target).add(y),i.object.lookAt(i.target),i.enableDamping===!0?(f.theta*=1-i.dampingFactor,f.phi*=1-i.dampingFactor,E.multiplyScalar(1-i.dampingFactor)):(f.set(0,0,0),E.set(0,0,0)),x=1,A||re.distanceToSquared(i.object.position)>p||8*(1-xe.dot(i.object.quaternion))>p||it.distanceToSquared(i.target)>0?(i.dispatchEvent(ya),re.copy(i.object.position),xe.copy(i.object.quaternion),it.copy(i.target),A=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",vt),i.domElement.removeEventListener("pointerdown",ut),i.domElement.removeEventListener("pointercancel",Re),i.domElement.removeEventListener("wheel",Wt),i.domElement.removeEventListener("pointermove",Le),i.domElement.removeEventListener("pointerup",Re),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Pt),i._domElementKeyEvents=null)};const i=this,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=l.NONE;const p=1e-6,g=new oo,f=new oo;let x=1;const E=new ge;let A=!1;const I=new Ne,V=new Ne,O=new Ne,G=new Ne,F=new Ne,R=new Ne,K=new Ne,U=new Ne,le=new Ne,N=[],z={};function H(){return 2*Math.PI/60/60*i.autoRotateSpeed}function J(){return Math.pow(.95,i.zoomSpeed)}function X(y){f.theta-=y}function oe(y){f.phi-=y}const me=function(){const y=new ge;return function(B,se){y.setFromMatrixColumn(se,0),y.multiplyScalar(-B),E.add(y)}}(),ze=function(){const y=new ge;return function(B,se){i.screenSpacePanning===!0?y.setFromMatrixColumn(se,1):(y.setFromMatrixColumn(se,0),y.crossVectors(i.object.up,y)),y.multiplyScalar(B),E.add(y)}}(),ue=function(){const y=new ge;return function(B,se){const re=i.domElement;if(i.object.isPerspectiveCamera){const xe=i.object.position;y.copy(xe).sub(i.target);let it=y.length();it*=Math.tan(i.object.fov/2*Math.PI/180),me(2*B*it/re.clientHeight,i.object.matrix),ze(2*se*it/re.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(me(B*(i.object.right-i.object.left)/i.object.zoom/re.clientWidth,i.object.matrix),ze(se*(i.object.top-i.object.bottom)/i.object.zoom/re.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function Ae(y){i.object.isPerspectiveCamera?x/=y:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*y)),i.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function we(y){i.object.isPerspectiveCamera?x*=y:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/y)),i.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ce(y){I.set(y.clientX,y.clientY)}function ie(y){K.set(y.clientX,y.clientY)}function Xt(y){G.set(y.clientX,y.clientY)}function Zt(y){V.set(y.clientX,y.clientY),O.subVectors(V,I).multiplyScalar(i.rotateSpeed);const B=i.domElement;X(2*Math.PI*O.x/B.clientHeight),oe(2*Math.PI*O.y/B.clientHeight),I.copy(V),i.update()}function yn(y){U.set(y.clientX,y.clientY),le.subVectors(U,K),le.y>0?Ae(J()):le.y<0&&we(J()),K.copy(U),i.update()}function We(y){F.set(y.clientX,y.clientY),R.subVectors(F,G).multiplyScalar(i.panSpeed),ue(R.x,R.y),G.copy(F),i.update()}function nt(y){y.deltaY<0?we(J()):y.deltaY>0&&Ae(J()),i.update()}function be(y){let B=!1;switch(y.code){case i.keys.UP:y.ctrlKey||y.metaKey||y.shiftKey?oe(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(0,i.keyPanSpeed),B=!0;break;case i.keys.BOTTOM:y.ctrlKey||y.metaKey||y.shiftKey?oe(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(0,-i.keyPanSpeed),B=!0;break;case i.keys.LEFT:y.ctrlKey||y.metaKey||y.shiftKey?X(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(i.keyPanSpeed,0),B=!0;break;case i.keys.RIGHT:y.ctrlKey||y.metaKey||y.shiftKey?X(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(-i.keyPanSpeed,0),B=!0;break}B&&(y.preventDefault(),i.update())}function Ee(){if(N.length===1)I.set(N[0].pageX,N[0].pageY);else{const y=.5*(N[0].pageX+N[1].pageX),B=.5*(N[0].pageY+N[1].pageY);I.set(y,B)}}function bt(){if(N.length===1)G.set(N[0].pageX,N[0].pageY);else{const y=.5*(N[0].pageX+N[1].pageX),B=.5*(N[0].pageY+N[1].pageY);G.set(y,B)}}function Dt(){const y=N[0].pageX-N[1].pageX,B=N[0].pageY-N[1].pageY,se=Math.sqrt(y*y+B*B);K.set(0,se)}function je(){i.enableZoom&&Dt(),i.enablePan&&bt()}function Ot(){i.enableZoom&&Dt(),i.enableRotate&&Ee()}function Nt(y){if(N.length==1)V.set(y.pageX,y.pageY);else{const se=ft(y),re=.5*(y.pageX+se.x),xe=.5*(y.pageY+se.y);V.set(re,xe)}O.subVectors(V,I).multiplyScalar(i.rotateSpeed);const B=i.domElement;X(2*Math.PI*O.x/B.clientHeight),oe(2*Math.PI*O.y/B.clientHeight),I.copy(V)}function Ue(y){if(N.length===1)F.set(y.pageX,y.pageY);else{const B=ft(y),se=.5*(y.pageX+B.x),re=.5*(y.pageY+B.y);F.set(se,re)}R.subVectors(F,G).multiplyScalar(i.panSpeed),ue(R.x,R.y),G.copy(F)}function pt(y){const B=ft(y),se=y.pageX-B.x,re=y.pageY-B.y,xe=Math.sqrt(se*se+re*re);U.set(0,xe),le.set(0,Math.pow(U.y/K.y,i.zoomSpeed)),Ae(le.y),K.copy(U)}function cn(y){i.enableZoom&&pt(y),i.enablePan&&Ue(y)}function Qe(y){i.enableZoom&&pt(y),i.enableRotate&&Nt(y)}function ut(y){i.enabled!==!1&&(N.length===0&&(i.domElement.setPointerCapture(y.pointerId),i.domElement.addEventListener("pointermove",Le),i.domElement.addEventListener("pointerup",Re)),kt(y),y.pointerType==="touch"?dn(y):Cn(y))}function Le(y){i.enabled!==!1&&(y.pointerType==="touch"?En(y):Et(y))}function Re(y){hn(y),N.length===0&&(i.domElement.releasePointerCapture(y.pointerId),i.domElement.removeEventListener("pointermove",Le),i.domElement.removeEventListener("pointerup",Re)),i.dispatchEvent(Ca),h=l.NONE}function Cn(y){let B;switch(y.button){case 0:B=i.mouseButtons.LEFT;break;case 1:B=i.mouseButtons.MIDDLE;break;case 2:B=i.mouseButtons.RIGHT;break;default:B=-1}switch(B){case $t.DOLLY:if(i.enableZoom===!1)return;ie(y),h=l.DOLLY;break;case $t.ROTATE:if(y.ctrlKey||y.metaKey||y.shiftKey){if(i.enablePan===!1)return;Xt(y),h=l.PAN}else{if(i.enableRotate===!1)return;ce(y),h=l.ROTATE}break;case $t.PAN:if(y.ctrlKey||y.metaKey||y.shiftKey){if(i.enableRotate===!1)return;ce(y),h=l.ROTATE}else{if(i.enablePan===!1)return;Xt(y),h=l.PAN}break;default:h=l.NONE}h!==l.NONE&&i.dispatchEvent(Bo)}function Et(y){switch(h){case l.ROTATE:if(i.enableRotate===!1)return;Zt(y);break;case l.DOLLY:if(i.enableZoom===!1)return;yn(y);break;case l.PAN:if(i.enablePan===!1)return;We(y);break}}function Wt(y){i.enabled===!1||i.enableZoom===!1||h!==l.NONE||(y.preventDefault(),i.dispatchEvent(Bo),nt(y),i.dispatchEvent(Ca))}function Pt(y){i.enabled===!1||i.enablePan===!1||be(y)}function dn(y){switch(jt(y),N.length){case 1:switch(i.touches.ONE){case qt.ROTATE:if(i.enableRotate===!1)return;Ee(),h=l.TOUCH_ROTATE;break;case qt.PAN:if(i.enablePan===!1)return;bt(),h=l.TOUCH_PAN;break;default:h=l.NONE}break;case 2:switch(i.touches.TWO){case qt.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;je(),h=l.TOUCH_DOLLY_PAN;break;case qt.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ot(),h=l.TOUCH_DOLLY_ROTATE;break;default:h=l.NONE}break;default:h=l.NONE}h!==l.NONE&&i.dispatchEvent(Bo)}function En(y){switch(jt(y),h){case l.TOUCH_ROTATE:if(i.enableRotate===!1)return;Nt(y),i.update();break;case l.TOUCH_PAN:if(i.enablePan===!1)return;Ue(y),i.update();break;case l.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;cn(y),i.update();break;case l.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Qe(y),i.update();break;default:h=l.NONE}}function vt(y){i.enabled!==!1&&y.preventDefault()}function kt(y){N.push(y)}function hn(y){delete z[y.pointerId];for(let B=0;B<N.length;B++)if(N[B].pointerId==y.pointerId){N.splice(B,1);return}}function jt(y){let B=z[y.pointerId];B===void 0&&(B=new Ne,z[y.pointerId]=B),B.set(y.pageX,y.pageY)}function ft(y){const B=y.pointerId===N[0].pointerId?N[1]:N[0];return z[B.pointerId]}i.domElement.addEventListener("contextmenu",vt),i.domElement.addEventListener("pointerdown",ut),i.domElement.addEventListener("pointercancel",Re),i.domElement.addEventListener("wheel",Wt,{passive:!1}),this.update()}}const rt={camera:void 0,composer:void 0,debugRoot:void 0,renderer:void 0,root:void 0,scene:void 0},Yp=()=>{const{camera:m,renderer:a}=rt,t=new Up(m,a);return()=>t.dispose()};var ro=(m=>(m[m.NONE=0]="NONE",m[m.ORBIT=1]="ORBIT",m))(ro||{});let Wi;const Pl=(m,a)=>{const{renderer:t}=rt,i=()=>{ln("three-inspect.camera",{position:a.position.toArray(),quaternion:a.quaternion.toArray(),target:Wi==null?void 0:Wi.target.toArray(),zoom:a.zoom})};Wi!==void 0&&(Wi.dispose(),window.removeEventListener("pointerup",i),window.removeEventListener("wheel",i)),m===1?(ln("three-inspect.controls",1),Wi=new qp(a,t.domElement),window.addEventListener("pointerup",i,{passive:!0}),window.addEventListener("wheel",i,{passive:!0}),Yp()):(ln("three-inspect.camera",null),ln("controls",null))};let wr=-1;const Os=[],kl=()=>{for(let m=0,a=Os.length;m<a;m+=1)Os[m]();wr=requestAnimationFrame(kl)},Xp=()=>{wr=requestAnimationFrame(kl)},Zp=()=>{cancelAnimationFrame(wr)},xr=m=>{Os.push(m)},yr=m=>{Os.splice(Os.indexOf(m),1)},Wp=`*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.visible{visibility:visible}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.bottom-0{bottom:0}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-10{z-index:10}.z-50{z-index:50}.z-\\[100\\]{z-index:100}.inline{display:inline}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-\\[105px\\]{height:105px}.h-screen{height:100vh}.w-6{width:1.5rem}.w-\\[350px\\]{width:350px}.w-full{width:100%}.w-screen{width:100vw}.grow{flex-grow:1}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.resize{resize:both}.flex-col{flex-direction:column}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.bg-\\[\\#28292e\\]{--tw-bg-opacity: 1;background-color:rgb(40 41 46 / var(--tw-bg-opacity))}.bg-\\[\\#333\\]{--tw-bg-opacity: 1;background-color:rgb(51 51 51 / var(--tw-bg-opacity))}.bg-zinc-400{--tw-bg-opacity: 1;background-color:rgb(161 161 170 / var(--tw-bg-opacity))}.bg-zinc-600{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity))}.fill-zinc-100{fill:#f4f4f5}.fill-zinc-400{fill:#a1a1aa}.p-1{padding:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.font-mono{font-family:var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace)}.text-\\[11px\\]{font-size:11px}.text-zinc-400{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity))}.text-zinc-800{--tw-text-opacity: 1;color:rgb(39 39 42 / var(--tw-text-opacity))}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.blur{--tw-blur: blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}*{--bs-br: 0px !important;scrollbar-width:none}*::-webkit-scrollbar{display:none}.tp-grlv_g{height:30px!important}.tp-imgv{height:20px!important;transition:.2s!important}.tp-imgv:hover{height:80px!important}.tp-rotv_c{height:0!important;padding:0!important;margin-top:5px;width:100%!important}.stats .tp-rotv_c{height:auto!important}.orbit-controls-gizmo{position:absolute;top:10px;left:-90px;z-index:10}.hover\\:bg-\\[rgba\\(255\\,255\\,255\\,0\\.05\\)\\]:hover{background-color:#ffffff0d}.hover\\:bg-zinc-600:hover{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity))}.hover\\:fill-zinc-100:hover{fill:#f4f4f5}.hover\\:fill-zinc-300:hover{fill:#d4d4d8}
`,Ea="tv-flex",Pa="tv-grid",ka="tv-hidden",Aa="tv-scrollable",zs="tv-resizable",Ma="tv-readonly",Ta="tv-disabled",La="tv-focus",ao="tv-multiple-values",Ia="tv-error",Sa="flash",Qp="tv-default-mousedown",Al="font-regular";class Jp{constructor(a,t,i){S(this,"owner");S(this,"name");S(this,"fn");this.owner=a,this.name=t,this.fn=i}unbind(){this.owner&&(this.owner.unbind(this.name??void 0,this.fn),this.owner=null,this.name=null,this.fn=null)}call(...a){this.fn&&this.fn.call(this.owner,...a)}on(a,t){var i;return(i=this.owner)==null?void 0:i.on(a,t)}}class eu{constructor(){S(this,"_suspendEvents",!1);S(this,"_additionalEmitters",[]);S(this,"_events");Object.defineProperty(this,"_events",{configurable:!1,enumerable:!1,value:{},writable:!0})}set suspendEvents(a){this._suspendEvents=!!a}get suspendEvents(){return this._suspendEvents}on(a,t){const i=this._events[a];return i===void 0?this._events[a]=[t]:i.indexOf(t)===-1&&i.push(t),new Jp(this,a,t)}once(a,t){const i=this.on(a,(...l)=>{t.call(this,...l),i.unbind()});return i}emit(a,...t){if(this._suspendEvents)return this;let i=this._events[a];if(i!=null&&i.length){i=i.slice(0);for(let l=0;l<i.length;l+=1)if(i[l])try{i[l].call(this,...t)}catch(h){console.error("%c%s %c(event error)","color: #06f",a,"color: #f00"),console.error(h.stack)}}if(this._additionalEmitters.length){const l=this._additionalEmitters.slice();for(let h=0,p=l.length;h<p;h+=1)l[h].emit(a,...t)}return this}unbind(a,t){if(a){const i=this._events[a];if(!i)return this;if(t){const l=i.indexOf(t);l!==-1&&(i.length===1?delete this._events[a]:i.splice(l,1))}else delete this._events[a]}else this._events={};return this}addEmitter(a){this._additionalEmitters.includes(a)||this._additionalEmitters.push(a)}removeEmitter(a){const t=this._additionalEmitters.indexOf(a);t!==-1&&this._additionalEmitters.splice(t,1)}}const tu=["flexDirection","flexGrow","flexBasis","flexShrink","flexWrap","alignItems","alignSelf","justifyContent","justifySelf"];class ht extends eu{constructor(t={}){super();S(this,"_destroyed",!1);S(this,"_parent",null);S(this,"_eventsParent",[]);S(this,"_dom");S(this,"_hiddenParents");S(this,"_flashTimeout",null);S(this,"_suppressChange",!1);S(this,"_ignoreParent",!1);S(this,"_enabled",!0);S(this,"_readOnly",!1);S(this,"_hidden",!1);S(this,"_hasError",!1);S(this,"_domContent",null);S(this,"_onMouseOver",t=>{this.emit("hover",t)});S(this,"_onMouseOut",t=>{this.emit("hoverend",t)});if(typeof t.dom=="string"?this._dom=document.createElement(t.dom):t.dom instanceof Node?this._dom=t.dom:this._dom=document.createElement("div"),t.id!==void 0&&(this._dom.id=t.id),this._dom.ui=this,this._dom.addEventListener("mouseover",this._onMouseOver),this._dom.addEventListener("mouseout",this._onMouseOut),this._dom.classList.add("tv-element",Al),t.class){const i=Array.isArray(t.class)?t.class:[t.class];for(const l of i)this._dom.classList.add(l)}this.enabled=t.enabled??!0,this._hiddenParents=!t.isRoot,this.hidden=t.hidden??!1,this.readOnly=t.readOnly??!1,this.ignoreParent=t.ignoreParent??!1,t.width!==void 0&&(this.width=t.width),t.height!==void 0&&(this.height=t.height),t.tabIndex!==void 0&&(this.tabIndex=t.tabIndex);for(const i in t)t[i]!==void 0&&tu.indexOf(i)!==-1&&(this[i]=t[i])}destroy(){if(this._destroyed)return;if(this._destroyed=!0,this.parent){const i=this.parent;for(const l of this._eventsParent)l.unbind();this._eventsParent.length=0,"remove"in i&&!i._destroyed&&i.remove(this),this._parent=null,!i._destroyed&&this._dom&&this._dom.parentElement&&this._dom.parentElement.removeChild(this._dom)}const t=this._dom;t&&(t.removeEventListener("mouseover",this._onMouseOver),t.removeEventListener("mouseout",this._onMouseOut),delete t.ui,this._dom=null),this._flashTimeout&&window.clearTimeout(this._flashTimeout),this.emit("destroy",t,this),this.unbind()}flash(){this._flashTimeout||(this.class.add(Sa),this._flashTimeout=window.setTimeout(()=>{this._flashTimeout=null,this.class.remove(Sa)},200))}_onClick(t){this.enabled&&this.emit("click",t)}_onHiddenToRootChange(t){this.emit(t?"hideToRoot":"showToRoot")}_onEnabledChange(t){t?this.class.remove(Ta):this.class.add(Ta),this.emit(t?"enable":"disable")}_onParentDestroy(){this.destroy()}_onParentDisable(){this._ignoreParent||this._enabled&&this._onEnabledChange(!1)}_onParentEnable(){this._ignoreParent||this._enabled&&this._onEnabledChange(!0)}_onParentShowToRoot(){const t=this.hiddenToRoot;this._hiddenParents=!1,t!==this.hiddenToRoot&&this._onHiddenToRootChange(this.hiddenToRoot)}_onParentHideToRoot(){const t=this.hiddenToRoot;this._hiddenParents=!0,t!==this.hiddenToRoot&&this._onHiddenToRootChange(this.hiddenToRoot)}_onReadOnlyChange(t){t?this.class.add(Ma):this.class.remove(Ma),this.emit("readOnly",t)}_onParentReadOnlyChange(t){this._ignoreParent||(t?this._readOnly||this._onReadOnlyChange(!0):this._readOnly||this._onReadOnlyChange(!1))}set enabled(t){if(this._enabled===t)return;const i=this.enabled;this._enabled=t,i!==t&&this._onEnabledChange(t)}get enabled(){return this._ignoreParent?this._enabled:this._enabled&&(!this._parent||this._parent.enabled)}set ignoreParent(t){this._ignoreParent=t,this._onEnabledChange(this.enabled),this._onReadOnlyChange(this.readOnly)}get ignoreParent(){return this._ignoreParent}get dom(){return this._dom}set parent(t){if(t===this._parent)return;const i=this.enabled,l=this.readOnly,h=this.hiddenToRoot;if(this._parent){for(let x=0;x<this._eventsParent.length;x+=1)this._eventsParent[x].unbind();this._eventsParent.length=0}this._parent=t,this._parent?(this._eventsParent.push(this._parent.once("destroy",this._onParentDestroy.bind(this))),this._eventsParent.push(this._parent.on("disable",this._onParentDisable.bind(this))),this._eventsParent.push(this._parent.on("enable",this._onParentEnable.bind(this))),this._eventsParent.push(this._parent.on("readOnly",this._onParentReadOnlyChange.bind(this))),this._eventsParent.push(this._parent.on("showToRoot",this._onParentShowToRoot.bind(this))),this._eventsParent.push(this._parent.on("hideToRoot",this._onParentHideToRoot.bind(this))),this._hiddenParents=this._parent.hiddenToRoot):this._hiddenParents=!0,this.emit("parent",this._parent);const p=this.enabled;p!==i&&this._onEnabledChange(p);const g=this.readOnly;g!==l&&this._onReadOnlyChange(g);const f=this.hiddenToRoot;f!==h&&this._onHiddenToRootChange(f)}get parent(){return this._parent}set hidden(t){if(t===this._hidden)return;const i=this.hiddenToRoot;this._hidden=t,t?this.class.add(ka):this.class.remove(ka),this.emit(t?"hide":"show"),this.hiddenToRoot!==i&&this._onHiddenToRootChange(this.hiddenToRoot)}get hidden(){return this._hidden}get hiddenToRoot(){return this._hidden||this._hiddenParents}set readOnly(t){this._readOnly!==t&&(this._readOnly=t,this._onReadOnlyChange(t))}get readOnly(){var t;return this._ignoreParent?this._readOnly:this._readOnly||!!((t=this._parent)!=null&&t.readOnly)}set error(t){this._hasError!==t&&(this._hasError=t,t?this.class.add(Ia):this.class.remove(Ia))}get error(){return this._hasError}get style(){return this._dom.style}get class(){return this._dom.classList}set width(t){this.style.width=typeof t=="number"?`${String(t)}px`:t}get width(){return this._dom.clientWidth}set height(t){this.style.height=typeof t=="number"?`${String(t)}px`:t}get height(){return this._dom.clientHeight}set tabIndex(t){this._dom.tabIndex=t}get tabIndex(){return this._dom.tabIndex}get destroyed(){return this._destroyed}set flexDirection(t){this.style.flexDirection=t}get flexDirection(){return this.style.flexDirection}set flexGrow(t){this.style.flexGrow=t}get flexGrow(){return this.style.flexGrow}set flexBasis(t){this.style.flexBasis=t}get flexBasis(){return this.style.flexBasis}set flexShrink(t){this.style.flexShrink=t}get flexShrink(){return this.style.flexShrink}set flexWrap(t){this.style.flexWrap=t}get flexWrap(){return this.style.flexWrap}set alignItems(t){this.style.alignItems=t}get alignItems(){return this.style.alignItems}set alignSelf(t){this.style.alignSelf=t}get alignSelf(){return this.style.alignSelf}set justifyContent(t){this.style.justifyContent=t}get justifyContent(){return this.style.justifyContent}set justifySelf(t){this.style.justifySelf=t}get justifySelf(){return this.style.justifySelf}set disabled(t){this.enabled=!t}get disabled(){return!this.enabled}set element(t){this._dom=t}get element(){return this.dom}set innerElement(t){this._domContent=t}get innerElement(){return this._domContent}}S(ht,"EVENT_ENABLE","enable"),S(ht,"EVENT_DISABLE","disable"),S(ht,"EVENT_HIDE","hide"),S(ht,"EVENT_HIDE_TO_ROOT","hideToRoot"),S(ht,"EVENT_SHOW","show"),S(ht,"EVENT_SHOW_TO_ROOT","showToRoot"),S(ht,"EVENT_READ_ONLY","readOnly"),S(ht,"EVENT_PARENT","parent"),S(ht,"EVENT_CLICK","click"),S(ht,"EVENT_HOVER","hover"),S(ht,"EVENT_HOVER_END","hoverend"),S(ht,"EVENT_DESTROY","destroy");const za=4,Ra=[null,"top","right","bottom","left"],Va=`${zs}-resizing`,nu="tv-resizable-handle",Rs="tv-container-dragged",Da=`${Rs}-child`,Ti=m=>"dom"in m?m.dom:m;class Ii extends ht{constructor(t={}){super(t);S(this,"_scrollable",!1);S(this,"_flex",!1);S(this,"_grid",!1);S(this,"_domResizeHandle",null);S(this,"_resizeTouchId",null);S(this,"_resizeData",null);S(this,"_resizeHorizontally",!0);S(this,"_resizeMin",100);S(this,"_resizeMax",300);S(this,"_draggedStartIndex",-1);S(this,"_domContent");S(this,"_resizable",null);S(this,"_onScroll",t=>{this.emit("scroll",t)});S(this,"_onResizeStart",t=>{t.preventDefault(),t.stopPropagation(),window.addEventListener("mousemove",this._onResizeMove),window.addEventListener("mouseup",this._onResizeEnd),this._resizeStart()});S(this,"_onResizeMove",t=>{t.preventDefault(),t.stopPropagation(),this._resizeMove(t.clientX,t.clientY)});S(this,"_onResizeEnd",t=>{t.preventDefault(),t.stopPropagation(),window.removeEventListener("mousemove",this._onResizeMove),window.removeEventListener("mouseup",this._onResizeEnd),this._resizeEnd()});S(this,"_onResizeTouchStart",t=>{t.preventDefault(),t.stopPropagation();for(let i=0;i<t.changedTouches.length;i+=1){const l=t.changedTouches[i];l.target===this._domResizeHandle&&(this._resizeTouchId=l.identifier)}window.addEventListener("touchmove",this._onResizeTouchMove),window.addEventListener("touchend",this._onResizeTouchEnd),this._resizeStart()});S(this,"_onResizeTouchMove",t=>{for(let i=0;i<t.changedTouches.length;i+=1){const l=t.changedTouches[i];if(l.identifier===this._resizeTouchId){t.stopPropagation(),t.preventDefault(),this._resizeMove(l.clientX,l.clientY);break}}});S(this,"_onResizeTouchEnd",t=>{for(let i=0;i<t.changedTouches.length;i+=1)if(t.changedTouches[i].identifier!==this._resizeTouchId){this._resizeTouchId=null,t.preventDefault(),t.stopPropagation(),window.removeEventListener("touchmove",this._onResizeTouchMove),window.removeEventListener("touchend",this._onResizeTouchEnd),this._resizeEnd();break}});this.class.add("tv-container"),this.domContent=this._dom,this._domContent=this._dom,t.scrollable&&(this.scrollable=!0),this.flex=!!t.flex;let i=!!t.grid;i&&this.flex&&(console.error('Invalid Container arguments: "grid" and "flex" cannot both be true.'),i=!1),this.grid=i,this.resizable=t.resizable??null,t.resizeMin!==void 0&&(this.resizeMin=t.resizeMin),t.resizeMax!==void 0&&(this.resizeMax=t.resizeMax)}destroy(){this._destroyed||(this.domContent=null,this._domResizeHandle&&(this._domResizeHandle.removeEventListener("mousedown",this._onResizeStart),window.removeEventListener("mousemove",this._onResizeMove),window.removeEventListener("mouseup",this._onResizeEnd),this._domResizeHandle.removeEventListener("touchstart",this._onResizeTouchStart),window.removeEventListener("touchmove",this._onResizeTouchMove),window.removeEventListener("touchend",this._onResizeTouchEnd)),super.destroy())}append(t){const i=Ti(t);this._domContent.appendChild(i),this._onAppendChild(t)}appendBefore(t,i){const l=Ti(t);this._domContent.appendChild(l);const h=i&&Ti(i);this._domContent.insertBefore(l,h),this._onAppendChild(t)}appendAfter(t,i){const l=Ti(t),h=i&&Ti(i),p=h?h.nextSibling:null;p?this._domContent.insertBefore(l,p):this._domContent.appendChild(l),this._onAppendChild(t)}prepend(t){const i=Ti(t),l=this._domContent.firstChild;l?this._domContent.insertBefore(i,l):this._domContent.appendChild(i),this._onAppendChild(t)}remove(t){if(t.parent!==this)return;const i=Ti(t);this._domContent.removeChild(i),this._onRemoveChild(t)}move(t,i){let l=-1;for(let h=0;h<this.dom.childNodes.length;h+=1)if(this.dom.childNodes[h].ui===t){l=h;break}l===-1?this.appendBefore(t,this.dom.childNodes[i]):i!==l&&(this.remove(t),i<l?this.appendBefore(t,this.dom.childNodes[i]):this.appendAfter(t,this.dom.childNodes[i-1]))}clear(){for(let t=this._domContent.childNodes.length-1;t>-1;t-=1){const i=this._domContent.childNodes[t];i.ui&&i.ui!==this&&i.ui.destroy()}this._domResizeHandle&&(this._domResizeHandle.removeEventListener("mousedown",this._onResizeStart),this._domResizeHandle.removeEventListener("touchstart",this._onResizeTouchStart),this._domResizeHandle=null),this._domContent.innerHTML="",this.resizable&&(this._domResizeHandle=this._createResizeHandle(),this._dom.appendChild(this._domResizeHandle))}_onAppendChild(t){t.parent=this,this.emit("append",t)}_onRemoveChild(t){t.parent=null,this.emit("remove",t)}_createResizeHandle(){const t=document.createElement("div");return t.classList.add(nu),t.ui=this,t.addEventListener("mousedown",this._onResizeStart),t.addEventListener("touchstart",this._onResizeTouchStart,{passive:!1}),t}_resizeStart(){this.class.add(Va)}_resizeMove(t,i){if(!this._resizeData){this._resizeData={height:this.dom.clientHeight,width:this.dom.clientWidth,x:t,y:i};return}if(this._resizeHorizontally){let l=this._resizeData.x-t;this._resizable==="right"&&(l=-l),this.width=za+Math.max(this._resizeMin,Math.min(this._resizeMax,this._resizeData.width+l))}else{let l=this._resizeData.y-i;this._resizable==="bottom"&&(l=-l),this.height=Math.max(this._resizeMin,Math.min(this._resizeMax,this._resizeData.height+l))}this.emit("resize")}_resizeEnd(){this._resizeData=null,this.class.remove(Va)}resize(t=0,i=0){this._resizeStart(),this._resizeMove(0,0),this._resizeMove(-t+za,-i),this._resizeEnd()}_getDraggedChildIndex(t){for(let i=0;i<this.dom.childNodes.length;i+=1)if(this.dom.childNodes[i].ui===t)return i;return-1}_onChildDragStart(t,i){this.class.add(Da),this._draggedStartIndex=this._getDraggedChildIndex(i),i.class.add(Rs),this.emit("child:dragstart",i,this._draggedStartIndex)}_onChildDragMove(t,i){const l=this.dom.getBoundingClientRect(),h=t.clientX<l.left||t.clientX>l.right||t.clientY<l.top||t.clientY>l.bottom,p=this._getDraggedChildIndex(i);if(h){i.class.remove(Rs),this._draggedStartIndex!==p&&(this.remove(i),this._draggedStartIndex<p?this.appendBefore(i,this.dom.childNodes[this._draggedStartIndex]):this.appendAfter(i,this.dom.childNodes[this._draggedStartIndex-1]));return}i.class.add(Rs);const g=t.clientY-l.top;let f=null;for(let x=0;x<this.dom.childNodes.length;x+=1){const E=this.dom.childNodes[x].ui,A=E.dom.offsetTop;if(x<p){if(g<=A+E.header.height){f=x;break}}else if(x>p&&g+i.height>=A+E.height){f=x;break}}f!==null&&p!==f&&(this.remove(i),f<p?this.appendBefore(i,this.dom.childNodes[f]):this.appendAfter(i,this.dom.childNodes[f-1]))}_onChildDragEnd(t,i){this.class.remove(Da),i.class.remove(Rs);const l=this._getDraggedChildIndex(i);this.emit("child:dragend",i,l,this._draggedStartIndex),this._draggedStartIndex=-1}forEachChild(t){for(let i=0;i<this.dom.childNodes.length;i+=1){const l=this.dom.childNodes[i].ui;if(l&&t(l,i)===!1)break}}set flex(t){t!==this._flex&&(this._flex=t,t?this.class.add(Ea):this.class.remove(Ea))}get flex(){return this._flex}set grid(t){t!==this._grid&&(this._grid=t,t?this.class.add(Pa):this.class.remove(Pa))}get grid(){return this._grid}set scrollable(t){this._scrollable!==t&&(this._scrollable=t,t?this.class.add(Aa):this.class.remove(Aa))}get scrollable(){return this._scrollable}set resizable(t){if(t!==this._resizable){if(Ra.indexOf(t)===-1){console.error(`Invalid resizable value: must be one of ${Ra.join(",")}`);return}this._resizable&&this.class.remove(`${zs}-${this._resizable}`),this._resizable=t,this._resizeHorizontally=t==="right"||t==="left",t?(this.class.add(zs),this.class.add(`${zs}-${t}`),this._domResizeHandle||(this._domResizeHandle=this._createResizeHandle()),this._dom.appendChild(this._domResizeHandle)):(this.class.remove(zs),this._domResizeHandle&&this._dom.removeChild(this._domResizeHandle))}}get resizable(){return this._resizable}set resizeMin(t){this._resizeMin=Math.max(0,Math.min(t,this._resizeMax))}get resizeMin(){return this._resizeMin}set resizeMax(t){this._resizeMax=Math.max(this._resizeMin,t)}get resizeMax(){return this._resizeMax}set domContent(t){this._domContent!==t&&(this._domContent&&this._domContent.removeEventListener("scroll",this._onScroll),this._domContent=t,this._domContent&&this._domContent.addEventListener("scroll",this._onScroll))}get domContent(){return this._domContent}}S(Ii,"EVENT_APPEND","append"),S(Ii,"EVENT_REMOVE","remove"),S(Ii,"EVENT_SCROLL","scroll"),S(Ii,"EVENT_RESIZE","resize");const iu="tv-label";class Oa extends ht{constructor(t={}){super({dom:"span",...t});S(this,"_unsafe");S(this,"_text","");S(this,"renderChanges",!1);this.class.add(iu),this._unsafe=t.unsafe??!1,this.text=t.text??t.value??"",t.allowTextSelection&&this.class.add(Qp),t.nativeTooltip&&(this.dom.title=this.text),this.placeholder=t.placeholder??null,this.renderChanges=t.renderChanges??!1,this.on("change",()=>{this.renderChanges&&this.flash()})}_updateText(t){return this.class.remove(ao),this._text===t?!1:(this._text=t,this._unsafe?this._dom.innerHTML=t:this._dom.textContent=t,this.emit("change",t),!0)}set text(t){this._updateText(t??"")}get text(){return this._text}set value(t){this.text=t}get value(){return this.text}set values(t){t.some(i=>i!==t[0])?(this._updateText(""),this.class.add(ao)):this._updateText(t[0])}set placeholder(t){t?this.dom.setAttribute("placeholder",t):this.dom.removeAttribute("placeholder")}get placeholder(){return this.dom.getAttribute("placeholder")??""}}const su="tv-input-element";class ou extends ht{constructor(t={}){super(t);S(this,"_domInput");S(this,"_suspendInputChangeEvt");S(this,"_prevValue");S(this,"_keyChange",!1);S(this,"_renderChanges",!1);S(this,"_blurOnEnter",!0);S(this,"_blurOnEscape",!0);S(this,"_onInputKeyDownEvt");S(this,"_onInputChangeEvt");S(this,"_onInputFocus",t=>{this.class.add(La),this.emit("focus",t),this._prevValue=this._domInput.value});S(this,"_onInputBlur",t=>{this.class.remove(La),this.emit("blur",t)});S(this,"_onInputKeyUp",t=>{t.key!=="Escape"&&this._onInputChange(t),this.emit("keyup",t)});S(this,"_onInputCtxMenu",t=>{this._domInput.select()});S(this,"_updateInputReadOnly",()=>{!this.enabled||this.readOnly?this._domInput.setAttribute("readonly","true"):this._domInput.removeAttribute("readonly")});this.class.add(su);let i=t.input;i||(i=document.createElement("input"),i.type="text"),i.ui=this,i.tabIndex=0,i.autocomplete="off",this._onInputKeyDownEvt=this._onInputKeyDown.bind(this),this._onInputChangeEvt=this._onInputChange.bind(this),i.addEventListener("change",this._onInputChangeEvt),i.addEventListener("keydown",this._onInputKeyDownEvt),i.addEventListener("focus",this._onInputFocus),i.addEventListener("blur",this._onInputBlur),i.addEventListener("contextmenu",this._onInputCtxMenu,!1),this.dom.appendChild(i),this._domInput=i,this._suspendInputChangeEvt=!1,t.value!==void 0&&(this._domInput.value=t.value),this.placeholder=t.placeholder??"",this.renderChanges=t.renderChanges??!1,this.blurOnEnter=t.blurOnEnter??!0,this.blurOnEscape=t.blurOnEscape??!0,this.keyChange=t.keyChange??!1,this._prevValue=null,this.on("change",()=>{this.renderChanges&&this.flash()}),this.on("disable",this._updateInputReadOnly),this.on("enable",this._updateInputReadOnly),this.on("readOnly",this._updateInputReadOnly),this._updateInputReadOnly()}destroy(){if(this._destroyed)return;const t=this._domInput;t.removeEventListener("change",this._onInputChangeEvt),t.removeEventListener("keydown",this._onInputKeyDownEvt),t.removeEventListener("focus",this._onInputFocus),t.removeEventListener("blur",this._onInputBlur),t.removeEventListener("keyup",this._onInputKeyUp),t.removeEventListener("contextmenu",this._onInputCtxMenu),super.destroy()}_onInputKeyDown(t){if(t.key==="Enter"&&this.blurOnEnter)this._suspendInputChangeEvt=this.keyChange,this._domInput.blur(),this._suspendInputChangeEvt=!1;else if(t.key==="Escape"){this._suspendInputChangeEvt=!0;const i=this._domInput.value;this._domInput.value=this._prevValue??"",this._suspendInputChangeEvt=!1,this.keyChange&&i!==this._prevValue&&this._onInputChange(t),this.blurOnEscape&&this._domInput.blur()}this.emit("keydown",t)}_onInputChange(t){}focus(t){this._domInput.focus(),t&&this._domInput.select()}blur(){this._domInput.blur()}set placeholder(t){t?this.dom.setAttribute("placeholder",t):this.dom.removeAttribute("placeholder")}get placeholder(){return this.dom.getAttribute("placeholder")??""}set keyChange(t){this._keyChange!==t&&(this._keyChange=t,t?this._domInput.addEventListener("keyup",this._onInputKeyUp):this._domInput.removeEventListener("keyup",this._onInputKeyUp))}get keyChange(){return this._keyChange}get input(){return this._domInput}set blurOnEnter(t){this._blurOnEnter=t}get blurOnEnter(){return this._blurOnEnter}set blurOnEscape(t){this._blurOnEnter=t}get blurOnEscape(){return this._blurOnEnter}set renderChanges(t){this._renderChanges=t}get renderChanges(){return this._renderChanges}}class ru extends ou{constructor(t={}){super(t);S(this,"_onValidate");this.class.add("tv-text-input"),t.onValidate&&(this.onValidate=t.onValidate)}_onInputChange(){if(!this._suspendInputChangeEvt){if(this._onValidate){const t=!this._onValidate(this.value);if(this.error=t,t)return}else this.error=!1;this.emit("change",this.value)}}_updateValue(t){let i=t;if(this.class.remove(ao),i&&typeof i=="object")if(Array.isArray(i)){let l=!1;for(let h=0;h<i.length;h+=1)if(i[h]&&typeof i[h]=="object"){l=!0;break}i=l?"[Not available]":i.map(h=>h===null?"null":h).join(",")}else i="[Not available]";return i===this.value?!1:(this._suspendInputChangeEvt=!0,this._domInput.value=i==null?"":String(i),this._suspendInputChangeEvt=!1,this.emit("change",i),!0)}set value(t){this._updateValue(t)&&(this.error=!1)}get value(){return this._domInput.value}set values(t){t.some(i=>i!==t[0])?(this._updateValue(null),this.class.add(ao)):this._updateValue(t[0])}set onValidate(t){this._onValidate=t}get onValidate(){return this._onValidate}}const Ko="tv-item-selected",Uo="tv-item-open",au="tv-item-contents",Go="tv-item-empty",$o="tv-item-rename",_n=class extends Ii{constructor(t={}){super(t);S(this,"_containerContents");S(this,"_labelIcon");S(this,"_labelText");S(this,"_numChildren",0);S(this,"_treeView");S(this,"_allowDrag",!0);S(this,"_allowDrop",!0);S(this,"_allowSelect",!0);S(this,"_icon");S(this,"_onContentKeyDown",t=>{t.target.tagName!=="INPUT"&&this.allowSelect&&this._treeView&&this._treeView._onChildKeyDown(t,this)});S(this,"_onContentMouseDown",t=>{var i;!((i=this._treeView)!=null&&i.allowDrag)||!this._allowDrag||(this._treeView._updateModifierKeys(t),t.stopPropagation())});S(this,"_onContentMouseUp",t=>{t.stopPropagation(),t.preventDefault(),window.removeEventListener("mouseup",this._onContentMouseUp),this._treeView&&this._treeView._onChildDragEnd(t,this)});S(this,"_onContentMouseOver",t=>{t.stopPropagation(),this._treeView&&this._treeView._onChildDragOver(t,this),this.emit("hover",t)});S(this,"_onContentDragStart",t=>{var i;t.stopPropagation(),t.preventDefault(),(i=this._treeView)!=null&&i.allowDrag&&(this.class.contains($o)||(this._treeView._onChildDragStart(t,this),window.addEventListener("mouseup",this._onContentMouseUp)))});S(this,"_onContentClick",t=>{if(!this.allowSelect||t.button!==0||t.target.tagName==="INPUT")return;t.stopPropagation();const i=this._containerContents.dom.getBoundingClientRect();this._numChildren>0&&t.clientX-i.left<0?(this.open=!this.open,t.altKey&&this._dfs(l=>{l.open=this.open}),this.focus()):this._treeView&&this._treeView._onChildClick(t,this)});S(this,"_onContentDblClick",t=>{var l;if(!((l=this._treeView)!=null&&l.allowRenaming)||t.button!==0||t.target.tagName==="INPUT")return;t.stopPropagation();const i=this._containerContents.dom.getBoundingClientRect();this.numChildren&&t.clientX-i.left<0||(this.allowSelect&&(this._treeView.deselect(),this._treeView._onChildClick(t,this)),this.rename())});S(this,"_onContentContextMenu",t=>{var i,l;(l=(i=this._treeView)==null?void 0:i._onContextMenu)==null||l.call(i,t,this)});S(this,"_onContentFocus",t=>{this.emit("focus")});S(this,"_onContentBlur",t=>{this.emit("blur")});this.class.add("tv-item",Go),this._containerContents=new Ii({class:au,flex:!0,flexDirection:"row",tabIndex:0}),this.append(this._containerContents),this._containerContents.dom.innerHTML+='<svg class="icon-minus" viewBox="0 0 32 32"><path fill="#fff" d="M8 14.656h16v2.688h-16v-2.688z"></path></svg>',this._containerContents.dom.innerHTML+='<svg class="icon-plus" viewBox="0 0 768 768"><path fill="#fff" d="M607.5 415.5h-192v192h-63v-192h-192v-63h192v-192h63v192h192v63z"></path></svg>',this._containerContents.dom.draggable=!0,this._labelIcon=new Oa({class:"tv-item-icon"}),this._containerContents.append(this._labelIcon),this.icon=t.icon,this._labelText=new Oa({class:"tv-item-text"}),this._containerContents.append(this._labelText),this.allowSelect=t.allowSelect??!0,this.allowDrop=t.allowDrop??!0,this.allowDrag=t.allowDrag??!0,t.text&&(this.text=t.text),t.selected&&(this.selected=t.selected);const i=this._containerContents.dom;i.addEventListener("focus",this._onContentFocus),i.addEventListener("blur",this._onContentBlur),i.addEventListener("keydown",this._onContentKeyDown),i.addEventListener("dragstart",this._onContentDragStart),i.addEventListener("mousedown",this._onContentMouseDown),i.addEventListener("mouseover",this._onContentMouseOver),i.addEventListener("click",this._onContentClick),i.addEventListener("dblclick",this._onContentDblClick),i.addEventListener("contextmenu",this._onContentContextMenu)}destroy(){if(this._destroyed)return;const{dom:t}=this._containerContents;t.removeEventListener("focus",this._onContentFocus),t.removeEventListener("blur",this._onContentBlur),t.removeEventListener("keydown",this._onContentKeyDown),t.removeEventListener("dragstart",this._onContentDragStart),t.removeEventListener("mousedown",this._onContentMouseDown),t.removeEventListener("mouseover",this._onContentMouseOver),t.removeEventListener("click",this._onContentClick),t.removeEventListener("dblclick",this._onContentDblClick),t.removeEventListener("contextmenu",this._onContentContextMenu),window.removeEventListener("mouseup",this._onContentMouseUp),super.destroy()}_onAppendChild(t){super._onAppendChild(t),t instanceof _n&&(this._numChildren+=1,this._parent!==this._treeView&&this.class.remove(Go),this._treeView&&this._treeView._onAppendTreeViewItem(t))}_onRemoveChild(t){t instanceof _n&&(this._numChildren-=1,this._numChildren===0&&this.class.add(Go),this._treeView&&this._treeView._onRemoveTreeViewItem(t)),super._onRemoveChild(t)}_dfs(t){t(this);let i=this.firstChild;for(;i;)i._dfs(t),i=i.nextSibling}rename(){this.class.add($o);const t=new ru({class:Al,renderChanges:!1,value:this.text});t.on("blur",()=>{t.destroy()}),t.on("destroy",()=>{this.class.remove($o),this.focus()}),t.on("change",i=>{const l=i.trim();l&&(this.text=l,t.destroy())}),t.on("disable",()=>{t.input.removeAttribute("readonly")}),this._containerContents.append(t),t.focus(!0)}focus(){this._containerContents.dom.focus()}blur(){this._containerContents.dom.blur()}set selected(t){if(t===this.selected){t&&this.focus();return}t?(this._containerContents.class.add(Ko),this.emit("select",this),this._treeView&&this._treeView._onChildSelected(this),this.focus()):(this._containerContents.class.remove(Ko),this.blur(),this.emit("deselect",this),this._treeView&&this._treeView._onChildDeselected(this))}get selected(){return this._containerContents.class.contains(Ko)}set text(t){this._labelText.value!==t&&(this._labelText.value=t,this._treeView&&this._treeView._onChildRename(this,t))}get text(){return this._labelText.value}get textLabel(){return this._labelText}get iconLabel(){return this._labelIcon}set open(t){if(this.open!==t)if(t){if(!this.numChildren)return;this.class.add(Uo),this.emit("open",this)}else this.class.remove(Uo),this.emit("close",this)}get open(){return this.class.contains(Uo)||this.parent===this._treeView}set parentsOpen(t){let i=this.parent;for(;i&&i instanceof _n;)i.open=t,i=i.parent}get parentsOpen(){let t=this.parent;for(;t&&t instanceof _n;){if(!t.open)return!1;t=t.parent}return!0}set allowDrop(t){this._allowDrop=t}get allowDrop(){return this._allowDrop}set allowDrag(t){this._allowDrag=t}get allowDrag(){return this._allowDrag}set allowSelect(t){this._allowSelect=t}get allowSelect(){return this._allowSelect}set treeView(t){this._treeView=t}get treeView(){return this._treeView}get numChildren(){return this._numChildren}get firstChild(){if(this._numChildren){for(let t=0;t<this.dom.childNodes.length;t+=1)if(this.dom.childNodes[t].ui instanceof _n)return this.dom.childNodes[t].ui}return null}get lastChild(){if(this._numChildren){for(let t=this.dom.childNodes.length-1;t>=0;t-=1)if(this.dom.childNodes[t].ui instanceof _n)return this.dom.childNodes[t].ui}return null}get nextSibling(){let t=this.dom.nextSibling;for(;t&&!(t.ui instanceof _n);)t=t.nextSibling;return t&&t.ui}get previousSibling(){let t=this.dom.previousSibling;for(;t&&!(t.ui instanceof _n);)t=t.previousSibling;return t&&t.ui}set icon(t){this._icon!==t&&(this._icon=t,t?this._labelIcon.dom.setAttribute("data-icon",String.fromCodePoint(Number.parseInt(t,16))):(this._labelIcon.dom.style.display="none",this._labelIcon.dom.removeAttribute("data-icon")))}get icon(){return this._icon}};let tt=_n;S(tt,"EVENT_SELECT","select"),S(tt,"EVENT_DESELECT","deselect"),S(tt,"EVENT_OPEN","open"),S(tt,"EVENT_CLOSE","close");const lu=`@charset "UTF-8";:host{--font-family: inconsolatamedium, Monaco, Menlo, "Ubuntu Mono", Consolas, source-code-pro, monospace;--bg-darkest: #202020;--bg-darker: #202020;--bg-dark: #282828;--bg-primary: #333333;--color-line: #333333;--color-icon: #666666;--text-darkest: rgb(170 170 170 / 50%);--text-dark: rgb(170 170 170 / 50%);--text-secondary: #aaaaaa;--text-primary: #ffffff;--text-active: #4CAF50;--error: #fb222f;--error-secondary: #d34141;--border-primary: #aaaaaa;--element-shadow-hover: 0 0 2px 1px rgba(255, 102, 0, .3);--element-shadow-active: 0 0 0 1px rgba(255, 102, 0, .3);--element-shadow-error: 0 0 0 1px var(--error-secondary);--element-color-placeholder: #829193;--field-padding: 3px;--disabled-opacity: .4;--element-margin: 6px;--element-opacity-disabled: .4;--element-opacity-readonly: .7}.tv-container{position:relative;min-width:0;min-height:0}.tv-container.tv-resizable>.tv-resizable-handle{position:absolute;z-index:1;opacity:0;background-color:transparent}.tv-container.tv-resizable>.tv-resizable-handle:hover{opacity:1}.tv-container.tv-resizable.tv-resizable-resizing>.tv-resizable-handle{opacity:1}.tv-container.tv-resizable.tv-resizable-left>.tv-resizable-handle,.tv-container.tv-resizable.tv-resizable-right>.tv-resizable-handle{top:0;bottom:0;width:1px;height:auto;cursor:ew-resize}.tv-container.tv-resizable.tv-resizable-left>.tv-resizable-handle{left:0;border-left:3px solid var(--bg-darkest)}.tv-container.tv-resizable.tv-resizable-right>.tv-resizable-handle{right:0;border-right:3px solid var(--bg-darkest)}.tv-container.tv-resizable.tv-resizable-top>.tv-resizable-handle,.tv-container.tv-resizable.tv-resizable-bottom>.tv-resizable-handle{left:0;right:0;width:auto;height:1px;cursor:ns-resize}.tv-container.tv-resizable.tv-resizable-top>.tv-resizable-handle{top:0;border-top:3px solid var(--bg-darkest)}.tv-container.tv-resizable.tv-resizable-bottom>.tv-resizable-handle{bottom:0;border-bottom:3px solid var(--bg-darkest)}.tv-container-dragged{outline:2px solid var(--text-primary);box-sizing:border-box;opacity:.7;z-index:1}.tv-container-dragged-child{outline:1px dotted var(--text-active);box-sizing:border-box}@keyframes tv-flash-animation{0%{outline-color:var(--text-active)}to{outline-color:rgba(var(--text-active),0)}}.tv-element{font-weight:400;font-style:normal;border:0 solid var(--border-primary)}.tv-element.flash{outline:1px solid var(--text-active);animation:tv-flash-animation .2s ease-in-out forwards}.tv-element:focus{outline:none}.tv-element::-moz-focus-inner{border:0}.tv-element.tv-hidden{display:none}.tv-input-element{display:inline-block;border:1px solid var(--bg-darker);border-radius:2px;box-sizing:border-box;margin:var(--element-margin);min-height:24px;height:24px;background-color:var(--bg-dark);vertical-align:top;transition:color .1s,background-color .1s,box-shadow .1s;position:relative;color:var(--text-secondary)}.tv-input-element>input{height:100%;width:calc(100% - 16px);padding:0 var(--element-margin);line-height:1;color:inherit;background:transparent;border:none;outline:none;box-shadow:none;font-family:var(--font-family);font-weight:400;font-size:12px}.tv-input-element:before{color:inherit}.tv-input-element.tv-multiple-values:before{position:absolute;padding:0 8px;content:"...";white-space:nowrap;font-family:var(--font-family);font-weight:400;font-size:12px;top:5px}.tv-input-element:not(.tv-disabled,.tv-readonly):hover{background-color:var(--bg-darker);color:var(--text-primary)}.tv-input-element:not(.tv-disabled,.tv-readonly):not(.tv-error):hover{box-shadow:var(--element-shadow-hover)}.tv-input-element:not(.tv-disabled,.tv-readonly).tv-focus{background-color:var(--bg-darkest);box-shadow:var(--element-shadow-active)}.tv-input-element.tv-focus:after,.tv-input-element.tv-focus:before,.tv-input-element:hover:after,.tv-input-element:hover:before{display:none}.tv-input-element.tv-readonly{border-color:transparent}.tv-input-element.tv-disabled{color:var(--text-darkest)}.tv-input-element.tv-error{color:var(--text-secondary);box-shadow:var(--element-shadow-error)}.tv-input-element[placeholder]{position:relative}.tv-input-element[placeholder]:after{content:attr(placeholder);background-color:var(--bg-dark);position:absolute;top:0;right:0;padding:0 8px;line-height:22px;font-size:10px;font-weight:600;white-space:nowrap;color:var(--element-color-placeholder);pointer-events:none}.tv-label{display:inline-block;box-sizing:border-box;margin:var(--element-margin);vertical-align:middle;transition:opacity .1s;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;user-select:none}.tv-label.tv-default-mousedown{user-select:initial}.tv-label.tv-multiple-values{position:relative;color:transparent}.tv-label.tv-multiple-values:before{content:"...";color:var(--text-secondary);white-space:nowrap;font-family:var(--font-family);font-weight:400;font-size:12px}.tv-label.tv-error{color:var(--error-secondary)}.tv-label.tv-selectable:hover{color:var(--text-active);text-decoration:underline;-webkit-touch-callout:none;user-select:none}.tv-label[placeholder]{position:relative}.tv-label[placeholder]:after{content:attr(placeholder);position:absolute;top:0;right:0;padding:0 8px;color:#999;pointer-events:none}@font-face{font-family:plusminus;font-weight:400;font-style:normal;font-display:block;src:url(data:application/octet-stream;base64,d09GMgABAAAAAAIwAA0AAAAABfgAAAHdAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP0ZGVE0cGh4GYACCXhEICoEEdwsQAAE2AiQDGgQgBYMbB08b9ATIngXlmGuJ8SoMIRZRsZl/ekTw/n6fc8598IHUlkA1VShRNdXA8c3GF5hkhanQ64qWQG+qm8oPha05+yUS9oRC13hgWQsEyteqVv9/VZNP3eT/L9AsHJO6TDJaYF1i4dgYYNp5gIGOTZsyCtADo6yd/1efyWczfAZJsv8mymY0CgHfr5/vw5//JurZwgAzkEJohAqJUi7EAzX5Mj/iPlXHXxujS9XERO12mo8yN52zvUABAdKVhLLtUgIHpASWStsMPR0phZXzMTUY5ufM9IJaEXoAQiEaogCRSABAUMETIaaNQQtGqLEYVgNUgECIVpioB3Hj4ZpRnC5nrwxiWPo5BIAp+4zEVxfZE94PBHDnzXA1rm3+1+lXvNcOytr8hI4EgV9slUY8fiM0FSD2AiQqwWeB1kCABADAyGsBQmtCILXWECha2wlUWgcI1PpOEGi0ngjQs9hfEVVXGGEg8YWg4OtAhe+kajMmVGPkSsOeTX5mzZ0dnZ2dMLs8+5xPsMvS2tPB1A1PyPLQm7Em32fp5m7rNwLL43ApGKwfM3eU7gdjbek0hTv1sLRwznwZHeADy+JCG9tqrc78/PnCEpDSupZIGUWJKurmyOF72YTc0dPWe5/JRt17IwA=)}.tv{-webkit-touch-callout:none;user-select:none;min-width:max-content}.tv-item{position:relative;padding-left:24px}.tv-item:before{content:"\\a0";position:absolute;background-color:var(--color-icon);width:2px;left:14px;top:-12px;bottom:12px}.tv-item:last-child:before{height:25px;bottom:auto}.tv-item.tv-disabled>.tv-item-contents>.tv-item-text{opacity:var(--disabled-opacity)}.tv-item-contents{position:relative;color:var(--text-secondary);margin-left:3px;border:1px solid transparent;align-items:center;height:24px;box-sizing:border-box}.tv-item-contents:hover{cursor:pointer;color:var(--text-primary);background-color:var(--bg-dark)}.tv-item-contents:hover>.tv-item-icon{color:var(--text-primary)}.tv-item-icon{color:var(--text-darkest);margin:0 2px 0 0;flex-shrink:0}.tv-item-icon:before{content:"\\a0";position:absolute;background-color:var(--color-icon);left:-12px;top:10px;width:24px;height:2px}.tv-item-icon:after{content:attr(data-icon);display:inline-block;vertical-align:sub;width:22px;height:22px;position:relative;z-index:1;text-align:center}.tv-item-text{margin:0;flex-shrink:0;position:relative;z-index:1;transition:opacity .1s;padding-right:8px;color:inherit}.tv-item-contents.tv-item-selected{background-color:var(--bg-darkest);color:var(--text-primary)}.tv-item-contents.tv-item-selected>.tv-item-icon{color:var(--text-primary)}.tv-item .icon-plus,.tv-item .icon-minus{position:absolute;font-size:10px;font-weight:700;text-align:center;color:var(--text-secondary);background-color:var(--bg-dark);top:0;left:-24px;width:16px;height:16px;line-height:16px;margin:3px;cursor:pointer;z-index:1;box-sizing:border-box;padding:2px}.tv-item .tv-item.tv-item-empty .icon-plus,.tv-item .tv-item.tv-item-empty .icon-minus{display:none}.tv-item>.tv-item-contents .icon-minus{display:none}.tv-item.tv-item-open>.tv-item-contents .icon-minus{display:block}.tv-item.tv-item-open>.tv-item-contents .icon-plus{display:none}.tv>.tv-item{padding-left:0}.tv>.tv-item:before{content:none}.tv>.tv-item>.tv-item-contents{margin-left:0}.tv>.tv-item>.tv-item-contents>.tv-item-icon:before{content:none}.tv>.tv-item>.tv-item-contents>.tv-item-icon:after{margin-left:0}.tv>.tv-item>.tv-item{padding-left:21px}.tv>.tv-item>.tv-item:before{left:11px}.tv:not(.tv-filtering)>.tv-item .tv-item:not(.tv-item-open,.tv-item-empty)>.tv-item{display:none}.tv-item-dragged>.tv-item-contents{background-color:rgba(var(--bg-dark),.5);color:var(--text-primary)}.tv-drag-handle{position:fixed;width:32px;height:20px;top:0;bottom:0;z-index:4;margin-top:-1px;margin-left:-1px}.tv-drag-handle.before{border-top:4px solid var(--text-active);padding-right:8px;height:24px}.tv-drag-handle.inside{border:4px solid var(--text-active)}.tv-drag-handle.after{border-bottom:4px solid var(--text-active);padding-right:8px;height:24px}.tv-item-contents:after{content:" ";display:block;clear:both}.tv-item.tv-item-rename>.tv-item-contents>.tv-item-text{display:none}.tv-item.tv-item-rename>.tv-item-contents>.tv-text-input{margin:0;flex-grow:1;box-shadow:none!important;border:0;background-color:transparent}.tv-item.tv-item-rename>.tv-item-contents>.tv-text-input>input{font-family:inherit;font-size:14px;padding:0}.tv.tv-filtering .tv-item{padding-left:0}.tv.tv-filtering .tv-item:before{display:none}.tv.tv-filtering .tv-item:not(.tv-filtering-result)>.tv-item-contents{display:none}.tv.tv-filtering .tv-item-contents{margin-left:0}.tv-filtering-result .tv-item-contents:before,.tv-filtering-result .tv-item-icon:before{display:none}.tv-no-select{-webkit-touch-callout:none;user-select:none}.tv-flex{flex-direction:column}.tv-flex:not(.tv-hidden){display:flex}.tv-grid{display:grid}.tv-scrollable{overflow:auto}.tv-hidden{display:none}.font-thin{font-weight:100;font-style:normal}.font-light{font-weight:200;font-style:normal}.font-regular{font-weight:400;font-style:normal}.font-bold{font-weight:700;font-style:normal}.fixed-font{font-family:var(--font-family);font-weight:400;font-size:12px}
`,cu=(m,a)=>{if(m.length===0)return a.length;if(a.length===0)return m.length;if(m===a)return 0;const t=[];for(let i=0;i<=a.length;i++)t[i]=[i];for(let i=0;i<=m.length;i++)t[0][i]=i;for(let i=1;i<=a.length;i++)for(let l=1;l<=m.length;l++)a.charAt(i-1)===m.charAt(l-1)?t[i][l]=t[i-1][l-1]:t[i][l]=Math.min(t[i-1][l-1]+1,Math.min(t[i][l-1]+1,t[i-1][l]+1));return t[a.length][m.length]},du=(m,a)=>{if(m===a)return m.length;let t=0;const i=new Set;for(let l=0;l<a.length;l++)i.add(a.charAt(l));for(let l=0;l<m.length;l++)i.has(m.charAt(l))&&t++;return t},Na=m=>{const a=[],t=m.replace(/([^A-Z])([A-Z][^A-Z])/g,"$1 $2").replace(/([A-Z0-9]{2,})/g," $1").split(/(\s|\-|_)/g);for(let i=0;i<t.length;i++)t[i]=t[i].toLowerCase().trim(),t[i]&&t[i]!=="-"&&t[i]!=="_"&&a.push(t[i]);return a},hu=(m,a,t)=>{const i=[];for(const l of m){if(l.subFull!==1/0){i.push(l),l.edits===1/0&&(l.edits=0),l.sub===1/0&&(l.sub=l.subFull);continue}else if(l.name===a||l.name.startsWith(a)){i.push(l),l.edits===1/0&&(l.edits=0),l.sub===1/0&&(l.sub=0);continue}if(du(a,l.name)/a.length<(t.containsCharsTolerance??0))continue;let h=1/0,p=1/0;for(let g=0;g<l.tokens.length;g++){if(l.tokens[g]===a){h=0,p=g;break}const f=cu(a,l.tokens[g]);if((p===1/0||f<h)&&l.tokens[g].indexOf(a)!==-1){p=g,h=f;continue}else p===1/0&&f<h&&f/Math.max(a.length,l.tokens[g].length)<=(t.editsDistanceTolerance??0)&&(h=f)}h!==1/0&&(i.push(l),l.edits=l.edits===1/0?h:l.edits+h,l.sub=l.sub===1/0?p:l.sub+p)}return i},pu=(m,a="",t={})=>{if(a=a.toLowerCase().trim(),!a)return[];const i=Na(a);if(!i.length)return[];t.containsCharsTolerance??(t.containsCharsTolerance=.5),t.editsDistanceTolerance??(t.editsDistanceTolerance=.5);let l=[];for(const p of m){const g=p[0].toLowerCase().trim().indexOf(a);l.push({name:p[0],item:p[1],tokens:Na(p[0]),edits:1/0,subFull:g!==-1?g:1/0,sub:1/0})}for(let p=0;p<i.length;p++)l=hu(l,i[p],t);l.sort((p,g)=>p.subFull!==g.subFull?p.subFull-g.subFull:p.sub!==g.sub?p.sub-g.sub:p.edits!==g.edits?p.edits-g.edits:p.name.length-g.name.length);let h=l.map(p=>p.item);return t.hasOwnProperty("limitResults")&&h.length>(t.limitResults??0)&&(h=h.slice(0,t.limitResults)),h},qo="tv-item-dragged",uu="tv-drag-handle",ja="tv-filtering",eo="tv-filtering-result",Jn="inside",Is="before",to="after",Yo=(m,a)=>Array.prototype.indexOf.call(a.dom.childNodes,m.dom)-1,Fa=m=>{m.parentsOpen=!0},Ha=m=>{if(m.numChildren>0&&m.open)return m.firstChild;const a=m.nextSibling;if(a)return a;let t=m.parent;if(!(t instanceof tt))return null;let i=t.nextSibling;for(;!i&&(t=t.parent,t instanceof tt);)i=t.nextSibling;return i},vu=m=>{if(!m.numChildren||!m.open)return null;let a=m.lastChild;for(;a!=null&&a.numChildren&&a.open;)a=a.lastChild;return a},Ba=m=>{const a=m.previousSibling;if(a)return a.numChildren>0&&a.open?vu(a):a;const t=m.parent;return t instanceof tt?t:null};class Li extends Ii{constructor(t={}){super(t);S(this,"_selectedItems",[]);S(this,"_dragItems",[]);S(this,"_allowDrag");S(this,"_allowReordering");S(this,"_allowRenaming");S(this,"_dragging",!1);S(this,"_dragOverItem",null);S(this,"_dragArea",Jn);S(this,"_dragScroll",0);S(this,"_dragScrollInterval",null);S(this,"_dragHandle");S(this,"_dragScrollElement");S(this,"_onContextMenu");S(this,"_onReparentFn");S(this,"_pressedCtrl",!1);S(this,"_pressedShift",!1);S(this,"_filter",null);S(this,"_filterResults",[]);S(this,"_wasDraggingAllowedBeforeFiltering");S(this,"_updateModifierKeys",t=>{this._pressedCtrl=(t==null?void 0:t.ctrlKey)??(t==null?void 0:t.metaKey)??!1,this._pressedShift=(t==null?void 0:t.shiftKey)??!1});S(this,"_onMouseLeave",t=>{!this._allowDrag||!this._dragging||(this._dragOverItem=null,this._updateDragHandle())});S(this,"_onMouseMove",t=>{if(!this._dragging)return;const i=this.dom.getBoundingClientRect();this._dragScroll=0;let l=i.top,h=i.bottom;if(this._dragScrollElement!==this){const p=this._dragScrollElement.dom.getBoundingClientRect();l=Math.max(l+this._dragScrollElement.dom.scrollTop,p.top),h=Math.min(h+this._dragScrollElement.dom.scrollTop,p.bottom)}l=Math.max(0,l),h=Math.min(h,document.body.clientHeight),t.pageY<l+32&&this._dragScrollElement.dom.scrollTop>0?this._dragScroll=-1:t.pageY>h-32&&this._dragScrollElement.dom.scrollHeight>this._dragScrollElement.height+this._dragScrollElement.dom.scrollTop&&(this._dragScroll=1)});S(this,"_onDragMove",t=>{if(t.preventDefault(),t.stopPropagation(),!this._allowDrag||!this._dragOverItem)return;const i=this._dragHandle.dom.getBoundingClientRect(),l=Math.floor((t.clientY-i.top)/i.height*5),h=this._dragArea,p=this._dragOverItem;if(this._dragOverItem.parent===this){let g=!1;for(let f=0;f<this._dragItems.length;f+=1)if(this._dragItems[f].parent===this._dragOverItem){g=!0,this._dragOverItem=null;break}g||(this._dragArea=Jn)}else{let g=!1;for(let f=0;f<this._dragItems.length;f+=1)if(this._dragItems[f].dom.contains(this._dragOverItem.dom)){g=!0;break}if(g)this._dragOverItem=null;else if(this._allowReordering&&l<=1&&this._dragOverItem.previousSibling&&this._dragItems.indexOf(this._dragOverItem.previousSibling)===-1)this._dragArea=Is;else if(this._allowReordering&&l>=4&&this._dragOverItem.nextSibling&&this._dragItems.indexOf(this._dragOverItem.nextSibling)===-1&&(this._dragOverItem.numChildren===0||!this._dragOverItem.open))this._dragArea=to;else{let f=!1;if(this._allowReordering&&this._dragOverItem.open){for(let x=0;x<this._dragItems.length;x+=1)if(this._dragItems[x].parent===this._dragOverItem){f=!0,this._dragArea=Is;break}}f||(this._dragArea=Jn)}}(h!==this._dragArea||p!==this._dragOverItem)&&this._updateDragHandle()});const i=document.createElement("style");i.innerHTML=lu,this.dom.append(i),this.class.add("tv"),this._allowDrag=t.allowDrag??!0,this._allowReordering=t.allowReordering??!0,this._allowRenaming=t.allowRenaming??!1,this._dragHandle=new ht({class:uu}),this._dragScrollElement=t.dragScrollElement??this,this.append(this._dragHandle),this._onContextMenu=t.onContextMenu,this._onReparentFn=t.onReparent,this._wasDraggingAllowedBeforeFiltering=this._allowDrag,window.addEventListener("keydown",this._updateModifierKeys),window.addEventListener("keyup",this._updateModifierKeys),window.addEventListener("mousedown",()=>this._updateModifierKeys()),this.dom.addEventListener("mouseleave",this._onMouseLeave),this._dragHandle.dom.addEventListener("mousemove",this._onDragMove),this._dragHandle.on("destroy",l=>{l.removeEventListener("mousemove",this._onDragMove)})}destroy(){this._destroyed||(window.removeEventListener("keydown",this._updateModifierKeys),window.removeEventListener("keyup",this._updateModifierKeys),window.removeEventListener("mousedown",()=>this._updateModifierKeys()),window.removeEventListener("mousemove",this._onMouseMove),this.dom.removeEventListener("mouseleave",this._onMouseLeave),this._dragScrollInterval&&(window.clearInterval(this._dragScrollInterval),this._dragScrollInterval=null),super.destroy())}_getChildrenRange(t,i){const l=[];if(this._filterResults.length){const h=this.dom.querySelectorAll(`.tv-item.${eo}`);let p=-1,g=-1;for(let f=0;f<h.length;f+=1){const x=h[f].ui;if(x===t?p=f:x===i&&(g=f),p!==-1&&g!==-1){const E=p<g?p:g,A=p<g?g:p;for(let I=E;I<=A;I+=1)l.push(h[I].ui);break}}}else{let h=t;const p=t.dom.getBoundingClientRect(),g=i.dom.getBoundingClientRect();if(p.top<g.top)for(;h&&h!==i;)h=Ha(h),h&&h!==i&&l.push(h);else for(;h&&h!==i;)h=Ba(h),h&&h!==i&&l.push(h);l.push(i)}return l}_onAppendChild(t){super._onAppendChild(t),t instanceof tt&&this._onAppendTreeViewItem(t)}_onRemoveChild(t){t instanceof tt&&this._onRemoveTreeViewItem(t),super._onRemoveChild(t)}_onAppendTreeViewItem(t){t.treeView=this,this._filter&&this._searchItems([[t.text,t]],this._filter),t.forEachChild(i=>{i instanceof tt&&this._onAppendTreeViewItem(i)})}_onRemoveTreeViewItem(t){t.selected=!1,t.forEachChild((i,l)=>{i instanceof tt&&this._onRemoveTreeViewItem(i)})}_onChildKeyDown(t,i){if(["Tab","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].indexOf(t.key)!==-1)if(t.preventDefault(),t.stopPropagation(),t.key==="ArrowDown"){if(this._selectedItems.length){const l=Ha(i);l&&(this._pressedShift||this._pressedCtrl?l.selected=!0:this._selectSingleItem(l))}}else if(t.key==="ArrowUp"){if(this._selectedItems.length){const l=Ba(i);l&&(this._pressedShift||this._pressedCtrl?l.selected=!0:this._selectSingleItem(l))}}else t.key==="ArrowLeft"?i.parent!==this&&(i.open=!1):t.key==="ArrowRight"?i.open=!0:t.key}_onChildClick(t,i){if(t.button===0&&i.allowSelect)if(this._pressedCtrl)i.selected=!i.selected;else if(this._pressedShift){if(!this._selectedItems.length||this._selectedItems.length===1&&this._selectedItems[0]===i){i.selected=!0;return}const l=this._selectedItems[this._selectedItems.length-1];Fa(l),this._getChildrenRange(l,i).forEach(h=>{h.allowSelect&&(h.selected=!0)})}else this._selectSingleItem(i)}traverseDepthFirst(t){const i=l=>{if(!(!l||!(l instanceof tt))&&(t(l),l.numChildren))for(let h=0;h<l.dom.childNodes.length;h+=1)i(l.dom.childNodes[h].ui)};for(let l=0;l<this.dom.childNodes.length;l+=1)i(this.dom.childNodes[l].ui)}_getTreeOrder(){const t=new Map;let i=0;return this.traverseDepthFirst(l=>{i+=1,t.set(l,i)}),t}_onChildDragStart(t,i){if(!(!this.allowDrag||this._dragging)){if(this._dragItems=[],this._selectedItems.indexOf(i)===-1)i.class.add(qo),this._dragItems.push(i);else{const l=[];let h=-1;for(let p=0;p<this._selectedItems.length;p+=1){let g=this._selectedItems[p].parent,f=0,x=!1;for(;g&&g instanceof tt;){if(this._selectedItems.indexOf(g)!==-1){x=!0;break}f+=1,g=g.parent}if(!x){if(h===-1)h=f;else if(h!==f)return;l.push(this._selectedItems[p])}}this._dragItems=l}this._dragItems.length&&(this._dragItems.forEach(l=>{l.class.add(qo)}),this.isDragging=!0,this.emit("dragstart",this._dragItems.slice()))}}_onChildDragEnd(t,i){if(!this.allowDrag||!this._dragging)return;this._dragItems.forEach(p=>p.class.remove(qo));let l=!1;for(let p=0;p<this._dragItems.length;p+=1)if(this._dragItems[p].parent===this){l=!0;break}const h=this._dragOverItem;if(!l&&h){if(this._dragItems.length>1){const p=this._getTreeOrder();this._dragItems.sort((g,f)=>(p.get(g)??0)-(p.get(f)??0))}if(this._dragItems.length){const p=[];if(this._onReparentFn){const g=[],f=x=>{let E=g.findIndex(A=>A.parent===x);return E===-1&&(g.push({children:[...x.dom.childNodes],parent:x}),E=g.length-1),g[E].children};this._dragItems.forEach(x=>{if(x.parent===h&&this._dragArea===Jn||(p.push({item:x,oldParent:x.parent}),!x.parent))return;const E=f(x.parent),A=E.indexOf(x.dom);E.splice(A,1)}),p.forEach((x,E)=>{if(this._dragArea===Is){if(x.newParent=h.parent,!h.parent)return;const A=f(h.parent),I=A.indexOf(h.dom);A.splice(I,0,x.item.dom),x.newChildIndex=I}else if(this._dragArea===Jn){x.newParent=h;const A=f(h);A.push(x.item.dom),x.newChildIndex=A.length-1}else if(this._dragArea===to){if(x.newParent=h.parent,!h.parent)return;const A=f(h.parent),I=E>0?p[E-1].item:h,V=A.indexOf(I.dom);A.splice(V+1,0,x.item.dom),x.newChildIndex=V+1}x.newChildIndex-=1})}else this._dragItems.forEach(g=>{g.parent===this._dragOverItem&&this._dragArea===Jn||(p.push({item:g,oldParent:g.parent}),g.parent.remove(g))}),p.forEach((g,f)=>{this._dragArea===Is?(g.newParent=h.parent,h.parent.appendBefore(g.item,h),g.newChildIndex=Yo(g.item,g.newParent)):this._dragArea===Jn?(g.newParent=h,h.append(g.item),h.open=!0,g.newChildIndex=Yo(g.item,g.newParent)):this._dragArea===to&&(g.newParent=h.parent,h.parent.appendAfter(g.item,f>0?p[f-1].item:this._dragOverItem),g.newChildIndex=Yo(g.item,g.newParent))});p.length&&(this._onReparentFn&&this._onReparentFn(p),this.emit("reparent",p))}}this._dragItems=[],this.isDragging=!1,this.emit("dragend")}_onChildDragOver(t,i){!this._allowDrag||!this._dragging||(i.allowDrop&&this._dragItems.indexOf(i)===-1?this._dragOverItem=i:this._dragOverItem=null,this._updateDragHandle(),this._onDragMove(t))}_scrollWhileDragging(){this._dragging&&this._dragScroll!==0&&(this._dragScrollElement.dom.scrollTop+=this._dragScroll*8,this._dragOverItem=null,this._updateDragHandle())}_updateDragHandle(t,i){if(!i&&(!this._allowDrag||!this._dragging))return;const l=t??this._dragOverItem;if(!l||l.hidden||!l.parentsOpen)this._dragHandle.hidden=!0;else{const h=l._containerContents.dom.getBoundingClientRect();this._dragHandle.hidden=!1,this._dragHandle.class.remove(to,Is,Jn),this._dragHandle.class.add(this._dragArea);const p=h.top;let g=h.left,f=h.width;if(this.dom.parentElement){const x=this.dom.parentElement.getBoundingClientRect();g=Math.max(g,x.left),f=Math.min(f,this.dom.parentElement.clientWidth-g+x.left)}this._dragHandle.style.top=`${p}px`,this._dragHandle.style.left=`${g}px`,this._dragHandle.style.width=`${f-7}px`}}_selectSingleItem(t){let i=!1;for(let l=this._selectedItems.length-1;l>-1;l-=1)this._selectedItems[l]&&this._selectedItems[l]!==t&&(this._selectedItems[l].selected=!1,i=!0);i?t.selected=!0:t.selected=!t.selected}_onChildSelected(t){this._selectedItems.push(t),Fa(t),this.emit("select",t)}_onChildDeselected(t){const i=this._selectedItems.indexOf(t);i!==-1&&(this._selectedItems.splice(i,1),this.emit("deselect",t))}_onChildRename(t,i){if(this._filter){t.class.remove(eo);const l=this._filterResults.indexOf(t);l!==-1&&this._filterResults.splice(l,1),this._searchItems([[t.text,t]],this._filter)}this.emit("rename",t,i)}_searchItems(t,i){const l=pu(t,i);l.length&&l.forEach(h=>{this._filterResults.push(h),h.class.add(eo)})}_applyFilter(t){this._clearFilter(),this._wasDraggingAllowedBeforeFiltering=this._allowDrag,this._allowDrag=!1,this.class.add(ja);const i=[];this.traverseDepthFirst(l=>{i.push([l.text,l])}),this._searchItems(i,t)}_clearFilter(){this._filterResults.forEach(t=>{t.destroyed||t.class.remove(eo)}),this._filterResults.length=0,this.class.remove(ja),this._allowDrag=this._wasDraggingAllowedBeforeFiltering}showDragHandle(t){this._updateDragHandle(t,!0)}deselect(){for(let t=this._selectedItems.length-1;t>-1;t-=1)this._selectedItems[t]&&(this._selectedItems[t].selected=!1)}clearTreeItems(){for(let t=this.dom.childNodes.length-1;t>-1;t-=1){const i=this.dom.childNodes[t];if(!i)continue;const l=i.ui;l instanceof tt&&l.destroy()}this._selectedItems=[],this._dragItems=[],this._allowDrag=this._wasDraggingAllowedBeforeFiltering}set allowDrag(t){this._allowDrag=t,this._filter&&(this._wasDraggingAllowedBeforeFiltering=t)}get allowDrag(){return this._allowDrag}set allowReordering(t){this._allowReordering=t}get allowReordering(){return this._allowReordering}set allowRenaming(t){this._allowRenaming=t}get allowRenaming(){return this._allowRenaming}set isDragging(t){this._dragging!==t&&(t?(this._dragging=!0,this._updateDragHandle(),(this.scrollable||this._dragScrollElement!==this)&&(window.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("mousemove",this._onMouseMove),this._dragScrollInterval||(this._dragScrollInterval=window.setInterval(()=>{this._scrollWhileDragging()},1e3/60)))):(this._dragOverItem=null,this._updateDragHandle(),this._dragging=!1,window.removeEventListener("mousemove",this._onMouseMove),this._dragScrollInterval&&(window.clearInterval(this._dragScrollInterval),this._dragScrollInterval=null)))}get isDragging(){return this._dragging}get selected(){return this._selectedItems.slice()}set filter(t){this._filter!==t&&(this._filter=t,t?this._applyFilter(t):this._clearFilter())}get filter(){return this._filter}get pressedCtrl(){return this._pressedCtrl}get pressedShift(){return this._pressedShift}}S(Li,"EVENT_DRAGSTART","dragstart"),S(Li,"EVENT_DRAGEND","dragend"),S(Li,"EVENT_REPARENT","reparent"),S(Li,"EVENT_SELECT","select"),S(Li,"EVENT_DESELECT","deselect"),S(Li,"EVENT_RENAME","rename");class mu extends Li{constructor(t={}){super(t);S(this,"wc",document.createElement("tree-view"));S(this,"shadowRoot",this.wc.attachShadow({mode:"open"}));this.shadowRoot.append(this.dom)}}const gu=()=>{const m=document.createElement("div");m.className="relative flex flex-col grow bg-[#28292e]",rt.debugRoot=m;const a=document.createElement("nav");a.className="tp-rotv z-50 sticky flex top-0 w-full overflow-x-auto z-1 bg-[#28292e] font-mono text-[11px]",m.append(a);const t=document.createElement("section");t.className="flex flex-col grow overflow-x-hidden overflow-y-auto",t.dataset.pane="World",m.append(t);const i=new mu;i.scrollable=!0,i.allowRenaming=!1,i.dom.style.cssText="font-family: monospace; font-size: 11px; height: 300px;",i.wc.classList.add("sticky","top-0","z-10","bg-[#333]"),t.append(i.wc);const l=new tt({text:"Scene"});i.append(l);const h=document.createElement("div");return t.append(h),{controls:m,nav:a,pane:h,treeroot:l,treeview:i}};var ar={exports:{}};(function(m,a){(function(t,i){i(a)})(Hs,function(t){class i{constructor(o){this.controller_=o}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(o){this.controller_.viewProps.set("disabled",o)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(o){this.controller_.viewProps.set("hidden",o)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class l{constructor(o){this.target=o}}class h extends l{constructor(o,d,b,P){super(o),this.value=d,this.presetKey=b,this.last=P??!0}}function p(u){return u==null}const g={alreadydisposed:()=>"View has been already disposed",invalidparams:u=>`Invalid parameters for '${u.name}'`,nomatchingcontroller:u=>`No matching controller for '${u.key}'`,nomatchingview:u=>`No matching view for '${JSON.stringify(u.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:u=>`Property '${u.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class f{constructor(o){var d;this.message=(d=g[o.type](o.context))!==null&&d!==void 0?d:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=o.type}static alreadyDisposed(){return new f({type:"alreadydisposed"})}static notBindable(){return new f({type:"notbindable"})}static propertyNotFound(o){return new f({type:"propertynotfound",context:{name:o}})}static shouldNeverHappen(){return new f({type:"shouldneverhappen"})}}class x{constructor(){this.observers_={}}on(o,d){let b=this.observers_[o];return b||(b=this.observers_[o]=[]),b.push({handler:d}),this}off(o,d){const b=this.observers_[o];return b&&(this.observers_[o]=b.filter(P=>P.handler!==d)),this}emit(o,d){const b=this.observers_[o];b&&b.forEach(P=>{P.handler(d)})}}const E="tp";function A(u){return(o,d)=>[E,"-",u,"v",o?`_${o}`:"",d?`-${d}`:""].join("")}function I(u,o){return d=>o(u(d))}function V(u){return u.rawValue}function O(u,o){u.emitter.on("change",I(V,o)),o(u.rawValue)}function G(u,o,d){O(u.value(o),d)}function F(u,o,d){d?u.classList.add(o):u.classList.remove(o)}function R(u,o){return d=>{F(u,o,d)}}function K(u,o){O(u,d=>{o.textContent=d??""})}const U=A("btn");class le{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(U()),d.viewProps.bindClassModifiers(this.element);const b=o.createElement("button");b.classList.add(U("b")),d.viewProps.bindDisabled(b),this.element.appendChild(b),this.buttonElement=b;const P=o.createElement("div");P.classList.add(U("t")),K(d.props.value("title"),P),this.buttonElement.appendChild(P)}}class N{constructor(o,d){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=d.props,this.viewProps=d.viewProps,this.view=new le(o,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class z{constructor(o,d){var b;this.constraint_=d==null?void 0:d.constraint,this.equals_=(b=d==null?void 0:d.equals)!==null&&b!==void 0?b:(P,T)=>P===T,this.emitter=new x,this.rawValue_=o}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(o){this.setRawValue(o,{forceEmit:!1,last:!0})}setRawValue(o,d){const b=d??{forceEmit:!1,last:!0},P=this.constraint_?this.constraint_.constrain(o):o,T=this.rawValue_;this.equals_(T,P)&&!b.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=P,this.emitter.emit("change",{options:b,previousRawValue:T,rawValue:P,sender:this}))}}class H{constructor(o){this.emitter=new x,this.value_=o}get rawValue(){return this.value_}set rawValue(o){this.setRawValue(o,{forceEmit:!1,last:!0})}setRawValue(o,d){const b=d??{forceEmit:!1,last:!0},P=this.value_;P===o&&!b.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=o,this.emitter.emit("change",{options:b,previousRawValue:P,rawValue:this.value_,sender:this}))}}function J(u,o){const d=o==null?void 0:o.constraint,b=o==null?void 0:o.equals;return!d&&!b?new H(u):new z(u,o)}class X{constructor(o){this.emitter=new x,this.valMap_=o;for(const d in this.valMap_)this.valMap_[d].emitter.on("change",()=>{this.emitter.emit("change",{key:d,sender:this})})}static createCore(o){return Object.keys(o).reduce((d,b)=>Object.assign(d,{[b]:J(o[b])}),{})}static fromObject(o){const d=this.createCore(o);return new X(d)}get(o){return this.valMap_[o].rawValue}set(o,d){this.valMap_[o].rawValue=d}value(o){return this.valMap_[o]}}function oe(u,o){return Object.keys(o).reduce((b,P)=>{if(b===void 0)return;const T=o[P],j=T(u[P]);return j.succeeded?Object.assign(Object.assign({},b),{[P]:j.value}):void 0},{})}function me(u,o){return u.reduce((d,b)=>{if(d===void 0)return;const P=o(b);if(!(!P.succeeded||P.value===void 0))return[...d,P.value]},[])}function ze(u){return u===null?!1:typeof u=="object"}function ue(u){return o=>d=>{if(!o&&d===void 0)return{succeeded:!1,value:void 0};if(o&&d===void 0)return{succeeded:!0,value:void 0};const b=u(d);return b!==void 0?{succeeded:!0,value:b}:{succeeded:!1,value:void 0}}}function Ae(u){return{custom:o=>ue(o)(u),boolean:ue(o=>typeof o=="boolean"?o:void 0)(u),number:ue(o=>typeof o=="number"?o:void 0)(u),string:ue(o=>typeof o=="string"?o:void 0)(u),function:ue(o=>typeof o=="function"?o:void 0)(u),constant:o=>ue(d=>d===o?o:void 0)(u),raw:ue(o=>o)(u),object:o=>ue(d=>{if(ze(d))return oe(d,o)})(u),array:o=>ue(d=>{if(Array.isArray(d))return me(d,o)})(u)}}const we={optional:Ae(!0),required:Ae(!1)};function ce(u,o){const d=we.required.object(o)(u);return d.succeeded?d.value:void 0}function ie(u){console.warn([`Missing '${u.key}' of ${u.target} in ${u.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function Xt(u){return u&&u.parentElement&&u.parentElement.removeChild(u),null}class Zt{constructor(o){this.value_=o}static create(o){return[new Zt(o),(d,b)=>{o.setRawValue(d,b)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const yn=A("");function We(u,o){return R(u,yn(void 0,o))}class nt extends X{constructor(o){var d;super(o),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=Zt.create(J(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(d=this.get("parent"))===null||d===void 0||d.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(o){var d,b,P;const T=o??{};return new nt(X.createCore({disabled:(d=T.disabled)!==null&&d!==void 0?d:!1,disposed:!1,hidden:(b=T.hidden)!==null&&b!==void 0?b:!1,parent:(P=T.parent)!==null&&P!==void 0?P:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(o){O(this.globalDisabled_,We(o,"disabled")),G(this,"hidden",We(o,"hidden"))}bindDisabled(o){O(this.globalDisabled_,d=>{o.disabled=d})}bindTabIndex(o){O(this.globalDisabled_,d=>{o.tabIndex=d?-1:0})}handleDispose(o){this.value("disposed").emitter.on("change",d=>{d&&o()})}getGlobalDisabled_(){const o=this.get("parent");return(o?o.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(o){var d;const b=o.previousRawValue;b==null||b.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(d=this.get("parent"))===null||d===void 0||d.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function be(){return["veryfirst","first","last","verylast"]}const Ee=A(""),bt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Dt{constructor(o){this.parent_=null,this.blade=o.blade,this.view=o.view,this.viewProps=o.viewProps;const d=this.view.element;this.blade.value("positions").emitter.on("change",()=>{be().forEach(b=>{d.classList.remove(Ee(void 0,bt[b]))}),this.blade.get("positions").forEach(b=>{d.classList.add(Ee(void 0,bt[b]))})}),this.viewProps.handleDispose(()=>{Xt(d)})}get parent(){return this.parent_}set parent(o){if(this.parent_=o,!("parent"in this.viewProps.valMap_)){ie({key:"parent",target:nt.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const je="http://www.w3.org/2000/svg";function Ot(u){u.offsetHeight}function Nt(u,o){const d=u.style.transition;u.style.transition="none",o(),u.style.transition=d}function Ue(u){return u.ontouchstart!==void 0}function pt(u){for(;u.childNodes.length>0;)u.removeChild(u.childNodes[0])}function cn(u){return u.relatedTarget?u.relatedTarget:"explicitOriginalTarget"in u?u.explicitOriginalTarget:null}const Qe=A("lbl");function ut(u,o){const d=u.createDocumentFragment();return o.split(`
`).map(b=>u.createTextNode(b)).forEach((b,P)=>{P>0&&d.appendChild(u.createElement("br")),d.appendChild(b)}),d}class Le{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(Qe()),d.viewProps.bindClassModifiers(this.element);const b=o.createElement("div");b.classList.add(Qe("l")),G(d.props,"label",T=>{p(T)?this.element.classList.add(Qe(void 0,"nol")):(this.element.classList.remove(Qe(void 0,"nol")),pt(b),b.appendChild(ut(o,T)))}),this.element.appendChild(b),this.labelElement=b;const P=o.createElement("div");P.classList.add(Qe("v")),this.element.appendChild(P),this.valueElement=P}}class Re extends Dt{constructor(o,d){const b=d.valueController.viewProps;super(Object.assign(Object.assign({},d),{view:new Le(o,{props:d.props,viewProps:b}),viewProps:b})),this.props=d.props,this.valueController=d.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Cn extends Dt{constructor(o){super(o),this.value=o.value}}class Et extends X{constructor(o){super(o)}static create(o){const d={completed:!0,expanded:o,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},b=X.createCore(d);return new Et(b)}get styleExpanded(){var o;return(o=this.get("temporaryExpanded"))!==null&&o!==void 0?o:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const o=this.get("expandedHeight");return this.get("shouldFixHeight")&&!p(o)?`${o}px`:"auto"}bindExpandedClass(o,d){const b=()=>{this.styleExpanded?o.classList.add(d):o.classList.remove(d)};G(this,"expanded",b),G(this,"temporaryExpanded",b)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Wt(u){return Et.create(u)}function Pt(u,o){let d=0;return Nt(o,()=>{u.set("expandedHeight",null),u.set("temporaryExpanded",!0),Ot(o),d=o.clientHeight,u.set("temporaryExpanded",null),Ot(o)}),d}function dn(u,o){o.style.height=u.styleHeight}function En(u,o){u.value("expanded").emitter.on("beforechange",()=>{u.set("completed",!1),p(u.get("expandedHeight"))&&u.set("expandedHeight",Pt(u,o)),u.set("shouldFixHeight",!0),Ot(o)}),u.emitter.on("change",()=>{dn(u,o)}),dn(u,o),o.addEventListener("transitionend",d=>{d.propertyName==="height"&&u.cleanUpTransition()})}class vt{constructor(o,d){const b=A(d.viewName);this.element=o.createElement("div"),this.element.classList.add(b()),d.viewProps.bindClassModifiers(this.element)}}class kt extends Cn{constructor(o,d){const b=d.valueController.viewProps;super(Object.assign(Object.assign({},d),{value:d.valueController.value,view:new Le(o,{props:d.props,viewProps:b}),viewProps:b})),this.props=d.props,this.valueController=d.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class hn{constructor(){this.disabled=!1,this.emitter=new x}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class jt{constructor(o,d){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=o,this.emitter=new x,this.interval_=d,this.setTimer_()}get disabled(){return this.disabled_}set disabled(o){this.disabled_=o,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const o=this.doc_.defaultView;o&&o.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const o=this.doc_.defaultView;o&&(this.timerId_=o.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class ft{constructor(o){this.constraints=o}constrain(o){return this.constraints.reduce((d,b)=>b.constrain(d),o)}}function y(u,o){if(u instanceof o)return u;if(u instanceof ft){const d=u.constraints.reduce((b,P)=>b||(P instanceof o?P:null),null);if(d)return d}return null}class B{constructor(o){this.values=X.fromObject({max:o.max,min:o.min})}constrain(o){const d=this.values.get("max"),b=this.values.get("min");return Math.min(Math.max(o,b),d)}}class se{constructor(o){this.values=X.fromObject({max:o.max,min:o.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(o){const d=this.values.get("max"),b=this.values.get("min");let P=o;return p(b)||(P=Math.max(P,b)),p(d)||(P=Math.min(P,d)),P}}class re{constructor(o,d=0){this.step=o,this.origin=d}constrain(o){const d=this.origin%this.step,b=Math.round((o-d)/this.step);return d+b*this.step}}const xe=A("pop");class it{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(xe()),d.viewProps.bindClassModifiers(this.element),O(d.shows,R(this.element,xe(void 0,"v")))}}class Ve{constructor(o,d){this.shows=J(!1),this.viewProps=d.viewProps,this.view=new it(o,{shows:this.shows,viewProps:this.viewProps})}}const _t=A("txt");class Fe{constructor(o,d){this.onChange_=this.onChange_.bind(this),this.element=o.createElement("div"),this.element.classList.add(_t()),d.viewProps.bindClassModifiers(this.element),this.props_=d.props,this.props_.emitter.on("change",this.onChange_);const b=o.createElement("input");b.classList.add(_t("i")),b.type="text",d.viewProps.bindDisabled(b),this.element.appendChild(b),this.inputElement=b,d.value.emitter.on("change",this.onChange_),this.value_=d.value,this.refresh()}refresh(){const o=this.props_.get("formatter");this.inputElement.value=o(this.value_.rawValue)}onChange_(){this.refresh()}}class Ie{constructor(o,d){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=d.parser,this.props=d.props,this.value=d.value,this.viewProps=d.viewProps,this.view=new Fe(o,{props:d.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(o){const d=o.currentTarget.value,b=this.parser_(d);p(b)||(this.value.rawValue=b),this.view.refresh()}}function st(u){return u==="false"?!1:!!u}class si{constructor(o){this.text=o}evaluate(){return Number(this.text)}toString(){return this.text}}const On={"**":(u,o)=>Math.pow(u,o),"*":(u,o)=>u*o,"/":(u,o)=>u/o,"%":(u,o)=>u%o,"+":(u,o)=>u+o,"-":(u,o)=>u-o,"<<":(u,o)=>u<<o,">>":(u,o)=>u>>o,">>>":(u,o)=>u>>>o,"&":(u,o)=>u&o,"^":(u,o)=>u^o,"|":(u,o)=>u|o};class Nn{constructor(o,d,b){this.left=d,this.operator=o,this.right=b}evaluate(){const o=On[this.operator];if(!o)throw new Error(`unexpected binary operator: '${this.operator}`);return o(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const oi={"+":u=>u,"-":u=>-u,"~":u=>~u};class os{constructor(o,d){this.operator=o,this.expression=d}evaluate(){const o=oi[this.operator];if(!o)throw new Error(`unexpected unary operator: '${this.operator}`);return o(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function ri(u){return(o,d)=>{for(let b=0;b<u.length;b++){const P=u[b](o,d);if(P!=="")return P}return""}}function Qt(u,o){var d;const b=u.substr(o).match(/^\s+/);return(d=b&&b[0])!==null&&d!==void 0?d:""}function Pn(u,o){const d=u.substr(o,1);return d.match(/^[1-9]$/)?d:""}function Me(u,o){var d;const b=u.substr(o).match(/^[0-9]+/);return(d=b&&b[0])!==null&&d!==void 0?d:""}function ai(u,o){const d=Me(u,o);if(d!=="")return d;const b=u.substr(o,1);if(o+=1,b!=="-"&&b!=="+")return"";const P=Me(u,o);return P===""?"":b+P}function Se(u,o){const d=u.substr(o,1);if(o+=1,d.toLowerCase()!=="e")return"";const b=ai(u,o);return b===""?"":d+b}function Si(u,o){const d=u.substr(o,1);if(d==="0")return d;const b=Pn(u,o);return o+=b.length,b===""?"":b+Me(u,o)}function kn(u,o){const d=Si(u,o);if(o+=d.length,d==="")return"";const b=u.substr(o,1);if(o+=b.length,b!==".")return"";const P=Me(u,o);return o+=P.length,d+b+P+Se(u,o)}function li(u,o){const d=u.substr(o,1);if(o+=d.length,d!==".")return"";const b=Me(u,o);return o+=b.length,b===""?"":d+b+Se(u,o)}function wt(u,o){const d=Si(u,o);return o+=d.length,d===""?"":d+Se(u,o)}const pn=ri([kn,li,wt]);function jn(u,o){var d;const b=u.substr(o).match(/^[01]+/);return(d=b&&b[0])!==null&&d!==void 0?d:""}function rs(u,o){const d=u.substr(o,2);if(o+=d.length,d.toLowerCase()!=="0b")return"";const b=jn(u,o);return b===""?"":d+b}function as(u,o){var d;const b=u.substr(o).match(/^[0-7]+/);return(d=b&&b[0])!==null&&d!==void 0?d:""}function ls(u,o){const d=u.substr(o,2);if(o+=d.length,d.toLowerCase()!=="0o")return"";const b=as(u,o);return b===""?"":d+b}function zi(u,o){var d;const b=u.substr(o).match(/^[0-9a-f]+/i);return(d=b&&b[0])!==null&&d!==void 0?d:""}function Fn(u,o){const d=u.substr(o,2);if(o+=d.length,d.toLowerCase()!=="0x")return"";const b=zi(u,o);return b===""?"":d+b}const cs=ri([rs,ls,Fn]),ds=ri([cs,pn]);function At(u,o){const d=ds(u,o);return o+=d.length,d===""?null:{evaluable:new si(d),cursor:o}}function Mt(u,o){const d=u.substr(o,1);if(o+=d.length,d!=="(")return null;const b=un(u,o);if(!b)return null;o=b.cursor,o+=Qt(u,o).length;const P=u.substr(o,1);return o+=P.length,P!==")"?null:{evaluable:b.evaluable,cursor:o}}function he(u,o){var d;return(d=At(u,o))!==null&&d!==void 0?d:Mt(u,o)}function An(u,o){const d=he(u,o);if(d)return d;const b=u.substr(o,1);if(o+=b.length,b!=="+"&&b!=="-"&&b!=="~")return null;const P=An(u,o);return P?(o=P.cursor,{cursor:o,evaluable:new os(b,P.evaluable)}):null}function Pe(u,o,d){d+=Qt(o,d).length;const b=u.filter(P=>o.startsWith(P,d))[0];return b?(d+=b.length,d+=Qt(o,d).length,{cursor:d,operator:b}):null}function ae(u,o){return(d,b)=>{const P=u(d,b);if(!P)return null;b=P.cursor;let T=P.evaluable;for(;;){const j=Pe(o,d,b);if(!j)break;b=j.cursor;const Y=u(d,b);if(!Y)return null;b=Y.cursor,T=new Nn(j.operator,T,Y.evaluable)}return T?{cursor:b,evaluable:T}:null}}const qe=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((u,o)=>ae(u,o),An);function un(u,o){return o+=Qt(u,o).length,qe(u,o)}function te(u){const o=un(u,0);return!o||o.cursor+Qt(u,o.cursor).length!==u.length?null:o.evaluable}function xt(u){var o;const d=te(u);return(o=d==null?void 0:d.evaluate())!==null&&o!==void 0?o:null}function hs(u){if(typeof u=="number")return u;if(typeof u=="string"){const o=xt(u);if(!p(o))return o}return 0}function Je(u){return o=>o.toFixed(Math.max(Math.min(u,20),0))}function Jt(u){return String(u)}function en(u,o){for(;u.length<o;)u.push(void 0)}function ci(u){const o=[];return en(o,u),J(o)}function di(u){const o=u.indexOf(void 0);return o<0?u:u.slice(0,o)}function hi(u,o){const d=[...di(u),o];return d.length>u.length?d.splice(0,d.length-u.length):en(d,u.length),d}function Hn({primary:u,secondary:o,forward:d,backward:b}){let P=!1;function T(j){P||(P=!0,j(),P=!1)}u.emitter.on("change",j=>{T(()=>{o.setRawValue(d(u,o),j.options)})}),o.emitter.on("change",j=>{T(()=>{u.setRawValue(b(u,o),j.options)}),T(()=>{o.setRawValue(d(u,o),j.options)})}),T(()=>{o.setRawValue(d(u,o),{forceEmit:!1,last:!0})})}function tn(u,o){const d=u*(o.altKey?.1:1)*(o.shiftKey?10:1);return o.upKey?+d:o.downKey?-d:0}function Tt(u){return{altKey:u.altKey,downKey:u.key==="ArrowDown",shiftKey:u.shiftKey,upKey:u.key==="ArrowUp"}}function pi(u){return{altKey:u.altKey,downKey:u.key==="ArrowLeft",shiftKey:u.shiftKey,upKey:u.key==="ArrowRight"}}function nn(u){return u==="ArrowUp"||u==="ArrowDown"}function ui(u){return nn(u)||u==="ArrowLeft"||u==="ArrowRight"}function Bn(u,o){var d,b;const P=o.ownerDocument.defaultView,T=o.getBoundingClientRect();return{x:u.pageX-(((d=P&&P.scrollX)!==null&&d!==void 0?d:0)+T.left),y:u.pageY-(((b=P&&P.scrollY)!==null&&b!==void 0?b:0)+T.top)}}class Kn{constructor(o){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=o,this.emitter=new x,o.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),o.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),o.addEventListener("touchend",this.onTouchEnd_),o.addEventListener("mousedown",this.onMouseDown_)}computePosition_(o){const d=this.elem_.getBoundingClientRect();return{bounds:{width:d.width,height:d.height},point:o?{x:o.x,y:o.y}:null}}onMouseDown_(o){var d;o.preventDefault(),(d=o.currentTarget)===null||d===void 0||d.focus();const b=this.elem_.ownerDocument;b.addEventListener("mousemove",this.onDocumentMouseMove_),b.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:o.altKey,data:this.computePosition_(Bn(o,this.elem_)),sender:this,shiftKey:o.shiftKey})}onDocumentMouseMove_(o){this.emitter.emit("move",{altKey:o.altKey,data:this.computePosition_(Bn(o,this.elem_)),sender:this,shiftKey:o.shiftKey})}onDocumentMouseUp_(o){const d=this.elem_.ownerDocument;d.removeEventListener("mousemove",this.onDocumentMouseMove_),d.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:o.altKey,data:this.computePosition_(Bn(o,this.elem_)),sender:this,shiftKey:o.shiftKey})}onTouchStart_(o){o.preventDefault();const d=o.targetTouches.item(0),b=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:o.altKey,data:this.computePosition_(d?{x:d.clientX-b.left,y:d.clientY-b.top}:void 0),sender:this,shiftKey:o.shiftKey}),this.lastTouch_=d}onTouchMove_(o){const d=o.targetTouches.item(0),b=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:o.altKey,data:this.computePosition_(d?{x:d.clientX-b.left,y:d.clientY-b.top}:void 0),sender:this,shiftKey:o.shiftKey}),this.lastTouch_=d}onTouchEnd_(o){var d;const b=(d=o.targetTouches.item(0))!==null&&d!==void 0?d:this.lastTouch_,P=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:o.altKey,data:this.computePosition_(b?{x:b.clientX-P.left,y:b.clientY-P.top}:void 0),sender:this,shiftKey:o.shiftKey})}}function He(u,o,d,b,P){const T=(u-o)/(d-o);return b+T*(P-b)}function Lt(u){return String(u.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function vn(u,o,d){return Math.min(Math.max(u,o),d)}const at=A("txt");class ps{constructor(o,d){this.onChange_=this.onChange_.bind(this),this.props_=d.props,this.props_.emitter.on("change",this.onChange_),this.element=o.createElement("div"),this.element.classList.add(at(),at(void 0,"num")),d.arrayPosition&&this.element.classList.add(at(void 0,d.arrayPosition)),d.viewProps.bindClassModifiers(this.element);const b=o.createElement("input");b.classList.add(at("i")),b.type="text",d.viewProps.bindDisabled(b),this.element.appendChild(b),this.inputElement=b,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=d.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(at()),this.inputElement.classList.add(at("i"));const P=o.createElement("div");P.classList.add(at("k")),this.element.appendChild(P),this.knobElement=P;const T=o.createElementNS(je,"svg");T.classList.add(at("g")),this.knobElement.appendChild(T);const j=o.createElementNS(je,"path");j.classList.add(at("gb")),T.appendChild(j),this.guideBodyElem_=j;const Y=o.createElementNS(je,"path");Y.classList.add(at("gh")),T.appendChild(Y),this.guideHeadElem_=Y;const fe=o.createElement("div");fe.classList.add(A("tt")()),this.knobElement.appendChild(fe),this.tooltipElem_=fe,d.value.emitter.on("change",this.onChange_),this.value=d.value,this.refresh()}onDraggingChange_(o){if(o.rawValue===null){this.element.classList.remove(at(void 0,"drg"));return}this.element.classList.add(at(void 0,"drg"));const d=o.rawValue/this.props_.get("draggingScale"),b=d+(d>0?-1:d<0?1:0),P=vn(-b,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${b+P},0 L${b},4 L${b+P},8`,`M ${d},-1 L${d},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${d},4`);const T=this.props_.get("formatter");this.tooltipElem_.textContent=T(this.value.rawValue),this.tooltipElem_.style.left=`${d}px`}refresh(){const o=this.props_.get("formatter");this.inputElement.value=o(this.value.rawValue)}onChange_(){this.refresh()}}class us{constructor(o,d){var b;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=d.baseStep,this.parser_=d.parser,this.props=d.props,this.sliderProps_=(b=d.sliderProps)!==null&&b!==void 0?b:null,this.value=d.value,this.viewProps=d.viewProps,this.dragging_=J(null),this.view=new ps(o,{arrayPosition:d.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const P=new Kn(this.view.knobElement);P.emitter.on("down",this.onPointerDown_),P.emitter.on("move",this.onPointerMove_),P.emitter.on("up",this.onPointerUp_)}constrainValue_(o){var d,b;const P=(d=this.sliderProps_)===null||d===void 0?void 0:d.get("minValue"),T=(b=this.sliderProps_)===null||b===void 0?void 0:b.get("maxValue");let j=o;return P!==void 0&&(j=Math.max(j,P)),T!==void 0&&(j=Math.min(j,T)),j}onInputChange_(o){const d=o.currentTarget.value,b=this.parser_(d);p(b)||(this.value.rawValue=this.constrainValue_(b)),this.view.refresh()}onInputKeyDown_(o){const d=tn(this.baseStep_,Tt(o));d!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+d),{forceEmit:!1,last:!1})}onInputKeyUp_(o){tn(this.baseStep_,Tt(o))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(o){if(!o.point)return null;const d=o.point.x-o.bounds.width/2;return this.constrainValue_(this.originRawValue_+d*this.props.get("draggingScale"))}onPointerMove_(o){const d=this.computeDraggingValue_(o.data);d!==null&&(this.value.setRawValue(d,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(o){const d=this.computeDraggingValue_(o.data);d!==null&&(this.value.setRawValue(d,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function vi(u,o){u.write(o)}function Mn(u){const o=u?y(u,re):null;return o?o.step:null}function It(u,o){const d=u&&y(u,re);return d?Lt(d.step):Math.max(Lt(o),2)}function sn(u){return Mn(u)??1}function Tn(u,o){var d;const b=u&&y(u,re),P=Math.abs((d=b==null?void 0:b.step)!==null&&d!==void 0?d:o);return P===0?.1:Math.pow(10,Math.floor(Math.log10(P))-1)}function mi(u){return[u[0],u[1],u[2]]}function yt(u,o){const d=Je(o==="float"?2:0);return`rgb(${mi(u.getComponents("rgb",o)).map(b=>d(b)).join(", ")})`}function gi(u){return o=>yt(o,u)}function vs(u,o){const d=Je(2),b=Je(o==="float"?2:0);return`rgba(${u.getComponents("rgb",o).map((P,T)=>(T===3?d:b)(P)).join(", ")})`}function Ft(u){return o=>vs(o,u)}function Ri(u,o){const d=Je(o==="float"?2:0),b=["r","g","b"];return`{${mi(u.getComponents("rgb",o)).map((P,T)=>`${b[T]}: ${d(P)}`).join(", ")}}`}function ms(u){return o=>Ri(o,u)}function Vi(u,o){const d=Je(2),b=Je(o==="float"?2:0),P=["r","g","b","a"];return`{${u.getComponents("rgb",o).map((T,j)=>{const Y=j===3?d:b;return`${P[j]}: ${Y(T)}`}).join(", ")}}`}function St(u){return o=>Vi(o,u)}[...["int","float"].reduce((u,o)=>[...u,{format:{alpha:!1,mode:"rgb",notation:"func",type:o},stringifier:gi(o)},{format:{alpha:!0,mode:"rgb",notation:"func",type:o},stringifier:Ft(o)},{format:{alpha:!1,mode:"rgb",notation:"object",type:o},stringifier:ms(o)},{format:{alpha:!0,mode:"rgb",notation:"object",type:o},stringifier:St(o)}],[])];class gs{constructor(o){this.components=o.components,this.asm_=o.assembly}constrain(o){const d=this.asm_.toComponents(o).map((b,P)=>{var T,j;return(j=(T=this.components[P])===null||T===void 0?void 0:T.constrain(b))!==null&&j!==void 0?j:b});return this.asm_.fromComponents(d)}}const mn=A("pndtxt");class bi{constructor(o,d){this.textViews=d.textViews,this.element=o.createElement("div"),this.element.classList.add(mn()),this.textViews.forEach(b=>{const P=o.createElement("div");P.classList.add(mn("a")),P.appendChild(b.element),this.element.appendChild(P)})}}function Ht(u,o,d){return new us(u,{arrayPosition:d===0?"fst":d===o.axes.length-1?"lst":"mid",baseStep:o.axes[d].baseStep,parser:o.parser,props:o.axes[d].textProps,value:J(0,{constraint:o.axes[d].constraint}),viewProps:o.viewProps})}class Ln{constructor(o,d){this.value=d.value,this.viewProps=d.viewProps,this.acs_=d.axes.map((b,P)=>Ht(o,d,P)),this.acs_.forEach((b,P)=>{Hn({primary:this.value,secondary:b.value,forward:T=>d.assembly.toComponents(T.rawValue)[P],backward:(T,j)=>{const Y=d.assembly.toComponents(T.rawValue);return Y[P]=j.rawValue,d.assembly.fromComponents(Y)}})}),this.view=new bi(o,{textViews:this.acs_.map(b=>b.view)})}}function Di(u,o){return"step"in u&&!p(u.step)?new re(u.step,o):null}function bs(u){return!p(u.max)&&!p(u.min)?new B({max:u.max,min:u.min}):!p(u.max)||!p(u.min)?new se({max:u.max,min:u.min}):null}const fs={monitor:{defaultInterval:200,defaultLineCount:3}},zt=A("grl");class Oi{constructor(o,d){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=o.createElement("div"),this.element.classList.add(zt()),d.viewProps.bindClassModifiers(this.element),this.formatter_=d.formatter,this.props_=d.props,this.cursor_=d.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const b=o.createElementNS(je,"svg");b.classList.add(zt("g")),b.style.height=`calc(var(--bld-us) * ${d.lineCount})`,this.element.appendChild(b),this.svgElem_=b;const P=o.createElementNS(je,"polyline");this.svgElem_.appendChild(P),this.lineElem_=P;const T=o.createElement("div");T.classList.add(zt("t"),A("tt")()),this.element.appendChild(T),this.tooltipElem_=T,d.value.emitter.on("change",this.onValueUpdate_),this.value=d.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const o=this.svgElem_.getBoundingClientRect(),d=this.value.rawValue.length-1,b=this.props_.get("minValue"),P=this.props_.get("maxValue"),T=[];this.value.rawValue.forEach((Kt,As)=>{if(Kt===void 0)return;const Ui=He(As,0,d,0,o.width),bo=He(Kt,b,P,o.height,0);T.push([Ui,bo].join(","))}),this.lineElem_.setAttributeNS(null,"points",T.join(" "));const j=this.tooltipElem_,Y=this.value.rawValue[this.cursor_.rawValue];if(Y===void 0){j.classList.remove(zt("t","a"));return}const fe=He(this.cursor_.rawValue,0,d,0,o.width),Ye=He(Y,b,P,o.height,0);j.style.left=`${fe}px`,j.style.top=`${Ye}px`,j.textContent=`${this.formatter_(Y)}`,j.classList.contains(zt("t","a"))||(j.classList.add(zt("t","a"),zt("t","in")),Ot(j),j.classList.remove(zt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class gn{constructor(o,d){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=d.props,this.value=d.value,this.viewProps=d.viewProps,this.cursor_=J(-1),this.view=new Oi(o,{cursor:this.cursor_,formatter:d.formatter,lineCount:d.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!Ue(o))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const b=new Kn(this.view.element);b.emitter.on("down",this.onGraphPointerDown_),b.emitter.on("move",this.onGraphPointerMove_),b.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(o){const d=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(He(o.offsetX,0,d.width,0,this.value.rawValue.length))}onGraphPointerDown_(o){this.onGraphPointerMove_(o)}onGraphPointerMove_(o){if(!o.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(He(o.data.point.x,0,o.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}class on{constructor(o){this.controller_=o}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(o){this.controller_.viewProps.set("disabled",o)}get title(){var o;return(o=this.controller_.props.get("title"))!==null&&o!==void 0?o:""}set title(o){this.controller_.props.set("title",o)}on(o,d){const b=d.bind(this);return this.controller_.emitter.on(o,()=>{b(new l(this))}),this}}class Ni extends l{constructor(o,d,b){super(o),this.cell=d,this.index=b}}class bn extends i{constructor(o){super(o),this.cellToApiMap_=new Map,this.emitter_=new x;const d=this.controller_.valueController;d.cellControllers.forEach((b,P)=>{const T=new on(b);this.cellToApiMap_.set(b,T),b.emitter.on("click",()=>{const j=P%d.size[0],Y=Math.floor(P/d.size[0]);this.emitter_.emit("click",{event:new Ni(this,T,[j,Y])})})})}cell(o,d){const b=this.controller_.valueController,P=b.cellControllers[d*b.size[0]+o];return this.cellToApiMap_.get(P)}on(o,d){const b=d.bind(this);return this.emitter_.on(o,P=>{b(P.event)}),this}}class w{constructor(o,d){this.size=d.size;const[b,P]=this.size,T=[];for(let j=0;j<P;j++)for(let Y=0;Y<b;Y++){const fe=new N(o,{props:X.fromObject(Object.assign({},d.cellConfig(Y,j))),viewProps:nt.create()});T.push(fe)}this.cellCs_=T,this.viewProps=nt.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(j=>{j.viewProps.set("disposed",!0)})}),this.view=new vt(o,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${b}, 1fr)`,this.cellCs_.forEach(j=>{this.view.element.appendChild(j.view.element)})}get cellControllers(){return this.cellCs_}}const c={id:"buttongrid",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(u){const o=we,d=ce(u,{cells:o.required.function,size:o.required.array(o.required.number),view:o.required.constant("buttongrid"),label:o.optional.string});return d?{params:d}:null},controller(u){return new Re(u.document,{blade:u.blade,props:X.fromObject({label:u.params.label}),valueController:new w(u.document,{cellConfig:u.params.cells,size:u.params.size})})},api(u){return!(u.controller instanceof Re)||!(u.controller.valueController instanceof w)?null:new bn(u.controller)}};class v extends i{get label(){return this.controller_.props.get("label")}set label(o){this.controller_.props.set("label",o)}get value(){return this.controller_.valueController.value.rawValue}set value(o){this.controller_.valueController.value.rawValue=o}on(o,d){const b=d.bind(this);return this.controller_.valueController.value.emitter.on(o,P=>{b(new h(this,P.rawValue,void 0,P.options.last))}),this}}function C(u,o,d){return u*(1-d)+o*d}const M=20,D=.001,$=100;function W(u,o){let d=.25,b=.5,P=-1;for(let T=0;T<M;T++){const[j,Y]=u.curve(b);if(b+=d*(j<o?1:-1),P=Y,d*=.5,Math.abs(o-j)<D)break}return P}class Z{constructor(o=0,d=0,b=1,P=1){this.cache_=[],this.comps_=[o,d,b,P]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(o){return p(o)||!Array.isArray(o)?!1:typeof o[0]=="number"&&typeof o[1]=="number"&&typeof o[2]=="number"&&typeof o[3]=="number"}static equals(o,d){return o.x1===d.x1&&o.y1===d.y1&&o.x2===d.x2&&o.y2===d.y2}curve(o){const d=C(0,this.x1,o),b=C(0,this.y1,o),P=C(this.x1,this.x2,o),T=C(this.y1,this.y2,o),j=C(this.x2,1,o),Y=C(this.y2,1,o),fe=C(d,P,o),Ye=C(b,T,o),Kt=C(P,j,o),As=C(T,Y,o);return[C(fe,Kt,o),C(Ye,As,o)]}y(o){if(this.cache_.length===0){const d=[];for(let b=0;b<$;b++)d.push(W(this,He(b,0,$-1,0,1)));this.cache_=d}return this.cache_[Math.round(He(vn(o,0,1),0,1,0,$-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const Q={toComponents:u=>u.toObject(),fromComponents:u=>new Z(...u)};function pe(u){const o=Je(2);return`cubic-bezier(${u.toObject().map(d=>o(d)).join(", ")})`}const Ce=[0,.5,.5,1];function Be(u){const o=u.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!o)return new Z(...Ce);const d=[o[1],o[2],o[3],o[4]].reduce((b,P)=>{if(!b)return null;const T=Number(P);return isNaN(T)?null:[...b,T]},[]);return new Z(...d??Ce)}const De=A("cbz");class Xe{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(De()),d.viewProps.bindClassModifiers(this.element),d.foldable.bindExpandedClass(this.element,De(void 0,"expanded")),G(d.foldable,"completed",R(this.element,De(void 0,"cpl")));const b=o.createElement("div");b.classList.add(De("h")),this.element.appendChild(b);const P=o.createElement("button");P.classList.add(De("b")),d.viewProps.bindDisabled(P);const T=o.createElementNS(je,"svg");T.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',P.appendChild(T),b.appendChild(P),this.buttonElement=P;const j=o.createElement("div");if(j.classList.add(De("t")),b.appendChild(j),this.textElement=j,d.pickerLayout==="inline"){const Y=o.createElement("div");Y.classList.add(De("p")),this.element.appendChild(Y),this.pickerElement=Y}else this.pickerElement=null}}const mt=A("cbzp");class ye{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(mt()),d.viewProps.bindClassModifiers(this.element);const b=o.createElement("div");b.classList.add(mt("g")),this.element.appendChild(b),this.graphElement=b;const P=o.createElement("div");P.classList.add(mt("t")),this.element.appendChild(P),this.textElement=P}}function In(u,o){const d=new MutationObserver(P=>{for(const T of P)T.type==="childList"&&T.addedNodes.forEach(j=>{j.contains(j)&&(o(),d.disconnect())})}),b=u.ownerDocument;d.observe(b.body,{attributes:!0,childList:!0,subtree:!0})}const rn=A("cbzg");function po(u,o){return d=>o(u(d))}class Bs{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(rn()),d.viewProps.bindClassModifiers(this.element),d.viewProps.bindTabIndex(this.element);const b=o.createElement("div");b.classList.add(rn("p")),this.element.appendChild(b),this.previewElement=b;const P=o.createElementNS(je,"svg");P.classList.add(rn("g")),this.element.appendChild(P),this.svgElem_=P;const T=o.createElementNS(je,"path");T.classList.add(rn("u")),this.svgElem_.appendChild(T),this.guideElem_=T;const j=o.createElementNS(je,"polyline");j.classList.add(rn("l")),this.svgElem_.appendChild(j),this.lineElem_=j,this.handleElems_=[o.createElement("div"),o.createElement("div")],this.handleElems_.forEach(Y=>{Y.classList.add(rn("h")),this.element.appendChild(Y)}),this.vectorElems_=[o.createElementNS(je,"line"),o.createElementNS(je,"line")],this.vectorElems_.forEach(Y=>{Y.classList.add(rn("v")),this.svgElem_.appendChild(Y)}),this.value_=d.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=d.selection,this.handleElems_.forEach((Y,fe)=>{O(this.sel_,po(Ye=>Ye===fe,R(Y,rn("h","sel"))))}),In(this.element,()=>{this.refresh()})}getVertMargin_(o){return o*.25}valueToPosition(o,d){const b=this.element.getBoundingClientRect(),P=b.width,T=b.height,j=this.getVertMargin_(T);return{x:He(o,0,1,0,P),y:He(d,0,1,T-j,j)}}positionToValue(o,d){const b=this.element.getBoundingClientRect(),P=b.width,T=b.height,j=this.getVertMargin_(T);return{x:vn(He(o,0,P,0,1),0,1),y:He(d,T-j,j,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(T=>{const j=this.valueToPosition(0,T),Y=this.valueToPosition(1,T);return[`M ${j.x},${j.y}`,`L ${Y.x},${Y.y}`].join(" ")}).join(" "));const o=this.value_.rawValue,d=[];let b=0;for(;;){const T=this.valueToPosition(...o.curve(b));if(d.push([T.x,T.y].join(",")),b>=1)break;b=Math.min(b+.05,1)}this.lineElem_.setAttributeNS(null,"points",d.join(" "));const P=o.toObject();[0,1].forEach(T=>{const j=this.valueToPosition(T,T),Y=this.valueToPosition(P[T*2],P[T*2+1]),fe=this.vectorElems_[T];fe.setAttributeNS(null,"x1",String(j.x)),fe.setAttributeNS(null,"y1",String(j.y)),fe.setAttributeNS(null,"x2",String(Y.x)),fe.setAttributeNS(null,"y2",String(Y.y));const Ye=this.handleElems_[T];Ye.style.left=`${Y.x}px`,Ye.style.top=`${Y.y}px`})}onValueChange_(){this.refresh()}}const Ks=24,_s=400,Us=1e3,lt=A("cbzprv");class ws{constructor(o,d){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=o.createElement("div"),this.element.classList.add(lt()),d.viewProps.bindClassModifiers(this.element);const b=o.createElementNS(je,"svg");b.classList.add(lt("g")),this.element.appendChild(b),this.svgElem_=b;const P=o.createElementNS(je,"path");P.classList.add(lt("t")),this.svgElem_.appendChild(P),this.ticksElem_=P;const T=o.createElement("div");T.classList.add(lt("m")),this.element.appendChild(T),this.markerElem_=T,this.value_=d.value,this.value_.emitter.on("change",this.onValueChange_),d.viewProps.handleDispose(this.onDispose_),In(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(lt("m","a")),this.startTime_=new Date().getTime()+_s,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(lt("m","a"))}onDispose_(){this.stop()}updateMarker_(o){const d=this.value_.rawValue.y(vn(o,0,1));this.markerElem_.style.left=`${d*100}%`}refresh(){const o=this.svgElem_.getBoundingClientRect(),d=o.width,b=o.height,P=[],T=this.value_.rawValue;for(let j=0;j<Ks;j++){const Y=He(j,0,Ks-1,0,1),fe=He(T.y(Y),0,1,0,d);P.push(`M ${fe},0 v${b}`)}this.ticksElem_.setAttributeNS(null,"d",P.join(" "))}onTimer_(){if(this.startTime_===null)return;const o=new Date().getTime()-this.startTime_,d=o/Us;this.updateMarker_(d),o>Us+_s&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function xs(u,o,d,b){const P=d-u,T=b-o;return Math.sqrt(P*P+T*T)}function Ze(u,o,d,b){const P=xs(u,o,d,b),T=Math.atan2(b-o,d-u),j=Math.round(T/(Math.PI/4))*Math.PI/4;return{x:u+Math.cos(j)*P,y:o+Math.sin(j)*P}}class Gs{constructor(o,d){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=d.baseStep,this.value=d.value,this.sel_=J(0),this.viewProps=d.viewProps,this.view=new Bs(o,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new ws(o,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",P=>{P.stopImmediatePropagation(),P.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const b=new Kn(this.view.element);b.emitter.on("down",this.onPointerDown_),b.emitter.on("move",this.onPointerMove_),b.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(o,d,b){const P=this.sel_.rawValue,T=this.value.rawValue.toObject(),j=this.view.positionToValue(o.x,o.y),Y=d?Ze(P,P,j.x,j.y):j;T[P*2]=Y.x,T[P*2+1]=Y.y,this.value.setRawValue(new Z(...T),b)}onPointerDown_(o){const d=o.data;if(!d.point)return;const b=this.value.rawValue,P=this.view.valueToPosition(b.x1,b.y1),T=xs(d.point.x,d.point.y,P.x,P.y),j=this.view.valueToPosition(b.x2,b.y2),Y=xs(d.point.x,d.point.y,j.x,j.y);this.sel_.rawValue=T<=Y?0:1,this.updateValue_(d.point,o.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(o){const d=o.data;d.point&&this.updateValue_(d.point,o.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(o){const d=o.data;d.point&&this.updateValue_(d.point,o.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(o){ui(o.key)&&o.preventDefault();const d=this.sel_.rawValue,b=this.value.rawValue.toObject();b[d*2]+=tn(this.baseStep_,pi(o)),b[d*2+1]+=tn(this.baseStep_,Tt(o)),this.value.setRawValue(new Z(...b),{forceEmit:!1,last:!1})}onKeyUp_(o){ui(o.key)&&o.preventDefault();const d=tn(this.baseStep_,pi(o)),b=tn(this.baseStep_,Tt(o));d===0&&b===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class fi{constructor(o,d){this.value=d.value,this.viewProps=d.viewProps,this.view=new ye(o,{viewProps:this.viewProps}),this.gc_=new Gs(o,{baseStep:d.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const b=Object.assign(Object.assign({},d.axis),{constraint:new se({max:1,min:0})}),P=Object.assign(Object.assign({},d.axis),{constraint:void 0});this.tc_=new Ln(o,{assembly:Q,axes:[b,P,b,P],parser:xt,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(o=>o.inputElement)]}refresh(){this.gc_.refresh()}}class ji{constructor(o,d){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=d.value,this.viewProps=d.viewProps,this.foldable_=Wt(d.expanded),this.view=new Xe(o,{foldable:this.foldable_,pickerLayout:d.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Ie(o,{parser:Be,props:X.fromObject({formatter:pe}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=d.pickerLayout==="popup"?new Ve(o,{viewProps:this.viewProps}):null;const b=new fi(o,{axis:d.axis,value:this.value,viewProps:this.viewProps});b.allFocusableElements.forEach(P=>{P.addEventListener("blur",this.onPopupChildBlur_),P.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=b,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),O(this.popC_.shows,P=>{P&&b.refresh()}),Hn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:P=>P.rawValue,backward:(P,T)=>T.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),En(this.foldable_,this.view.pickerElement))}onButtonBlur_(o){if(!this.popC_)return;const d=o.relatedTarget;(!d||!this.popC_.view.element.contains(d))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(o){if(!this.popC_)return;const d=this.popC_.view.element,b=cn(o);b&&d.contains(b)||b&&b===this.view.buttonElement&&!Ue(d.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(o){this.popC_&&o.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function ys(){return new gs({assembly:Q,components:[0,1,2,3].map(u=>u%2===0?new se({min:0,max:1}):void 0)})}const _i={id:"cubic-bezier",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(u){const o=we,d=ce(u,{value:o.required.array(o.required.number),view:o.required.constant("cubicbezier"),expanded:o.optional.boolean,label:o.optional.string,picker:o.optional.custom(b=>b==="inline"||b==="popup"?b:void 0)});return d?{params:d}:null},controller(u){var o,d;const b=new Z(...u.params.value),P=J(b,{constraint:ys(),equals:Z.equals}),T=new ji(u.document,{axis:{baseStep:.1,textProps:X.fromObject({draggingScale:.01,formatter:Je(2)})},expanded:(o=u.params.expanded)!==null&&o!==void 0?o:!1,pickerLayout:(d=u.params.picker)!==null&&d!==void 0?d:"popup",value:P,viewProps:u.viewProps});return new kt(u.document,{blade:u.blade,props:X.fromObject({label:u.params.label}),valueController:T})},api(u){return!(u.controller instanceof kt)||!(u.controller.valueController instanceof ji)?null:new v(u.controller)}};class ot extends i{begin(){this.controller_.valueController.begin()}end(){this.controller_.valueController.end()}}const Un=20;class Bt{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(o){this.start_=o.getTime()}calculateFps_(o){if(this.timestamps_.length===0)return null;const d=this.timestamps_[0];return 1e3*(this.frameCount_-d.frameCount)/(o-d.time)}compactTimestamps_(){if(this.timestamps_.length<=Un)return;const o=this.timestamps_.length-Un;this.timestamps_.splice(0,o);const d=this.timestamps_[0].frameCount;this.timestamps_.forEach(b=>{b.frameCount-=d}),this.frameCount_-=d}end(o){if(this.start_===null)return;const d=o.getTime();this.duration_=d-this.start_,this.start_=null,this.fps_=this.calculateFps_(d),this.timestamps_.push({frameCount:this.frameCount_,time:d}),++this.frameCount_,this.compactTimestamps_()}}const wi=A("fps");class Cs{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(wi()),d.viewProps.bindClassModifiers(this.element),this.graphElement=o.createElement("div"),this.graphElement.classList.add(wi("g")),this.element.appendChild(this.graphElement);const b=o.createElement("div");b.classList.add(wi("l")),this.element.appendChild(b);const P=o.createElement("span");P.classList.add(wi("v")),P.textContent="--",b.appendChild(P),this.valueElement=P;const T=o.createElement("span");T.classList.add(wi("u")),T.textContent="FPS",b.appendChild(T)}}class xi{constructor(o,d){this.stopwatch_=new Bt,this.onTick_=this.onTick_.bind(this),this.ticker_=d.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=d.value,this.viewProps=d.viewProps,this.view=new Cs(o,{viewProps:this.viewProps}),this.graphC_=new gn(o,{formatter:Je(0),lineCount:d.lineCount,props:X.fromObject({maxValue:d.maxValue,minValue:d.minValue}),value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()})}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const o=this.stopwatch_.fps;if(o!==null){const d=this.value_.rawValue;this.value_.rawValue=hi(d,o),this.view.valueElement.textContent=o.toFixed(0)}}}function Sn(u,o){return o===0?new hn:new jt(u,o??fs.monitor.defaultInterval)}const Te={id:"fpsgraph",type:"blade",accept(u){const o=we,d=ce(u,{view:o.required.constant("fpsgraph"),interval:o.optional.number,label:o.optional.string,lineCount:o.optional.number,max:o.optional.number,min:o.optional.number});return d?{params:d}:null},controller(u){var o,d,b,P;const T=(o=u.params.interval)!==null&&o!==void 0?o:500;return new Re(u.document,{blade:u.blade,props:X.fromObject({label:u.params.label}),valueController:new xi(u.document,{lineCount:(d=u.params.lineCount)!==null&&d!==void 0?d:2,maxValue:(b=u.params.max)!==null&&b!==void 0?b:90,minValue:(P=u.params.min)!==null&&P!==void 0?P:0,ticker:Sn(u.document,T),value:ci(80),viewProps:u.viewProps})})},api(u){return!(u.controller instanceof Re)||!(u.controller.valueController instanceof xi)?null:new ot(u.controller)}};class ct{constructor(o,d){this.min=o,this.max=d}static isObject(o){if(typeof o!="object"||o===null)return!1;const d=o.min,b=o.max;return!(typeof d!="number"||typeof b!="number")}static equals(o,d){return o.min===d.min&&o.max===d.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const Ke={fromComponents:u=>new ct(u[0],u[1]),toComponents:u=>[u.min,u.max]};class Fi{constructor(o){this.edge=o}constrain(o){var d,b,P,T,j,Y,fe,Ye;if(o.min<=o.max)return new ct((b=(d=this.edge)===null||d===void 0?void 0:d.constrain(o.min))!==null&&b!==void 0?b:o.min,(T=(P=this.edge)===null||P===void 0?void 0:P.constrain(o.max))!==null&&T!==void 0?T:o.max);const Kt=(o.min+o.max)/2;return new ct((Y=(j=this.edge)===null||j===void 0?void 0:j.constrain(Kt))!==null&&Y!==void 0?Y:Kt,(Ye=(fe=this.edge)===null||fe===void 0?void 0:fe.constrain(Kt))!==null&&Ye!==void 0?Ye:Kt)}}const dt=A("rsltxt");class $s{constructor(o,d){this.sliderView_=d.sliderView,this.textView_=d.textView,this.element=o.createElement("div"),this.element.classList.add(dt());const b=o.createElement("div");b.classList.add(dt("s")),b.appendChild(this.sliderView_.element),this.element.appendChild(b);const P=o.createElement("div");P.classList.add(dt("t")),P.appendChild(this.textView_.element),this.element.appendChild(P)}}const Rt=A("rsl");class Hi{constructor(o,d){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=d.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=o.createElement("div"),this.element.classList.add(Rt()),d.viewProps.bindClassModifiers(this.element),this.value_=d.value,this.value_.emitter.on("change",this.onValueChange_);const b=o.createElement("div");b.classList.add(Rt("t")),this.element.appendChild(b),this.trackElement=b;const P=o.createElement("div");P.classList.add(Rt("b")),b.appendChild(P),this.barElement=P;const T=["min","max"].map(j=>{const Y=o.createElement("div");return Y.classList.add(Rt("k"),Rt("k",j)),b.appendChild(Y),Y});this.knobElements=[T[0],T[1]],this.update_()}valueToX_(o){const d=this.sliderProps_.get("minValue"),b=this.sliderProps_.get("maxValue");return vn(He(o,d,b,0,1),0,1)*100}update_(){const o=this.value_.rawValue;o.length===0?this.element.classList.add(Rt(void 0,"zero")):this.element.classList.remove(Rt(void 0,"zero"));const d=[this.valueToX_(o.min),this.valueToX_(o.max)];this.barElement.style.left=`${d[0]}%`,this.barElement.style.right=`${100-d[1]}%`,this.knobElements.forEach((b,P)=>{b.style.left=`${d[P]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class qs{constructor(o,d){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=d.sliderProps,this.viewProps=d.viewProps,this.value=d.value,this.view=new Hi(o,{sliderProps:this.sliderProps,value:this.value,viewProps:d.viewProps});const b=new Kn(this.view.trackElement);b.emitter.on("down",this.onPointerDown_),b.emitter.on("move",this.onPointerMove_),b.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(o){if(!o.point)return null;const d=(o.point.x+this.ofs_())/o.bounds.width,b=this.sliderProps.get("minValue"),P=this.sliderProps.get("maxValue");return He(d,0,1,b,P)}onPointerDown_(o){if(!o.data.point)return;const d=o.data.point.x/o.data.bounds.width,b=this.value.rawValue,P=this.sliderProps.get("minValue"),T=this.sliderProps.get("maxValue"),j=He(b.min,P,T,0,1),Y=He(b.max,P,T,0,1);Math.abs(Y-d)<=.025?this.grabbing_="max":Math.abs(j-d)<=.025?this.grabbing_="min":d>=j&&d<=Y?(this.grabbing_="length",this.grabOffset_=He(d-j,0,1,0,T-P)):d<j?(this.grabbing_="min",this.onPointerMove_(o)):d>Y&&(this.grabbing_="max",this.onPointerMove_(o))}applyPointToValue_(o,d){const b=this.valueFromData_(o);if(b===null)return;const P=this.sliderProps.get("minValue"),T=this.sliderProps.get("maxValue");if(this.grabbing_==="min")this.value.setRawValue(new ct(b,this.value.rawValue.max),d);else if(this.grabbing_==="max")this.value.setRawValue(new ct(this.value.rawValue.min,b),d);else if(this.grabbing_==="length"){const j=this.value.rawValue.length;let Y=b-this.grabOffset_,fe=Y+j;Y<P?(Y=P,fe=P+j):fe>T&&(Y=T-j,fe=T),this.value.setRawValue(new ct(Y,fe),d)}}onPointerMove_(o){this.applyPointToValue_(o.data,{forceEmit:!1,last:!1})}onPointerUp_(o){this.applyPointToValue_(o.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class Ys{constructor(o,d){this.value=d.value,this.viewProps=d.viewProps,this.sc_=new qs(o,d);const b={baseStep:d.baseStep,constraint:d.constraint,textProps:X.fromObject({draggingScale:d.draggingScale,formatter:d.formatter})};this.tc_=new Ln(o,{assembly:Ke,axes:[b,b],parser:d.parser,value:this.value,viewProps:d.viewProps}),this.view=new $s(o,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function Es(u){return ct.isObject(u)?new ct(u.min,u.max):new ct(0,0)}function uo(u,o){u.writeProperty("max",o.max),u.writeProperty("min",o.min)}function Ps(u){const o=[],d=bs(u);d&&o.push(d);const b=Di(u);return b&&o.push(b),new Fi(new ft(o))}const yi={id:"input-interval",type:"input",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept:(u,o)=>{if(!ct.isObject(u))return null;const d=we,b=ce(o,{format:d.optional.function,max:d.optional.number,min:d.optional.number,step:d.optional.number});return b?{initialValue:new ct(u.min,u.max),params:b}:null},binding:{reader:u=>Es,constraint:u=>Ps(u.params),equals:ct.equals,writer:u=>uo},controller(u){var o;const d=u.value,b=u.constraint;if(!(b instanceof Fi))throw f.shouldNeverHappen();const P=(d.rawValue.min+d.rawValue.max)/2,T=(o=u.params.format)!==null&&o!==void 0?o:Je(It(b.edge,P)),j=b.edge&&y(b.edge,B);if(j)return new Ys(u.document,{baseStep:sn(b.edge),constraint:b.edge,draggingScale:Tn(b.edge,P),formatter:T,parser:xt,sliderProps:new X({maxValue:j.values.value("max"),minValue:j.values.value("min")}),value:d,viewProps:u.viewProps});const Y={baseStep:sn(b.edge),constraint:b.edge,textProps:X.fromObject({draggingScale:P,formatter:T})};return new Ln(u.document,{assembly:Ke,axes:[Y,Y],parser:xt,value:d,viewProps:u.viewProps})}};class Ci{constructor(o){this.controller_=o}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(o){this.controller_.viewProps.set("disabled",o)}get title(){var o;return(o=this.controller_.props.get("title"))!==null&&o!==void 0?o:""}set title(o){this.controller_.props.set("title",o)}}class ks extends h{constructor(o,d,b,P,T){super(o,P,T),this.cell=d,this.index=b}}class an extends i{constructor(o){super(o),this.cellToApiMap_=new Map,this.controller_.valueController.cellControllers.forEach(d=>{const b=new Ci(d);this.cellToApiMap_.set(d,b)})}get value(){return this.controller_.value}cell(o,d){const b=this.controller_.valueController,P=b.cellControllers[d*b.size[0]+o];return this.cellToApiMap_.get(P)}on(o,d){const b=d.bind(this);this.controller_.value.emitter.on(o,P=>{const T=this.controller_.valueController,j=T.findCellByValue(P.rawValue);if(!j)return;const Y=this.cellToApiMap_.get(j);if(!Y)return;const fe=T.cellControllers.indexOf(j);b(new ks(this,Y,[fe%T.size[0],Math.floor(fe/T.size[0])],P.rawValue,void 0))})}}const Gn=A("rad");class Bi{constructor(o,d){this.element=o.createElement("div"),this.element.classList.add(Gn()),d.viewProps.bindClassModifiers(this.element);const b=o.createElement("label");b.classList.add(Gn("l")),this.element.appendChild(b);const P=o.createElement("input");P.classList.add(Gn("i")),P.name=d.name,P.type="radio",d.viewProps.bindDisabled(P),b.appendChild(P),this.inputElement=P;const T=o.createElement("div");T.classList.add(Gn("b")),b.appendChild(T);const j=o.createElement("div");j.classList.add(Gn("t")),T.appendChild(j),G(d.props,"title",Y=>{j.textContent=Y})}}class Xs{constructor(o,d){this.props=d.props,this.viewProps=d.viewProps,this.view=new Bi(o,{name:d.name,props:this.props,viewProps:this.viewProps})}}class zn{constructor(o,d){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=d.size;const[b,P]=this.size;for(let T=0;T<P;T++)for(let j=0;j<b;j++){const Y=new Xs(o,{name:d.groupName,props:X.fromObject(Object.assign({},d.cellConfig(j,T))),viewProps:nt.create()});this.cellCs_.push(Y),this.cellValues_.push(d.cellConfig(j,T).value)}this.value=d.value,O(this.value,T=>{const j=this.findCellByValue(T);j&&(j.view.inputElement.checked=!0)}),this.viewProps=nt.create(),this.view=new vt(o,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${b}, 1fr)`,this.cellCs_.forEach(T=>{T.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(T.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(o){const d=this.cellValues_.findIndex(b=>b===o);return d<0?null:this.cellCs_[d]}onCellInputChange_(o){const d=o.currentTarget,b=this.cellCs_.findIndex(P=>P.view.inputElement===d);b<0||(this.value.rawValue=this.cellValues_[b])}}const $n=function(){return{id:"radiogrid",type:"blade",accept(u){const o=we,d=ce(u,{cells:o.required.function,groupName:o.required.string,size:o.required.array(o.required.number),value:o.required.raw,view:o.required.constant("radiogrid"),label:o.optional.string});return d?{params:d}:null},controller(u){return new kt(u.document,{blade:u.blade,props:X.fromObject({label:u.params.label}),valueController:new zn(u.document,{groupName:u.params.groupName,cellConfig:u.params.cells,size:u.params.size,value:J(u.params.value)})})},api(u){return!(u.controller instanceof kt)||!(u.controller.valueController instanceof zn)?null:new an(u.controller)}}}();function fn(u){return{id:"input-radiogrid",type:"input",accept(o,d){if(!u.isType(o))return null;const b=we,P=ce(d,{cells:b.required.function,groupName:b.required.string,size:b.required.array(b.required.number),view:b.required.constant("radiogrid")});return P?{initialValue:o,params:P}:null},binding:u.binding,controller:o=>new zn(o.document,{cellConfig:o.params.cells,groupName:o.params.groupName,size:o.params.size,value:o.value})}}const Ki=fn({isType:u=>typeof u=="number",binding:{reader:u=>hs,writer:u=>vi}}),vo=fn({isType:u=>typeof u=="string",binding:{reader:u=>Jt,writer:u=>vi}}),mo=fn({isType:u=>typeof u=="boolean",binding:{reader:u=>st,writer:u=>vi}}),go=[c,_i,Te,yi,$n,mo,Ki,vo];t.ButtonCellApi=on,t.ButtonGridApi=bn,t.ButtonGridController=w,t.CubicBezier=Z,t.CubicBezierApi=v,t.CubicBezierAssembly=Q,t.CubicBezierController=ji,t.CubicBezierGraphController=Gs,t.CubicBezierGraphView=Bs,t.CubicBezierPickerController=fi,t.CubicBezierPickerView=ye,t.CubicBezierPreviewView=ws,t.CubicBezierView=Xe,t.FpsGraphBladeApi=ot,t.FpsGraphController=xi,t.FpsView=Cs,t.Fpswatch=Bt,t.Interval=ct,t.IntervalAssembly=Ke,t.IntervalConstraint=Fi,t.RadioCellApi=Ci,t.RadioController=Xs,t.RadioGridApi=an,t.RadioGridController=zn,t.RadioView=Bi,t.RangeSliderController=qs,t.RangeSliderTextController=Ys,t.RangeSliderTextView=$s,t.RangeSliderView=Hi,t.TpRadioGridChangeEvent=ks,t.plugins=go,Object.defineProperty(t,"__esModule",{value:!0})})})(ar,ar.exports);var Ml=ar.exports;const bu=ho(Ml),Tl=co({__proto__:null,default:bu},[Ml]);var lr={exports:{}};(function(m,a){(function(t,i){i(a)})(Hs,function(t){const i="tp";function l(N){return(z,H)=>[i,"-",N,"v",z?`_${z}`:"",H?`-${H}`:""].join("")}function h(N,z){return Object.keys(z).reduce((J,X)=>{if(J===void 0)return;const oe=z[X],me=oe(N[X]);return me.succeeded?Object.assign(Object.assign({},J),{[X]:me.value}):void 0},{})}function p(N,z){return N.reduce((H,J)=>{if(H===void 0)return;const X=z(J);if(!(!X.succeeded||X.value===void 0))return[...H,X.value]},[])}function g(N){return N===null?!1:typeof N=="object"}function f(N){return z=>H=>{if(!z&&H===void 0)return{succeeded:!1,value:void 0};if(z&&H===void 0)return{succeeded:!0,value:void 0};const J=N(H);return J!==void 0?{succeeded:!0,value:J}:{succeeded:!1,value:void 0}}}function x(N){return{custom:z=>f(z)(N),boolean:f(z=>typeof z=="boolean"?z:void 0)(N),number:f(z=>typeof z=="number"?z:void 0)(N),string:f(z=>typeof z=="string"?z:void 0)(N),function:f(z=>typeof z=="function"?z:void 0)(N),constant:z=>f(H=>H===z?z:void 0)(N),raw:f(z=>z)(N),object:z=>f(H=>{if(g(H))return h(H,z)})(N),array:z=>f(H=>{if(Array.isArray(H))return p(H,z)})(N)}}const E={optional:x(!0),required:x(!1)};function A(N,z){const H=E.required.object(z)(N);return H.succeeded?H.value:void 0}function I(N,z,H,J){function X(oe){return oe instanceof H?oe:new H(function(me){me(oe)})}return new(H||(H=Promise))(function(oe,me){function ze(we){try{Ae(J.next(we))}catch(ce){me(ce)}}function ue(we){try{Ae(J.throw(we))}catch(ce){me(ce)}}function Ae(we){we.done?oe(we.value):X(we.value).then(ze,ue)}Ae((J=J.apply(N,z||[])).next())})}function V(){const N=document.createElement("canvas");N.width=128,N.height=64;const z=N.getContext("2d");return z.fillStyle="#222",z.fillRect(0,0,N.width,N.height),z.fillStyle="#ddd",z.font="monospaced",z.textAlign="center",z.textBaseline="middle",z.fillText("No image",N.width*.5,N.height*.5),new Promise(H=>{N.toBlob(J=>{const X=new Image;X.src=URL.createObjectURL(J),X.onload=()=>{H(X)}})})}function O(N){return I(this,void 0,void 0,function*(){const z=new Image;return z.crossOrigin="anonymous",new Promise(H=>{z.src=N,z.onload=()=>{H(z)}})})}function G(N){const z=document.createElement("canvas");z.width=N.width,z.height=N.height,z.getContext("2d").drawImage(N,0,0);const H=new Image;return new Promise(J=>{z.toBlob(X=>{H.src=URL.createObjectURL(X),H.onload=()=>{J(H)}})})}const F=l("img");class R{constructor(z,H){this.element=z.createElement("div"),this.element.classList.add(F()),H.viewProps.bindClassModifiers(this.element),this.input=z.createElement("input"),this.input.classList.add(F("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",H.extensions.join(",")),this.element.appendChild(this.input),this.image_=z.createElement("img"),this.image_.classList.add(F("image")),this.image_.classList.add(F(`image_${H.imageFit}`)),this.element.classList.add(F("area_root")),this.element.appendChild(this.image_)}changeImage(z){this.image_.src=z}changeDraggingState(z){const H=this.element;z?H==null||H.classList.add(F("area_dragging")):H==null||H.classList.remove(F("area_dragging"))}}class K{constructor(z,H){this.placeholderImage=null,this.value=H.value,this.viewProps=H.viewProps,this.view=new R(z,{viewProps:this.viewProps,extensions:H.extensions,imageFit:H.imageFit}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(z){const H=(z==null?void 0:z.target).files;if(!H||!H.length)return;const J=H[0],X=URL.createObjectURL(J);this.setValue(X),this.updateImage(X)}onDrop(z){return I(this,void 0,void 0,function*(){z.preventDefault();try{const{dataTransfer:H}=z,J=H==null?void 0:H.files[0];if(J){const X=URL.createObjectURL(J);this.updateImage(X),this.setValue(X)}else{const X=H==null?void 0:H.getData("url");if(!X)throw new Error("No url");O(X).then(oe=>I(this,void 0,void 0,function*(){const me=yield G(oe);this.updateImage(me.src),this.setValue(me)}))}}catch(H){console.error("Could not parse the dropped image",H)}finally{this.view.changeDraggingState(!1)}})}onDragOver(z){z.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(z){return I(this,void 0,void 0,function*(){if(z instanceof HTMLImageElement)G(z).then(H=>{this.updateImage(H.src)});else if(typeof z=="string"){let H="";try{if(z==="placeholder")throw new Error("placeholder");new URL(z),H=(yield O(z)).src}catch{H=(yield this.handlePlaceholderImage()).src}finally{this.updateImage(H),this.setValue(H)}}})}updateImage(z){this.view.changeImage(z)}setValue(z){return I(this,void 0,void 0,function*(){z instanceof HTMLImageElement?this.value.setRawValue(z):z?this.value.setRawValue(yield O(z)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return I(this,void 0,void 0,function*(){return this.placeholderImage||(this.placeholderImage=yield V()),this.placeholderImage})}}const U=[".jpg",".png",".gif"],le={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:grid;height:calc(var(--bld-us) * 3);overflow:hidden;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:100%;height:100%;opacity:0}.tp-imgv_image{width:100%;height:100%;position:absolute;pointer-events:none;border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:6px;opacity:0.6}",accept(N,z){if(!(N instanceof HTMLImageElement||typeof N=="string"))return null;const H=E,J=A(z,{view:H.required.constant("input-image"),acceptUrl:H.optional.boolean,imageFit:H.optional.custom(X=>X==="contain"||X==="cover"?X:void 0),extensions:H.optional.array(H.required.string)});return J?{initialValue:N,params:J}:null},binding:{reader(N){return z=>z instanceof HTMLImageElement?z.src===""?"placeholder":z.src:typeof z=="string"?z:"placeholder"},writer(N){return(z,H)=>{z.write(H)}}},controller(N){var z,H;return new K(N.document,{value:N.value,imageFit:(z=N.params.imageFit)!==null&&z!==void 0?z:"cover",viewProps:N.viewProps,extensions:(H=N.params.extensions)!==null&&H!==void 0?H:U})}};t.plugin=le,Object.defineProperty(t,"__esModule",{value:!0})})})(lr,lr.exports);var Ll=lr.exports;const fu=ho(Ll),_u=co({__proto__:null,default:fu},[Ll]);var cr={exports:{}};(function(m,a){(function(t,i){i(a)})(Hs,function(t){function i(w){return w==null}const l={alreadydisposed:()=>"View has been already disposed",invalidparams:w=>`Invalid parameters for '${w.name}'`,nomatchingcontroller:w=>`No matching controller for '${w.key}'`,nomatchingview:w=>`No matching view for '${JSON.stringify(w.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:w=>`Property '${w.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class h{constructor(c){var v;this.message=(v=l[c.type](c.context))!==null&&v!==void 0?v:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=c.type}static alreadyDisposed(){return new h({type:"alreadydisposed"})}static notBindable(){return new h({type:"notbindable"})}static propertyNotFound(c){return new h({type:"propertynotfound",context:{name:c}})}static shouldNeverHappen(){return new h({type:"shouldneverhappen"})}}class p{constructor(){this.observers_={}}on(c,v){let C=this.observers_[c];return C||(C=this.observers_[c]=[]),C.push({handler:v}),this}off(c,v){const C=this.observers_[c];return C&&(this.observers_[c]=C.filter(M=>M.handler!==v)),this}emit(c,v){const C=this.observers_[c];C&&C.forEach(M=>{M.handler(v)})}}const g="tp";function f(w){return(c,v)=>[g,"-",w,"v",c?`_${c}`:"",v?`-${v}`:""].join("")}function x(w,c){return v=>c(w(v))}function E(w){return w.rawValue}function A(w,c){w.emitter.on("change",x(E,c)),c(w.rawValue)}function I(w,c,v){A(w.value(c),v)}function V(w,c,v){v?w.classList.add(c):w.classList.remove(c)}function O(w,c){return v=>{V(w,c,v)}}class G{constructor(c,v){var C;this.constraint_=v==null?void 0:v.constraint,this.equals_=(C=v==null?void 0:v.equals)!==null&&C!==void 0?C:(M,D)=>M===D,this.emitter=new p,this.rawValue_=c}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(c){this.setRawValue(c,{forceEmit:!1,last:!0})}setRawValue(c,v){const C=v??{forceEmit:!1,last:!0},M=this.constraint_?this.constraint_.constrain(c):c;this.equals_(this.rawValue_,M)&&!C.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=M,this.emitter.emit("change",{options:C,rawValue:M,sender:this}))}}class F{constructor(c){this.emitter=new p,this.value_=c}get rawValue(){return this.value_}set rawValue(c){this.setRawValue(c,{forceEmit:!1,last:!0})}setRawValue(c,v){const C=v??{forceEmit:!1,last:!0};this.value_===c&&!C.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=c,this.emitter.emit("change",{options:C,rawValue:this.value_,sender:this}))}}function R(w,c){const v=c==null?void 0:c.constraint,C=c==null?void 0:c.equals;return!v&&!C?new F(w):new G(w,c)}class K{constructor(c){this.emitter=new p,this.valMap_=c;for(const v in this.valMap_)this.valMap_[v].emitter.on("change",()=>{this.emitter.emit("change",{key:v,sender:this})})}static createCore(c){return Object.keys(c).reduce((v,C)=>Object.assign(v,{[C]:R(c[C])}),{})}static fromObject(c){const v=this.createCore(c);return new K(v)}get(c){return this.valMap_[c].rawValue}set(c,v){this.valMap_[c].rawValue=v}value(c){return this.valMap_[c]}}function U(w,c){return Object.keys(c).reduce((C,M)=>{if(C===void 0)return;const D=c[M],$=D(w[M]);return $.succeeded?Object.assign(Object.assign({},C),{[M]:$.value}):void 0},{})}function le(w,c){return w.reduce((v,C)=>{if(v===void 0)return;const M=c(C);if(!(!M.succeeded||M.value===void 0))return[...v,M.value]},[])}function N(w){return w===null?!1:typeof w=="object"}function z(w){return c=>v=>{if(!c&&v===void 0)return{succeeded:!1,value:void 0};if(c&&v===void 0)return{succeeded:!0,value:void 0};const C=w(v);return C!==void 0?{succeeded:!0,value:C}:{succeeded:!1,value:void 0}}}function H(w){return{custom:c=>z(c)(w),boolean:z(c=>typeof c=="boolean"?c:void 0)(w),number:z(c=>typeof c=="number"?c:void 0)(w),string:z(c=>typeof c=="string"?c:void 0)(w),function:z(c=>typeof c=="function"?c:void 0)(w),constant:c=>z(v=>v===c?c:void 0)(w),raw:z(c=>c)(w),object:c=>z(v=>{if(N(v))return U(v,c)})(w),array:c=>z(v=>{if(Array.isArray(v))return le(v,c)})(w)}}const J={optional:H(!0),required:H(!1)};function X(w,c){const v=J.required.object(c)(w);return v.succeeded?v.value:void 0}const oe="http://www.w3.org/2000/svg";function me(w){w.offsetHeight}function ze(w,c){const v=w.style.transition;w.style.transition="none",c(),w.style.transition=v}function ue(w){return w.ontouchstart!==void 0}function Ae(w){return w.relatedTarget?w.relatedTarget:"explicitOriginalTarget"in w?w.explicitOriginalTarget:null}class we extends K{constructor(c){super(c)}static create(c){const v={completed:!0,expanded:c,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},C=K.createCore(v);return new we(C)}get styleExpanded(){var c;return(c=this.get("temporaryExpanded"))!==null&&c!==void 0?c:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const c=this.get("expandedHeight");return this.get("shouldFixHeight")&&!i(c)?`${c}px`:"auto"}bindExpandedClass(c,v){I(this,"expanded",()=>{this.styleExpanded?c.classList.add(v):c.classList.remove(v)})}}function ce(w,c){let v=0;return ze(c,()=>{w.set("expandedHeight",null),w.set("temporaryExpanded",!0),me(c),v=c.clientHeight,w.set("temporaryExpanded",null),me(c)}),v}function ie(w,c){c.style.height=w.styleHeight}function Xt(w,c){w.value("expanded").emitter.on("beforechange",()=>{w.set("completed",!1),i(w.get("expandedHeight"))&&w.set("expandedHeight",ce(w,c)),w.set("shouldFixHeight",!0),me(c)}),w.emitter.on("change",()=>{ie(w,c)}),ie(w,c),c.addEventListener("transitionend",v=>{v.propertyName==="height"&&(w.set("shouldFixHeight",!1),w.set("expandedHeight",null),w.set("completed",!0))})}class Zt{constructor(c){this.constraints=c}constrain(c){return this.constraints.reduce((v,C)=>C.constrain(v),c)}}class yn{constructor(c){this.maxValue=c.max,this.minValue=c.min}constrain(c){let v=c;return i(this.minValue)||(v=Math.max(v,this.minValue)),i(this.maxValue)||(v=Math.min(v,this.maxValue)),v}}class We{constructor(c){this.step=c}constrain(c){return(c<0?-Math.round(-c/this.step):Math.round(c/this.step))*this.step}}const nt=f("pop");class be{constructor(c,v){this.element=c.createElement("div"),this.element.classList.add(nt()),v.viewProps.bindClassModifiers(this.element),A(v.shows,O(this.element,nt(void 0,"v")))}}class Ee{constructor(c,v){this.shows=R(!1),this.viewProps=v.viewProps,this.view=new be(c,{shows:this.shows,viewProps:this.viewProps})}}class bt{constructor(c){this.text=c}evaluate(){return Number(this.text)}toString(){return this.text}}const Dt={"**":(w,c)=>Math.pow(w,c),"*":(w,c)=>w*c,"/":(w,c)=>w/c,"%":(w,c)=>w%c,"+":(w,c)=>w+c,"-":(w,c)=>w-c,"<<":(w,c)=>w<<c,">>":(w,c)=>w>>c,">>>":(w,c)=>w>>>c,"&":(w,c)=>w&c,"^":(w,c)=>w^c,"|":(w,c)=>w|c};class je{constructor(c,v,C){this.left=v,this.operator=c,this.right=C}evaluate(){const c=Dt[this.operator];if(!c)throw new Error(`unexpected binary operator: '${this.operator}`);return c(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ot={"+":w=>w,"-":w=>-w,"~":w=>~w};class Nt{constructor(c,v){this.operator=c,this.expression=v}evaluate(){const c=Ot[this.operator];if(!c)throw new Error(`unexpected unary operator: '${this.operator}`);return c(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Ue(w){return(c,v)=>{for(let C=0;C<w.length;C++){const M=w[C](c,v);if(M!=="")return M}return""}}function pt(w,c){var v;const C=w.substr(c).match(/^\s+/);return(v=C&&C[0])!==null&&v!==void 0?v:""}function cn(w,c){const v=w.substr(c,1);return v.match(/^[1-9]$/)?v:""}function Qe(w,c){var v;const C=w.substr(c).match(/^[0-9]+/);return(v=C&&C[0])!==null&&v!==void 0?v:""}function ut(w,c){const v=Qe(w,c);if(v!=="")return v;const C=w.substr(c,1);if(c+=1,C!=="-"&&C!=="+")return"";const M=Qe(w,c);return M===""?"":C+M}function Le(w,c){const v=w.substr(c,1);if(c+=1,v.toLowerCase()!=="e")return"";const C=ut(w,c);return C===""?"":v+C}function Re(w,c){const v=w.substr(c,1);if(v==="0")return v;const C=cn(w,c);return c+=C.length,C===""?"":C+Qe(w,c)}function Cn(w,c){const v=Re(w,c);if(c+=v.length,v==="")return"";const C=w.substr(c,1);if(c+=C.length,C!==".")return"";const M=Qe(w,c);return c+=M.length,v+C+M+Le(w,c)}function Et(w,c){const v=w.substr(c,1);if(c+=v.length,v!==".")return"";const C=Qe(w,c);return c+=C.length,C===""?"":v+C+Le(w,c)}function Wt(w,c){const v=Re(w,c);return c+=v.length,v===""?"":v+Le(w,c)}const Pt=Ue([Cn,Et,Wt]);function dn(w,c){var v;const C=w.substr(c).match(/^[01]+/);return(v=C&&C[0])!==null&&v!==void 0?v:""}function En(w,c){const v=w.substr(c,2);if(c+=v.length,v.toLowerCase()!=="0b")return"";const C=dn(w,c);return C===""?"":v+C}function vt(w,c){var v;const C=w.substr(c).match(/^[0-7]+/);return(v=C&&C[0])!==null&&v!==void 0?v:""}function kt(w,c){const v=w.substr(c,2);if(c+=v.length,v.toLowerCase()!=="0o")return"";const C=vt(w,c);return C===""?"":v+C}function hn(w,c){var v;const C=w.substr(c).match(/^[0-9a-f]+/i);return(v=C&&C[0])!==null&&v!==void 0?v:""}function jt(w,c){const v=w.substr(c,2);if(c+=v.length,v.toLowerCase()!=="0x")return"";const C=hn(w,c);return C===""?"":v+C}const ft=Ue([En,kt,jt]),y=Ue([ft,Pt]);function B(w,c){const v=y(w,c);return c+=v.length,v===""?null:{evaluable:new bt(v),cursor:c}}function se(w,c){const v=w.substr(c,1);if(c+=v.length,v!=="(")return null;const C=Fe(w,c);if(!C)return null;c=C.cursor,c+=pt(w,c).length;const M=w.substr(c,1);return c+=M.length,M!==")"?null:{evaluable:C.evaluable,cursor:c}}function re(w,c){return B(w,c)||se(w,c)}function xe(w,c){const v=re(w,c);if(v)return v;const C=w.substr(c,1);if(c+=C.length,C!=="+"&&C!=="-"&&C!=="~")return null;const M=xe(w,c);return M?(c=M.cursor,{cursor:c,evaluable:new Nt(C,M.evaluable)}):null}function it(w,c,v){v+=pt(c,v).length;const C=w.filter(M=>c.startsWith(M,v))[0];return C?(v+=C.length,v+=pt(c,v).length,{cursor:v,operator:C}):null}function Ve(w,c){return(v,C)=>{const M=w(v,C);if(!M)return null;C=M.cursor;let D=M.evaluable;for(;;){const $=it(c,v,C);if(!$)break;C=$.cursor;const W=w(v,C);if(!W)return null;C=W.cursor,D=new je($.operator,D,W.evaluable)}return D?{cursor:C,evaluable:D}:null}}const _t=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((w,c)=>Ve(w,c),xe);function Fe(w,c){return c+=pt(w,c).length,_t(w,c)}function Ie(w){const c=Fe(w,0);return!c||c.cursor+pt(w,c.cursor).length!==w.length?null:c.evaluable}function st(w){var c;const v=Ie(w);return(c=v==null?void 0:v.evaluate())!==null&&c!==void 0?c:null}function si(w){return c=>c.toFixed(Math.max(Math.min(w,20),0))}function On({primary:w,secondary:c,forward:v,backward:C}){let M=!1;function D($){M||(M=!0,$(),M=!1)}w.emitter.on("change",$=>{D(()=>{c.setRawValue(v(w,c),$.options)})}),c.emitter.on("change",$=>{D(()=>{w.setRawValue(C(w,c),$.options)}),D(()=>{c.setRawValue(v(w,c),$.options)})}),D(()=>{c.setRawValue(v(w,c),{forceEmit:!1,last:!0})})}function Nn(w,c){const v=w*(c.altKey?.1:1)*(c.shiftKey?10:1);return c.upKey?+v:c.downKey?-v:0}function oi(w){return{altKey:w.altKey,downKey:w.key==="ArrowDown",shiftKey:w.shiftKey,upKey:w.key==="ArrowUp"}}function os(w){return{altKey:w.altKey,downKey:w.key==="ArrowLeft",shiftKey:w.shiftKey,upKey:w.key==="ArrowRight"}}function ri(w){return w==="ArrowUp"||w==="ArrowDown"}function Qt(w){return ri(w)||w==="ArrowLeft"||w==="ArrowRight"}function Pn(w,c){const v=c.ownerDocument.defaultView,C=c.getBoundingClientRect();return{x:w.pageX-((v&&v.scrollX||0)+C.left),y:w.pageY-((v&&v.scrollY||0)+C.top)}}class Me{constructor(c){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=c,this.emitter=new p,c.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),c.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),c.addEventListener("touchend",this.onTouchEnd_),c.addEventListener("mousedown",this.onMouseDown_)}computePosition_(c){const v=this.elem_.getBoundingClientRect();return{bounds:{width:v.width,height:v.height},point:c?{x:c.x,y:c.y}:null}}onMouseDown_(c){var v;c.preventDefault(),(v=c.currentTarget)===null||v===void 0||v.focus();const C=this.elem_.ownerDocument;C.addEventListener("mousemove",this.onDocumentMouseMove_),C.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:c.altKey,data:this.computePosition_(Pn(c,this.elem_)),sender:this,shiftKey:c.shiftKey})}onDocumentMouseMove_(c){this.emitter.emit("move",{altKey:c.altKey,data:this.computePosition_(Pn(c,this.elem_)),sender:this,shiftKey:c.shiftKey})}onDocumentMouseUp_(c){const v=this.elem_.ownerDocument;v.removeEventListener("mousemove",this.onDocumentMouseMove_),v.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:c.altKey,data:this.computePosition_(Pn(c,this.elem_)),sender:this,shiftKey:c.shiftKey})}onTouchStart_(c){c.preventDefault();const v=c.targetTouches.item(0),C=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:c.altKey,data:this.computePosition_(v?{x:v.clientX-C.left,y:v.clientY-C.top}:void 0),sender:this,shiftKey:c.shiftKey}),this.lastTouch_=v}onTouchMove_(c){const v=c.targetTouches.item(0),C=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:c.altKey,data:this.computePosition_(v?{x:v.clientX-C.left,y:v.clientY-C.top}:void 0),sender:this,shiftKey:c.shiftKey}),this.lastTouch_=v}onTouchEnd_(c){var v;const C=(v=c.targetTouches.item(0))!==null&&v!==void 0?v:this.lastTouch_,M=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:c.altKey,data:this.computePosition_(C?{x:C.clientX-M.left,y:C.clientY-M.top}:void 0),sender:this,shiftKey:c.shiftKey})}}function ai(w,c,v){return Math.min(Math.max(w,c),v)}const Se=f("txt");class Si{constructor(c,v){this.onChange_=this.onChange_.bind(this),this.props_=v.props,this.props_.emitter.on("change",this.onChange_),this.element=c.createElement("div"),this.element.classList.add(Se(),Se(void 0,"num")),v.arrayPosition&&this.element.classList.add(Se(void 0,v.arrayPosition)),v.viewProps.bindClassModifiers(this.element);const C=c.createElement("input");C.classList.add(Se("i")),C.type="text",v.viewProps.bindDisabled(C),this.element.appendChild(C),this.inputElement=C,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=v.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Se()),this.inputElement.classList.add(Se("i"));const M=c.createElement("div");M.classList.add(Se("k")),this.element.appendChild(M),this.knobElement=M;const D=c.createElementNS(oe,"svg");D.classList.add(Se("g")),this.knobElement.appendChild(D);const $=c.createElementNS(oe,"path");$.classList.add(Se("gb")),D.appendChild($),this.guideBodyElem_=$;const W=c.createElementNS(oe,"path");W.classList.add(Se("gh")),D.appendChild(W),this.guideHeadElem_=W;const Z=c.createElement("div");Z.classList.add(f("tt")()),this.knobElement.appendChild(Z),this.tooltipElem_=Z,v.value.emitter.on("change",this.onChange_),this.value=v.value,this.refresh()}onDraggingChange_(c){if(c.rawValue===null){this.element.classList.remove(Se(void 0,"drg"));return}this.element.classList.add(Se(void 0,"drg"));const v=c.rawValue/this.props_.get("draggingScale"),C=v+(v>0?-1:v<0?1:0),M=ai(-C,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${C+M},0 L${C},4 L${C+M},8`,`M ${v},-1 L${v},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${v},4`);const D=this.props_.get("formatter");this.tooltipElem_.textContent=D(this.value.rawValue),this.tooltipElem_.style.left=`${v}px`}refresh(){const c=this.props_.get("formatter");this.inputElement.value=c(this.value.rawValue)}onChange_(){this.refresh()}}class kn{constructor(c,v){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=v.baseStep,this.parser_=v.parser,this.props=v.props,this.value=v.value,this.viewProps=v.viewProps,this.dragging_=R(null),this.view=new Si(c,{arrayPosition:v.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const C=new Me(this.view.knobElement);C.emitter.on("down",this.onPointerDown_),C.emitter.on("move",this.onPointerMove_),C.emitter.on("up",this.onPointerUp_)}onInputChange_(c){const v=c.currentTarget.value,C=this.parser_(v);i(C)||(this.value.rawValue=C),this.view.refresh()}onInputKeyDown_(c){const v=Nn(this.baseStep_,oi(c));v!==0&&this.value.setRawValue(this.value.rawValue+v,{forceEmit:!1,last:!1})}onInputKeyUp_(c){Nn(this.baseStep_,oi(c))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(c){if(!c.point)return null;const v=c.point.x-c.bounds.width/2;return this.originRawValue_+v*this.props.get("draggingScale")}onPointerMove_(c){const v=this.computeDraggingValue_(c.data);v!==null&&(this.value.setRawValue(v,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(c){const v=this.computeDraggingValue_(c.data);v!==null&&(this.value.setRawValue(v,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function li(w){if(w==="inline"||w==="popup")return w}function wt(w){const c=J;return c.required.object({max:c.optional.number,min:c.optional.number,step:c.optional.number})(w).value}class pn{constructor(c){this.components=c.components,this.asm_=c.assembly}constrain(c){const v=this.asm_.toComponents(c).map((C,M)=>{var D,$;return($=(D=this.components[M])===null||D===void 0?void 0:D.constrain(C))!==null&&$!==void 0?$:C});return this.asm_.fromComponents(v)}}const jn=f("pndtxt");class rs{constructor(c,v){this.textViews=v.textViews,this.element=c.createElement("div"),this.element.classList.add(jn()),this.textViews.forEach(C=>{const M=c.createElement("div");M.classList.add(jn("a")),M.appendChild(C.element),this.element.appendChild(M)})}}function as(w,c,v){return new kn(w,{arrayPosition:v===0?"fst":v===c.axes.length-1?"lst":"mid",baseStep:c.axes[v].baseStep,parser:c.parser,props:c.axes[v].textProps,value:R(0,{constraint:c.axes[v].constraint}),viewProps:c.viewProps})}class ls{constructor(c,v){this.value=v.value,this.viewProps=v.viewProps,this.acs_=v.axes.map((C,M)=>as(c,v,M)),this.acs_.forEach((C,M)=>{On({primary:this.value,secondary:C.value,forward:D=>v.assembly.toComponents(D.rawValue)[M],backward:(D,$)=>{const W=v.assembly.toComponents(D.rawValue);return W[M]=$.rawValue,v.assembly.fromComponents(W)}})}),this.view=new rs(c,{textViews:this.acs_.map(C=>C.view)})}}class zi{multiply(c){return this.format(this.quat.multiply(c.quat))}premultiply(c){return this.format(c.multiply(this))}slerp(c,v){return this.format(this.quat.slerp(c.quat,v))}}function Fn(w,c,v){return Math.min(Math.max(w,c),v)}function cs(w,c){return Math.floor(w/c)*c}function ds(w,c){return w-cs(w,c)}function At(w){return ds(w+Math.PI,Math.PI*2)-Math.PI}class Mt extends zi{constructor(c,v,C,M,D){super(),this.x=c??0,this.y=v??0,this.z=C??0,this.order=M??"XYZ",this.unit=D??"rad"}static fromQuaternion(c,v,C){const M=c.toMat3(),[D,$,W,Z]=v==="XYZ"?[0,1,2,1]:v==="XZY"?[0,2,1,-1]:v==="YXZ"?[1,0,2,-1]:v==="YZX"?[1,2,0,1]:v==="ZXY"?[2,0,1,1]:[2,1,0,-1],Q=[0,0,0],pe=M[W+D*3];return Q[$]=-Z*Math.asin(Fn(pe,-1,1)),Math.abs(pe)<.999999?(Q[D]=Z*Math.atan2(M[W+$*3],M[W*4]),Q[W]=Z*Math.atan2(M[$+D*3],M[D*4])):Q[D]=Z*Math.atan2(-M[$+W*3],M[$*4]),Math.abs(Q[D])+Math.abs(Q[W])>Math.PI&&(Q[D]=At(Q[D]+Math.PI),Q[$]=At(Math.PI-Q[$]),Q[W]=At(Q[W]+Math.PI)),new Mt(...Q,v).reunit(C)}get quat(){return he.fromEuler(this)}getComponents(){return[this.x,this.y,this.z]}toEuler(c,v){return this.reorder(c).reunit(v)}format(c){return c instanceof Mt?c.reorder(this.order):c.toEuler(this.order,this.unit)}reorder(c){return c===this.order?this:this.quat.toEuler(c,this.unit)}reunit(c){const v={deg:Math.PI/180,rad:1,turn:2*Math.PI}[this.unit],C={deg:180/Math.PI,rad:1,turn:.5/Math.PI}[c],M=v*C;return new Mt(M*this.x,M*this.y,M*this.z,this.order,c)}}class he extends zi{constructor(c,v,C,M){super(),this.x=c??0,this.y=v??0,this.z=C??0,this.w=M??1}static fromAxisAngle(c,v){const C=v/2,M=Math.sin(C);return new he(c.x*M,c.y*M,c.z*M,Math.cos(C))}static fromEuler(c){const v=c.reunit("rad"),[C,M,D,$]=v.order==="XYZ"?[0,1,2,1]:v.order==="XZY"?[0,2,1,-1]:v.order==="YXZ"?[1,0,2,-1]:v.order==="YZX"?[1,2,0,1]:v.order==="ZXY"?[2,0,1,1]:[2,1,0,-1],W=v.getComponents(),Z=.5*W[C],Q=.5*$*W[M],pe=.5*W[D],Ce=Math.cos(Z),Be=Math.cos(Q),De=Math.cos(pe),Xe=Math.sin(Z),mt=Math.sin(Q),ye=Math.sin(pe),In=[0,0,0,De*Be*Ce+ye*mt*Xe];return In[C]=De*Be*Xe-ye*mt*Ce,In[M]=$*(De*mt*Ce+ye*Be*Xe),In[D]=ye*Be*Ce-De*mt*Xe,new he(...In)}static lookRotation(c,v){const{normal:C,tangent:M,binormal:D}=c.orthoNormalize(v),$=D.x,W=M.x,Z=C.x,Q=D.y,pe=M.y,Ce=C.y,Be=D.z,De=M.z,Xe=C.z,mt=$+pe+Xe;if(mt>0){const ye=.5/Math.sqrt(mt+1);return new he((De-Ce)*ye,(Z-Be)*ye,(Q-W)*ye,.25/ye)}else if($>pe&&$>Xe){const ye=2*Math.sqrt(1+$-pe-Xe);return new he(.25*ye,(W+Q)/ye,(Z+Be)/ye,(De-Ce)/ye)}else if(pe>Xe){const ye=2*Math.sqrt(1+pe-$-Xe);return new he((W+Q)/ye,.25*ye,(Ce+De)/ye,(Z-Be)/ye)}else{const ye=2*Math.sqrt(1+Xe-$-pe);return new he((Z+Be)/ye,(Ce+De)/ye,.25*ye,(Q-W)/ye)}}get quat(){return this}getComponents(){return[this.x,this.y,this.z,this.w]}toEuler(c,v){return Mt.fromQuaternion(this,c,v)}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const c=this.length;return c===0?new he:new he(this.x/c,this.y/c,this.z/c,this.w/c)}get negated(){return new he(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(c){const v=c.quat;return new he(this.w*v.x+this.x*v.w+this.y*v.z-this.z*v.y,this.w*v.y-this.x*v.z+this.y*v.w+this.z*v.x,this.w*v.z+this.x*v.y-this.y*v.x+this.z*v.w,this.w*v.w-this.x*v.x-this.y*v.y-this.z*v.z)}format(c){return c.quat}slerp(c,v){let C=c.quat;if(v===0)return this;if(v===1)return C;const M=this.ban360s;C=C.ban360s;let D=M.w*C.w+M.x*C.x+M.y*C.y+M.z*C.z;if(D<0&&(C=C.negated,D=-D),D>=1)return M;const $=1-D*D;if($<=Number.EPSILON){const Ce=1-v;return new he(Ce*M.x+v*C.x,Ce*M.y+v*C.y,Ce*M.z+v*C.z,Ce*M.w+v*C.w).normalized}const W=Math.sqrt($),Z=Math.atan2(W,D),Q=Math.sin((1-v)*Z)/W,pe=Math.sin(v*Z)/W;return new he(M.x*Q+C.x*pe,M.y*Q+C.y*pe,M.z*Q+C.z*pe,M.w*Q+C.w*pe)}toMat3(){const{x:c,y:v,z:C,w:M}=this;return[1-2*v*v-2*C*C,2*c*v+2*C*M,2*c*C-2*v*M,2*c*v-2*C*M,1-2*c*c-2*C*C,2*v*C+2*c*M,2*c*C+2*v*M,2*v*C-2*c*M,1-2*c*c-2*v*v]}}class An{constructor(){this.offset=[0,0,-5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(c){const v=(this.viewport[0]+this.viewport[2])*.5,C=(this.viewport[1]+this.viewport[3])*.5,M=this.viewport[2]-this.viewport[0],D=this.viewport[3]-this.viewport[1],$=1/Math.tan(this.fov*Math.PI/360),W=-(c.z+this.offset[2]),Z=v+(c.x+this.offset[0])/W*$*M*.5/this.aspect,Q=C-(c.y+this.offset[1])/W*$*D*.5;return[Z,Q]}}class Pe{constructor(c,v,C){this.element=c.createElementNS(oe,"path"),this.vertices=v,this.projector=C}setRotation(c){let v="";return this.vertices.forEach((C,M)=>{const D=C.applyQuaternion(c),[$,W]=this.projector.project(D);v+=`${M===0?"M":"L"}${$} ${W}`}),this.element.setAttributeNS(null,"d",v),this}}class ae{constructor(c,v,C){this.x=c??0,this.y=v??0,this.z=C??0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const c=this.length;return c===0?new ae:new ae(this.x/c,this.y/c,this.z/c)}get negated(){return new ae(-this.x,-this.y,-this.z)}add(c){return new ae(this.x+c.x,this.y+c.y,this.z+c.z)}sub(c){return new ae(this.x-c.x,this.y-c.y,this.z-c.z)}scale(c){return new ae(this.x*c,this.y*c,this.z*c)}dot(c){return this.x*c.x+this.y*c.y+this.z*c.z}cross(c){return new ae(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x)}orthoNormalize(c){const v=this.normalized;c=c.normalized;let C=v.dot(c);C===1&&(Math.abs(v.y)>Math.abs(v.z)?c=new ae(0,0,1):c=new ae(0,1,0),C=v.dot(c)),c=c.sub(v.scale(C)).normalized;const M=c.cross(v);return{normal:v,tangent:c,binormal:M}}applyQuaternion(c){const v=c.w*this.x+c.y*this.z-c.z*this.y,C=c.w*this.y+c.z*this.x-c.x*this.z,M=c.w*this.z+c.x*this.y-c.y*this.x,D=-c.x*this.x-c.y*this.y-c.z*this.z;return new ae(v*c.w+D*-c.x+C*-c.z-M*-c.y,C*c.w+D*-c.y+M*-c.x-v*-c.z,M*c.w+D*-c.z+v*-c.y-C*-c.x)}}function qe(w,c){const v=c.z>0?new he(0,0,0,1):new he(0,0,1,0);return Math.abs(w.z)>.9999?v:he.lookRotation(w,c)}function un(w,c,v,C,M,D=1){const $=[];for(let W=0;W<v;W++){const Z=w+c*W/(v-1),Q=new ae;Q[C]=D*Math.cos(Z),Q[M]=D*Math.sin(Z),$.push(Q)}return $}const te=f("rotationgizmo"),xt=new ae(0,0,0),hs=new ae(1,0,0),Je=new ae(0,1,0),Jt=new ae(0,0,1),en=new ae(0,0,-1),ci=new ae(.7,0,0),di=new ae(0,.7,0),hi=new ae(0,0,.7),Hn=new ae(-.7,0,0),tn=new ae(0,-.7,0),Tt=new ae(0,0,-.7),pi=new he(0,0,0,1);function nn(w,c,v){const C=w.createElementNS(oe,"g"),M=w.createElementNS(oe,"circle");M.classList.add(te(c)),M.setAttributeNS(null,"cx","0"),M.setAttributeNS(null,"cy","0"),M.setAttributeNS(null,"r","8"),C.appendChild(M);const D=w.createElementNS(oe,"text");return D.classList.add(te("labeltext")),D.setAttributeNS(null,"y","4"),D.setAttributeNS(null,"text-anchor","middle"),D.setAttributeNS(null,"font-size","10"),D.textContent=v,C.appendChild(D),C}class ui{constructor(c,v){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=c.createElement("div"),this.element.classList.add(te()),v.pickerLayout==="popup"&&this.element.classList.add(te(void 0,"p"));const C=c.createElement("div");C.classList.add(te("p")),v.viewProps.bindTabIndex(C),this.element.appendChild(C),this.padElement=C;const M=c.createElementNS(oe,"svg");M.classList.add(te("g")),this.padElement.appendChild(M),this.svgElem_=M,this.projector_=new An,this.projector_.viewport=[0,0,136,136];const D=un(0,Math.PI,33,"x","y"),$=un(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new Pe(c,D,this.projector_),this.xArcB_.element.classList.add(te("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new Pe(c,D,this.projector_),this.yArcB_.element.classList.add(te("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new Pe(c,D,this.projector_),this.zArcB_.element.classList.add(te("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new Pe(c,D,this.projector_),this.xArcBC_.element.classList.add(te("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new Pe(c,D,this.projector_),this.yArcBC_.element.classList.add(te("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new Pe(c,D,this.projector_),this.zArcBC_.element.classList.add(te("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const W=c.createElementNS(oe,"g");M.classList.add(te("axes")),this.svgElem_.appendChild(W),this.axesElem_=W,this.xAxis_=new Pe(c,[xt,ci],this.projector_),this.xAxis_.element.classList.add(te("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new Pe(c,[xt,di],this.projector_),this.yAxis_.element.classList.add(te("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new Pe(c,[xt,hi],this.projector_),this.zAxis_.element.classList.add(te("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new Pe(c,[xt,Hn],this.projector_),this.xnAxis_.element.classList.add(te("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new Pe(c,[xt,tn],this.projector_),this.ynAxis_.element.classList.add(te("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new Pe(c,[xt,Tt],this.projector_),this.znAxis_.element.classList.add(te("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new Pe(c,D,this.projector_),this.xArcF_.element.classList.add(te("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new Pe(c,D,this.projector_),this.yArcF_.element.classList.add(te("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new Pe(c,D,this.projector_),this.zArcF_.element.classList.add(te("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new Pe(c,D,this.projector_),this.xArcFC_.element.classList.add(te("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new Pe(c,D,this.projector_),this.yArcFC_.element.classList.add(te("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new Pe(c,D,this.projector_),this.zArcFC_.element.classList.add(te("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new Pe(c,$,this.projector_),this.rArc_.element.classList.add(te("arcr")),this.rArc_.setRotation(pi),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new Pe(c,$,this.projector_),this.rArcC_.element.classList.add(te("arcc")),this.rArcC_.setRotation(pi),this.svgElem_.appendChild(this.rArcC_.element);const Z=c.createElementNS(oe,"g");M.classList.add(te("labels")),this.svgElem_.appendChild(Z),this.labelsElem_=Z,this.xLabel=nn(c,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=nn(c,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=nn(c,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=nn(c,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=nn(c,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=nn(c,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const Q=()=>{this.xArcB_.element.classList.add(te("arcx_hover")),this.xArcF_.element.classList.add(te("arcx_hover"))},pe=()=>{this.xArcB_.element.classList.remove(te("arcx_hover")),this.xArcF_.element.classList.remove(te("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",Q),this.xArcBC_.element.addEventListener("mouseleave",pe),this.xArcFC_.element.addEventListener("mouseenter",Q),this.xArcFC_.element.addEventListener("mouseleave",pe);const Ce=()=>{this.yArcB_.element.classList.add(te("arcy_hover")),this.yArcF_.element.classList.add(te("arcy_hover"))},Be=()=>{this.yArcB_.element.classList.remove(te("arcy_hover")),this.yArcF_.element.classList.remove(te("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",Ce),this.yArcBC_.element.addEventListener("mouseleave",Be),this.yArcFC_.element.addEventListener("mouseenter",Ce),this.yArcFC_.element.addEventListener("mouseleave",Be);const De=()=>{this.zArcB_.element.classList.add(te("arcz_hover")),this.zArcF_.element.classList.add(te("arcz_hover"))},Xe=()=>{this.zArcB_.element.classList.remove(te("arcz_hover")),this.zArcF_.element.classList.remove(te("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",De),this.zArcBC_.element.addEventListener("mouseleave",Xe),this.zArcFC_.element.addEventListener("mouseenter",De),this.zArcFC_.element.addEventListener("mouseleave",Xe);const mt=()=>{this.rArc_.element.classList.add(te("arcr_hover"))},ye=()=>{this.rArc_.element.classList.remove(te("arcr_hover"))};this.rArcC_.element.addEventListener("mouseenter",mt),this.rArcC_.element.addEventListener("mouseleave",ye),v.value.emitter.on("change",this.onValueChange_),this.value=v.value,v.mode.emitter.on("change",this.onModeChange_),this.mode_=v.mode,this.update_()}get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}get allFocusableElements(){return[this.padElement]}update_(){const c=this.value.rawValue.quat.normalized;this.xAxis_.setRotation(c),this.yAxis_.setRotation(c),this.zAxis_.setRotation(c),this.xnAxis_.setRotation(c),this.ynAxis_.setRotation(c),this.znAxis_.setRotation(c);const v=hs.applyQuaternion(c),C=Je.applyQuaternion(c),M=Jt.applyQuaternion(c),D=v.negated,$=C.negated,W=M.negated;[{el:this.xAxis_.element,v},{el:this.yAxis_.element,v:C},{el:this.zAxis_.element,v:M},{el:this.xnAxis_.element,v:D},{el:this.ynAxis_.element,v:$},{el:this.znAxis_.element,v:W}].map(({el:Z,v:Q})=>(this.axesElem_.removeChild(Z),{el:Z,v:Q})).sort((Z,Q)=>Z.v.z-Q.v.z).forEach(({el:Z})=>{this.axesElem_.appendChild(Z)}),this.xArcB_.setRotation(qe(v,en)),this.yArcB_.setRotation(qe(C,en)),this.zArcB_.setRotation(qe(M,en)),this.xArcBC_.setRotation(qe(v,en)),this.yArcBC_.setRotation(qe(C,en)),this.zArcBC_.setRotation(qe(M,en)),this.xArcF_.setRotation(qe(v,Jt)),this.yArcF_.setRotation(qe(C,Jt)),this.zArcF_.setRotation(qe(M,Jt)),this.xArcFC_.setRotation(qe(v,Jt)),this.yArcFC_.setRotation(qe(C,Jt)),this.zArcFC_.setRotation(qe(M,Jt)),[{el:this.xLabel,v:ci},{el:this.yLabel,v:di},{el:this.zLabel,v:hi},{el:this.xnLabel,v:Hn},{el:this.ynLabel,v:tn},{el:this.znLabel,v:Tt}].forEach(({el:Z,v:Q})=>{const[pe,Ce]=this.projector_.project(Q.applyQuaternion(c));Z.setAttributeNS(null,"transform",`translate( ${pe}, ${Ce} )`)}),[{el:this.xLabel,v},{el:this.yLabel,v:C},{el:this.zLabel,v:M},{el:this.xnLabel,v:D},{el:this.ynLabel,v:$},{el:this.znLabel,v:W}].map(({el:Z,v:Q})=>(this.labelsElem_.removeChild(Z),{el:Z,v:Q})).sort((Z,Q)=>Z.v.z-Q.v.z).forEach(({el:Z})=>{this.labelsElem_.appendChild(Z)})}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const c=this.mode_.rawValue,v=c==="angle-x"?"add":"remove",C=c==="angle-y"?"add":"remove",M=c==="angle-z"?"add":"remove",D=c==="angle-r"?"add":"remove";this.xArcB_.element.classList[v](te("arcx_active")),this.yArcB_.element.classList[C](te("arcy_active")),this.zArcB_.element.classList[M](te("arcz_active")),this.xArcF_.element.classList[v](te("arcx_active")),this.yArcF_.element.classList[C](te("arcy_active")),this.zArcF_.element.classList[M](te("arcz_active")),this.rArc_.element.classList[D](te("arcr_active"))}}function Bn(w){return Fn(w,0,1)}function Kn(w){if(w<=0)return 0;if(w>=1)return 1;const c=1-w,v=c*(c*(c*(c*(c*(c*(c*-6+7))))));return Bn(1-v)}function He(w,c,v){return Bn((v-w)/(c-w))}const Lt=1/Math.sqrt(2),vn=new ae(1,0,0),at=new ae(0,1,0),ps=new ae(0,0,1),us=new he(0,0,0,1),vi=new he(Lt,0,0,Lt),Mn=new he(0,-Lt,0,Lt),It=new he(-Lt,0,0,Lt),sn=new he(0,Lt,0,Lt),Tn=new he(0,1,0,0);class mi{constructor(c,v){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=v.value,this.viewProps=v.viewProps,this.mode_=R("free"),this.view=new ui(c,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:v.pickerLayout}),this.ptHandler_=new Me(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const C=new Me(this.view.xArcBElement);C.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),C.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const M=new Me(this.view.xArcFElement);M.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),M.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const D=new Me(this.view.yArcBElement);D.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),D.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const $=new Me(this.view.yArcFElement);$.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),$.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const W=new Me(this.view.zArcBElement);W.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),W.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const Z=new Me(this.view.zArcFElement);Z.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),Z.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const Q=new Me(this.view.rArcElement);Q.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-r")),Q.emitter.on("up",()=>this.changeModeIfNotAuto_("free")),[{el:this.view.xLabel,q:Mn},{el:this.view.yLabel,q:vi},{el:this.view.zLabel,q:us},{el:this.view.xnLabel,q:sn},{el:this.view.ynLabel,q:It},{el:this.view.znLabel,q:Tn}].forEach(({el:pe,q:Ce})=>{new Me(pe).emitter.on("down",()=>this.autoRotate_(Ce))}),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(c){if(!c.point)return;const v=this.mode_.rawValue,C=c.point.x,M=c.point.y;if(v!=="auto")if(v==="free"){if(this.px_!=null&&this.py_!=null){const D=C-this.px_,$=M-this.py_,W=Math.sqrt(D*D+$*$);if(W===0)return;const Z=new ae($/W,D/W,0),Q=he.fromAxisAngle(Z,W/68);this.value.rawValue=this.value.rawValue.premultiply(Q)}this.px_=C,this.py_=M}else if(v==="angle-r"){const D=c.bounds.width/2,$=c.bounds.height/2,W=Math.atan2(M-$,C-D);if(this.angleState_==null){const Z=new ae(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:W,axis:Z,reverseAngle:!0}}else{const{initialRotation:Z,initialAngle:Q,axis:pe}=this.angleState_,Ce=-At(W-Q),Be=he.fromAxisAngle(pe,Ce);this.value.rawValue=Z.premultiply(Be)}}else{const D=c.bounds.width/2,$=c.bounds.height/2,W=Math.atan2(M-$,C-D);if(this.angleState_==null){const Z=v==="angle-x"?vn:v==="angle-y"?at:ps,Q=Z.applyQuaternion(this.value.rawValue.quat).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:W,axis:Z,reverseAngle:Q}}else{const{initialRotation:Z,initialAngle:Q,axis:pe,reverseAngle:Ce}=this.angleState_;let Be=At(W-Q);Be=Ce?-Be:Be;const De=he.fromAxisAngle(pe,Be);this.value.rawValue=Z.multiply(De)}}}onPointerDown_(c){this.handlePointerEvent_(c.data)}onPointerMove_(c){this.handlePointerEvent_(c.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(c){Qt(c.key)&&c.preventDefault();const v=Nn(1,os(c)),C=Nn(1,oi(c));if(v!==0||C!==0){const M=new ae(-C,v,0),D=he.fromAxisAngle(M,Math.PI/16);this.value.rawValue=this.value.rawValue.premultiply(D)}}changeModeIfNotAuto_(c){this.mode_.rawValue!=="auto"&&(this.mode_.rawValue=c)}autoRotate_(c){this.mode_.rawValue="auto";const v=this.value.rawValue,C=Date.now(),M=()=>{const D=Date.now(),$=Kn(He(0,300,D-C));if(this.value.rawValue=v.slerp(c,$),$===1){this.mode_.rawValue="free";return}requestAnimationFrame(M)};requestAnimationFrame(M)}}const yt=f("rotationswatch"),gi=new ae(1,0,0),vs=new ae(0,1,0),Ft=new ae(0,0,1),Ri=new he(0,0,0,1);class ms{constructor(c,v){this.onValueChange_=this.onValueChange_.bind(this),v.value.emitter.on("change",this.onValueChange_),this.value=v.value,this.element=c.createElement("div"),this.element.classList.add(yt()),v.viewProps.bindClassModifiers(this.element);const C=c.createElement("button");C.classList.add(yt("b")),v.viewProps.bindDisabled(C),this.element.appendChild(C),this.buttonElement=C;const M=c.createElementNS(oe,"svg");M.classList.add(yt("g")),C.appendChild(M),this.svgElem_=M,this.projector_=new An,this.projector_.viewport=[0,0,20,20];const D=un(0,Math.PI,33,"x","y"),$=un(0,2*Math.PI,65,"x","y");this.rArc_=new Pe(c,$,this.projector_),this.rArc_.element.classList.add(yt("arcr")),M.appendChild(this.rArc_.element),this.rArc_.setRotation(Ri),this.xArc_=new Pe(c,D,this.projector_),this.xArc_.element.classList.add(yt("arc")),M.appendChild(this.xArc_.element),this.yArc_=new Pe(c,D,this.projector_),this.yArc_.element.classList.add(yt("arc")),M.appendChild(this.yArc_.element),this.zArc_=new Pe(c,D,this.projector_),this.zArc_.element.classList.add(yt("arc")),M.appendChild(this.zArc_.element),this.update_()}update_(){const c=this.value.rawValue.quat.normalized,v=gi.applyQuaternion(c),C=vs.applyQuaternion(c),M=Ft.applyQuaternion(c);this.xArc_.setRotation(qe(v,Ft)),this.yArc_.setRotation(qe(C,Ft)),this.zArc_.setRotation(qe(M,Ft))}onValueChange_(){this.update_()}}class Vi{constructor(c,v){this.value=v.value,this.viewProps=v.viewProps,this.view=new ms(c,{value:this.value,viewProps:this.viewProps})}}const St=f("rotation");class gs{constructor(c,v){this.element=c.createElement("div"),this.element.classList.add(St()),v.foldable.bindExpandedClass(this.element,St(void 0,"expanded")),I(v.foldable,"completed",O(this.element,St(void 0,"cpl"))),v.rotationMode==="quaternion"&&this.element.classList.add(St("quat"));const C=c.createElement("div");C.classList.add(St("h")),this.element.appendChild(C);const M=c.createElement("div");M.classList.add(St("s")),C.appendChild(M),this.swatchElement=M;const D=c.createElement("div");if(D.classList.add(St("t")),C.appendChild(D),this.textElement=D,v.pickerLayout==="inline"){const $=c.createElement("div");$.classList.add(St("g")),this.element.appendChild($),this.pickerElement=$}else this.pickerElement=null}}class mn{constructor(c,v){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=v.value,this.viewProps=v.viewProps,this.foldable_=we.create(v.expanded),this.swatchC_=new Vi(c,{value:this.value,viewProps:this.viewProps});const C=this.swatchC_.view.buttonElement;C.addEventListener("blur",this.onButtonBlur_),C.addEventListener("click",this.onButtonClick_),this.textC_=new ls(c,{assembly:v.assembly,axes:v.axes,parser:v.parser,value:this.value,viewProps:this.viewProps}),this.view=new gs(c,{rotationMode:v.rotationMode,foldable:this.foldable_,pickerLayout:v.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=v.pickerLayout==="popup"?new Ee(c,{viewProps:this.viewProps}):null;const M=new mi(c,{value:this.value,viewProps:this.viewProps,pickerLayout:v.pickerLayout});M.view.allFocusableElements.forEach(D=>{D.addEventListener("blur",this.onPopupChildBlur_),D.addEventListener("keydown",this.onPopupChildKeydown_)}),this.gizmoC_=M,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(M.view.element),On({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:D=>D.rawValue,backward:(D,$)=>$.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),Xt(this.foldable_,this.view.pickerElement))}onButtonBlur_(c){if(!this.popC_)return;const v=this.view.element,C=c.relatedTarget;(!C||!v.contains(C))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(c){if(!this.popC_)return;const v=this.popC_.view.element,C=Ae(c);C&&v.contains(C)||C&&C===this.swatchC_.view.buttonElement&&!ue(v.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(c){this.popC_?c.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&c.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function bi(w,c){const v=Math.pow(.1,w);return{baseStep:v,constraint:c,textProps:K.fromObject({draggingScale:v,formatter:si(w)})}}function Ht(w){if(!w)return;const c=[];return i(w.step)||c.push(new We(w.step)),(!i(w.max)||!i(w.min))&&c.push(new yn({max:w.max,min:w.min})),new Zt(c)}function Ln(w,c){return{toComponents:v=>v.getComponents(),fromComponents:v=>new Mt(v[0],v[1],v[2],w,c)}}function Di(w,c,v){var C,M,D;return typeof((C=w)===null||C===void 0?void 0:C.x)=="number"&&typeof((M=w)===null||M===void 0?void 0:M.y)=="number"&&typeof((D=w)===null||D===void 0?void 0:D.z)=="number"?new Mt(w.x,w.y,w.z,c,v):new Mt(0,0,0,c,v)}function bs(w){switch(w){case"XYZ":case"XZY":case"YXZ":case"YZX":case"ZXY":case"ZYX":return w;default:return}}function fs(w){switch(w){case"rad":case"deg":case"turn":return w;default:return}}const zt={id:"rotation",type:"input",css:".tp-rotationswatchv_b,.tp-rotationgizmov_p{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationswatchv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-rotationswatchv_b:hover{background-color:var(--btn-bg-h)}.tp-rotationswatchv_b:focus{background-color:var(--btn-bg-f)}.tp-rotationswatchv_b:active{background-color:var(--btn-bg-a)}.tp-rotationswatchv_b:disabled{opacity:0.5}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:0.5}.tp-rotationv{position:relative}.tp-rotationv_quat .tp-txtv_i{padding-left:0}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc( 2.0 * var(--bld-us))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--bld-s);opacity:1}.tp-rotationv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-rotationswatchv path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationswatchv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-rotationswatchv_arc{fill:none;stroke:var(--btn-bg);stroke-width:1px}.tp-rotationswatchv_arcr{fill:var(--btn-fg);stroke:var(--btn-bg);stroke-width:1px}.tp-rotationgizmov{padding-left:calc(var(--bld-us) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:transparent;stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:0.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:0.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:0.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:0.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",accept(w,c){var v,C;const M=J,D=X(c,{view:M.required.constant("rotation"),label:M.optional.string,picker:M.optional.custom(li),expanded:M.optional.boolean,rotationMode:M.required.constant("euler"),x:M.optional.custom(wt),y:M.optional.custom(wt),z:M.optional.custom(wt),order:M.optional.custom(bs),unit:M.optional.custom(fs)});return D?{initialValue:Di(w,(v=D.order)!==null&&v!==void 0?v:"XYZ",(C=D.unit)!==null&&C!==void 0?C:"rad"),params:D}:null},binding:{reader({params:w}){return c=>{var v,C;return Di(c,(v=w.order)!==null&&v!==void 0?v:"XYZ",(C=w.unit)!==null&&C!==void 0?C:"rad")}},constraint({params:w}){var c,v;return new pn({assembly:Ln((c=w.order)!==null&&c!==void 0?c:"XYZ",(v=w.unit)!==null&&v!==void 0?v:"rad"),components:[Ht("x"in w?w.x:void 0),Ht("y"in w?w.y:void 0),Ht("z"in w?w.z:void 0)]})},writer(w){return(c,v)=>{c.writeProperty("x",v.x),c.writeProperty("y",v.y),c.writeProperty("z",v.z)}}},controller({document:w,value:c,constraint:v,params:C,viewProps:M}){var D,$;if(!(v instanceof pn))throw h.shouldNeverHappen();const W="expanded"in C?C.expanded:void 0,Z="picker"in C?C.picker:void 0,Q=(D=C.unit)!==null&&D!==void 0?D:"rad",pe={rad:2,deg:0,turn:2}[Q];return new mn(w,{axes:[bi(pe,v.components[0]),bi(pe,v.components[1]),bi(pe,v.components[2])],assembly:Ln(($=C.order)!==null&&$!==void 0?$:"XYZ",Q),rotationMode:"euler",expanded:W??!1,parser:st,pickerLayout:Z??"popup",value:c,viewProps:M})}},Oi={toComponents:w=>[w.x,w.y,w.z,w.w],fromComponents:w=>new he(w[0],w[1],w[2],w[3])};function gn(w){return{baseStep:.01,constraint:w,textProps:K.fromObject({draggingScale:.01,formatter:c=>Math.abs(c)<.995?c.toFixed(2).replace("0.","."):c.toFixed(1)})}}function on(w){var c,v,C,M;return typeof((c=w)===null||c===void 0?void 0:c.x)=="number"&&typeof((v=w)===null||v===void 0?void 0:v.y)=="number"&&typeof((C=w)===null||C===void 0?void 0:C.z)=="number"&&typeof((M=w)===null||M===void 0?void 0:M.w)=="number"?new he(w.x,w.y,w.z,w.w):new he(0,0,0,1)}const Ni={id:"rotation",type:"input",css:".tp-rotationswatchv_b,.tp-rotationgizmov_p{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationswatchv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-rotationswatchv_b:hover{background-color:var(--btn-bg-h)}.tp-rotationswatchv_b:focus{background-color:var(--btn-bg-f)}.tp-rotationswatchv_b:active{background-color:var(--btn-bg-a)}.tp-rotationswatchv_b:disabled{opacity:0.5}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:0.5}.tp-rotationv{position:relative}.tp-rotationv_quat .tp-txtv_i{padding-left:0}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc( 2.0 * var(--bld-us))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--bld-s);opacity:1}.tp-rotationv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-rotationswatchv path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationswatchv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-rotationswatchv_arc{fill:none;stroke:var(--btn-bg);stroke-width:1px}.tp-rotationswatchv_arcr{fill:var(--btn-fg);stroke:var(--btn-bg);stroke-width:1px}.tp-rotationgizmov{padding-left:calc(var(--bld-us) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:transparent;stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:0.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:0.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:0.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:0.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",accept(w,c){const v=J,C=X(c,{view:v.required.constant("rotation"),label:v.optional.string,picker:v.optional.custom(li),expanded:v.optional.boolean,rotationMode:v.optional.constant("quaternion"),x:v.optional.custom(wt),y:v.optional.custom(wt),z:v.optional.custom(wt),w:v.optional.custom(wt)});return C?{initialValue:on(w),params:C}:null},binding:{reader(w){return c=>on(c)},constraint({params:w}){return new pn({assembly:Oi,components:[Ht("x"in w?w.x:void 0),Ht("y"in w?w.y:void 0),Ht("z"in w?w.z:void 0),Ht("w"in w?w.w:void 0)]})},writer(w){return(c,v)=>{c.writeProperty("x",v.x),c.writeProperty("y",v.y),c.writeProperty("z",v.z),c.writeProperty("w",v.w)}}},controller({document:w,value:c,constraint:v,params:C,viewProps:M}){if(!(v instanceof pn))throw h.shouldNeverHappen();const D="expanded"in C?C.expanded:void 0,$="picker"in C?C.picker:void 0;return new mn(w,{axes:[gn(v.components[0]),gn(v.components[1]),gn(v.components[2]),gn(v.components[3])],assembly:Oi,rotationMode:"quaternion",expanded:D??!1,parser:st,pickerLayout:$??"popup",value:c,viewProps:M})}},bn=[zt,Ni];t.RotationInputPluginEuler=zt,t.RotationInputPluginQuaternion=Ni,t.plugins=bn,Object.defineProperty(t,"__esModule",{value:!0})})})(cr,cr.exports);var Il=cr.exports;const wu=ho(Il),xu=co({__proto__:null,default:wu},[Il]);var dr={exports:{}};(function(m,a){(function(t,i){i(a)})(Hs,function(t){const i="tp";function l(F){return(R,K)=>[i,"-",F,"v",R?`_${R}`:"",K?`-${K}`:""].join("")}function h(F,R){return Object.keys(R).reduce((U,le)=>{if(U===void 0)return;const N=R[le],z=N(F[le]);return z.succeeded?Object.assign(Object.assign({},U),{[le]:z.value}):void 0},{})}function p(F,R){return F.reduce((K,U)=>{if(K===void 0)return;const le=R(U);if(!(!le.succeeded||le.value===void 0))return[...K,le.value]},[])}function g(F){return F===null?!1:typeof F=="object"}function f(F){return R=>K=>{if(!R&&K===void 0)return{succeeded:!1,value:void 0};if(R&&K===void 0)return{succeeded:!0,value:void 0};const U=F(K);return U!==void 0?{succeeded:!0,value:U}:{succeeded:!1,value:void 0}}}function x(F){return{custom:R=>f(R)(F),boolean:f(R=>typeof R=="boolean"?R:void 0)(F),number:f(R=>typeof R=="number"?R:void 0)(F),string:f(R=>typeof R=="string"?R:void 0)(F),function:f(R=>typeof R=="function"?R:void 0)(F),constant:R=>f(K=>K===R?R:void 0)(F),raw:f(R=>R)(F),object:R=>f(K=>{if(g(K))return h(K,R)})(F),array:R=>f(K=>{if(Array.isArray(K))return p(K,R)})(F)}}const E={optional:x(!0),required:x(!1)};function A(F,R){const K=E.required.object(R)(F);return K.succeeded?K.value:void 0}const I=l("txtr");class V{constructor(R,K){this.onChange_=this.onChange_.bind(this),this.element=R.createElement("div"),this.element.classList.add(I()),K.viewProps.bindClassModifiers(this.element);const U=R.createElement("textarea");U.rows=K.lineCount,U.cols=22,U.placeholder=K.placeholder,U.classList.add(I("i")),K.viewProps.bindDisabled(U),this.element.appendChild(U),this.inputElement=U,K.value.emitter.on("change",this.onChange_),this.value_=K.value,this.refresh()}refresh(){this.inputElement.value=this.value_.rawValue}onChange_(){this.refresh()}}class O{constructor(R,K){this.onInputChange_=this.onInputChange_.bind(this),this.value=K.value,this.viewProps=K.viewProps,this.lineCount=K.lineCount,this.placeholder=K.placeholder,this.view=new V(R,{value:this.value,viewProps:this.viewProps,lineCount:this.lineCount,placeholder:this.placeholder}),this.view.inputElement.addEventListener("keyup",this.onInputChange_)}onInputChange_(R){const K=R.currentTarget.value;this.value.rawValue=K,this.view.refresh()}}const G=[{id:"input-template",type:"input",css:".tp-txtrv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-txtrv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtrv:hover{background-color:var(--in-bg-h)}.tp-txtrv:focus{background-color:var(--in-bg-f)}.tp-txtrv:active{background-color:var(--in-bg-a)}.tp-txtrv:disabled{opacity:.5}.tp-txtrv{display:block;height:auto;padding-bottom:0;overflow:hidden;position:relative}.tp-txtrv.tp-v-disabled{opacity:.5}.tp-txtrv .tp-txtrv_i{font-family:var(--font-family);background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-size:11px;padding:4px;line-height:16px;min-width:0;width:100%;border:none;height:100%;resize:none;margin-bottom:-8px}.tp-txtrv .tp-txtrv_i:focus{outline:none}",accept(F,R){if(typeof F!="string")return null;const K=E,U=A(R,{view:K.required.constant("textarea"),lineCount:K.optional.number,placeholder:K.optional.string});return U?{initialValue:F,params:U}:null},binding:{reader(F){return R=>typeof R=="string"?R:""},writer(F){return(R,K)=>{R.write(K)}}},controller(F){var R,K;return new O(F.document,{value:F.value,lineCount:(R=F.params.lineCount)!==null&&R!==void 0?R:3,placeholder:(K=F.params.placeholder)!==null&&K!==void 0?K:"Enter text here",viewProps:F.viewProps})}}];t.plugins=G,Object.defineProperty(t,"__esModule",{value:!0})})})(dr,dr.exports);var Sl=dr.exports;const yu=ho(Sl),Cu=co({__proto__:null,default:yu},[Sl]),zl=m=>{const a=new ss.Pane({container:m});return a.registerPlugin(Tl),a.registerPlugin(_u),a.registerPlugin(xu),a.registerPlugin(Cu),a};class Eu{constructor(){S(this,"listeners",{})}addEventListener(a,t){const{listeners:i}=this;i[a]??(i[a]=[]);const l=i[a];l.includes(t)||l.push(t)}hasEventListener(a,t){var i;return(i=this.listeners[a])==null?void 0:i.includes(t)}removeEventListener(a,t){const{listeners:i}=this,l=i[a];if(l===void 0)return;const h=l.indexOf(t);h!==-1&&l.splice(h,1)}dispatchEvent(a){const{listeners:t}=this,i=t[a.type];if(i===void 0)return;a.target=this;const l=[...i];for(let h=0,p=l.length;h<p;h+=1)l[h].call(this,a);a.target=void 0}}const Rl=new Eu,Pu='<svg viewBox="0 0 24 24"><path d="M4.9 4.9 17.2 10l-4.9 1.7a.9.9 0 0 0-.6.6L10 17.2zm8.2 9.6 5.3 5.3a.9.9 0 1 0 1.4-1.4l-5.3-5.3 5.9-2a1 1 0 0 0 0-1.9l-17-7a1 1 0 0 0-1.3 1.3l7 17a1 1 0 0 0 1.9-.1z"/></svg>',ku=(m,a)=>{let t="";const i=g=>{var E,A;if(t===g)return;ln("three-inspect.selectedPane",g),(E=m.querySelector(`[data-pane="${t}"]`))==null||E.classList.add("hidden");const f=a.querySelector(`[data-nav="${t}"]`);f==null||f.classList.remove("bg-zinc-400","text-zinc-800"),f==null||f.classList.add("text-zinc-400"),(A=m.querySelector(`[data-pane="${g}"]`))==null||A.classList.remove("hidden");const x=a.querySelector(`[data-nav="${g}"]`);x==null||x.classList.add("bg-zinc-400","text-zinc-800"),x==null||x.classList.remove("text-zinc-400"),t=g},l=g=>{const f=document.createElement("button");f.className="py-1.5 px-2 text-zinc-400",f.dataset.nav=g,f.textContent=g,f.addEventListener("click",()=>i(g),{passive:!0}),a.append(f)},h=g=>{const f=document.createElement("section");return f.className="h-screen flex flex-col overflow-x-hidden overflow-y-auto hidden",f.dataset.pane=g,m.insertBefore(f,m.children[m.children.length-2]),l(g),zl(f)},p=document.createElement("button");return p.title="Select an element to inspect it",p.innerHTML=Pu,p.className="w-6 fill-zinc-400 p-1 hover:fill-zinc-300 hover:bg-[rgba(255,255,255,0.05)]",p.addEventListener("click",()=>{const g=p.classList.toggle("enabled");p.classList.toggle("bg-zinc-600",g),p.classList.toggle("hover:bg-zinc-600",g),p.classList.toggle("fill-zinc-100",g),p.classList.toggle("hover:fill-zinc-100",g),Rl.dispatchEvent({enabled:g,type:"enable-select"})},{passive:!0}),a.append(p),l("World"),i(wn("three-inspect.selectedPane")??"World"),{addPane:h}},Au=3,Mu=m=>{switch(m){case"left":return"left: 0;";case"right":return"left: calc(100% - 3px);";case"top":return"top: 0;";case"bottom":return"bottom: 0;";default:return""}},Tu=m=>{const{element:a,side:t,min:i=100,max:l=300}=m;let h=0,p=0,g=0,f=0;const x=t==="right"||t==="left",E=document.createElement("div"),A=document.createElement("div");A.style.cssText=`
    position: absolute;
    z-index: 1000;
    opacity: 0.5;
    background-color: var(--color-resize-handle, #888);
    cursor: ${x?"ew":"ns"}-resize;
    ${x?"width":"height"}: 3px;
    ${x?"height":"width"}: 100%;
    ${x?"top: 0; bottom: 0;":"left: 0; right: 0;"}
    ${Mu(t)}
  `;const I=G=>{if(G.preventDefault(),G.stopPropagation(),x){let F=h-G.clientX;t==="right"&&(F=-F);const R=Au+Math.max(i,Math.min(l,g+F));E.style.width=`${R}px`}else{let F=p-G.clientY;t==="bottom"&&(F=-F);const R=Math.max(i,Math.min(l,f+F));E.style.height=`${R}px`}},V=G=>{G.preventDefault(),G.stopPropagation(),window.removeEventListener("mousemove",I),window.removeEventListener("mouseup",V),A.style.opacity="0.5"},O=G=>{G.preventDefault(),G.stopPropagation(),h=G.clientX,p=G.clientY,g=E.clientWidth,f=E.clientHeight,window.addEventListener("mousemove",I),window.addEventListener("mouseup",V),A.style.opacity="1"};return A.addEventListener("mousedown",O),E.style.position="relative",E.style.overflow="hidden",E.append(a),E.append(A),m.height&&(E.style.height=`${m.height}px`),m.width&&(E.style.width=`${m.width}px`),E},Lu=()=>{const m=rt.renderer.domElement;m.setAttribute("style",`
    width: 100% !important;
    height: 100% !important;
  `);const a=Tu({element:m,max:Number.POSITIVE_INFINITY,side:"right",width:window.innerWidth-335});return a.style.cssText+="--color-resize-handle: #222;",a.classList.add("h-screen"),a},Iu=m=>{const{composer:a}=rt;if(a===void 0)return()=>0;const t=m.addFolder({title:"Postprocessing"}),{passes:i}=a;let l;for(let p=0,g=i.length;p<g;p+=1){const f=i[p];if("effects"in f){l=f;break}}if(l===void 0)return()=>t.dispose();const{effects:h}=l;for(let p=0,g=h.length;p<g;p+=1){const f=h[p];if(f.name==="SMAAEffect")t.addFolder({title:"smaa"});else if(f.name==="BloomEffect"){const x=f,E=t.addFolder({title:"bloom"});E.addInput(x,"height"),E.addInput(x,"width"),E.addInput(x,"intensity")}else if(f.name==="NoiseEffect")t.addFolder({title:"noise"}).addInput(f.blendMode.opacity,"value",{label:"opacity"});else if(f.name==="VignetteEffect"){const x=f,E=t.addFolder({title:"vignette"});E.addInput(x,"darkness"),E.addInput(x,"technique",{options:{default:0,eskil:1}}),E.addInput(x,"offset")}else if(f.name==="SSREffect"){const x=f,E=t.addFolder({title:"ssr"});E.addInput(x,"intensity",{max:3,min:0,step:.01}),E.addInput(x,"exponent",{max:8,min:.125,step:.125}),E.addInput(x,"distance",{max:10,min:.001,step:.1}),E.addInput(x,"fade",{max:20,min:0,step:.01}),E.addInput(x,"roughnessFade",{max:1,min:0,step:.01}),E.addInput(x,"thickness",{max:10,min:0,step:.01}),E.addInput(x,"ior",{max:2.3333,min:1,step:.01}),E.addInput(x,"maxRoughness",{max:1,min:0,step:.01}),E.addInput(x,"maxDepthDifference",{max:100,min:0,step:.1});const A=E.addFolder({index:0,title:"Temporal Resolve"});A.addInput(x,"blend",{max:1,min:0,step:.001}),A.addInput(x,"correction",{max:1,min:0,step:1e-4}),A.addInput(x,"correctionRadius",{max:4,min:1,step:1});const I=E.addFolder({index:0,title:"Blur"});I.addInput(x,"blur",{max:1,min:0,step:.01}),I.addInput(x,"blurKernel",{max:5,min:0,step:1}),I.addInput(x,"blurSharpness",{max:100,min:0,step:1});const V=E.addFolder({index:0,title:"Jitter"});V.addInput(x,"jitter",{max:4,min:0,step:.01}),V.addInput(x,"jitterRoughness",{max:4,min:0,step:.01});const O=E.addFolder({index:0,title:"Tracing"});O.addInput(x,"steps",{max:256,min:1,step:1}),O.addInput(x,"refineSteps",{max:16,min:0,step:1}),O.addInput(x,"missedRays");const G=E.addFolder({index:0,title:"Resolution"});G.addInput(x,"resolutionScale",{max:1,min:.125,step:.125}),G.addInput(x,"velocityResolutionScale",{max:1,min:.125,step:.125})}else console.warn(`three-inspect does not yet support postprocessing effect: ${f.name}`)}return()=>t.dispose()},Ns={controlling:!1},Vl={expanded:!1,picker:"inline",rotationMode:"euler",view:"rotation"},Su=(m,a)=>{const t=new is;m.addSeparator();const i={index:0,position:new ge,rotation:new fr,scale:new ge},l=m.addInput(i,"index",{label:"instance index",max:a.count-1,min:0,step:1}),h=m.addInput(i,"position",{index:0}),p=m.addInput(i,"rotation",Vl),g=m.addInput(i,"scale",{index:0}),f=()=>{a.getMatrixAt(i.index,t),i.position.setFromMatrixPosition(t),i.rotation.setFromRotationMatrix(t),i.scale.setFromMatrixScale(t),h.refresh(),p.refresh(),g.refresh()},x=()=>{t.makeRotationFromEuler(i.rotation),t.setPosition(i.position),t.scale(i.scale),a.setMatrixAt(i.index,t),a.instanceMatrix.needsUpdate=!0};l.on("change",f),h.on("change",x),p.on("change",x),g.on("change",x);const E=()=>{Ns.controlling||f()};return xr(E),()=>yr(E)},Ka=()=>{Ns.controlling=!0},Ua=()=>{Ns.controlling=!1},ni=(m,a)=>{const{element:t}=m,i={rotation:new fr},l=()=>{Ns.controlling&&a.rotation.copy(i.rotation)};m.addSeparator();const h=m.addInput(a,"position",{step:.1}),p=m.addInput(i,"rotation",Vl).on("change",l),g=m.addInput(a,"scale",{step:.1}),f=()=>{Ns.controlling||(a.rotation.equals(i.rotation)||(i.rotation.copy(a.rotation),p.refresh()),h.refresh(),g.refresh())};xr(f);let x;return"isInstancedMesh"in a&&(x=Su(m,a)),t.addEventListener("mousedown",Ka,{passive:!0}),t.addEventListener("mouseup",Ua,{passive:!0}),()=>{t.removeEventListener("mousedown",Ka),t.removeEventListener("mouseup",Ua),h.dispose(),p.dispose(),g.dispose(),yr(f),x==null||x()}},Cr=(m,a)=>{m.addSeparator();const t={userData:JSON.stringify(a.userData,void 0,2)},i=t.userData.split(/\r\n|\r|\n/u).length,l=m.addMonitor(t,"userData",{interval:5e3,lineCount:i,multiline:!0});return()=>l.dispose()},Ga=[ro.NONE,ro.ORBIT],$a={controls:wn("three-inspect.controls")??ro.NONE},zu=(m,a)=>{const t=["none","orbit","map"];m.addInput($a,"controls",{cells:(g,f)=>({title:t[Ga[f*3+g]],value:Ga[f*3+g]}),groupName:"controls",label:"inspect controls",size:[2,1],view:"radiogrid"}).on("change",()=>Pl($a.controls,a));const i=()=>{a.updateProjectionMatrix()};m.addInput(a,"near").on("change",i),m.addInput(a,"far").on("change",i);const l=m.addInput(a,"zoom").on("change",i),h=()=>l.refresh();window.addEventListener("wheel",h,{passive:!0}),a instanceof br&&(m.addInput(a,"bottom").on("change",i),m.addInput(a,"left").on("change",i),m.addInput(a,"right").on("change",i),m.addInput(a,"top").on("change",i)),a instanceof il&&(m.addInput(a,"fov").on("change",i),m.addInput(a,"filmOffset").on("change",i),m.addInput(a,"filmGauge").on("change",i));const p=[];return p.push(ni(m,a),Cr(m,a)),rt.composer!==null&&p.push(Iu(m)),p.push(()=>window.removeEventListener("wheel",h)),p},js=new WeakMap,Er=new WeakMap,Ru=m=>{var a;return"isInstancedMesh"in m?"InstancedMesh":(a=m.geometry)!=null&&a.isMeshLine?"MeshLine":m.type},Xo=m=>Er.get(m),Vu=m=>js.get(m),lo=m=>{if(m.userData.THREE_INSPECT_OMIT===!0)return;m.traverse(t=>m!==t&&lo(t));const a=js.get(m);js.delete(m),a!==void 0&&(Er.delete(a),a.destroy())},Zo=new Map,Pr=(m,a,t)=>{if(a.userData.THREE_INSPECT_OMIT===!0)return;const i=a.name,l="isScene"in t?m:js.get(t),h=`${i?`${i} `:""}(${Ru(a)})`,p=new tt({text:h});p.open=!0,js.set(a,p),Er.set(p,a),l?l.append(p):a.parent&&Zo.set(a.parent.uuid,p);const g=Zo.get(a.uuid);g&&(p.append(g),Zo.delete(a.uuid));{const{children:f}=a;for(let x=0,E=f.length;x<E;x+=1)Pr(m,f[x],a)}},Du=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],Ou=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],Nu=(m,a)=>{const t=new nr;t.setAttribute("position",new pa(Du,3)),t.computeBoundingSphere();const i=new mr({fog:!1}),l=new tl;l.type="RectAreaLightHelper";const h=new nr;h.setAttribute("position",new pa(Ou,3)),h.computeBoundingSphere(),l.add(new Fs(h,new xn({fog:!1,side:fl}))),l.updateMatrixWorld=()=>{if(l.scale.set(.5*m.width,.5*m.height,1),a===void 0){i.color.copy(m.color).multiplyScalar(m.intensity);const{color:g}=i,f=Math.max(g.r,g.g,g.b);f>1&&g.multiplyScalar(1/f),l.children[0].material.color.copy(g)}else i.color.set(a),l.children[0].material.color.set(a);l.matrixWorld.extractRotation(m.matrixWorld).scale(l.scale).copyPosition(m.matrixWorld),l.children[0].matrixWorld.copy(l.matrixWorld)};const p=l;return p.dispose=()=>{l.geometry.dispose(),l.material.dispose();const g=l.children[0];g.geometry.dispose(),g.material.dispose()},l},Oe={max:1,min:0},qa=(m,a)=>{m.addSeparator(),m.addInput(a.target,"position",{label:"target position",step:.1}).on("change",()=>{a.target.updateMatrixWorld()})},ju=(m,a)=>{let t,i;const l=[],h={color:`#${a.color.getHexString().toUpperCase()}`,helper:!1,shadowHelper:!1};if(a instanceof bl||m.addInput(h,"helper").on("change",()=>t&&a[h.helper?"add":"remove"](t)),m.addInput(h,"color").on("change",()=>a.color.set(h.color)),m.addInput(a,"intensity"),a instanceof io?(m.addInput(a,"castShadow"),ni(m,a),qa(m,a),t=new lh(a)):a instanceof ch?(m.addInput(a,"groundColor"),t=new dh(a,10)):a instanceof Ja?(m.addInput(a,"decay"),m.addInput(a,"distance"),m.addInput(a,"power"),m.addInput(a,"castShadow"),ni(m,a),t=new hh(a,10)):a instanceof er?(m.addInput(a,"angle",{max:Math.PI/2,min:0}),m.addInput(a,"decay"),m.addInput(a,"distance"),m.addInput(a,"penumbra",Oe),m.addInput(a,"power"),m.addInput(a,"castShadow"),ni(m,a),qa(m,a),t=new ph(a)):a instanceof uh&&(m.addInput(a,"power"),m.addInput(a,"width"),m.addInput(a,"height"),ni(m,a),t=Nu(a)),t!==void 0&&(t.userData.THREE_INSPECT_OMIT=!0),a.castShadow&&a.shadow){const p=m.addFolder({index:a.id,title:"Shadow Camera"});p.addInput(a.shadow,"autoUpdate"),p.addInput(h,"shadowHelper",{label:"helper"}).on("change",()=>i&&a[h.shadowHelper?"add":"remove"](i));const g={mapSize:a.shadow.mapSize.x},f=()=>{a.shadow&&(a.shadow.mapSize.width=g.mapSize,a.shadow.mapSize.height=g.mapSize,a.shadow.dispose(),a.shadow.map=null)},x=[256,512,1024,2048];if(p.addInput(g,"mapSize",{cells:E=>({title:x[E],value:x[E]}),groupName:"mapSize",size:[4,1],view:"radiogrid"}).on("change",f),p.addInput(a.shadow,"bias",{max:.09,min:0,step:.001}),p.addInput(a.shadow,"normalBias").on("change",f),p.addInput(a.shadow,"radius").on("change",f),a instanceof io){const{camera:E}=a.shadow;p.addInput(E,"near").on("change",f),p.addInput(E,"far").on("change",f),p.addInput(E,"left").on("change",f),p.addInput(E,"right").on("change",f),p.addInput(E,"top").on("change",f),p.addInput(E,"bottom").on("change",f),ni(p,E)}else if(a instanceof er){const{camera:E}=a.shadow;p.addInput(E,"near").on("change",f),p.addInput(E,"far").on("change",f),p.addInput(E,"focus",Oe),ni(p,E)}i=new vh(a.shadow.camera),i.userData.THREE_INSPECT_OMIT=!0}return m.on("change",()=>{var p;(p=t==null?void 0:t.update)==null||p.call(t),i==null||i.update()}),l.push(Cr(m,a),()=>{var p;t!==void 0&&(a.remove(t),(p=t.dispose)==null||p.call(t)),i!==void 0&&(a.remove(i),i.dispose())}),l},Fu=(m,a)=>{const t=new mh;t.name="Forward helper",t.setLength(1),t.userData.THREE_INSPECT_OMIT=!0;const i={forwardHelper:!1},l=m.addInput(i,"forwardHelper").on("change",()=>{i.forwardHelper?a.add(t):a.remove(t)});return()=>{l.dispose(),a.remove(t),t.dispose()}},Hu=()=>{const m=document.createElement("canvas");m.width=1,m.height=1;const a=m.getContext("2d");a!==null&&(a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,1,1));const t=document.createElement("img");return t.src=m.toDataURL("image/png"),t},hr=Hu(),gt=(m,a,t)=>{const i=a[t],l={current:()=>{}},h={ClampToEdgeWrapping:hl,MirroredRepeatWrapping:pl,RepeatWrapping:so},p={LinearFilter:ur,NearestFilter:al},g={...p,LinearMipmapLinearFilter:vr,LinearMipmapNearestFilter:cl,NearestMipmapLinearFilter:dl,NearestMipmapNearestFilter:ll},f={0:0,16:16,2:2,4:4,8:8},x={AlphaFormat:Lh,DepthFormat:Ih,DepthStencilFormat:Sh,LuminanceAlphaFormat:zh,LuminanceFormat:Rh,RGBAFormat:Vh,RGBAIntegerFormat:Dh,RGFormat:Oh,RGIntegerFormat:Nh,RedFormat:jh,RedIntegerFormat:Fh},E={BasicDepthPacking:Hh,LinearEncoding:Bh,RGBADepthPacking:Kh,sRGBEncoding:Uh},A={map:(i==null?void 0:i.image)??hr},I=O=>{V.hidden=!1,V.title=`${O.name} (Texture)`.trim();const G=()=>O.needsUpdate=!0;V.addInput(O,"wrapS",{options:h}).on("change",G),V.addInput(O,"wrapT",{options:h}).on("change",G),V.addInput(O,"magFilter",{options:p}),V.addInput(O,"minFilter",{options:g}),V.addInput(O,"offset",{step:.01}),V.addInput(O,"rotation",{step:.01}),V.addInput(O,"anisotropy",{options:f}).on("change",G),V.addInput(O,"format",{options:x}).on("change",G),V.addInput(O,"repeat",{x:{step:1},y:{step:1}}),V.addInput(O,"center"),V.addInput(O,"flipY"),V.addInput(O,"encoding",{options:E}).on("change",()=>{G(),a instanceof ii&&(a.needsUpdate=!0)}),l.current=()=>{for(const F of V.children)F.dispose()}};m.addInput(A,"map",{label:t,view:"input-image"}).on("change",({value:O})=>{var F;if(O.src===hr.src||O.src===(i==null?void 0:i.image.src))return;(F=a[t])==null||F.dispose();const G=new tr(O);a[t]=G,G.needsUpdate=!0,a instanceof ii&&(a.needsUpdate=!0),l.current(),I(G)});const V=m.addFolder({hidden:!0,title:""});return i&&I(i),()=>l.current()},Ya=(m,a)=>{const t=a.material,i=m.addFolder({index:a.id,title:`${t.name} (${t.type})`.trim()}),l={ObjectSpaceNormalMap:Mh,TangentSpaceNormalMap:Th},h=()=>{t.needsUpdate=!0},p=f=>{const x=t,E={[f]:`#${x[f].getHexString()}`};i.addInput(E,f).on("change",()=>x[f].set(E.color))};i.addInput(t,"visible"),i.addInput(t,"transparent").on("change",h),i.addInput(t,"opacity",Oe);const g=[["Back",fl],["Double",gr],["Front",ul]];if(i.addInput(t,"side",{cells:f=>({title:g[f][0],value:g[f][1]}),groupName:"side",size:[3,1],view:"radiogrid"}),i.addInput(t,"vertexColors"),i.addSeparator(),t instanceof el)p("color"),i.addInput(t,"size"),i.addInput(t,"sizeAttenuation");else if(t instanceof mr||t instanceof gh)p("color"),i.addInput(t,"fog"),i.addInput(t,"linewidth");else if(t instanceof xn)p("color"),i.addInput(t,"fog"),i.addInput(t,"reflectivity",Oe),i.addInput(t,"refractionRatio",Oe),i.addInput(t,"wireframe");else if(t instanceof bh)i.addInput(t,"fog");else if(t instanceof Vo)p("color"),p("emissive"),i.addInput(t,"emissiveIntensity",{min:0}),i.addInput(t,"flatShading").on("change",h),i.addInput(t,"fog"),i.addInput(t,"reflectivity",Oe),i.addInput(t,"refractionRatio",Oe),i.addInput(t,"wireframe");else if(t instanceof Do)p("color"),p("emissive"),i.addInput(t,"emissiveIntensity",{min:0}),i.addInput(t,"flatShading").on("change",h),i.addInput(t,"fog"),i.addInput(t,"reflectivity",Oe),i.addInput(t,"refractionRatio",Oe),i.addInput(t,"shininess",Oe),i.addInput(t,"wireframe");else if(t instanceof ts)p("color"),p("emissive"),i.addInput(t,"emissiveIntensity",{min:0}),i.addInput(t,"roughness",Oe),i.addInput(t,"metalness",Oe),i.addInput(t,"flatShading").on("change",h),i.addInput(t,"fog"),i.addInput(t,"wireframe"),i.addInput(t,"envMapIntensity"),t instanceof Vt&&(i.addSeparator(),p("attenuationColor"),i.addInput(t,"clearcoat",Oe),i.addInput(t,"clearcoatRoughness",Oe),i.addInput(t,"transmission",Oe),i.addInput(t,"ior",{max:2.333,min:1}),i.addInput(t,"reflectivity",Oe),i.addInput(t,"sheen",Oe),i.addInput(t,"sheenRoughness",Oe),p("sheenColor"));else if(t instanceof ol){const f={uniforms:JSON.stringify(t.uniforms,null,2)};i.addInput(f,"uniforms",{view:"textarea"}).on("change",()=>{try{t.uniforms=JSON.parse(f.uniforms),h()}catch{}}),i.addInput(t,"vertexShader",{view:"textarea"}).on("change",h),i.addInput(t,"fragmentShader",{view:"textarea"}).on("change",h)}return(t instanceof xn||t instanceof Vo||t instanceof Do||t instanceof ts||t instanceof Vt)&&(i.addSeparator(),gt(i,t,"map"),gt(i,t,"alphaMap"),gt(i,t,"aoMap"),i.addInput(t,"aoMapIntensity",Oe),gt(i,t,"lightMap"),i.addInput(t,"lightMapIntensity",Oe),(t instanceof Vo||t instanceof Do||t instanceof ts||t instanceof Vt)&&(gt(i,t,"bumpMap"),i.addInput(t,"bumpScale",Oe),gt(i,t,"displacementMap"),i.addInput(t,"displacementScale"),i.addInput(t,"displacementBias"),gt(i,t,"emissiveMap"),gt(i,t,"normalMap"),i.addInput(t,"normalMapType",{options:l})),(t instanceof ts||t instanceof Vt)&&(gt(i,t,"metalnessMap"),gt(i,t,"roughnessMap"),t instanceof Vt&&(gt(i,t,"clearcoatMap"),gt(i,t,"clearcoatNormalMap"),i.addInput(t,"clearcoatNormalScale",{x:Oe,y:Oe}),gt(i,t,"clearcoatRoughnessMap"),gt(i,t,"sheenRoughnessMap")))),i.addSeparator(),i.addInput(t,"alphaTest",Oe),i.addInput(t,"blendDst"),i.addInput(t,"clipShadows"),i.addInput(t,"depthTest"),i.addInput(t,"depthWrite"),i.addInput(t,"polygonOffset"),i.addInput(t,"polygonOffsetFactor"),i.addInput(t,"dithering"),()=>i.dispose()},Bu=(m,a)=>{a instanceof nl&&m.addMonitor(a.geometry.attributes.position,"count"),m.addInput(a,"castShadow"),m.addInput(a,"receiveShadow"),m.addInput(a,"frustumCulled"),m.addInput(a,"matrixAutoUpdate"),m.addInput(a,"visible");const t=[];a.type.toLowerCase().includes("helper")||t.push(Fu(m,a)),t.push(ni(m,a));const i=a;if(Array.isArray(i.material))for(let l=0,h=i.material.length;l<h;l+=1)i.material[l]instanceof ii&&t.push(Ya(m,i));else i.material!==void 0&&i.material instanceof ii&&t.push(Ya(m,i));return t.push(Cr(m,a)),t},Ku=m=>{const{renderer:a}=rt,t=new Yt;a.getClearColor(t);const i={clearColor:`#${t.getHexString().toUpperCase()}`};m.addInput(i,"clearColor").on("change",()=>{a.setClearColor(i.clearColor)});const l=()=>{a.shadowMap.needsUpdate=!0};m.addSeparator(),m.addInput(a.shadowMap,"enabled",{label:"shadowmap"}).on("change",l),m.addInput(a.shadowMap,"autoUpdate").on("change",l),m.addInput(a.shadowMap,"type",{options:{Basic:fh,PCF:_h,"PCF Soft":wh,VSM:xh}}).on("change",()=>{a.shadowMap.needsUpdate=!0}),m.addSeparator(),m.addInput(a,"toneMapping",{options:{ACESFilmic:yh,Cineon:Ch,Custom:Eh,Linear:Ph,None:kh,Reinhard:Ah}}),m.addInput(a,"toneMappingExposure",{label:"exposure"}),m.addSeparator();const h={calls:"",geometries:"",lines:"",points:"",textures:"",triangles:""},p={maxAnisotropy:a.capabilities.getMaxAnisotropy().toString(),maxAttributes:a.capabilities.maxAttributes.toFixed(0),maxCubemapSize:`${a.capabilities.maxCubemapSize} (h * w)`,maxFragmentUniforms:a.capabilities.maxFragmentUniforms.toFixed(0),maxTextureSize:`${a.capabilities.maxTextureSize.toFixed(0)} (h * w)`,maxTextures:a.capabilities.maxTextures.toFixed(0),maxVaryings:a.capabilities.maxVaryings.toFixed(0),maxVertexTextures:a.capabilities.maxVertexTextures.toFixed(0),maxVertexUniforms:a.capabilities.maxVertexUniforms.toFixed(0)},g={interval:1e6},f=[];f.push(m.addMonitor(h,"calls",g),m.addMonitor(h,"geometries",g),m.addMonitor(h,"lines",g),m.addMonitor(h,"points",g),m.addMonitor(h,"textures",g),m.addMonitor(h,"triangles",g)),m.addSeparator(),m.addMonitor(p,"maxAnisotropy",g),m.addMonitor(p,"maxAttributes",g),m.addMonitor(p,"maxCubemapSize",g),m.addMonitor(p,"maxFragmentUniforms",g),m.addMonitor(p,"maxTextureSize",g),m.addMonitor(p,"maxTextures",g),m.addMonitor(p,"maxVaryings",g),m.addMonitor(p,"maxVertexTextures",g),m.addMonitor(p,"maxVertexUniforms",g),m.addMonitor(a.capabilities,"precision",g);const x=()=>{const{render:A,memory:I}=a.info;h.calls=A.calls.toFixed(0),h.geometries=I.geometries.toFixed(0),h.lines=A.lines.toFixed(0),h.points=A.points.toFixed(0),h.textures=I.textures.toFixed(0),h.triangles=A.triangles.toFixed(0);for(let V=0,O=f.length;V<O;V+=1)f[V].refresh()},E=setInterval(x,2e3);return x(),()=>clearInterval(E)},Ge={axes:!!wn("three-inspect.axes"),background:hr,fogColor:"#000000",grid:!!wn("three-inspect.grid"),gridCellSize:wn("three-inspect.gridCellSize")??1,gridColor:wn("three-inspect.gridColor")??"#ffffff",gridDistance:wn("three-inspect.gridDistance")??100,gridLargeCellSize:wn("three-inspect.largeCellSize")??10},Wo=new Yt,et={axes:new Qa(1e3),grid:new Hp(Ge.gridCellSize,Ge.gridLargeCellSize,Ge.gridColor,Ge.gridDistance)},Uu=()=>{const{scene:m}=rt;return et.axes=new Qa(1e3),et.axes.name="Axes helper",et.axes.userData.THREE_INSPECT_OMIT=!0,et.grid.name="Grid helper",et.grid.userData.THREE_INSPECT_OMIT=!0,Ge.grid&&m.add(et.grid),Ge.axes&&m.add(et.axes),()=>{m.remove(et.grid,et.axes)}},Gu=m=>{const{scene:a}=rt,t=[],i=h=>{a[Ge[h]?"add":"remove"](et[h]),Ge[h]?ln(`three-inspect.${h}`,!0):ln(`three-inspect.${h}`,!1)},l=h=>{Wo.set(Ge.gridColor),et.grid.cellSize=Ge.gridCellSize,et.grid.largeCellSize=Ge.gridLargeCellSize,et.grid.color instanceof Yt?et.grid.color.copy(Wo):et.grid.color=Wo,et.grid.distance=Ge.gridDistance,ln(h,Ge[h])};if(m.addInput(Ge,"axes",{label:"axes"}).on("change",()=>i("axes")),m.addInput(Ge,"grid",{label:"grid"}).on("change",()=>i("grid")),m.addInput(Ge,"gridCellSize",{label:"cell size"}).on("change",()=>l("gridCellSize")),m.addInput(Ge,"gridLargeCellSize",{label:"large cell size",step:1}).on("change",()=>l("gridLargeCellSize")),m.addInput(Ge,"gridColor",{label:"color",step:1}).on("change",()=>l("gridColor")),m.addInput(Ge,"gridDistance",{label:"distance",step:1}).on("change",()=>l("gridDistance")),a.fog!==null){Ge.fogColor=`#${a.fog.color.getHexString().toUpperCase()}`;const h=m.addFolder({title:"Fog"});h.addInput(Ge,"fogColor",{label:"color"}).on("change",()=>{var p;(p=a.fog)==null||p.color.set(Ge.fogColor)}),"near"in a.fog&&h.addInput(a.fog,"near"),"far"in a.fog&&h.addInput(a.fog,"far")}return m.addSeparator(),t.push(gt(m,a,"background")),m.addSeparator(),t.push(Ku(m),()=>{a.remove(et.grid),et.axes.dispose()}),t},$u=m=>{const{renderer:a}=rt,t=a.domElement,i=new ml,l=new Ne,h=p=>{const{scene:g,camera:f}=rt;l.x=p.clientX/t.clientWidth*2-1,l.y=-(p.clientY/t.clientHeight*2)+1,i.setFromCamera(l,f);const x=i.intersectObjects(g.children).filter(E=>E.object.userData.THREE_INSPECT_OMIT!==!0);m(x)};Rl.addEventListener("enable-select",p=>{p.enabled?t.addEventListener("pointerdown",h,{passive:!0}):t.removeEventListener("pointerdown",h)})},qu=m=>{const a=Ct.prototype.add,t=Ct.prototype.remove,i=Ct.prototype.clear;return Ct.prototype.add=function(...l){a.call(this,...l);for(let h=0,p=l.length;h<p;h+=1)Pr(m,l[h],this);return this},Ct.prototype.remove=function(...l){t.call(this,...l);for(let h=0,p=l.length;h<p;h+=1)lo(l[h]);return this},Ct.prototype.clear=function(){const{children:l}=this;i.call(this);for(let h=0,p=l.length;h<p;h+=1)lo(l[h]);return this},()=>{Ct.prototype.add=a,Ct.prototype.remove=t,Ct.prototype.clear=i}},Yu=(m,a)=>{a.name&&ln("three-inspect.selected",a.name);const t=zl(m);let i;return"isPerspectiveCamera"in a||"isOrthographicCamera"in a?i=zu(t,a):"isScene"in a?i=Gu(t):"isLight"in a?i=ju(t,a):i=Bu(t,a),()=>{i.forEach(l=>l()),t.dispose()}},Xu=(m,a,t)=>{const{scene:i}=rt,l=qu(a);let h;$u(f=>{if(f.length<1)return;let x;for(;x===void 0;){const E=f.shift();if(E===void 0)break;x=Vu(E.object)}x!==void 0&&(h!==void 0&&(h.selected=!1),x.selected=!0,x.dom.scrollIntoView())});let p=null;m.on("deselect",()=>{p==null||p(),p=null,h=void 0}),m.on("select",f=>{p==null||p(),p=null,h=f;const x=f.text==="Scene"?i:Xo(f);x!==void 0&&(p=Yu(t,x))}),m.on("reparent",f=>{for(let x=0,E=f.length;x<E;x+=1){const{item:A,newParent:I}=f[x],V=Xo(A),O=I.text==="Scene"?i:Xo(I);O!==void 0&&V!==void 0&&O.attach(V)}});{const{children:f}=i;for(let x=0,E=f.length;x<E;x+=1)Pr(a,f[x],i)}const g=()=>{const{children:f}=i;for(let x=0,E=f.length;x<E;x+=1)lo(f[x])};return()=>{l(),m.clearTreeItems(),g()}},Zu=m=>{const a=document.createElement("div");a.className="sticky bottom-0 h-[105px]",m.append(a);const t=new ss.Pane({container:a});t.registerPlugin(Tl),t.addSeparator();const i=1048576,{memory:l}=performance,h={memory:l?l.usedJSHeapSize/i:0,time:""},p=performance.now();let g=0;const f=()=>{g=(performance.now()-p)/1e3;const V=g%60|0,O=g/60|0,G=g/60/60|0;h.time=`${G<10?`0${G}`:G}:${O<10?`0${O}`:O}:${V<10?`0${V}`:V}`};f();const x=setInterval(f,1e3);t.addMonitor(h,"time",{interval:1e3});const E=t.addBlade({label:"fps",lineCount:2,view:"fpsgraph"});let A=-1;l&&(t.addMonitor(h,"memory",{max:l.jsHeapSizeLimit/i,min:0,view:"graph"}),A=setInterval(()=>{h.memory=l.usedJSHeapSize/i},3e3));const I=()=>{const V=E;V.end(),V.begin()};return xr(I),()=>{t.dispose(),clearInterval(x),clearInterval(A),yr(I)}},Wu=m=>{const a=[],t=document.createElement("div");if(t.className=m.location==="right"?"z-[100] absolute top-0 left-0 w-screen h-screen flex":"z-[100] absolute top-0 right-0 w-[350px] h-screen flex",rt.root=t,m.location==="right"){const x=Lu();t.append(x);let E=window.innerWidth;const A=()=>{const{innerWidth:I}=window,V=I-E;x.style.width=`${x.clientWidth+V}px`,E=I};window.addEventListener("resize",A,{passive:!0}),a.push(()=>window.removeEventListener("resize",A))}const{controls:i,nav:l,treeroot:h,treeview:p,pane:g}=gu(),{addPane:f}=ku(i,l);return a.push(Zu(i),Xu(p,h,g)),t.append(i),document.body.append(t),{addPane:f,disposers:a}},Dl=document.createElement("style");Dl.textContent=Wp;document.head.append(Dl);class Qu{constructor({scene:a,camera:t,renderer:i,composer:l,options:h={}}){S(this,"disposers",[]);S(this,"addPane");S(this,"dispose",()=>{Zp();for(let a=this.disposers.length-1;a>-1;a-=1)this.disposers[a]();this.disposers.slice(0,this.disposers.length)});if(!a){const x="three-inspect constructor arguments have changed. Consult docs for new args: https://www.npmjs.com/package/three-inspect";throw new Error(x)}rt.scene=a,rt.camera=t,rt.renderer=i,rt.composer=l??void 0;const{disposers:p,addPane:g}=Wu({location:"right",...h});this.addPane=g,this.disposers.push(...p,Uu());const f=wn("three-inspect.controls");f!==null&&Pl(f,t),Xp()}registerPlugin(a){this.disposers.push(a(this))}}const Xa={type:"change"},Qo={type:"start"},Za={type:"end"};class Ju extends vl{constructor(a,t){super(),this.object=a,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new ge,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$t.ROTATE,MIDDLE:$t.DOLLY,RIGHT:$t.PAN},this.touches={ONE:qt.ROTATE,TWO:qt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(y){y.addEventListener("keydown",Pt),this._domElementKeyEvents=y},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Pt),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Xa),i.update(),h=l.NONE},this.update=function(){const y=new ge,B=new Dn().setFromUnitVectors(a.up,new ge(0,1,0)),se=B.clone().invert(),re=new ge,xe=new Dn,it=new ge,Ve=2*Math.PI;return function(){const Fe=i.object.position;y.copy(Fe).sub(i.target),y.applyQuaternion(B),g.setFromVector3(y),i.autoRotate&&h===l.NONE&&X(H()),i.enableDamping?(g.theta+=f.theta*i.dampingFactor,g.phi+=f.phi*i.dampingFactor):(g.theta+=f.theta,g.phi+=f.phi);let Ie=i.minAzimuthAngle,st=i.maxAzimuthAngle;return isFinite(Ie)&&isFinite(st)&&(Ie<-Math.PI?Ie+=Ve:Ie>Math.PI&&(Ie-=Ve),st<-Math.PI?st+=Ve:st>Math.PI&&(st-=Ve),Ie<=st?g.theta=Math.max(Ie,Math.min(st,g.theta)):g.theta=g.theta>(Ie+st)/2?Math.max(Ie,g.theta):Math.min(st,g.theta)),g.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=x,g.radius=Math.max(i.minDistance,Math.min(i.maxDistance,g.radius)),i.enableDamping===!0?i.target.addScaledVector(E,i.dampingFactor):i.target.add(E),y.setFromSpherical(g),y.applyQuaternion(se),Fe.copy(i.target).add(y),i.object.lookAt(i.target),i.enableDamping===!0?(f.theta*=1-i.dampingFactor,f.phi*=1-i.dampingFactor,E.multiplyScalar(1-i.dampingFactor)):(f.set(0,0,0),E.set(0,0,0)),x=1,A||re.distanceToSquared(i.object.position)>p||8*(1-xe.dot(i.object.quaternion))>p||it.distanceToSquared(i.target)>0?(i.dispatchEvent(Xa),re.copy(i.object.position),xe.copy(i.object.quaternion),it.copy(i.target),A=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",vt),i.domElement.removeEventListener("pointerdown",ut),i.domElement.removeEventListener("pointercancel",Re),i.domElement.removeEventListener("wheel",Wt),i.domElement.removeEventListener("pointermove",Le),i.domElement.removeEventListener("pointerup",Re),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Pt),i._domElementKeyEvents=null)};const i=this,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=l.NONE;const p=1e-6,g=new oo,f=new oo;let x=1;const E=new ge;let A=!1;const I=new Ne,V=new Ne,O=new Ne,G=new Ne,F=new Ne,R=new Ne,K=new Ne,U=new Ne,le=new Ne,N=[],z={};function H(){return 2*Math.PI/60/60*i.autoRotateSpeed}function J(){return Math.pow(.95,i.zoomSpeed)}function X(y){f.theta-=y}function oe(y){f.phi-=y}const me=function(){const y=new ge;return function(se,re){y.setFromMatrixColumn(re,0),y.multiplyScalar(-se),E.add(y)}}(),ze=function(){const y=new ge;return function(se,re){i.screenSpacePanning===!0?y.setFromMatrixColumn(re,1):(y.setFromMatrixColumn(re,0),y.crossVectors(i.object.up,y)),y.multiplyScalar(se),E.add(y)}}(),ue=function(){const y=new ge;return function(se,re){const xe=i.domElement;if(i.object.isPerspectiveCamera){const it=i.object.position;y.copy(it).sub(i.target);let Ve=y.length();Ve*=Math.tan(i.object.fov/2*Math.PI/180),me(2*se*Ve/xe.clientHeight,i.object.matrix),ze(2*re*Ve/xe.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(me(se*(i.object.right-i.object.left)/i.object.zoom/xe.clientWidth,i.object.matrix),ze(re*(i.object.top-i.object.bottom)/i.object.zoom/xe.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function Ae(y){i.object.isPerspectiveCamera?x/=y:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*y)),i.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function we(y){i.object.isPerspectiveCamera?x*=y:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/y)),i.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ce(y){I.set(y.clientX,y.clientY)}function ie(y){K.set(y.clientX,y.clientY)}function Xt(y){G.set(y.clientX,y.clientY)}function Zt(y){V.set(y.clientX,y.clientY),O.subVectors(V,I).multiplyScalar(i.rotateSpeed);const B=i.domElement;X(2*Math.PI*O.x/B.clientHeight),oe(2*Math.PI*O.y/B.clientHeight),I.copy(V),i.update()}function yn(y){U.set(y.clientX,y.clientY),le.subVectors(U,K),le.y>0?Ae(J()):le.y<0&&we(J()),K.copy(U),i.update()}function We(y){F.set(y.clientX,y.clientY),R.subVectors(F,G).multiplyScalar(i.panSpeed),ue(R.x,R.y),G.copy(F),i.update()}function nt(y){y.deltaY<0?we(J()):y.deltaY>0&&Ae(J()),i.update()}function be(y){let B=!1;switch(y.code){case i.keys.UP:y.ctrlKey||y.metaKey||y.shiftKey?oe(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(0,i.keyPanSpeed),B=!0;break;case i.keys.BOTTOM:y.ctrlKey||y.metaKey||y.shiftKey?oe(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(0,-i.keyPanSpeed),B=!0;break;case i.keys.LEFT:y.ctrlKey||y.metaKey||y.shiftKey?X(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(i.keyPanSpeed,0),B=!0;break;case i.keys.RIGHT:y.ctrlKey||y.metaKey||y.shiftKey?X(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ue(-i.keyPanSpeed,0),B=!0;break}B&&(y.preventDefault(),i.update())}function Ee(){if(N.length===1)I.set(N[0].pageX,N[0].pageY);else{const y=.5*(N[0].pageX+N[1].pageX),B=.5*(N[0].pageY+N[1].pageY);I.set(y,B)}}function bt(){if(N.length===1)G.set(N[0].pageX,N[0].pageY);else{const y=.5*(N[0].pageX+N[1].pageX),B=.5*(N[0].pageY+N[1].pageY);G.set(y,B)}}function Dt(){const y=N[0].pageX-N[1].pageX,B=N[0].pageY-N[1].pageY,se=Math.sqrt(y*y+B*B);K.set(0,se)}function je(){i.enableZoom&&Dt(),i.enablePan&&bt()}function Ot(){i.enableZoom&&Dt(),i.enableRotate&&Ee()}function Nt(y){if(N.length==1)V.set(y.pageX,y.pageY);else{const se=ft(y),re=.5*(y.pageX+se.x),xe=.5*(y.pageY+se.y);V.set(re,xe)}O.subVectors(V,I).multiplyScalar(i.rotateSpeed);const B=i.domElement;X(2*Math.PI*O.x/B.clientHeight),oe(2*Math.PI*O.y/B.clientHeight),I.copy(V)}function Ue(y){if(N.length===1)F.set(y.pageX,y.pageY);else{const B=ft(y),se=.5*(y.pageX+B.x),re=.5*(y.pageY+B.y);F.set(se,re)}R.subVectors(F,G).multiplyScalar(i.panSpeed),ue(R.x,R.y),G.copy(F)}function pt(y){const B=ft(y),se=y.pageX-B.x,re=y.pageY-B.y,xe=Math.sqrt(se*se+re*re);U.set(0,xe),le.set(0,Math.pow(U.y/K.y,i.zoomSpeed)),Ae(le.y),K.copy(U)}function cn(y){i.enableZoom&&pt(y),i.enablePan&&Ue(y)}function Qe(y){i.enableZoom&&pt(y),i.enableRotate&&Nt(y)}function ut(y){i.enabled!==!1&&(N.length===0&&(i.domElement.setPointerCapture(y.pointerId),i.domElement.addEventListener("pointermove",Le),i.domElement.addEventListener("pointerup",Re)),kt(y),y.pointerType==="touch"?dn(y):Cn(y))}function Le(y){i.enabled!==!1&&(y.pointerType==="touch"?En(y):Et(y))}function Re(y){hn(y),N.length===0&&(i.domElement.releasePointerCapture(y.pointerId),i.domElement.removeEventListener("pointermove",Le),i.domElement.removeEventListener("pointerup",Re)),i.dispatchEvent(Za),h=l.NONE}function Cn(y){let B;switch(y.button){case 0:B=i.mouseButtons.LEFT;break;case 1:B=i.mouseButtons.MIDDLE;break;case 2:B=i.mouseButtons.RIGHT;break;default:B=-1}switch(B){case $t.DOLLY:if(i.enableZoom===!1)return;ie(y),h=l.DOLLY;break;case $t.ROTATE:if(y.ctrlKey||y.metaKey||y.shiftKey){if(i.enablePan===!1)return;Xt(y),h=l.PAN}else{if(i.enableRotate===!1)return;ce(y),h=l.ROTATE}break;case $t.PAN:if(y.ctrlKey||y.metaKey||y.shiftKey){if(i.enableRotate===!1)return;ce(y),h=l.ROTATE}else{if(i.enablePan===!1)return;Xt(y),h=l.PAN}break;default:h=l.NONE}h!==l.NONE&&i.dispatchEvent(Qo)}function Et(y){switch(h){case l.ROTATE:if(i.enableRotate===!1)return;Zt(y);break;case l.DOLLY:if(i.enableZoom===!1)return;yn(y);break;case l.PAN:if(i.enablePan===!1)return;We(y);break}}function Wt(y){i.enabled===!1||i.enableZoom===!1||h!==l.NONE||(y.preventDefault(),i.dispatchEvent(Qo),nt(y),i.dispatchEvent(Za))}function Pt(y){i.enabled===!1||i.enablePan===!1||be(y)}function dn(y){switch(jt(y),N.length){case 1:switch(i.touches.ONE){case qt.ROTATE:if(i.enableRotate===!1)return;Ee(),h=l.TOUCH_ROTATE;break;case qt.PAN:if(i.enablePan===!1)return;bt(),h=l.TOUCH_PAN;break;default:h=l.NONE}break;case 2:switch(i.touches.TWO){case qt.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;je(),h=l.TOUCH_DOLLY_PAN;break;case qt.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ot(),h=l.TOUCH_DOLLY_ROTATE;break;default:h=l.NONE}break;default:h=l.NONE}h!==l.NONE&&i.dispatchEvent(Qo)}function En(y){switch(jt(y),h){case l.TOUCH_ROTATE:if(i.enableRotate===!1)return;Nt(y),i.update();break;case l.TOUCH_PAN:if(i.enablePan===!1)return;Ue(y),i.update();break;case l.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;cn(y),i.update();break;case l.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Qe(y),i.update();break;default:h=l.NONE}}function vt(y){i.enabled!==!1&&y.preventDefault()}function kt(y){N.push(y)}function hn(y){delete z[y.pointerId];for(let B=0;B<N.length;B++)if(N[B].pointerId==y.pointerId){N.splice(B,1);return}}function jt(y){let B=z[y.pointerId];B===void 0&&(B=new Ne,z[y.pointerId]=B),B.set(y.pageX,y.pageY)}function ft(y){const B=y.pointerId===N[0].pointerId?N[1]:N[0];return z[B.pointerId]}i.domElement.addEventListener("contextmenu",vt),i.domElement.addEventListener("pointerdown",ut),i.domElement.addEventListener("pointercancel",Re),i.domElement.addEventListener("wheel",Wt,{passive:!1}),this.update()}}const ev=new Gh;let Vn;const{canvas:tv,camera:Ss,update:nv,scene:ei,renderer:iv}=$h({parameters:{antialias:!0}});nv(()=>Vn==null?void 0:Vn.update());const rv=async(m={})=>{const{controls:a=!0,webGPU:t=!1}=m;let i;a&&(Vn&&(Vn.enabled=!1,Vn.dispose()),Vn=new Ju(Ss.current,tv),Vn.enableDamping=!0,Vn.enablePan=!1),ei.clear(),ei.add(Ss.current);const l=new io(void 0,4);l.name="Directional",l.position.set(2,2,2),ei.add(l),ei.add(new bl(void 0,.8));const h=await ev.loadAsync("./glb/strawberry.glb"),p=new no;p.add(h.scene.getObjectByName("Stem")),p.add(h.scene.getObjectByName("Seeds")),p.add(h.scene.getObjectByName("Leaves")),p.add(h.scene.getObjectByName("Body")),p.name="Strawberry",ei.add(p),p.position.y=.2,p.scale.setScalar(.1);const g=qh(void 0,4,4);return g.rotation.x=-Math.PI/2,ei.add(g),t?(l.shadow.mapSize.set(4096,4096),l.shadow.bias=1e-4,l.shadow.camera.near=1,l.shadow.camera.far=100,l.shadow.camera.right=17,l.shadow.camera.left=-17,l.shadow.camera.top=17,l.shadow.camera.bottom=-17):_l(ei),Ss.current.position.set(1,1.8,1),Ss.current.lookAt(0,0,0),localStorage.getItem("debug")&&new Qu({scene:ei,camera:Ss.current,renderer:iv}),{controls:i,floor:g}};export{rv as s};
//# sourceMappingURL=setup-019dd85b.js.map
