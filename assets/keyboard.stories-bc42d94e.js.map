{"version":3,"file":"keyboard.stories-bc42d94e.js","sources":["../../src/components/controls/keyboard.ts"],"sourcesContent":["/**\n * \n * @param options\n * @param options.element The element to attach the keyboard and blur event listeners. Default is window.\n * @param options.preventDefault If true, prevents default on every keyup / keydown. Default is true.\n */\nexport const keyboardManager = (options: {\n  element?: HTMLElement\n  preventDefault?: boolean\n} = {}) => {\n  const {\n    element = window,\n    preventDefault = true\n  } = options\n\n  const pressedKeys = new Set<string>()\n\n  const keyboard = {\n    keys: {} as Record<string, boolean>,\n    controlling: false,\n    shift: 0,\n    space: 0,\n    r: 0,\n    x: 0,\n    y: 0,\n  }\n\n  const handleKey = (key: string, pressed: number) => {\n    const lowerkey = key.toLowerCase()\n  \n    switch (lowerkey) {\n    case 's':\n    case 'arrowdown':\n      keyboard.y = -1 * pressed\n      break\n    case 'w':\n    case 'arrowup':\n      keyboard.y = +1 * pressed\n      break\n    case 'a':\n    case 'arrowleft':\n      keyboard.x = -1 * pressed\n      break\n    case 'd':\n    case 'arrowright':\n      keyboard.x = +1 * pressed\n      break\n    case ' ':\n      keyboard.space = +1 * pressed\n      break\n    case 'q':\n      keyboard.r = +1 * pressed\n      break\n    case 'e':\n      keyboard.r = -1 * pressed\n      break\n    case 'shift':\n      keyboard.shift = +1 * pressed\n      break\n    default:\n      break\n    }\n\n    if (pressed === 1) {\n      keyboard.keys[lowerkey] = true\n    } else {\n      delete keyboard.keys[lowerkey]\n    }\n  }\n\n  const handleKeyDown = (event: KeyboardEvent) => {\n    if (preventDefault) {\n      event.preventDefault()\n      event.stopImmediatePropagation()\n    }\n\n    const key = event.key.toLowerCase()\n    keyboard.controlling = true\n  \n    pressedKeys.add(key)\n  \n    for (const pressedKey of pressedKeys) {\n      handleKey(pressedKey, 1)\n    }\n  }\n\n  const handleKeyUp = (event: KeyboardEvent) => {\n    if (preventDefault) {\n      event.preventDefault()\n      event.stopImmediatePropagation()\n    }\n    \n    const key = event.key.toLowerCase()\n    pressedKeys.delete(key)\n  \n    handleKey(key, 0)\n  \n    for (const pressedKey of pressedKeys) {\n      handleKey(pressedKey, 1)\n    }\n\n    if (pressedKeys.size === 0) {\n      keyboard.controlling = false\n    }\n  }  \n\n  const handleBlur = () => {\n    for (const pressedKey of pressedKeys) {\n      handleKey(pressedKey, 0)\n    }\n    pressedKeys.clear()\n  }\n\n  const disposeKeyboard = () => {\n    // @ts-expect-error :|\n    element.removeEventListener('keydown', handleKeyDown)\n    // @ts-expect-error :|\n    element.removeEventListener('keyup', handleKeyUp)\n    element.addEventListener('blur', handleBlur)\n  }\n\n  // @ts-expect-error :|\n  element.addEventListener('keydown', handleKeyDown)\n  // @ts-expect-error :|\n  element.addEventListener('keyup', handleKeyUp)\n  element.addEventListener('blur', handleBlur)\n\n  return { keyboard, disposeKeyboard }\n}\n"],"names":["keyboardManager","options","element","preventDefault","pressedKeys","keyboard","handleKey","key","pressed","lowerkey","handleKeyDown","event","pressedKey","handleKeyUp","handleBlur","disposeKeyboard"],"mappings":"+CAMO,MAAMA,EAAkB,CAACC,EAG5B,KAAO,CACH,KAAA,CACJ,QAAAC,EAAU,OACV,eAAAC,EAAiB,EACf,EAAAF,EAEEG,MAAkB,IAElBC,EAAW,CACf,KAAM,CAAC,EACP,YAAa,GACb,MAAO,EACP,MAAO,EACP,EAAG,EACH,EAAG,EACH,EAAG,CAAA,EAGCC,EAAY,CAACC,EAAaC,IAAoB,CAC5C,MAAAC,EAAWF,EAAI,cAErB,OAAQE,EAAU,CAClB,IAAK,IACL,IAAK,YACHJ,EAAS,EAAI,GAAKG,EAClB,MACF,IAAK,IACL,IAAK,UACHH,EAAS,EAAI,EAAKG,EAClB,MACF,IAAK,IACL,IAAK,YACHH,EAAS,EAAI,GAAKG,EAClB,MACF,IAAK,IACL,IAAK,aACHH,EAAS,EAAI,EAAKG,EAClB,MACF,IAAK,IACHH,EAAS,MAAQ,EAAKG,EACtB,MACF,IAAK,IACHH,EAAS,EAAI,EAAKG,EAClB,MACF,IAAK,IACHH,EAAS,EAAI,GAAKG,EAClB,MACF,IAAK,QACHH,EAAS,MAAQ,EAAKG,EACtB,KAGF,CAEIA,IAAY,EACLH,EAAA,KAAKI,CAAQ,EAAI,GAEnB,OAAAJ,EAAS,KAAKI,CAAQ,CAC/B,EAGIC,EAAiBC,GAAyB,CAC1CR,IACFQ,EAAM,eAAe,EACrBA,EAAM,yBAAyB,GAG3B,MAAAJ,EAAMI,EAAM,IAAI,YAAY,EAClCN,EAAS,YAAc,GAEvBD,EAAY,IAAIG,CAAG,EAEnB,UAAWK,KAAcR,EACvBE,EAAUM,EAAY,CAAC,CACzB,EAGIC,EAAeF,GAAyB,CACxCR,IACFQ,EAAM,eAAe,EACrBA,EAAM,yBAAyB,GAG3B,MAAAJ,EAAMI,EAAM,IAAI,YAAY,EAClCP,EAAY,OAAOG,CAAG,EAEtBD,EAAUC,EAAK,CAAC,EAEhB,UAAWK,KAAcR,EACvBE,EAAUM,EAAY,CAAC,EAGrBR,EAAY,OAAS,IACvBC,EAAS,YAAc,GACzB,EAGIS,EAAa,IAAM,CACvB,UAAWF,KAAcR,EACvBE,EAAUM,EAAY,CAAC,EAEzBR,EAAY,MAAM,CAAA,EAGdW,EAAkB,IAAM,CAEpBb,EAAA,oBAAoB,UAAWQ,CAAa,EAE5CR,EAAA,oBAAoB,QAASW,CAAW,EACxCX,EAAA,iBAAiB,OAAQY,CAAU,CAAA,EAIrC,OAAAZ,EAAA,iBAAiB,UAAWQ,CAAa,EAEzCR,EAAA,iBAAiB,QAASW,CAAW,EACrCX,EAAA,iBAAiB,OAAQY,CAAU,EAEpC,CAAE,SAAAT,EAAU,gBAAAU,EACrB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}