{"version":3,"file":"index.stories-b4d38615.js","sources":["../../node_modules/three/examples/jsm/capabilities/WebGPU.js","../../node_modules/three/examples/jsm/renderers/webgpu/constants.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUAnimation.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUWeakMap.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderObject.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderObjects.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUAttributes.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUGeometries.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUInfo.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUProperties.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderPipeline.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUProgrammableStage.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderPipelines.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUComputePipelines.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUBindings.js","../../node_modules/three/examples/jsm/nodes/core/constants.js","../../node_modules/three/examples/jsm/nodes/core/NodeUtils.js","../../node_modules/three/examples/jsm/nodes/core/Node.js","../../node_modules/three/examples/jsm/nodes/core/InputNode.js","../../node_modules/three/examples/jsm/nodes/utils/ArrayElementNode.js","../../node_modules/three/examples/jsm/nodes/utils/ConvertNode.js","../../node_modules/three/examples/jsm/nodes/core/TempNode.js","../../node_modules/three/examples/jsm/nodes/utils/JoinNode.js","../../node_modules/three/examples/jsm/nodes/utils/SplitNode.js","../../node_modules/three/examples/jsm/nodes/core/ConstNode.js","../../node_modules/three/examples/jsm/nodes/shadernode/ShaderNode.js","../../node_modules/three/examples/jsm/nodes/core/UniformNode.js","../../node_modules/three/examples/jsm/nodes/core/VaryingNode.js","../../node_modules/three/examples/jsm/nodes/core/AttributeNode.js","../../node_modules/three/examples/jsm/nodes/core/BypassNode.js","../../node_modules/three/examples/jsm/nodes/core/NodeCache.js","../../node_modules/three/examples/jsm/nodes/core/CacheNode.js","../../node_modules/three/examples/jsm/nodes/core/ContextNode.js","../../node_modules/three/examples/jsm/nodes/core/InstanceIndexNode.js","../../node_modules/three/examples/jsm/nodes/core/NodeAttribute.js","../../node_modules/three/examples/jsm/nodes/core/NodeUniform.js","../../node_modules/three/examples/jsm/nodes/core/NodeVar.js","../../node_modules/three/examples/jsm/nodes/core/NodeVarying.js","../../node_modules/three/examples/jsm/nodes/core/NodeCode.js","../../node_modules/three/examples/jsm/nodes/core/NodeKeywords.js","../../node_modules/three/examples/jsm/nodes/math/OperatorNode.js","../../node_modules/three/examples/jsm/nodes/code/ExpressionNode.js","../../node_modules/three/examples/jsm/nodes/core/PropertyNode.js","../../node_modules/three/examples/jsm/nodes/math/CondNode.js","../../node_modules/three/examples/jsm/nodes/core/StackNode.js","../../node_modules/three/examples/jsm/nodes/utils/MaxMipLevelNode.js","../../node_modules/three/examples/jsm/nodes/core/NodeBuilder.js","../../node_modules/three/examples/jsm/nodes/core/NodeFrame.js","../../node_modules/three/examples/jsm/nodes/core/NodeFunctionInput.js","../../node_modules/three/examples/jsm/nodes/core/VarNode.js","../../node_modules/three/examples/jsm/nodes/math/MathNode.js","../../node_modules/three/examples/jsm/nodes/accessors/Object3DNode.js","../../node_modules/three/examples/jsm/nodes/accessors/ModelNode.js","../../node_modules/three/examples/jsm/nodes/accessors/PositionNode.js","../../node_modules/three/examples/jsm/nodes/utils/EquirectUVNode.js","../../node_modules/three/examples/jsm/nodes/accessors/CameraNode.js","../../node_modules/three/examples/jsm/nodes/accessors/NormalNode.js","../../node_modules/three/examples/jsm/nodes/utils/SpecularMIPLevelNode.js","../../node_modules/three/examples/jsm/nodes/accessors/UVNode.js","../../node_modules/three/examples/jsm/nodes/accessors/TextureNode.js","../../node_modules/three/examples/jsm/nodes/accessors/TangentNode.js","../../node_modules/three/examples/jsm/nodes/accessors/BitangentNode.js","../../node_modules/three/examples/jsm/nodes/accessors/BufferNode.js","../../node_modules/three/examples/jsm/nodes/accessors/ReflectVectorNode.js","../../node_modules/three/examples/jsm/nodes/accessors/CubeTextureNode.js","../../node_modules/three/examples/jsm/nodes/accessors/ReferenceNode.js","../../node_modules/three/examples/jsm/nodes/accessors/MaterialReferenceNode.js","../../node_modules/three/examples/jsm/nodes/accessors/MaterialNode.js","../../node_modules/three/examples/jsm/nodes/display/FrontFacingNode.js","../../node_modules/three/examples/jsm/nodes/display/NormalMapNode.js","../../node_modules/three/examples/jsm/nodes/accessors/ExtendedMaterialNode.js","../../node_modules/three/examples/jsm/nodes/accessors/InstanceNode.js","../../node_modules/three/examples/jsm/nodes/accessors/ModelViewProjectionNode.js","../../node_modules/three/examples/jsm/nodes/accessors/SkinningNode.js","../../node_modules/three/examples/jsm/nodes/display/ToneMappingNode.js","../../node_modules/three/examples/jsm/nodes/display/ViewportNode.js","../../node_modules/three/examples/jsm/nodes/code/CodeNode.js","../../node_modules/three/examples/jsm/nodes/fog/FogNode.js","../../node_modules/three/examples/jsm/nodes/fog/FogRangeNode.js","../../node_modules/three/examples/jsm/nodes/fog/FogExp2Node.js","../../node_modules/three/examples/jsm/nodes/lighting/LightingNode.js","../../node_modules/three/examples/jsm/nodes/lighting/LightsNode.js","../../node_modules/three/examples/jsm/nodes/lighting/AONode.js","../../node_modules/three/examples/jsm/nodes/lighting/EnvironmentNode.js","../../node_modules/three/examples/jsm/nodes/materials/NodeMaterial.js","../../node_modules/three/examples/jsm/nodes/materials/MeshBasicNodeMaterial.js","../../node_modules/three/examples/jsm/nodes/lighting/AnalyticLightNode.js","../../node_modules/three/examples/jsm/nodes/core/NodeParser.js","../../node_modules/three/examples/jsm/nodes/core/NodeFunction.js","../../node_modules/three/examples/jsm/nodes/parsers/WGSLNodeFunction.js","../../node_modules/three/examples/jsm/nodes/parsers/WGSLNodeParser.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderLists.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderStates.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUTextureUtils.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUTextures.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUBackground.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUBinding.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUBufferUtils.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUBuffer.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUUniformBuffer.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUUniformsGroup.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUUniform.js","../../node_modules/three/examples/jsm/renderers/webgpu/nodes/WebGPUNodeUniform.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUSampler.js","../../node_modules/three/examples/jsm/renderers/webgpu/nodes/WebGPUNodeSampler.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUSampledTexture.js","../../node_modules/three/examples/jsm/renderers/webgpu/nodes/WebGPUNodeSampledTexture.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUStorageBuffer.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderTarget.js","../../node_modules/three/examples/jsm/renderers/webgpu/nodes/WebGPUNodeBuilder.js","../../node_modules/three/examples/jsm/renderers/webgpu/nodes/WebGPUNodes.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPUUtils.js","../../node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderer.js","../../src/stories/webgpu/code.js?raw"],"sourcesContent":["if ( window.GPUShaderStage === undefined ) {\n\n\twindow.GPUShaderStage = { VERTEX: 1, FRAGMENT: 2, COMPUTE: 4 };\n\n}\n\nclass WebGPU {\n\n\tstatic isAvailable() {\n\n\t\treturn ( navigator.gpu !== undefined );\n\n\t}\n\n\tstatic getErrorMessage() {\n\n\t\tconst message = 'Your browser does not support <a href=\"https://gpuweb.github.io/gpuweb/\" style=\"color:blue\">WebGPU</a> yet';\n\n\t\tconst element = document.createElement( 'div' );\n\t\telement.id = 'webgpumessage';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.maxWidth = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\telement.innerHTML = message;\n\n\t\treturn element;\n\n\t}\n\n}\n\nexport default WebGPU;\n","export const GPUPrimitiveTopology = {\n\tPointList: 'point-list',\n\tLineList: 'line-list',\n\tLineStrip: 'line-strip',\n\tTriangleList: 'triangle-list',\n\tTriangleStrip: 'triangle-strip',\n};\n\nexport const GPUCompareFunction = {\n\tNever: 'never',\n\tLess: 'less',\n\tEqual: 'equal',\n\tLessEqual: 'less-equal',\n\tGreater: 'greater',\n\tNotEqual: 'not-equal',\n\tGreaterEqual: 'greater-equal',\n\tAlways: 'always'\n};\n\nexport const GPUStoreOp = {\n\tStore: 'store',\n\tDiscard: 'discard'\n};\n\nexport const GPULoadOp = {\n\tLoad: 'load',\n\tClear: 'clear'\n};\n\nexport const GPUFrontFace = {\n\tCCW: 'ccw',\n\tCW: 'cw'\n};\n\nexport const GPUCullMode = {\n\tNone: 'none',\n\tFront: 'front',\n\tBack: 'back'\n};\n\nexport const GPUIndexFormat = {\n\tUint16: 'uint16',\n\tUint32: 'uint32'\n};\n\nexport const GPUVertexFormat = {\n\tUint8x2: 'uint8x2',\n\tUint8x4: 'uint8x4',\n\tSint8x2: 'sint8x2',\n\tSint8x4: 'sint8x4',\n\tUnorm8x2: 'unorm8x2',\n\tUnorm8x4: 'unorm8x4',\n\tSnorm8x2: 'snorm8x2',\n\tSnorm8x4: 'snorm8x4',\n\tUint16x2: 'uint16x2',\n\tUint16x4: 'uint16x4',\n\tSint16x2: 'sint16x2',\n\tSint16x4: 'sint16x4',\n\tUnorm16x2: 'unorm16x2',\n\tUnorm16x4: 'unorm16x4',\n\tSnorm16x2: 'snorm16x2',\n\tSnorm16x4: 'snorm16x4',\n\tFloat16x2: 'float16x2',\n\tFloat16x4: 'float16x4',\n\tFloat32: 'float32',\n\tFloat32x2: 'float32x2',\n\tFloat32x3: 'float32x3',\n\tFloat32x4: 'float32x4',\n\tUint32: 'uint32',\n\tUint32x2: 'uint32x2',\n\tUint32x3: 'uint32x3',\n\tUint32x4: 'uint32x4',\n\tSint32: 'sint32',\n\tSint32x2: 'sint32x2',\n\tSint32x3: 'sint32x3',\n\tSint32x4: 'sint32x4'\n};\n\nexport const GPUTextureFormat = {\n\n\t// 8-bit formats\n\n\tR8Unorm: 'r8unorm',\n\tR8Snorm: 'r8snorm',\n\tR8Uint: 'r8uint',\n\tR8Sint: 'r8sint',\n\n\t// 16-bit formats\n\n\tR16Uint: 'r16uint',\n\tR16Sint: 'r16sint',\n\tR16Float: 'r16float',\n\tRG8Unorm: 'rg8unorm',\n\tRG8Snorm: 'rg8snorm',\n\tRG8Uint: 'rg8uint',\n\tRG8Sint: 'rg8sint',\n\n\t// 32-bit formats\n\n\tR32Uint: 'r32uint',\n\tR32Sint: 'r32sint',\n\tR32Float: 'r32float',\n\tRG16Uint: 'rg16uint',\n\tRG16Sint: 'rg16sint',\n\tRG16Float: 'rg16float',\n\tRGBA8Unorm: 'rgba8unorm',\n\tRGBA8UnormSRGB: 'rgba8unorm-srgb',\n\tRGBA8Snorm: 'rgba8snorm',\n\tRGBA8Uint: 'rgba8uint',\n\tRGBA8Sint: 'rgba8sint',\n\tBGRA8Unorm: 'bgra8unorm',\n\tBGRA8UnormSRGB: 'bgra8unorm-srgb',\n\t// Packed 32-bit formats\n\tRGB9E5UFloat: 'rgb9e5ufloat',\n\tRGB10A2Unorm: 'rgb10a2unorm',\n\tRG11B10uFloat: 'rgb10a2unorm',\n\n\t// 64-bit formats\n\n\tRG32Uint: 'rg32uint',\n\tRG32Sint: 'rg32sint',\n\tRG32Float: 'rg32float',\n\tRGBA16Uint: 'rgba16uint',\n\tRGBA16Sint: 'rgba16sint',\n\tRGBA16Float: 'rgba16float',\n\n\t// 128-bit formats\n\n\tRGBA32Uint: 'rgba32uint',\n\tRGBA32Sint: 'rgba32sint',\n\tRGBA32Float: 'rgba32float',\n\n\t// Depth and stencil formats\n\n\tStencil8: 'stencil8',\n\tDepth16Unorm: 'depth16unorm',\n\tDepth24Plus: 'depth24plus',\n\tDepth24PlusStencil8: 'depth24plus-stencil8',\n\tDepth32Float: 'depth32float',\n\n\t// 'depth32float-stencil8' extension\n\n\tDepth32FloatStencil8: 'depth32float-stencil8',\n\n\t// BC compressed formats usable if 'texture-compression-bc' is both\n\t// supported by the device/user agent and enabled in requestDevice.\n\n\tBC1RGBAUnorm: 'bc1-rgba-unorm',\n\tBC1RGBAUnormSRGB: 'bc1-rgba-unorm-srgb',\n\tBC2RGBAUnorm: 'bc2-rgba-unorm',\n\tBC2RGBAUnormSRGB: 'bc2-rgba-unorm-srgb',\n\tBC3RGBAUnorm: 'bc3-rgba-unorm',\n\tBC3RGBAUnormSRGB: 'bc3-rgba-unorm-srgb',\n\tBC4RUnorm: 'bc4-r-unorm',\n\tBC4RSnorm: 'bc4-r-snorm',\n\tBC5RGUnorm: 'bc5-rg-unorm',\n\tBC5RGSnorm: 'bc5-rg-snorm',\n\tBC6HRGBUFloat: 'bc6h-rgb-ufloat',\n\tBC6HRGBFloat: 'bc6h-rgb-float',\n\tBC7RGBAUnorm: 'bc7-rgba-unorm',\n\tBC7RGBAUnormSRGB: 'bc7-rgba-srgb',\n\n\t// ETC2 compressed formats usable if 'texture-compression-etc2' is both\n\t// supported by the device/user agent and enabled in requestDevice.\n\n\tETC2RGB8Unorm: 'etc2-rgb8unorm',\n\tETC2RGB8UnormSRGB: 'etc2-rgb8unorm-srgb',\n\tETC2RGB8A1Unorm: 'etc2-rgb8a1unorm',\n\tETC2RGB8A1UnormSRGB: 'etc2-rgb8a1unorm-srgb',\n\tETC2RGBA8Unorm: 'etc2-rgba8unorm',\n\tETC2RGBA8UnormSRGB: 'etc2-rgba8unorm-srgb',\n\tEACR11Unorm: 'eac-r11unorm',\n\tEACR11Snorm: 'eac-r11snorm',\n\tEACRG11Unorm: 'eac-rg11unorm',\n\tEACRG11Snorm: 'eac-rg11snorm',\n\n\t// ASTC compressed formats usable if 'texture-compression-astc' is both\n\t// supported by the device/user agent and enabled in requestDevice.\n\n\tASTC4x4Unorm: 'astc-4x4-unorm',\n\tASTC4x4UnormSRGB: 'astc-4x4-unorm-srgb',\n\tASTC5x4Unorm: 'astc-5x4-unorm',\n\tASTC5x4UnormSRGB: 'astc-5x4-unorm-srgb',\n\tASTC5x5Unorm: 'astc-5x5-unorm',\n\tASTC5x5UnormSRGB: 'astc-5x5-unorm-srgb',\n\tASTC6x5Unorm: 'astc-6x5-unorm',\n\tASTC6x5UnormSRGB: 'astc-6x5-unorm-srgb',\n\tASTC6x6Unorm: 'astc-6x6-unorm',\n\tASTC6x6UnormSRGB: 'astc-6x6-unorm-srgb',\n\tASTC8x5Unorm: 'astc-8x5-unorm',\n\tASTC8x5UnormSRGB: 'astc-8x5-unorm-srgb',\n\tASTC8x6Unorm: 'astc-8x6-unorm',\n\tASTC8x6UnormSRGB: 'astc-8x6-unorm-srgb',\n\tASTC8x8Unorm: 'astc-8x8-unorm',\n\tASTC8x8UnormSRGB: 'astc-8x8-unorm-srgb',\n\tASTC10x5Unorm: 'astc-10x5-unorm',\n\tASTC10x5UnormSRGB: 'astc-10x5-unorm-srgb',\n\tASTC10x6Unorm: 'astc-10x6-unorm',\n\tASTC10x6UnormSRGB: 'astc-10x6-unorm-srgb',\n\tASTC10x8Unorm: 'astc-10x8-unorm',\n\tASTC10x8UnormSRGB: 'astc-10x8-unorm-srgb',\n\tASTC10x10Unorm: 'astc-10x10-unorm',\n\tASTC10x10UnormSRGB: 'astc-10x10-unorm-srgb',\n\tASTC12x10Unorm: 'astc-12x10-unorm',\n\tASTC12x10UnormSRGB: 'astc-12x10-unorm-srgb',\n\tASTC12x12Unorm: 'astc-12x12-unorm',\n\tASTC12x12UnormSRGB: 'astc-12x12-unorm-srgb',\n\n};\n\nexport const GPUAddressMode = {\n\tClampToEdge: 'clamp-to-edge',\n\tRepeat: 'repeat',\n\tMirrorRepeat: 'mirror-repeat'\n};\n\nexport const GPUFilterMode = {\n\tLinear: 'linear',\n\tNearest: 'nearest'\n};\n\nexport const GPUBlendFactor = {\n\tZero: 'zero',\n\tOne: 'one',\n\tSrcColor: 'src-color',\n\tOneMinusSrcColor: 'one-minus-src-color',\n\tSrcAlpha: 'src-alpha',\n\tOneMinusSrcAlpha: 'one-minus-src-alpha',\n\tDstColor: 'dst-color',\n\tOneMinusDstColor: 'one-minus-dst-color',\n\tDstAlpha: 'dst-alpha',\n\tOneMinusDstAlpha: 'one-minus-dst-alpha',\n\tSrcAlphaSaturated: 'src-alpha-saturated',\n\tBlendColor: 'blend-color',\n\tOneMinusBlendColor: 'one-minus-blend-color'\n};\n\nexport const GPUBlendOperation = {\n\tAdd: 'add',\n\tSubtract: 'subtract',\n\tReverseSubtract: 'reverse-subtract',\n\tMin: 'min',\n\tMax: 'max'\n};\n\nexport const GPUColorWriteFlags = {\n\tNone: 0,\n\tRed: 0x1,\n\tGreen: 0x2,\n\tBlue: 0x4,\n\tAlpha: 0x8,\n\tAll: 0xF\n};\n\nexport const GPUStencilOperation = {\n\tKeep: 'keep',\n\tZero: 'zero',\n\tReplace: 'replace',\n\tInvert: 'invert',\n\tIncrementClamp: 'increment-clamp',\n\tDecrementClamp: 'decrement-clamp',\n\tIncrementWrap: 'increment-wrap',\n\tDecrementWrap: 'decrement-wrap'\n};\n\nexport const GPUBindingType = {\n\tUniformBuffer: 'uniform-buffer',\n\tStorageBuffer: 'storage-buffer',\n\tReadonlyStorageBuffer: 'readonly-storage-buffer',\n\tSampler: 'sampler',\n\tComparisonSampler: 'comparison-sampler',\n\tSampledTexture: 'sampled-texture',\n\tMultisampledTexture: 'multisampled-texture',\n\tReadonlyStorageTexture: 'readonly-storage-texture',\n\tWriteonlyStorageTexture: 'writeonly-storage-texture'\n};\n\nexport const GPUTextureDimension = {\n\tOneD: '1d',\n\tTwoD: '2d',\n\tThreeD: '3d'\n};\n\nexport const GPUTextureViewDimension = {\n\tOneD: '1d',\n\tTwoD: '2d',\n\tTwoDArray: '2d-array',\n\tCube: 'cube',\n\tCubeArray: 'cube-array',\n\tThreeD: '3d'\n};\n\nexport const GPUTextureAspect = {\n\tAll: 'all',\n\tStencilOnly: 'stencil-only',\n\tDepthOnly: 'depth-only'\n};\n\nexport const GPUInputStepMode = {\n\tVertex: 'vertex',\n\tInstance: 'instance'\n};\n\nexport const GPUFeatureName = {\n\tDepthClipControl: 'depth-clip-control',\n\tDepth32FloatStencil8: 'depth32float-stencil8',\n\tTextureCompressionBC: 'texture-compression-bc',\n\tTextureCompressionETC2: 'texture-compression-etc2',\n\tTextureCompressionASTC: 'texture-compression-astc',\n\tTimestampQuery: 'timestamp-query',\n\tIndirectFirstInstance: 'indirect-first-instance',\n\tShaderF16: 'shader-f16',\n\tRG11B10UFloat: 'rg11b10ufloat-renderable',\n\tBGRA8UNormStorage: 'bgra8unorm-storage',\n\tFloat32Filterable: 'float32-filterable'\n};\n\nexport const GPUChunkSize = 16; // size of a chunk in bytes (STD140 layout)\n\n// @TODO: Move to src/constants.js\n\nexport const BlendColorFactor = 211;\nexport const OneMinusBlendColorFactor = 212;\n","class WebGPUAnimation {\n\n\tconstructor() {\n\n\t\tthis.nodes = null;\n\n\t\tthis.animationLoop = null;\n\t\tthis.requestId = null;\n\n\t\tthis.isAnimating = false;\n\n\t\tthis.context = self;\n\n\t}\n\n\tstart() {\n\n\t\tif ( this.isAnimating === true || this.animationLoop === null || this.nodes === null ) return;\n\n\t\tthis.isAnimating = true;\n\n\t\tconst update = ( time, frame ) => {\n\n\t\t\tthis.requestId = self.requestAnimationFrame( update );\n\n\t\t\tthis.nodes.nodeFrame.update();\n\n\t\t\tthis.animationLoop( time, frame );\n\n\t\t};\n\n\t\tthis.requestId = self.requestAnimationFrame( update );\n\n\t}\n\n\tstop() {\n\n\t\tself.cancelAnimationFrame( this.requestId );\n\n\t\tthis.isAnimating = false;\n\n\t}\n\n\tsetAnimationLoop( callback ) {\n\n\t\tthis.animationLoop = callback;\n\n\t}\n\n\tsetNodes( nodes ) {\n\n\t\tthis.nodes = nodes;\n\n\t}\n\n}\n\nexport default WebGPUAnimation;\n","export default class WebGPUWeakMap extends WeakMap {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t}\n\n\tget( keys ) {\n\n\t\tif ( Array.isArray( keys ) ) {\n\n\t\t\tlet map = this;\n\n\t\t\tfor ( let i = 0; i < keys.length - 1; i ++ ) {\n\n\t\t\t\tmap = map.get( keys[ i ] );\n\n\t\t\t\tif ( map === undefined ) return undefined;\n\n\t\t\t}\n\n\t\t\treturn map.get( keys[ keys.length - 1 ] );\n\n\t\t} else {\n\n\t\t\treturn super.get( keys );\n\n\t\t}\n\n\t}\n\n\tset( keys, value ) {\n\n\t\tif ( Array.isArray( keys ) ) {\n\n\t\t\tlet map = this;\n\n\t\t\tfor ( let i = 0; i < keys.length - 1; i ++ ) {\n\n\t\t\t\tconst key = keys[ i ];\n\n\t\t\t\tif ( map.has( key ) === false ) map.set( key, new WeakMap() );\n\n\t\t\t\tmap = map.get( key );\n\n\t\t\t}\n\n\t\t\treturn map.set( keys[ keys.length - 1 ], value );\n\n\t\t} else {\n\n\t\t\treturn super.set( keys, value );\n\n\t\t}\n\n\t}\n\n\tdelete( keys ) {\n\n\t\tif ( Array.isArray( keys ) ) {\n\n\t\t\tlet map = this;\n\n\t\t\tfor ( let i = 0; i < keys.length - 1; i ++ ) {\n\n\t\t\t\tmap = map.get( keys[ i ] );\n\n\t\t\t\tif ( map === undefined ) return false;\n\n\t\t\t}\n\n\t\t\treturn map.delete( keys[ keys.length - 1 ] );\n\n\t\t} else {\n\n\t\t\treturn super.delete( keys );\n\n\t\t}\n\n\t}\n\n}\n","export default class WebGPURenderObject {\n\n\tconstructor( renderer, nodes, object, material, scene, camera, lightsNode ) {\n\n\t\tthis.renderer = renderer;\n\t\tthis.nodes = nodes;\n\t\tthis.object = object;\n\t\tthis.material = material;\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\t\tthis.lightsNode = lightsNode;\n\n\t\tthis.geometry = object.geometry;\n\n\t\tthis._materialVersion = - 1;\n\t\tthis._materialCacheKey = '';\n\n\t}\n\n\tgetCacheKey() {\n\n\t\tconst { material, scene, lightsNode } = this;\n\n\t\tif ( material.version !== this._materialVersion ) {\n\n\t\t\tthis._materialVersion = material.version;\n\t\t\tthis._materialCacheKey = material.customProgramCacheKey();\n\n\t\t}\n\n\t\tconst cacheKey = [];\n\n\t\tcacheKey.push( 'material:' + this._materialCacheKey );\n\t\tcacheKey.push( 'nodes:' + this.nodes.getCacheKey( scene, lightsNode ) );\n\n\t\treturn '{' + cacheKey.join( ',' ) + '}';\n\n\t}\n\n}\n","import WebGPUWeakMap from './WebGPUWeakMap.js';\nimport WebGPURenderObject from './WebGPURenderObject.js';\n\nclass WebGPURenderObjects {\n\n\tconstructor( renderer, nodes, geometries, info ) {\n\n\t\tthis.renderer = renderer;\n\t\tthis.nodes = nodes;\n\t\tthis.geometries = geometries;\n\t\tthis.info = info;\n\n\t\tthis.cache = new WebGPUWeakMap();\n\n\t}\n\n\tget( object, material, scene, camera, lightsNode ) {\n\n\t\tconst chainKey = [ object, material, scene, camera, lightsNode ];\n\n\t\tlet renderObject = this.cache.get( chainKey );\n\n\t\tif ( renderObject === undefined ) {\n\n\t\t\trenderObject = new WebGPURenderObject( this.renderer, this.nodes, object, material, scene, camera, lightsNode );\n\n\t\t\tthis.cache.set( chainKey, renderObject );\n\n\t\t}\n\n\t\treturn renderObject;\n\n\t}\n\n\tremove( object, material, scene, camera, lightsNode ) {\n\n\t\tthis.cache.delete( [ object, material, scene, camera, lightsNode ] );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.cache = new WebGPUWeakMap();\n\t\tthis.updateMap = new WeakMap();\n\n\t}\n\n}\n\nexport default WebGPURenderObjects;\n","class WebGPUAttributes {\n\n\tconstructor( device ) {\n\n\t\tthis.buffers = new WeakMap();\n\t\tthis.device = device;\n\n\t}\n\n\tget( attribute ) {\n\n\t\tattribute = this._getAttribute( attribute );\n\n\t\treturn this.buffers.get( attribute );\n\n\t}\n\n\tremove( attribute ) {\n\n\t\tattribute = this._getAttribute( attribute );\n\n\t\tconst data = this.buffers.get( attribute );\n\n\t\tif ( data ) {\n\n\t\t\tthis._destroyBuffers( data );\n\n\t\t\tthis.buffers.delete( attribute );\n\n\t\t}\n\n\t}\n\n\tupdate( attribute, isIndex = false, usage = null ) {\n\n\t\tattribute = this._getAttribute( attribute );\n\n\t\tlet data = this.buffers.get( attribute );\n\n\t\tif ( data === undefined ) {\n\n\t\t\tif ( usage === null ) {\n\n\t\t\t\tusage = ( isIndex === true ) ? GPUBufferUsage.INDEX : GPUBufferUsage.VERTEX;\n\n\t\t\t}\n\n\t\t\tdata = this._createBuffer( attribute, usage );\n\n\t\t\tthis.buffers.set( attribute, data );\n\n\t\t} else if ( usage && usage !== data.usage ) {\n\n\t\t\tthis._destroyBuffers( data );\n\n\t\t\tdata = this._createBuffer( attribute, usage );\n\n\t\t\tthis.buffers.set( attribute, data );\n\n\t\t} else if ( data.version < attribute.version ) {\n\n\t\t\tthis._writeBuffer( data.buffer, attribute );\n\n\t\t\tdata.version = attribute.version;\n\n\t\t}\n\n\t}\n\n\tasync getArrayBuffer( attribute ) {\n\n\t\tconst data = this.get( attribute );\n\t\tconst device = this.device;\n\n\t\tconst gpuBuffer = data.buffer;\n\t\tconst size = gpuBuffer.size;\n\n\t\tlet gpuReadBuffer = data.readBuffer;\n\t\tlet needsUnmap = true;\n\n\t\tif ( gpuReadBuffer === null ) {\n\n\t\t\tgpuReadBuffer = device.createBuffer( {\n\t\t\t\tlabel: attribute.name,\n\t\t\t\tsize,\n\t\t\t\tusage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ\n\t\t\t} );\n\n\t\t\tneedsUnmap = false;\n\n\t\t\tdata.readBuffer = gpuReadBuffer;\n\n\t\t}\n\n\t\tconst cmdEncoder = device.createCommandEncoder( {} );\n\n\t\tcmdEncoder.copyBufferToBuffer(\n\t\t\tgpuBuffer,\n\t\t\t0,\n\t\t\tgpuReadBuffer,\n\t\t\t0,\n\t\t\tsize\n\t\t);\n\n\t\tif ( needsUnmap ) gpuReadBuffer.unmap();\n\n\t\tconst gpuCommands = cmdEncoder.finish();\n\t\tdevice.queue.submit( [ gpuCommands ] );\n\n\t\tawait gpuReadBuffer.mapAsync( GPUMapMode.READ );\n\n\t\tconst arrayBuffer = gpuReadBuffer.getMappedRange();\n\n\t\treturn arrayBuffer;\n\n\t}\n\n\t_getAttribute( attribute ) {\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) attribute = attribute.data;\n\n\t\treturn attribute;\n\n\t}\n\n\t_createBuffer( attribute, usage ) {\n\n\t\tconst array = attribute.array;\n\t\tconst size = array.byteLength + ( ( 4 - ( array.byteLength % 4 ) ) % 4 ); // ensure 4 byte alignment, see #20441\n\n\t\tconst buffer = this.device.createBuffer( {\n\t\t\tlabel: attribute.name,\n\t\t\tsize,\n\t\t\tusage: usage | GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST,\n\t\t\tmappedAtCreation: true\n\t\t} );\n\n\t\tnew array.constructor( buffer.getMappedRange() ).set( array );\n\n\t\tbuffer.unmap();\n\n\t\tattribute.onUploadCallback();\n\n\t\treturn {\n\t\t\tversion: attribute.version,\n\t\t\tbuffer,\n\t\t\treadBuffer: null,\n\t\t\tusage\n\t\t};\n\n\t}\n\n\t_writeBuffer( buffer, attribute ) {\n\n\t\tconst device = this.device;\n\n\t\tconst array = attribute.array;\n\t\tconst updateRange = attribute.updateRange;\n\n\t\tif ( updateRange.count === - 1 ) {\n\n\t\t\t// Not using update ranges\n\n\t\t\tdevice.queue.writeBuffer(\n\t\t\t\tbuffer,\n\t\t\t\t0,\n\t\t\t\tarray,\n\t\t\t\t0\n\t\t\t);\n\n\t\t} else {\n\n\t\t\tdevice.queue.writeBuffer(\n\t\t\t\tbuffer,\n\t\t\t\t0,\n\t\t\t\tarray,\n\t\t\t\tupdateRange.offset * array.BYTES_PER_ELEMENT,\n\t\t\t\tupdateRange.count * array.BYTES_PER_ELEMENT\n\t\t\t);\n\n\t\t\tupdateRange.count = - 1; // reset range\n\n\t\t}\n\n\t}\n\n\t_destroyBuffers( { buffer, readBuffer } ) {\n\n\t\tbuffer.destroy();\n\n\t\tif ( readBuffer !== null ) readBuffer.destroy();\n\n\t}\n\n}\n\nexport default WebGPUAttributes;\n","import { Uint32BufferAttribute, Uint16BufferAttribute } from 'three';\n\nfunction arrayNeedsUint32( array ) {\n\n\t// assumes larger values usually on last\n\n\tfor ( let i = array.length - 1; i >= 0; -- i ) {\n\n\t\tif ( array[ i ] >= 65535 ) return true; // account for PRIMITIVE_RESTART_FIXED_INDEX, #24565\n\n\t}\n\n\treturn false;\n\n}\n\nfunction getWireframeVersion( geometry ) {\n\n\treturn ( geometry.index !== null ) ? geometry.index.version : geometry.attributes.position.version;\n\n}\n\nfunction getWireframeIndex( geometry ) {\n\n\tconst indices = [];\n\n\tconst geometryIndex = geometry.index;\n\tconst geometryPosition = geometry.attributes.position;\n\n\tif ( geometryIndex !== null ) {\n\n\t\tconst array = geometryIndex.array;\n\n\t\tfor ( let i = 0, l = array.length; i < l; i += 3 ) {\n\n\t\t\tconst a = array[ i + 0 ];\n\t\t\tconst b = array[ i + 1 ];\n\t\t\tconst c = array[ i + 2 ];\n\n\t\t\tindices.push( a, b, b, c, c, a );\n\n\t\t}\n\n\t} else {\n\n\t\tconst array = geometryPosition.array;\n\n\t\tfor ( let i = 0, l = ( array.length / 3 ) - 1; i < l; i += 3 ) {\n\n\t\t\tconst a = i + 0;\n\t\t\tconst b = i + 1;\n\t\t\tconst c = i + 2;\n\n\t\t\tindices.push( a, b, b, c, c, a );\n\n\t\t}\n\n\t}\n\n\tconst attribute = new ( arrayNeedsUint32( indices ) ? Uint32BufferAttribute : Uint16BufferAttribute )( indices, 1 );\n\tattribute.version = getWireframeVersion( geometry );\n\n\treturn attribute;\n\n}\n\nclass WebGPUGeometries {\n\n\tconstructor( attributes, properties, info ) {\n\n\t\tthis.attributes = attributes;\n\t\tthis.properties = properties;\n\t\tthis.info = info;\n\n\t\tthis.wireframes = new WeakMap();\n\t\tthis.geometryFrame = new WeakMap();\n\n\t}\n\n\thas( renderObject ) {\n\n\t\tconst geometry = renderObject.geometry;\n\n\t\treturn this.properties.has( geometry ) && this.properties.get( geometry ).initialized === true;\n\n\t}\n\n\tupdate( renderObject ) {\n\n\t\tif ( this.has( renderObject ) === false ) this.initGeometry( renderObject );\n\n\t\tthis.updateFrameAttributes( renderObject );\n\n\t}\n\n\tinitGeometry( renderObject ) {\n\n\t\tconst geometry = renderObject.geometry;\n\t\tconst geometryProperties = this.properties.get( geometry );\n\n\t\tgeometryProperties.initialized = true;\n\n\t\tconst dispose = () => {\n\n\t\t\tthis.info.memory.geometries --;\n\n\t\t\tconst index = geometry.index;\n\t\t\tconst geometryAttributes = geometry.attributes;\n\n\t\t\tif ( index !== null ) {\n\n\t\t\t\tthis.attributes.remove( index );\n\n\t\t\t}\n\n\t\t\tfor ( const name in geometryAttributes ) {\n\n\t\t\t\tthis.attributes.remove( geometryAttributes[ name ] );\n\n\t\t\t}\n\n\t\t\tconst wireframeAttribute = this.wireframes.get( geometry );\n\n\t\t\tif ( wireframeAttribute !== undefined ) {\n\n\t\t\t\tthis.attributes.remove( wireframeAttribute );\n\n\t\t\t}\n\n\t\t\tgeometry.removeEventListener( 'dispose', dispose );\n\n\t\t};\n\n\t\tthis.info.memory.geometries ++;\n\n\t\tgeometry.addEventListener( 'dispose', dispose );\n\n\t}\n\n\tupdateFrameAttributes( renderObject ) {\n\n\t\tconst frame = this.info.render.frame;\n\t\tconst geometry = renderObject.geometry;\n\n\t\tif ( this.geometryFrame.get( geometry ) !== frame ) {\n\n\t\t\tthis.updateAttributes( renderObject );\n\n\t\t\tthis.geometryFrame.set( geometry, frame );\n\n\t\t}\n\n\t}\n\n\tupdateAttributes( renderObject ) {\n\n\t\tconst geometry = renderObject.geometry;\n\t\tconst geometryAttributes = geometry.attributes;\n\n\t\tfor ( const name in geometryAttributes ) {\n\n\t\t\tthis.attributes.update( geometryAttributes[ name ] );\n\n\t\t}\n\n\t\tconst index = this.getIndex( renderObject );\n\n\t\tif ( index !== null ) {\n\n\t\t\tthis.attributes.update( index, true );\n\n\t\t}\n\n\t}\n\n\tgetIndex( renderObject ) {\n\n\t\tconst { geometry, material } = renderObject;\n\n\t\tlet index = geometry.index;\n\n\t\tif ( material.wireframe === true ) {\n\n\t\t\tconst wireframes = this.wireframes;\n\n\t\t\tlet wireframeAttribute = wireframes.get( geometry );\n\n\t\t\tif ( wireframeAttribute === undefined ) {\n\n\t\t\t\twireframeAttribute = getWireframeIndex( geometry );\n\n\t\t\t\twireframes.set( geometry, wireframeAttribute );\n\n\t\t\t} else if ( wireframeAttribute.version !== getWireframeVersion( geometry ) ) {\n\n\t\t\t\tthis.attributes.remove( wireframeAttribute );\n\n\t\t\t\twireframeAttribute = getWireframeIndex( geometry );\n\n\t\t\t\twireframes.set( geometry, wireframeAttribute );\n\n\t\t\t}\n\n\t\t\tindex = wireframeAttribute;\n\n\t\t}\n\n\t\treturn index;\n\n\t}\n\n}\n\nexport default WebGPUGeometries;\n","class WebGPUInfo {\n\n\tconstructor() {\n\n\t\tthis.autoReset = true;\n\n\t\tthis.render = {\n\t\t\tframe: 0,\n\t\t\tdrawCalls: 0,\n\t\t\ttriangles: 0,\n\t\t\tpoints: 0,\n\t\t\tlines: 0\n\t\t};\n\n\t\tthis.memory = {\n\t\t\tgeometries: 0,\n\t\t\ttextures: 0\n\t\t};\n\n\t}\n\n\tupdate( object, count, instanceCount ) {\n\n\t\tthis.render.drawCalls ++;\n\n\t\tif ( object.isMesh || object.isSprite ) {\n\n\t\t\tthis.render.triangles += instanceCount * ( count / 3 );\n\n\t\t} else if ( object.isPoints ) {\n\n\t\t\tthis.render.points += instanceCount * count;\n\n\t\t} else if ( object.isLineSegments ) {\n\n\t\t\tthis.render.lines += instanceCount * ( count / 2 );\n\n\t\t} else if ( object.isLine ) {\n\n\t\t\tthis.render.lines += instanceCount * ( count - 1 );\n\n\t\t} else {\n\n\t\t\tconsole.error( 'THREE.WebGPUInfo: Unknown object type.' );\n\n\t\t}\n\n\t}\n\n\treset() {\n\n\t\tthis.render.frame ++;\n\t\tthis.render.drawCalls = 0;\n\t\tthis.render.triangles = 0;\n\t\tthis.render.points = 0;\n\t\tthis.render.lines = 0;\n\n\t}\n\n\tdispose() {\n\n\t\tthis.reset();\n\n\t\tthis.render.frame = 0;\n\n\t\tthis.memory.geometries = 0;\n\t\tthis.memory.textures = 0;\n\n\t}\n\n}\n\n\nexport default WebGPUInfo;\n","class WebGPUProperties {\n\n\tconstructor() {\n\n\t\tthis.properties = new WeakMap();\n\n\t}\n\n\tget( object ) {\n\n\t\tlet map = this.properties.get( object );\n\n\t\tif ( map === undefined ) {\n\n\t\t\tmap = {};\n\t\t\tthis.properties.set( object, map );\n\n\t\t}\n\n\t\treturn map;\n\n\t}\n\n\tremove( object ) {\n\n\t\tthis.properties.delete( object );\n\n\t}\n\n\thas( object ) {\n\n\t\treturn this.properties.has( object );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.properties = new WeakMap();\n\n\t}\n\n}\n\nexport default WebGPUProperties;\n","import { GPUIndexFormat, GPUCompareFunction, GPUFrontFace, GPUCullMode, GPUBlendFactor, GPUBlendOperation, BlendColorFactor, OneMinusBlendColorFactor, GPUColorWriteFlags, GPUStencilOperation, GPUInputStepMode } from './constants.js';\nimport {\n\tFloat16BufferAttribute,\n\tFrontSide, BackSide, DoubleSide,\n\tNeverDepth, AlwaysDepth, LessDepth, LessEqualDepth, EqualDepth, GreaterEqualDepth, GreaterDepth, NotEqualDepth,\n\tNeverStencilFunc, AlwaysStencilFunc, LessStencilFunc, LessEqualStencilFunc, EqualStencilFunc, GreaterEqualStencilFunc, GreaterStencilFunc, NotEqualStencilFunc,\n\tKeepStencilOp, ZeroStencilOp, ReplaceStencilOp, InvertStencilOp, IncrementStencilOp, DecrementStencilOp, IncrementWrapStencilOp, DecrementWrapStencilOp,\n\tNoBlending, NormalBlending, AdditiveBlending, SubtractiveBlending, MultiplyBlending, CustomBlending,\n\tAddEquation, SubtractEquation, ReverseSubtractEquation, MinEquation, MaxEquation,\n\tZeroFactor, OneFactor, SrcColorFactor, OneMinusSrcColorFactor, SrcAlphaFactor, OneMinusSrcAlphaFactor, DstAlphaFactor, OneMinusDstAlphaFactor, DstColorFactor, OneMinusDstColorFactor, SrcAlphaSaturateFactor\n} from 'three';\n\nconst typedArraysToVertexFormatPrefix = new Map( [\n\t[ Int8Array, [ 'sint8', 'snorm8' ]],\n\t[ Uint8Array, [ 'uint8', 'unorm8' ]],\n\t[ Int16Array, [ 'sint16', 'snorm16' ]],\n\t[ Uint16Array, [ 'uint16', 'unorm16' ]],\n\t[ Int32Array, [ 'sint32', 'snorm32' ]],\n\t[ Uint32Array, [ 'uint32', 'unorm32' ]],\n\t[ Float32Array, [ 'float32', ]],\n] );\n\nconst typedAttributeToVertexFormatPrefix = new Map( [\n\t[ Float16BufferAttribute, [ 'float16', ]],\n] );\n\nconst typeArraysToVertexFormatPrefixForItemSize1 = new Map( [\n\t[ Int32Array, 'sint32' ],\n\t[ Uint32Array, 'uint32' ],\n\t[ Float32Array, 'float32' ]\n] );\n\nclass WebGPURenderPipeline {\n\n\tconstructor( device, utils ) {\n\n\t\tthis.cacheKey = null;\n\t\tthis.shaderAttributes = null;\n\t\tthis.stageVertex = null;\n\t\tthis.stageFragment = null;\n\t\tthis.usedTimes = 0;\n\n\t\tthis._device = device;\n\t\tthis._utils = utils;\n\n\t}\n\n\tinit( cacheKey, stageVertex, stageFragment, renderObject, nodeBuilder ) {\n\n\t\tconst { object, material, geometry } = renderObject;\n\n\t\t// determine shader attributes\n\n\t\tconst shaderAttributes = this._getShaderAttributes( nodeBuilder, geometry );\n\n\t\t// vertex buffers\n\n\t\tconst vertexBuffers = [];\n\n\t\tfor ( const attribute of shaderAttributes ) {\n\n\t\t\tconst name = attribute.name;\n\t\t\tconst geometryAttribute = geometry.getAttribute( name );\n\t\t\tconst stepMode = ( geometryAttribute !== undefined && geometryAttribute.isInstancedBufferAttribute ) ? GPUInputStepMode.Instance : GPUInputStepMode.Vertex;\n\n\t\t\tvertexBuffers.push( {\n\t\t\t\tarrayStride: attribute.arrayStride,\n\t\t\t\tattributes: [ { shaderLocation: attribute.slot, offset: attribute.offset, format: attribute.format } ],\n\t\t\t\tstepMode: stepMode\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.cacheKey = cacheKey;\n\t\tthis.shaderAttributes = shaderAttributes;\n\t\tthis.stageVertex = stageVertex;\n\t\tthis.stageFragment = stageFragment;\n\n\t\t// blending\n\n\t\tlet alphaBlend = {};\n\t\tlet colorBlend = {};\n\n\t\tif ( material.transparent === true && material.blending !== NoBlending ) {\n\n\t\t\talphaBlend = this._getAlphaBlend( material );\n\t\t\tcolorBlend = this._getColorBlend( material );\n\n\t\t}\n\n\t\t// stencil\n\n\t\tlet stencilFront = {};\n\n\t\tif ( material.stencilWrite === true ) {\n\n\t\t\tstencilFront = {\n\t\t\t\tcompare: this._getStencilCompare( material ),\n\t\t\t\tfailOp: this._getStencilOperation( material.stencilFail ),\n\t\t\t\tdepthFailOp: this._getStencilOperation( material.stencilZFail ),\n\t\t\t\tpassOp: this._getStencilOperation( material.stencilZPass )\n\t\t\t};\n\n\t\t}\n\n\t\t//\n\n\t\tconst primitiveState = this._getPrimitiveState( object, geometry, material );\n\t\tconst colorWriteMask = this._getColorWriteMask( material );\n\t\tconst depthCompare = this._getDepthCompare( material );\n\t\tconst colorFormat = this._utils.getCurrentColorFormat();\n\t\tconst depthStencilFormat = this._utils.getCurrentDepthStencilFormat();\n\t\tconst sampleCount = this._utils.getSampleCount();\n\n\t\tthis.pipeline = this._device.createRenderPipeline( {\n\t\t\tvertex: Object.assign( {}, stageVertex.stage, { buffers: vertexBuffers } ),\n\t\t\tfragment: Object.assign( {}, stageFragment.stage, { targets: [ {\n\t\t\t\tformat: colorFormat,\n\t\t\t\tblend: {\n\t\t\t\t\talpha: alphaBlend,\n\t\t\t\t\tcolor: colorBlend\n\t\t\t\t},\n\t\t\t\twriteMask: colorWriteMask\n\t\t\t} ] } ),\n\t\t\tprimitive: primitiveState,\n\t\t\tdepthStencil: {\n\t\t\t\tformat: depthStencilFormat,\n\t\t\t\tdepthWriteEnabled: material.depthWrite,\n\t\t\t\tdepthCompare: depthCompare,\n\t\t\t\tstencilFront: stencilFront,\n\t\t\t\tstencilBack: {}, // three.js does not provide an API to configure the back function (gl.stencilFuncSeparate() was never used)\n\t\t\t\tstencilReadMask: material.stencilFuncMask,\n\t\t\t\tstencilWriteMask: material.stencilWriteMask\n\t\t\t},\n\t\t\tmultisample: {\n\t\t\t\tcount: sampleCount\n\t\t\t},\n\t\t\tlayout: 'auto'\n\t\t} );\n\n\t}\n\n\t_getAlphaBlend( material ) {\n\n\t\tconst blending = material.blending;\n\t\tconst premultipliedAlpha = material.premultipliedAlpha;\n\n\t\tlet alphaBlend = undefined;\n\n\t\tswitch ( blending ) {\n\n\t\t\tcase NormalBlending:\n\n\t\t\t\tif ( premultipliedAlpha === false ) {\n\n\t\t\t\t\talphaBlend = {\n\t\t\t\t\t\tsrcFactor: GPUBlendFactor.One,\n\t\t\t\t\t\tdstFactor: GPUBlendFactor.OneMinusSrcAlpha,\n\t\t\t\t\t\toperation: GPUBlendOperation.Add\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase AdditiveBlending:\n\n\t\t\t\talphaBlend = {\n\t\t\t\t\tsrcFactor: GPUBlendFactor.Zero,\n\t\t\t\t\tdstFactor: GPUBlendFactor.One,\n\t\t\t\t\toperation: GPUBlendOperation.Add\n\t\t\t\t};\n\n\t\t\t\tbreak;\n\n\t\t\tcase SubtractiveBlending:\n\n\t\t\t\tif ( premultipliedAlpha === true ) {\n\n\t\t\t\t\talphaBlend = {\n\t\t\t\t\t\tsrcFactor: GPUBlendFactor.OneMinusSrcColor,\n\t\t\t\t\t\tdstFactor: GPUBlendFactor.OneMinusSrcAlpha,\n\t\t\t\t\t\toperation: GPUBlendOperation.Add\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase MultiplyBlending:\n\n\t\t\t\tif ( premultipliedAlpha === true ) {\n\n\t\t\t\t\talphaBlend = {\n\t\t\t\t\t\tsrcFactor: GPUBlendFactor.Zero,\n\t\t\t\t\t\tdstFactor: GPUBlendFactor.SrcAlpha,\n\t\t\t\t\t\toperation: GPUBlendOperation.Add\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase CustomBlending:\n\n\t\t\t\tconst blendSrcAlpha = material.blendSrcAlpha;\n\t\t\t\tconst blendDstAlpha = material.blendDstAlpha;\n\t\t\t\tconst blendEquationAlpha = material.blendEquationAlpha;\n\n\t\t\t\tif ( blendSrcAlpha !== null && blendDstAlpha !== null && blendEquationAlpha !== null ) {\n\n\t\t\t\t\talphaBlend = {\n\t\t\t\t\t\tsrcFactor: this._getBlendFactor( blendSrcAlpha ),\n\t\t\t\t\t\tdstFactor: this._getBlendFactor( blendDstAlpha ),\n\t\t\t\t\t\toperation: this._getBlendOperation( blendEquationAlpha )\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Blending not supported.', blending );\n\n\t\t}\n\n\t\treturn alphaBlend;\n\n\t}\n\n\t_getBlendFactor( blend ) {\n\n\t\tlet blendFactor;\n\n\t\tswitch ( blend ) {\n\n\t\t\tcase ZeroFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.Zero;\n\t\t\t\tbreak;\n\n\t\t\tcase OneFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.One;\n\t\t\t\tbreak;\n\n\t\t\tcase SrcColorFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.SrcColor;\n\t\t\t\tbreak;\n\n\t\t\tcase OneMinusSrcColorFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.OneMinusSrcColor;\n\t\t\t\tbreak;\n\n\t\t\tcase SrcAlphaFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.SrcAlpha;\n\t\t\t\tbreak;\n\n\t\t\tcase OneMinusSrcAlphaFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.OneMinusSrcAlpha;\n\t\t\t\tbreak;\n\n\t\t\tcase DstColorFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.DstColor;\n\t\t\t\tbreak;\n\n\t\t\tcase OneMinusDstColorFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.OneMinusDstColor;\n\t\t\t\tbreak;\n\n\t\t\tcase DstAlphaFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.DstAlpha;\n\t\t\t\tbreak;\n\n\t\t\tcase OneMinusDstAlphaFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.OneMinusDstAlpha;\n\t\t\t\tbreak;\n\n\t\t\tcase SrcAlphaSaturateFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.SrcAlphaSaturated;\n\t\t\t\tbreak;\n\n\t\t\tcase BlendColorFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.BlendColor;\n\t\t\t\tbreak;\n\n\t\t\tcase OneMinusBlendColorFactor:\n\t\t\t\tblendFactor = GPUBlendFactor.OneMinusBlendColor;\n\t\t\t\tbreak;\n\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Blend factor not supported.', blend );\n\n\t\t}\n\n\t\treturn blendFactor;\n\n\t}\n\n\t_getBlendOperation( blendEquation ) {\n\n\t\tlet blendOperation;\n\n\t\tswitch ( blendEquation ) {\n\n\t\t\tcase AddEquation:\n\t\t\t\tblendOperation = GPUBlendOperation.Add;\n\t\t\t\tbreak;\n\n\t\t\tcase SubtractEquation:\n\t\t\t\tblendOperation = GPUBlendOperation.Subtract;\n\t\t\t\tbreak;\n\n\t\t\tcase ReverseSubtractEquation:\n\t\t\t\tblendOperation = GPUBlendOperation.ReverseSubtract;\n\t\t\t\tbreak;\n\n\t\t\tcase MinEquation:\n\t\t\t\tblendOperation = GPUBlendOperation.Min;\n\t\t\t\tbreak;\n\n\t\t\tcase MaxEquation:\n\t\t\t\tblendOperation = GPUBlendOperation.Max;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Blend equation not supported.', blendEquation );\n\n\t\t}\n\n\t\treturn blendOperation;\n\n\t}\n\n\t_getColorBlend( material ) {\n\n\t\tconst blending = material.blending;\n\t\tconst premultipliedAlpha = material.premultipliedAlpha;\n\n\t\tconst colorBlend = {\n\t\t\tsrcFactor: null,\n\t\t\tdstFactor: null,\n\t\t\toperation: null\n\t\t};\n\n\t\tswitch ( blending ) {\n\n\t\t\tcase NormalBlending:\n\t\t\t\tcolorBlend.srcFactor = ( premultipliedAlpha === true ) ? GPUBlendFactor.One : GPUBlendFactor.SrcAlpha;\n\t\t\t\tcolorBlend.dstFactor = GPUBlendFactor.OneMinusSrcAlpha;\n\t\t\t\tcolorBlend.operation = GPUBlendOperation.Add;\n\t\t\t\tbreak;\n\n\t\t\tcase AdditiveBlending:\n\t\t\t\tcolorBlend.srcFactor = ( premultipliedAlpha === true ) ? GPUBlendFactor.One : GPUBlendFactor.SrcAlpha;\n\t\t\t\tcolorBlend.dstFactor = GPUBlendFactor.One;\n\t\t\t\tcolorBlend.operation = GPUBlendOperation.Add;\n\t\t\t\tbreak;\n\n\t\t\tcase SubtractiveBlending:\n\t\t\t\tcolorBlend.srcFactor = GPUBlendFactor.Zero;\n\t\t\t\tcolorBlend.dstFactor = ( premultipliedAlpha === true ) ? GPUBlendFactor.Zero : GPUBlendFactor.OneMinusSrcColor;\n\t\t\t\tcolorBlend.operation = GPUBlendOperation.Add;\n\t\t\t\tbreak;\n\n\t\t\tcase MultiplyBlending:\n\t\t\t\tcolorBlend.srcFactor = GPUBlendFactor.Zero;\n\t\t\t\tcolorBlend.dstFactor = GPUBlendFactor.SrcColor;\n\t\t\t\tcolorBlend.operation = GPUBlendOperation.Add;\n\t\t\t\tbreak;\n\n\t\t\tcase CustomBlending:\n\t\t\t\tcolorBlend.srcFactor = this._getBlendFactor( material.blendSrc );\n\t\t\t\tcolorBlend.dstFactor = this._getBlendFactor( material.blendDst );\n\t\t\t\tcolorBlend.operation = this._getBlendOperation( material.blendEquation );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Blending not supported.', blending );\n\n\t\t}\n\n\t\treturn colorBlend;\n\n\t}\n\n\t_getColorWriteMask( material ) {\n\n\t\treturn ( material.colorWrite === true ) ? GPUColorWriteFlags.All : GPUColorWriteFlags.None;\n\n\t}\n\n\t_getDepthCompare( material ) {\n\n\t\tlet depthCompare;\n\n\t\tif ( material.depthTest === false ) {\n\n\t\t\tdepthCompare = GPUCompareFunction.Always;\n\n\t\t} else {\n\n\t\t\tconst depthFunc = material.depthFunc;\n\n\t\t\tswitch ( depthFunc ) {\n\n\t\t\t\tcase NeverDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.Never;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase AlwaysDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.Always;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase LessDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.Less;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase LessEqualDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.LessEqual;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase EqualDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.Equal;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GreaterEqualDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.GreaterEqual;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GreaterDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.Greater;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase NotEqualDepth:\n\t\t\t\t\tdepthCompare = GPUCompareFunction.NotEqual;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Invalid depth function.', depthFunc );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn depthCompare;\n\n\t}\n\n\t_getPrimitiveState( object, geometry, material ) {\n\n\t\tconst descriptor = {};\n\n\t\tdescriptor.topology = this._utils.getPrimitiveTopology( object, material );\n\n\t\tif ( object.isLine === true && object.isLineSegments !== true ) {\n\n\t\t\tconst count = ( geometry.index ) ? geometry.index.count : geometry.attributes.position.count;\n\t\t\tdescriptor.stripIndexFormat = ( count > 65535 ) ? GPUIndexFormat.Uint32 : GPUIndexFormat.Uint16; // define data type for primitive restart value\n\n\t\t}\n\n\t\tswitch ( material.side ) {\n\n\t\t\tcase FrontSide:\n\t\t\t\tdescriptor.frontFace = GPUFrontFace.CW;\n\t\t\t\tdescriptor.cullMode = GPUCullMode.Front;\n\t\t\t\tbreak;\n\n\t\t\tcase BackSide:\n\t\t\t\tdescriptor.frontFace = GPUFrontFace.CW;\n\t\t\t\tdescriptor.cullMode = GPUCullMode.Back;\n\t\t\t\tbreak;\n\n\t\t\tcase DoubleSide:\n\t\t\t\tdescriptor.frontFace = GPUFrontFace.CW;\n\t\t\t\tdescriptor.cullMode = GPUCullMode.None;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Unknown Material.side value.', material.side );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn descriptor;\n\n\t}\n\n\t_getStencilCompare( material ) {\n\n\t\tlet stencilCompare;\n\n\t\tconst stencilFunc = material.stencilFunc;\n\n\t\tswitch ( stencilFunc ) {\n\n\t\t\tcase NeverStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.Never;\n\t\t\t\tbreak;\n\n\t\t\tcase AlwaysStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.Always;\n\t\t\t\tbreak;\n\n\t\t\tcase LessStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.Less;\n\t\t\t\tbreak;\n\n\t\t\tcase LessEqualStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.LessEqual;\n\t\t\t\tbreak;\n\n\t\t\tcase EqualStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.Equal;\n\t\t\t\tbreak;\n\n\t\t\tcase GreaterEqualStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.GreaterEqual;\n\t\t\t\tbreak;\n\n\t\t\tcase GreaterStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.Greater;\n\t\t\t\tbreak;\n\n\t\t\tcase NotEqualStencilFunc:\n\t\t\t\tstencilCompare = GPUCompareFunction.NotEqual;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Invalid stencil function.', stencilFunc );\n\n\t\t}\n\n\t\treturn stencilCompare;\n\n\t}\n\n\t_getStencilOperation( op ) {\n\n\t\tlet stencilOperation;\n\n\t\tswitch ( op ) {\n\n\t\t\tcase KeepStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.Keep;\n\t\t\t\tbreak;\n\n\t\t\tcase ZeroStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.Zero;\n\t\t\t\tbreak;\n\n\t\t\tcase ReplaceStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.Replace;\n\t\t\t\tbreak;\n\n\t\t\tcase InvertStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.Invert;\n\t\t\t\tbreak;\n\n\t\t\tcase IncrementStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.IncrementClamp;\n\t\t\t\tbreak;\n\n\t\t\tcase DecrementStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.DecrementClamp;\n\t\t\t\tbreak;\n\n\t\t\tcase IncrementWrapStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.IncrementWrap;\n\t\t\t\tbreak;\n\n\t\t\tcase DecrementWrapStencilOp:\n\t\t\t\tstencilOperation = GPUStencilOperation.DecrementWrap;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Invalid stencil operation.', stencilOperation );\n\n\t\t}\n\n\t\treturn stencilOperation;\n\n\t}\n\n\t_getVertexFormat( geometryAttribute ) {\n\n\t\tconst { itemSize, normalized } = geometryAttribute;\n\t\tconst ArrayType = geometryAttribute.array.constructor;\n\t\tconst AttributeType = geometryAttribute.constructor;\n\n\t\tlet format;\n\n\t\tif ( itemSize == 1 ) {\n\n\t\t\tformat = typeArraysToVertexFormatPrefixForItemSize1.get( ArrayType );\n\n\t\t} else {\n\n\t\t\tconst prefixOptions = typedAttributeToVertexFormatPrefix.get( AttributeType ) || typedArraysToVertexFormatPrefix.get( ArrayType );\n\t\t\tconst prefix = prefixOptions[ normalized ? 1 : 0 ];\n\n\t\t\tif ( prefix ) {\n\n\t\t\t\tconst bytesPerUnit = ArrayType.BYTES_PER_ELEMENT * itemSize;\n\t\t\t\tconst paddedBytesPerUnit = Math.floor( ( bytesPerUnit + 3 ) / 4 ) * 4;\n\t\t\t\tconst paddedItemSize = paddedBytesPerUnit / ArrayType.BYTES_PER_ELEMENT;\n\n\t\t\t\tif ( paddedItemSize % 1 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.WebGPURenderer: Bad vertex format item size.' );\n\n\t\t\t\t}\n\n\t\t\t\tformat = `${prefix}x${paddedItemSize}`;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ! format ) {\n\n\t\t\tconsole.error( 'THREE.WebGPURenderer: Vertex format not supported yet.' );\n\n\t\t}\n\n\t\treturn format;\n\n\t}\n\n\t_getShaderAttributes( nodeBuilder, geometry ) {\n\n\t\tconst nodeAttributes = nodeBuilder.attributes;\n\t\tconst attributes = [];\n\n\t\tfor ( let slot = 0; slot < nodeAttributes.length; slot ++ ) {\n\n\t\t\tconst nodeAttribute = nodeAttributes[ slot ];\n\t\t\tconst name = nodeAttribute.name;\n\n\t\t\tconst geometryAttribute = geometry.getAttribute( name );\n\t\t\tconst bytesPerElement = geometryAttribute.array.BYTES_PER_ELEMENT;\n\n\t\t\tconst format = this._getVertexFormat( geometryAttribute );\n\n\t\t\tlet arrayStride = geometryAttribute.itemSize * bytesPerElement;\n\t\t\tlet offset = 0;\n\n\t\t\tif ( geometryAttribute.isInterleavedBufferAttribute === true ) {\n\n\t\t\t\t// @TODO: It can be optimized for \"vertexBuffers\" on RenderPipeline\n\n\t\t\t\tarrayStride = geometryAttribute.data.stride * bytesPerElement;\n\t\t\t\toffset = geometryAttribute.offset * bytesPerElement;\n\n\t\t\t}\n\n\t\t\tattributes.push( {\n\t\t\t\tname,\n\t\t\t\tarrayStride,\n\t\t\t\toffset,\n\t\t\t\tformat,\n\t\t\t\tslot\n\t\t\t} );\n\n\t\t}\n\n\t\treturn attributes;\n\n\t}\n\n}\n\nexport default WebGPURenderPipeline;\n","let _id = 0;\n\nclass WebGPUProgrammableStage {\n\n\tconstructor( device, code, type ) {\n\n\t\tthis.id = _id ++;\n\n\t\tthis.code = code;\n\t\tthis.type = type;\n\t\tthis.usedTimes = 0;\n\n\t\tthis.stage = {\n\t\t\tmodule: device.createShaderModule( { code, label: type } ),\n\t\t\tentryPoint: 'main'\n\t\t};\n\n\t}\n\n}\n\nexport default WebGPUProgrammableStage;\n","import WebGPURenderPipeline from './WebGPURenderPipeline.js';\nimport WebGPUProgrammableStage from './WebGPUProgrammableStage.js';\n\nclass WebGPURenderPipelines {\n\n\tconstructor( device, nodes, utils ) {\n\n\t\tthis.device = device;\n\t\tthis.nodes = nodes;\n\t\tthis.utils = utils;\n\n\t\tthis.bindings = null;\n\n\t\tthis.pipelines = [];\n\t\tthis.cache = new WeakMap();\n\n\t\tthis.stages = {\n\t\t\tvertex: new Map(),\n\t\t\tfragment: new Map()\n\t\t};\n\n\t}\n\n\tget( renderObject ) {\n\n\t\tconst device = this.device;\n\t\tconst cache = this._getCache( renderObject );\n\n\t\tlet currentPipeline = cache.currentPipeline;\n\n\t\tif ( this._needsUpdate( renderObject ) ) {\n\n\t\t\t// release previous cache\n\n\t\t\tthis._releasePipeline( renderObject );\n\n\t\t\t// get shader\n\n\t\t\tconst nodeBuilder = this.nodes.get( renderObject );\n\n\t\t\t// programmable stages\n\n\t\t\tlet stageVertex = this.stages.vertex.get( nodeBuilder.vertexShader );\n\n\t\t\tif ( stageVertex === undefined ) {\n\n\t\t\t\tstageVertex = new WebGPUProgrammableStage( device, nodeBuilder.vertexShader, 'vertex' );\n\t\t\t\tthis.stages.vertex.set( nodeBuilder.vertexShader, stageVertex );\n\n\t\t\t}\n\n\t\t\tlet stageFragment = this.stages.fragment.get( nodeBuilder.fragmentShader );\n\n\t\t\tif ( stageFragment === undefined ) {\n\n\t\t\t\tstageFragment = new WebGPUProgrammableStage( device, nodeBuilder.fragmentShader, 'fragment' );\n\t\t\t\tthis.stages.fragment.set( nodeBuilder.fragmentShader, stageFragment );\n\n\t\t\t}\n\n\t\t\t// determine render pipeline\n\n\t\t\tcurrentPipeline = this._acquirePipeline( stageVertex, stageFragment, renderObject );\n\t\t\tcache.currentPipeline = currentPipeline;\n\n\t\t\t// keep track of all used times\n\n\t\t\tcurrentPipeline.usedTimes ++;\n\t\t\tstageVertex.usedTimes ++;\n\t\t\tstageFragment.usedTimes ++;\n\n\t\t}\n\n\t\treturn currentPipeline;\n\n\t}\n\n\tremove( renderObject ) {\n\n\t\tthis._releasePipeline( renderObject );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.pipelines = [];\n\t\tthis.cache = new WeakMap();\n\t\tthis.shaderModules = {\n\t\t\tvertex: new Map(),\n\t\t\tfragment: new Map()\n\t\t};\n\n\t}\n\n\t_acquirePipeline( stageVertex, stageFragment, renderObject ) {\n\n\t\tlet pipeline;\n\t\tconst pipelines = this.pipelines;\n\n\t\t// check for existing pipeline\n\n\t\tconst cacheKey = this._computeCacheKey( stageVertex, stageFragment, renderObject );\n\n\t\tfor ( let i = 0, il = pipelines.length; i < il; i ++ ) {\n\n\t\t\tconst preexistingPipeline = pipelines[ i ];\n\n\t\t\tif ( preexistingPipeline.cacheKey === cacheKey ) {\n\n\t\t\t\tpipeline = preexistingPipeline;\n\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( pipeline === undefined ) {\n\n\t\t\tpipeline = new WebGPURenderPipeline( this.device, this.utils );\n\t\t\tpipeline.init( cacheKey, stageVertex, stageFragment, renderObject, this.nodes.get( renderObject ) );\n\n\t\t\tpipelines.push( pipeline );\n\n\t\t}\n\n\t\treturn pipeline;\n\n\t}\n\n\t_computeCacheKey( stageVertex, stageFragment, renderObject ) {\n\n\t\tconst { object, material } = renderObject;\n\t\tconst utils = this.utils;\n\n\t\tconst parameters = [\n\t\t\tstageVertex.id, stageFragment.id,\n\t\t\tmaterial.transparent, material.blending, material.premultipliedAlpha,\n\t\t\tmaterial.blendSrc, material.blendDst, material.blendEquation,\n\t\t\tmaterial.blendSrcAlpha, material.blendDstAlpha, material.blendEquationAlpha,\n\t\t\tmaterial.colorWrite,\n\t\t\tmaterial.depthWrite, material.depthTest, material.depthFunc,\n\t\t\tmaterial.stencilWrite, material.stencilFunc,\n\t\t\tmaterial.stencilFail, material.stencilZFail, material.stencilZPass,\n\t\t\tmaterial.stencilFuncMask, material.stencilWriteMask,\n\t\t\tmaterial.side,\n\t\t\tutils.getSampleCount(),\n\t\t\tutils.getCurrentColorSpace(), utils.getCurrentColorFormat(), utils.getCurrentDepthStencilFormat(),\n\t\t\tutils.getPrimitiveTopology( object, material )\n\t\t];\n\n\t\treturn parameters.join();\n\n\t}\n\n\t_getCache( renderObject ) {\n\n\t\tlet cache = this.cache.get( renderObject );\n\n\t\tif ( cache === undefined ) {\n\n\t\t\tcache = {};\n\t\t\tthis.cache.set( renderObject, cache );\n\n\t\t}\n\n\t\treturn cache;\n\n\t}\n\n\t_releasePipeline( renderObject ) {\n\n\t\tconst cache = this._getCache( renderObject );\n\n\t\tconst pipeline = cache.currentPipeline;\n\t\tdelete cache.currentPipeline;\n\n\t\tthis.bindings.remove( renderObject );\n\n\t\tif ( pipeline && -- pipeline.usedTimes === 0 ) {\n\n\t\t\tconst pipelines = this.pipelines;\n\n\t\t\tconst i = pipelines.indexOf( pipeline );\n\t\t\tpipelines[ i ] = pipelines[ pipelines.length - 1 ];\n\t\t\tpipelines.pop();\n\n\t\t\tthis._releaseStage( pipeline.stageVertex );\n\t\t\tthis._releaseStage( pipeline.stageFragment );\n\n\t\t}\n\n\t}\n\n\t_releaseStage( stage ) {\n\n\t\tif ( -- stage.usedTimes === 0 ) {\n\n\t\t\tconst code = stage.code;\n\t\t\tconst type = stage.type;\n\n\t\t\tthis.stages[ type ].delete( code );\n\n\t\t}\n\n\t}\n\n\t_needsUpdate( renderObject ) {\n\n\t\tconst cache = this._getCache( renderObject );\n\t\tconst material = renderObject.material;\n\n\t\tlet needsUpdate = false;\n\n\t\t// check pipeline state\n\n\t\tif ( cache.currentPipeline === undefined ) needsUpdate = true;\n\n\t\t// check material state\n\n\t\tif ( cache.material !== material || cache.materialVersion !== material.version ||\n\t\t\tcache.transparent !== material.transparent || cache.blending !== material.blending || cache.premultipliedAlpha !== material.premultipliedAlpha ||\n\t\t\tcache.blendSrc !== material.blendSrc || cache.blendDst !== material.blendDst || cache.blendEquation !== material.blendEquation ||\n\t\t\tcache.blendSrcAlpha !== material.blendSrcAlpha || cache.blendDstAlpha !== material.blendDstAlpha || cache.blendEquationAlpha !== material.blendEquationAlpha ||\n\t\t\tcache.colorWrite !== material.colorWrite ||\n\t\t\tcache.depthWrite !== material.depthWrite || cache.depthTest !== material.depthTest || cache.depthFunc !== material.depthFunc ||\n\t\t\tcache.stencilWrite !== material.stencilWrite || cache.stencilFunc !== material.stencilFunc ||\n\t\t\tcache.stencilFail !== material.stencilFail || cache.stencilZFail !== material.stencilZFail || cache.stencilZPass !== material.stencilZPass ||\n\t\t\tcache.stencilFuncMask !== material.stencilFuncMask || cache.stencilWriteMask !== material.stencilWriteMask ||\n\t\t\tcache.side !== material.side\n\t\t) {\n\n\t\t\tcache.material = material; cache.materialVersion = material.version;\n\t\t\tcache.transparent = material.transparent; cache.blending = material.blending; cache.premultipliedAlpha = material.premultipliedAlpha;\n\t\t\tcache.blendSrc = material.blendSrc; cache.blendDst = material.blendDst; cache.blendEquation = material.blendEquation;\n\t\t\tcache.blendSrcAlpha = material.blendSrcAlpha; cache.blendDstAlpha = material.blendDstAlpha; cache.blendEquationAlpha = material.blendEquationAlpha;\n\t\t\tcache.colorWrite = material.colorWrite;\n\t\t\tcache.depthWrite = material.depthWrite; cache.depthTest = material.depthTest; cache.depthFunc = material.depthFunc;\n\t\t\tcache.stencilWrite = material.stencilWrite; cache.stencilFunc = material.stencilFunc;\n\t\t\tcache.stencilFail = material.stencilFail; cache.stencilZFail = material.stencilZFail; cache.stencilZPass = material.stencilZPass;\n\t\t\tcache.stencilFuncMask = material.stencilFuncMask; cache.stencilWriteMask = material.stencilWriteMask;\n\t\t\tcache.side = material.side;\n\n\t\t\tneedsUpdate = true;\n\n\t\t}\n\n\t\t// check renderer state\n\n\t\tconst utils = this.utils;\n\n\t\tconst sampleCount = utils.getSampleCount();\n\t\tconst colorSpace = utils.getCurrentColorSpace();\n\t\tconst colorFormat = utils.getCurrentColorFormat();\n\t\tconst depthStencilFormat = utils.getCurrentDepthStencilFormat();\n\n\t\tif ( cache.sampleCount !== sampleCount || cache.colorSpace !== colorSpace ||\n\t\t\tcache.colorFormat !== colorFormat || cache.depthStencilFormat !== depthStencilFormat ) {\n\n\t\t\tcache.sampleCount = sampleCount;\n\t\t\tcache.colorSpace = colorSpace;\n\t\t\tcache.colorFormat = colorFormat;\n\t\t\tcache.depthStencilFormat = depthStencilFormat;\n\n\t\t\tneedsUpdate = true;\n\n\t\t}\n\n\t\treturn needsUpdate;\n\n\t}\n\n}\n\nexport default WebGPURenderPipelines;\n","import WebGPUProgrammableStage from './WebGPUProgrammableStage.js';\n\nclass WebGPUComputePipelines {\n\n\tconstructor( device, nodes ) {\n\n\t\tthis.device = device;\n\t\tthis.nodes = nodes;\n\n\t\tthis.pipelines = new WeakMap();\n\t\tthis.stages = {\n\t\t\tcompute: new WeakMap()\n\t\t};\n\n\t}\n\n\thas( computeNode ) {\n\n\t\treturn this.pipelines.get( computeNode ) !== undefined;\n\n\t}\n\n\tget( computeNode ) {\n\n\t\tlet pipeline = this.pipelines.get( computeNode );\n\n\t\t// @TODO: Reuse compute pipeline if possible, introduce WebGPUComputePipeline\n\n\t\tif ( pipeline === undefined ) {\n\n\t\t\tconst device = this.device;\n\n\t\t\t// get shader\n\n\t\t\tconst nodeBuilder = this.nodes.getForCompute( computeNode );\n\t\t\tconst computeShader = nodeBuilder.computeShader;\n\n\t\t\tconst shader = {\n\t\t\t\tcomputeShader\n\t\t\t};\n\n\t\t\t// programmable stage\n\n\t\t\tlet stageCompute = this.stages.compute.get( shader );\n\n\t\t\tif ( stageCompute === undefined ) {\n\n \t\t\t\tstageCompute = new WebGPUProgrammableStage( device, computeShader, 'compute' );\n\n\t\t\t\tthis.stages.compute.set( shader, stageCompute );\n\n\t\t\t}\n\n\t\t\tpipeline = device.createComputePipeline( {\n\t\t\t\tcompute: stageCompute.stage,\n\t\t\t\tlayout: 'auto'\n\t\t\t} );\n\n\t\t\tthis.pipelines.set( computeNode, pipeline );\n\n\t\t}\n\n\t\treturn pipeline;\n\n\t}\n\n\tdispose() {\n\n\t\tthis.pipelines = new WeakMap();\n\t\tthis.stages = {\n\t\t\tcompute: new WeakMap()\n\t\t};\n\n\t}\n\n}\n\nexport default WebGPUComputePipelines;\n","class WebGPUBindings {\n\n\tconstructor( device, info, properties, textures, renderPipelines, computePipelines, attributes, nodes ) {\n\n\t\tthis.device = device;\n\t\tthis.info = info;\n\t\tthis.properties = properties;\n\t\tthis.textures = textures;\n\t\tthis.renderPipelines = renderPipelines;\n\t\tthis.computePipelines = computePipelines;\n\t\tthis.attributes = attributes;\n\t\tthis.nodes = nodes;\n\n\t\tthis.uniformsData = new WeakMap();\n\n\t\tthis.updateMap = new WeakMap();\n\n\t}\n\n\tget( renderObject ) {\n\n\t\tlet data = this.uniformsData.get( renderObject );\n\n\t\tif ( data === undefined ) {\n\n\t\t\t// each object defines an array of bindings (ubos, textures, samplers etc.)\n\n\t\t\tconst nodeBuilder = this.nodes.get( renderObject );\n\t\t\tconst bindings = nodeBuilder.getBindings();\n\n\t\t\t// setup (static) binding layout and (dynamic) binding group\n\n\t\t\tconst pipeline = this.renderPipelines.get( renderObject ).pipeline;\n\n\t\t\tconst bindLayout = pipeline.getBindGroupLayout( 0 );\n\t\t\tconst bindGroup = this._createBindGroup( bindings, bindLayout );\n\n\t\t\tdata = {\n\t\t\t\tlayout: bindLayout,\n\t\t\t\tgroup: bindGroup,\n\t\t\t\tbindings: bindings\n\t\t\t};\n\n\t\t\tthis.uniformsData.set( renderObject, data );\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n\tgetForCompute( computeNode ) {\n\n\t\tlet data = this.uniformsData.get( computeNode );\n\n\t\tif ( data === undefined ) {\n\n\t\t\t// each object defines an array of bindings (ubos, textures, samplers etc.)\n\n\t\t\tconst nodeBuilder = this.nodes.getForCompute( computeNode );\n\t\t\tconst bindings = nodeBuilder.getBindings();\n\n\t\t\t// setup (static) binding layout and (dynamic) binding group\n\n\t\t\tconst pipeline = this.computePipelines.get( computeNode );\n\n\t\t\tconst bindLayout = pipeline.getBindGroupLayout( 0 );\n\t\t\tconst bindGroup = this._createBindGroup( bindings, bindLayout );\n\n\t\t\tdata = {\n\t\t\t\tlayout: bindLayout,\n\t\t\t\tgroup: bindGroup,\n\t\t\t\tbindings: bindings\n\t\t\t};\n\n\t\t\tthis.uniformsData.set( computeNode, data );\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n\tremove( object ) {\n\n\t\tthis.uniformsData.delete( object );\n\n\t}\n\n\tupdate( object ) {\n\n\t\tconst textures = this.textures;\n\n\t\tconst data = this.get( object );\n\t\tconst bindings = data.bindings;\n\n\t\tconst updateMap = this.updateMap;\n\t\tconst frame = this.info.render.frame;\n\n\t\tlet needsBindGroupRefresh = false;\n\n\t\t// iterate over all bindings and check if buffer updates or a new binding group is required\n\n\t\tfor ( const binding of bindings ) {\n\n\t\t\tconst isShared = binding.isShared;\n\t\t\tconst isUpdated = updateMap.get( binding ) === frame;\n\n\t\t\tif ( isShared && isUpdated ) continue;\n\n\t\t\tif ( binding.isUniformBuffer ) {\n\n\t\t\t\tconst buffer = binding.getBuffer();\n\t\t\t\tconst needsBufferWrite = binding.update();\n\n\t\t\t\tif ( needsBufferWrite === true ) {\n\n\t\t\t\t\tconst bufferGPU = binding.bufferGPU;\n\n\t\t\t\t\tthis.device.queue.writeBuffer( bufferGPU, 0, buffer, 0 );\n\n\t\t\t\t}\n\n\t\t\t} else if ( binding.isStorageBuffer ) {\n\n\t\t\t\tconst attribute = binding.attribute;\n\n\t\t\t\tthis.attributes.update( attribute, false, binding.usage );\n\n\t\t\t} else if ( binding.isSampler ) {\n\n\t\t\t\tconst texture = binding.getTexture();\n\n\t\t\t\ttextures.updateSampler( texture );\n\n\t\t\t\tconst samplerGPU = textures.getSampler( texture );\n\n\t\t\t\tif ( binding.samplerGPU !== samplerGPU ) {\n\n\t\t\t\t\tbinding.samplerGPU = samplerGPU;\n\t\t\t\t\tneedsBindGroupRefresh = true;\n\n\t\t\t\t}\n\n\t\t\t} else if ( binding.isSampledTexture ) {\n\n\t\t\t\tconst texture = binding.getTexture();\n\n\t\t\t\tconst needsTextureRefresh = textures.updateTexture( texture );\n\n\t\t\t\tconst textureGPU = textures.getTextureGPU( texture );\n\n\t\t\t\tif ( textureGPU !== undefined && binding.textureGPU !== textureGPU || needsTextureRefresh === true ) {\n\n\t\t\t\t\tbinding.textureGPU = textureGPU;\n\t\t\t\t\tneedsBindGroupRefresh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tupdateMap.set( binding, frame );\n\n\t\t}\n\n\t\tif ( needsBindGroupRefresh === true ) {\n\n\t\t\tdata.group = this._createBindGroup( bindings, data.layout );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.uniformsData = new WeakMap();\n\t\tthis.updateMap = new WeakMap();\n\n\t}\n\n\t_createBindGroup( bindings, layout ) {\n\n\t\tlet bindingPoint = 0;\n\t\tconst entries = [];\n\n\t\tfor ( const binding of bindings ) {\n\n\t\t\tif ( binding.isUniformBuffer ) {\n\n\t\t\t\tif ( binding.bufferGPU === null ) {\n\n\t\t\t\t\tconst byteLength = binding.getByteLength();\n\n\t\t\t\t\tbinding.bufferGPU = this.device.createBuffer( {\n\t\t\t\t\t\tlabel: 'bindingBuffer',\n\t\t\t\t\t\tsize: byteLength,\n\t\t\t\t\t\tusage: binding.usage\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tentries.push( { binding: bindingPoint, resource: { buffer: binding.bufferGPU } } );\n\n\t\t\t} else if ( binding.isStorageBuffer ) {\n\n\t\t\t\tif ( binding.bufferGPU === null ) {\n\n\t\t\t\t\tconst attribute = binding.attribute;\n\n\t\t\t\t\tthis.attributes.update( attribute, false, binding.usage );\n\t\t\t\t\tbinding.bufferGPU = this.attributes.get( attribute ).buffer;\n\n\t\t\t\t}\n\n\t\t\t\tentries.push( { binding: bindingPoint, resource: { buffer: binding.bufferGPU } } );\n\n\t\t\t} else if ( binding.isSampler ) {\n\n\t\t\t\tif ( binding.samplerGPU === null ) {\n\n\t\t\t\t\tbinding.samplerGPU = this.textures.getDefaultSampler();\n\n\t\t\t\t}\n\n\t\t\t\tentries.push( { binding: bindingPoint, resource: binding.samplerGPU } );\n\n\t\t\t} else if ( binding.isSampledTexture ) {\n\n\t\t\t\tif ( binding.textureGPU === null ) {\n\n\t\t\t\t\tif ( binding.isSampledCubeTexture ) {\n\n\t\t\t\t\t\tbinding.textureGPU = this.textures.getDefaultCubeTexture();\n\n\t\t\t\t\t} else if ( binding.texture.isVideoTexture ) {\n\n\t\t\t\t\t\tbinding.textureGPU = this.textures.getDefaultVideoTexture();\n\n\t\t\t\t\t} else if ( binding.texture.isDepthTexture ) {\n\n\t\t\t\t\t\tbinding.textureGPU = this.textures.getDefaultDepthTexture();\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tbinding.textureGPU = this.textures.getDefaultTexture();\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tconst resource = binding.textureGPU instanceof GPUTexture ? binding.textureGPU.createView( { aspect: binding.aspect, dimension: binding.dimension } ) : binding.textureGPU;\n\n\t\t\t\tentries.push( { binding: bindingPoint, resource } );\n\n\t\t\t}\n\n\t\t\tbindingPoint ++;\n\n\t\t}\n\n\t\treturn this.device.createBindGroup( {\n\t\t\tlayout,\n\t\t\tentries\n\t\t} );\n\n\t}\n\n}\n\nexport default WebGPUBindings;\n","export const NodeShaderStage = {\n\tVERTEX: 'vertex',\n\tFRAGMENT: 'fragment'\n};\n\nexport const NodeUpdateType = {\n\tNONE: 'none',\n\tFRAME: 'frame',\n\tRENDER: 'render',\n\tOBJECT: 'object'\n};\n\nexport const NodeType = {\n\tBOOLEAN: 'bool',\n\tINTEGER: 'int',\n\tFLOAT: 'float',\n\tVECTOR2: 'vec2',\n\tVECTOR3: 'vec3',\n\tVECTOR4: 'vec4',\n\tMATRIX3: 'mat3',\n\tMATRIX4: 'mat4'\n};\n\nexport const defaultShaderStages = [ 'fragment', 'vertex' ];\nexport const defaultBuildStages = [ 'construct', 'analyze', 'generate' ];\nexport const shaderStages = [ ...defaultShaderStages, 'compute' ];\nexport const vectorComponents = [ 'x', 'y', 'z', 'w' ];\n","import { Color, Matrix3, Matrix4, Vector2, Vector3, Vector4 } from 'three';\n\nexport function getCacheKey( object ) {\n\n\tlet cacheKey = '{';\n\n\tif ( object.isNode === true ) {\n\n\t\tcacheKey += `uuid:\"${ object.uuid }\"`;\n\n\t}\n\n\tfor ( const { property, index, childNode } of getNodeChildren( object ) ) {\n\n\t\t// @TODO: Think about implement NodeArray and NodeObject.\n\n\t\tlet childCacheKey = getCacheKey( childNode );\n\t\tif ( ! childCacheKey.includes( ',' ) ) childCacheKey = childCacheKey.slice( childCacheKey.indexOf( '\"' ), childCacheKey.indexOf( '}' ) );\n\t\tcacheKey += `,${ property }${ index !== undefined ? '/' + index : '' }:${ childCacheKey }`;\n\n\t}\n\n\tcacheKey += '}';\n\n\treturn cacheKey;\n\n}\n\nexport function* getNodeChildren( node, toJSON = false ) {\n\n\tfor ( const property in node ) {\n\n\t\t// Ignore private properties.\n\t\tif ( property.startsWith( '_' ) === true ) continue;\n\n\t\tconst object = node[ property ];\n\n\t\tif ( Array.isArray( object ) === true ) {\n\n\t\t\tfor ( let i = 0; i < object.length; i ++ ) {\n\n\t\t\t\tconst child = object[ i ];\n\n\t\t\t\tif ( child && ( child.isNode === true || toJSON && typeof child.toJSON === 'function' ) ) {\n\n\t\t\t\t\tyield { property, index: i, childNode: child };\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( object && object.isNode === true ) {\n\n\t\t\tyield { property, childNode: object };\n\n\t\t} else if ( typeof object === 'object' ) {\n\n\t\t\tfor ( const subProperty in object ) {\n\n\t\t\t\tconst child = object[ subProperty ];\n\n\t\t\t\tif ( child && ( child.isNode === true || toJSON && typeof child.toJSON === 'function' ) ) {\n\n\t\t\t\t\tyield { property, index: subProperty, childNode: child };\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nexport function getValueType( value ) {\n\n\tif ( value === undefined || value === null ) return null;\n\n\tconst typeOf = typeof value;\n\n\tif ( value.isNode === true ) {\n\n\t\treturn 'node';\n\n\t} else if ( typeOf === 'number' ) {\n\n\t\treturn 'float';\n\n\t} else if ( typeOf === 'boolean' ) {\n\n\t\treturn 'bool';\n\n\t} else if ( typeOf === 'string' ) {\n\n\t\treturn 'string';\n\n\t} else if ( value.isVector2 === true ) {\n\n\t\treturn 'vec2';\n\n\t} else if ( value.isVector3 === true ) {\n\n\t\treturn 'vec3';\n\n\t} else if ( value.isVector4 === true ) {\n\n\t\treturn 'vec4';\n\n\t} else if ( value.isMatrix3 === true ) {\n\n\t\treturn 'mat3';\n\n\t} else if ( value.isMatrix4 === true ) {\n\n\t\treturn 'mat4';\n\n\t} else if ( value.isColor === true ) {\n\n\t\treturn 'color';\n\n\t} else if ( value instanceof ArrayBuffer ) {\n\n\t\treturn 'ArrayBuffer';\n\n\t}\n\n\treturn null;\n\n}\n\nexport function getValueFromType( type, ...params ) {\n\n\tconst last4 = type ? type.slice( - 4 ) : undefined;\n\n\tif ( type === 'color' ) {\n\n\t\treturn new Color( ...params );\n\n\t} else if ( last4 === 'vec2' ) {\n\n\t\treturn new Vector2( ...params );\n\n\t} else if ( last4 === 'vec3' ) {\n\n\t\treturn new Vector3( ...params );\n\n\t} else if ( last4 === 'vec4' ) {\n\n\t\treturn new Vector4( ...params );\n\n\t} else if ( last4 === 'mat3' ) {\n\n\t\treturn new Matrix3( ...params );\n\n\t} else if ( last4 === 'mat4' ) {\n\n\t\treturn new Matrix4( ...params );\n\n\t} else if ( type === 'bool' ) {\n\n\t\treturn params[ 0 ] || false;\n\n\t} else if ( ( type === 'float' ) || ( type === 'int' ) || ( type === 'uint' ) ) {\n\n\t\treturn params[ 0 ] || 0;\n\n\t} else if ( type === 'string' ) {\n\n\t\treturn params[ 0 ] || '';\n\n\t} else if ( type === 'ArrayBuffer' ) {\n\n\t\treturn base64ToArrayBuffer( params[ 0 ] );\n\n\t}\n\n\treturn null;\n\n}\n\nexport function arrayBufferToBase64( arrayBuffer ) {\n\n\tlet chars = '';\n\n\tconst array = new Uint8Array( arrayBuffer );\n\n\tfor ( let i = 0; i < array.length; i ++ ) {\n\n\t\tchars += String.fromCharCode( array[ i ] );\n\n\t}\n\n\treturn btoa( chars );\n\n}\n\nexport function base64ToArrayBuffer( base64 ) {\n\n\treturn Uint8Array.from( atob( base64 ), c => c.charCodeAt( 0 ) ).buffer;\n\n}\n","import { NodeUpdateType } from './constants.js';\nimport { getNodeChildren, getCacheKey } from './NodeUtils.js';\nimport { MathUtils } from 'three';\n\nconst NodeClasses = new Map();\n\nlet _nodeId = 0;\n\nclass Node {\n\n\tconstructor( nodeType = null ) {\n\n\t\tthis.isNode = true;\n\n\t\tthis.nodeType = nodeType;\n\n\t\tthis.updateType = NodeUpdateType.NONE;\n\t\tthis.updateBeforeType = NodeUpdateType.NONE;\n\n\t\tthis.uuid = MathUtils.generateUUID();\n\n\t\tObject.defineProperty( this, 'id', { value: _nodeId ++ } );\n\n\t}\n\n\tget type() {\n\n\t\treturn this.constructor.name;\n\n\t}\n\n\tisGlobal( /*builder*/ ) {\n\n\t\treturn false;\n\n\t}\n\n\t* getChildren() {\n\n\t\tconst self = this;\n\n\t\tfor ( const { property, index, childNode } of getNodeChildren( this ) ) {\n\n\t\t\tif ( index !== undefined ) {\n\n\t\t\t\tyield { childNode, replaceNode( node ) {\n\n\t\t\t\t\tself[ property ][ index ] = node;\n\n\t\t\t\t} };\n\n\t\t\t} else {\n\n\t\t\t\tyield { childNode, replaceNode( node ) {\n\n\t\t\t\t\tself[ property ] = node;\n\n\t\t\t\t} };\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttraverse( callback, replaceNode = null ) {\n\n\t\tcallback( this, replaceNode );\n\n\t\tfor ( const { childNode, replaceNode } of this.getChildren() ) {\n\n\t\t\tchildNode.traverse( callback, replaceNode );\n\n\t\t}\n\n\t}\n\n\tgetCacheKey() {\n\n\t\treturn getCacheKey( this );\n\n\t}\n\n\tgetHash( /*builder*/ ) {\n\n\t\treturn this.uuid;\n\n\t}\n\n\tgetUpdateType() {\n\n\t\treturn this.updateType;\n\n\t}\n\n\tgetUpdateBeforeType() {\n\n\t\treturn this.updateBeforeType;\n\n\t}\n\n\tgetNodeType( /*builder*/ ) {\n\n\t\treturn this.nodeType;\n\n\t}\n\n\tgetReference( builder ) {\n\n\t\tconst hash = this.getHash( builder );\n\t\tconst nodeFromHash = builder.getNodeFromHash( hash );\n\n\t\treturn nodeFromHash || this;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst nodeProperties = builder.getNodeProperties( this );\n\n\t\tfor ( const { childNode } of this.getChildren() ) {\n\n\t\t\tnodeProperties[ '_node' + childNode.id ] = childNode;\n\n\t\t}\n\n\t\t// return a outputNode if exists\n\t\treturn null;\n\n\t}\n\n\tanalyze( builder ) {\n\n\t\tconst nodeData = builder.getDataFromNode( this );\n\t\tnodeData.dependenciesCount = nodeData.dependenciesCount === undefined ? 1 : nodeData.dependenciesCount + 1;\n\n\t\tif ( nodeData.dependenciesCount === 1 ) {\n\n\t\t\t// node flow children\n\n\t\t\tconst nodeProperties = builder.getNodeProperties( this );\n\n\t\t\tfor ( const childNode of Object.values( nodeProperties ) ) {\n\n\t\t\t\tif ( childNode && childNode.isNode === true ) {\n\n\t\t\t\t\tchildNode.build( builder );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst { outputNode } = builder.getNodeProperties( this );\n\n\t\tif ( outputNode && outputNode.isNode === true ) {\n\n\t\t\treturn outputNode.build( builder, output );\n\n\t\t}\n\n\t}\n\n\tupdateBefore( /*frame*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tupdate( /*frame*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tbuild( builder, output = null ) {\n\n\t\tconst refNode = this.getReference( builder );\n\n\t\tif ( this !== refNode ) {\n\n\t\t\treturn refNode.build( builder, output );\n\n\t\t}\n\n\t\tbuilder.addNode( this );\n\t\tbuilder.addChain( this );\n\n\t\t/* Build stages expected results:\n\t\t\t- \"construct\"\t-> Node\n\t\t\t- \"analyze\"\t\t-> null\n\t\t\t- \"generate\"\t-> String\n\t\t*/\n\t\tlet result = null;\n\n\t\tconst buildStage = builder.getBuildStage();\n\n\t\tif ( buildStage === 'construct' ) {\n\n\t\t\tconst properties = builder.getNodeProperties( this );\n\n\t\t\tif ( properties.initialized !== true || builder.context.tempRead === false ) {\n\n\t\t\t\tproperties.initialized = true;\n\t\t\t\tproperties.outputNode = this.construct( builder );\n\n\t\t\t\tfor ( const childNode of Object.values( properties ) ) {\n\n\t\t\t\t\tif ( childNode && childNode.isNode === true ) {\n\n\t\t\t\t\t\tchildNode.build( builder );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( buildStage === 'analyze' ) {\n\n\t\t\tthis.analyze( builder );\n\n\t\t} else if ( buildStage === 'generate' ) {\n\n\t\t\tconst isGenerateOnce = this.generate.length === 1;\n\n\t\t\tif ( isGenerateOnce ) {\n\n\t\t\t\tconst type = this.getNodeType( builder );\n\t\t\t\tconst nodeData = builder.getDataFromNode( this );\n\n\t\t\t\tresult = nodeData.snippet;\n\n\t\t\t\tif ( result === undefined /*|| builder.context.tempRead === false*/ ) {\n\n\t\t\t\t\tresult = this.generate( builder ) || '';\n\n\t\t\t\t\tnodeData.snippet = result;\n\n\t\t\t\t}\n\n\t\t\t\tresult = builder.format( result, type, output );\n\n\t\t\t} else {\n\n\t\t\t\tresult = this.generate( builder, output ) || '';\n\n\t\t\t}\n\n\t\t}\n\n\t\tbuilder.removeChain( this );\n\n\t\treturn result;\n\n\t}\n\n\tgetSerializeChildren() {\n\n\t\treturn getNodeChildren( this );\n\n\t}\n\n\tserialize( json ) {\n\n\t\tconst nodeChildren = this.getSerializeChildren();\n\n\t\tconst inputNodes = {};\n\n\t\tfor ( const { property, index, childNode } of nodeChildren ) {\n\n\t\t\tif ( index !== undefined ) {\n\n\t\t\t\tif ( inputNodes[ property ] === undefined ) {\n\n\t\t\t\t\tinputNodes[ property ] = Number.isInteger( index ) ? [] : {};\n\n\t\t\t\t}\n\n\t\t\t\tinputNodes[ property ][ index ] = childNode.toJSON( json.meta ).uuid;\n\n\t\t\t} else {\n\n\t\t\t\tinputNodes[ property ] = childNode.toJSON( json.meta ).uuid;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( Object.keys( inputNodes ).length > 0 ) {\n\n\t\t\tjson.inputNodes = inputNodes;\n\n\t\t}\n\n\t}\n\n\tdeserialize( json ) {\n\n\t\tif ( json.inputNodes !== undefined ) {\n\n\t\t\tconst nodes = json.meta.nodes;\n\n\t\t\tfor ( const property in json.inputNodes ) {\n\n\t\t\t\tif ( Array.isArray( json.inputNodes[ property ] ) ) {\n\n\t\t\t\t\tconst inputArray = [];\n\n\t\t\t\t\tfor ( const uuid of json.inputNodes[ property ] ) {\n\n\t\t\t\t\t\tinputArray.push( nodes[ uuid ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis[ property ] = inputArray;\n\n\t\t\t\t} else if ( typeof json.inputNodes[ property ] === 'object' ) {\n\n\t\t\t\t\tconst inputObject = {};\n\n\t\t\t\t\tfor ( const subProperty in json.inputNodes[ property ] ) {\n\n\t\t\t\t\t\tconst uuid = json.inputNodes[ property ][ subProperty ];\n\n\t\t\t\t\t\tinputObject[ subProperty ] = nodes[ uuid ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis[ property ] = inputObject;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconst uuid = json.inputNodes[ property ];\n\n\t\t\t\t\tthis[ property ] = nodes[ uuid ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttoJSON( meta ) {\n\n\t\tconst { uuid, type } = this;\n\t\tconst isRoot = ( meta === undefined || typeof meta === 'string' );\n\n\t\tif ( isRoot ) {\n\n\t\t\tmeta = {\n\t\t\t\ttextures: {},\n\t\t\t\timages: {},\n\t\t\t\tnodes: {}\n\t\t\t};\n\n\t\t}\n\n\t\t// serialize\n\n\t\tlet data = meta.nodes[ uuid ];\n\n\t\tif ( data === undefined ) {\n\n\t\t\tdata = {\n\t\t\t\tuuid,\n\t\t\t\ttype,\n\t\t\t\tmeta,\n\t\t\t\tmetadata: {\n\t\t\t\t\tversion: 4.5,\n\t\t\t\t\ttype: 'Node',\n\t\t\t\t\tgenerator: 'Node.toJSON'\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif ( isRoot !== true ) meta.nodes[ data.uuid ] = data;\n\n\t\t\tthis.serialize( data );\n\n\t\t\tdelete data.meta;\n\n\t\t}\n\n\t\t// TODO: Copied from Object3D.toJSON\n\n\t\tfunction extractFromCache( cache ) {\n\n\t\t\tconst values = [];\n\n\t\t\tfor ( const key in cache ) {\n\n\t\t\t\tconst data = cache[ key ];\n\t\t\t\tdelete data.metadata;\n\t\t\t\tvalues.push( data );\n\n\t\t\t}\n\n\t\t\treturn values;\n\n\t\t}\n\n\t\tif ( isRoot ) {\n\n\t\t\tconst textures = extractFromCache( meta.textures );\n\t\t\tconst images = extractFromCache( meta.images );\n\t\t\tconst nodes = extractFromCache( meta.nodes );\n\n\t\t\tif ( textures.length > 0 ) data.textures = textures;\n\t\t\tif ( images.length > 0 ) data.images = images;\n\t\t\tif ( nodes.length > 0 ) data.nodes = nodes;\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n}\n\nexport default Node;\n\nexport function addNodeClass( nodeClass ) {\n\n\tif ( typeof nodeClass !== 'function' || ! nodeClass.name ) throw new Error( `Node class ${ nodeClass.name } is not a class` );\n\tif ( NodeClasses.has( nodeClass.name ) ) throw new Error( `Redefinition of node class ${ nodeClass.name }` );\n\n\tNodeClasses.set( nodeClass.name, nodeClass );\n\n}\n\nexport function createNodeFromType( type ) {\n\n\tconst Class = NodeClasses.get( type );\n\n\tif ( Class !== undefined ) {\n\n\t\treturn new Class();\n\n\t}\n\n}\n","import Node, { addNodeClass } from './Node.js';\nimport { getValueType, getValueFromType, arrayBufferToBase64 } from './NodeUtils.js';\n\nclass InputNode extends Node {\n\n\tconstructor( value, nodeType = null ) {\n\n\t\tsuper( nodeType );\n\n\t\tthis.isInputNode = true;\n\n\t\tthis.value = value;\n\t\tthis.precision = null;\n\n\t}\n\n\tgetNodeType( /*builder*/ ) {\n\n\t\tif ( this.nodeType === null ) {\n\n\t\t\treturn getValueType( this.value );\n\n\t\t}\n\n\t\treturn this.nodeType;\n\n\t}\n\n\tgetInputType( builder ) {\n\n\t\treturn this.getNodeType( builder );\n\n\t}\n\n\tsetPrecision( precision ) {\n\n\t\tthis.precision = precision;\n\n\t\treturn this;\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.value = this.value;\n\n\t\tif ( this.value && this.value.toArray ) data.value = this.value.toArray();\n\n\t\tdata.valueType = getValueType( this.value );\n\t\tdata.nodeType = this.nodeType;\n\n\t\tif ( data.valueType === 'ArrayBuffer' ) data.value = arrayBufferToBase64( data.value );\n\n\t\tdata.precision = this.precision;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.nodeType = data.nodeType;\n\t\tthis.value = Array.isArray( data.value ) ? getValueFromType( data.valueType, ...data.value ) : data.value;\n\n\t\tthis.precision = data.precision || null;\n\n\t\tif ( this.value && this.value.fromArray ) this.value = this.value.fromArray( data.value );\n\n\t}\n\n\tgenerate( /*builder, output*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n}\n\nexport default InputNode;\n\naddNodeClass( InputNode );\n","import Node, { addNodeClass } from '../core/Node.js';\n\nclass ArrayElementNode extends Node { // @TODO: If extending from TempNode it breaks webgpu_compute\n\n\tconstructor( node, indexNode ) {\n\n\t\tsuper();\n\n\t\tthis.node = node;\n\t\tthis.indexNode = indexNode;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.node.getNodeType( builder );\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst nodeSnippet = this.node.build( builder );\n\t\tconst indexSnippet = this.indexNode.build( builder, 'uint' );\n\n\t\treturn `${nodeSnippet}[ ${indexSnippet} ]`;\n\n\t}\n\n}\n\nexport default ArrayElementNode;\n\naddNodeClass( ArrayElementNode );\n","import Node, { addNodeClass } from '../core/Node.js';\n\nclass ConvertNode extends Node {\n\n\tconstructor( node, convertTo ) {\n\n\t\tsuper();\n\n\t\tthis.node = node;\n\t\tthis.convertTo = convertTo;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst requestType = this.node.getNodeType( builder );\n\n\t\tlet convertTo = null;\n\n\t\tfor ( const overloadingType of this.convertTo.split( '|' ) ) {\n\n\t\t\tif ( convertTo === null || builder.getTypeLength( requestType ) === builder.getTypeLength( overloadingType ) ) {\n\n\t\t\t\tconvertTo = overloadingType;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn convertTo;\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.convertTo = this.convertTo;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.convertTo = data.convertTo;\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst node = this.node;\n\t\tconst type = this.getNodeType( builder );\n\n\t\tconst snippet = node.build( builder, type );\n\n\t\treturn builder.format( snippet, type, output );\n\n\t}\n\n}\n\nexport default ConvertNode;\n\naddNodeClass( ConvertNode );\n","import Node, { addNodeClass } from './Node.js';\n\nclass TempNode extends Node {\n\n\tconstructor( type ) {\n\n\t\tsuper( type );\n\n\t\tthis.isTempNode = true;\n\n\t}\n\n\thasDependencies( builder ) {\n\n\t\treturn builder.getDataFromNode( this ).dependenciesCount > 1;\n\n\t}\n\n\tbuild( builder, output ) {\n\n\t\tconst buildStage = builder.getBuildStage();\n\n\t\tif ( buildStage === 'generate' ) {\n\n\t\t\tconst type = builder.getVectorType( this.getNodeType( builder, output ) );\n\t\t\tconst nodeData = builder.getDataFromNode( this );\n\n\t\t\tif ( builder.context.tempRead !== false && nodeData.propertyName !== undefined ) {\n\n\t\t\t\treturn builder.format( nodeData.propertyName, type, output );\n\n\t\t\t} else if ( builder.context.tempWrite !== false && type !== 'void' && output !== 'void' && this.hasDependencies( builder ) ) {\n\n\t\t\t\tconst snippet = super.build( builder, type );\n\n\t\t\t\tconst nodeVar = builder.getVarFromNode( this, type );\n\t\t\t\tconst propertyName = builder.getPropertyName( nodeVar );\n\n\t\t\t\tbuilder.addLineFlowCode( `${propertyName} = ${snippet}` );\n\n\t\t\t\tnodeData.snippet = snippet;\n\t\t\t\tnodeData.propertyName = propertyName;\n\n\t\t\t\treturn builder.format( nodeData.propertyName, type, output );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn super.build( builder, output );\n\n\t}\n\n}\n\nexport default TempNode;\n\naddNodeClass( TempNode );\n","import { addNodeClass } from '../core/Node.js';\nimport TempNode from '../core/TempNode.js';\n\nclass JoinNode extends TempNode {\n\n\tconstructor( nodes = [], nodeType = null ) {\n\n\t\tsuper( nodeType );\n\n\t\tthis.nodes = nodes;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tif ( this.nodeType !== null ) {\n\n\t\t\treturn builder.getVectorType( this.nodeType );\n\n\t\t}\n\n\t\treturn builder.getTypeFromLength( this.nodes.reduce( ( count, cur ) => count + builder.getTypeLength( cur.getNodeType( builder ) ), 0 ) );\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst type = this.getNodeType( builder );\n\t\tconst nodes = this.nodes;\n\n\t\tconst snippetValues = [];\n\n\t\tfor ( const input of nodes ) {\n\n\t\t\tconst inputSnippet = input.build( builder );\n\n\t\t\tsnippetValues.push( inputSnippet );\n\n\t\t}\n\n\t\tconst snippet = `${ builder.getType( type ) }( ${ snippetValues.join( ', ' ) } )`;\n\n\t\treturn builder.format( snippet, type, output );\n\n\t}\n\n}\n\nexport default JoinNode;\n\naddNodeClass( JoinNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { vectorComponents } from '../core/constants.js';\n\nconst stringVectorComponents = vectorComponents.join( '' );\n\nclass SplitNode extends Node {\n\n\tconstructor( node, components = 'x' ) {\n\n\t\tsuper();\n\n\t\tthis.node = node;\n\t\tthis.components = components;\n\n\t}\n\n\tgetVectorLength() {\n\n\t\tlet vectorLength = this.components.length;\n\n\t\tfor ( const c of this.components ) {\n\n\t\t\tvectorLength = Math.max( vectorComponents.indexOf( c ) + 1, vectorLength );\n\n\t\t}\n\n\t\treturn vectorLength;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn builder.getTypeFromLength( this.components.length );\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst node = this.node;\n\t\tconst nodeTypeLength = builder.getTypeLength( node.getNodeType( builder ) );\n\n\t\tlet snippet = null;\n\n\t\tif ( nodeTypeLength > 1 ) {\n\n\t\t\tlet type = null;\n\n\t\t\tconst componentsLength = this.getVectorLength();\n\n\t\t\tif ( componentsLength >= nodeTypeLength ) {\n\n\t\t\t\t// needed expand the input node\n\n\t\t\t\ttype = builder.getTypeFromLength( this.getVectorLength() );\n\n\t\t\t}\n\n\t\t\tconst nodeSnippet = node.build( builder, type );\n\n\t\t\tif ( this.components.length === nodeTypeLength && this.components === stringVectorComponents.slice( 0, this.components.length ) ) {\n\n\t\t\t\t// unecessary swizzle\n\n\t\t\t\tsnippet = builder.format( nodeSnippet, type, output );\n\n\t\t\t} else {\n\n\t\t\t\tsnippet = builder.format( `${nodeSnippet}.${this.components}`, this.getNodeType( builder ), output );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// ignore .components if .node returns float/integer\n\n\t\t\tsnippet = node.build( builder, output );\n\n\t\t}\n\n\t\treturn snippet;\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.components = this.components;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.components = data.components;\n\n\t}\n\n}\n\nexport default SplitNode;\n\naddNodeClass( SplitNode );\n","import InputNode from './InputNode.js';\nimport { addNodeClass } from './Node.js';\n\nclass ConstNode extends InputNode {\n\n\tconstructor( value, nodeType = null ) {\n\n\t\tsuper( value, nodeType );\n\n\t\tthis.isConstNode = true;\n\n\t}\n\n\tgenerateConst( builder ) {\n\n\t\treturn builder.getConst( this.getNodeType( builder ), this.value );\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst type = this.getNodeType( builder );\n\n\t\treturn builder.format( this.generateConst( builder ), type, output );\n\n\t}\n\n}\n\nexport default ConstNode;\n\naddNodeClass( ConstNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport ArrayElementNode from '../utils/ArrayElementNode.js';\nimport ConvertNode from '../utils/ConvertNode.js';\nimport JoinNode from '../utils/JoinNode.js';\nimport SplitNode from '../utils/SplitNode.js';\nimport ConstNode from '../core/ConstNode.js';\nimport { getValueFromType, getValueType } from '../core/NodeUtils.js';\n\nconst NodeElements = new Map(); // @TODO: Currently only a few nodes are added, probably also add others\n\nexport function addNodeElement( name, nodeElement ) {\n\n\tif ( NodeElements.has( name ) ) throw new Error( `Redefinition of node element ${ name }` );\n\tif ( typeof nodeElement !== 'function' ) throw new Error( `Node element ${ name } is not a function` );\n\n\tNodeElements.set( name, nodeElement );\n\n}\n\nconst shaderNodeHandler = {\n\n\tconstruct( NodeClosure, params ) {\n\n\t\tconst inputs = params.shift();\n\n\t\treturn NodeClosure( nodeObjects( inputs ), ...params );\n\n\t},\n\n\tget: function ( node, prop, nodeObj ) {\n\n\t\tif ( typeof prop === 'string' && node[ prop ] === undefined ) {\n\n\t\t\tif ( NodeElements.has( prop ) ) {\n\n\t\t\t\tconst nodeElement = NodeElements.get( prop );\n\n\t\t\t\treturn ( ...params ) => nodeElement( nodeObj, ...params );\n\n\t\t\t} else if ( prop.endsWith( 'Assign' ) && NodeElements.has( prop.slice( 0, prop.length - 'Assign'.length ) ) ) {\n\n\t\t\t\tconst nodeElement = NodeElements.get( prop.slice( 0, prop.length - 'Assign'.length ) );\n\n\t\t\t\treturn ( ...params ) => nodeObj.assign( nodeElement( nodeObj, ...params ) );\n\n\t\t\t} else if ( /^[xyzwrgbastpq]{1,4}$/.test( prop ) === true ) {\n\n\t\t\t\t// accessing properties ( swizzle )\n\n\t\t\t\tprop = prop\n\t\t\t\t\t.replace( /r|s/g, 'x' )\n\t\t\t\t\t.replace( /g|t/g, 'y' )\n\t\t\t\t\t.replace( /b|p/g, 'z' )\n\t\t\t\t\t.replace( /a|q/g, 'w' );\n\n\t\t\t\treturn nodeObject( new SplitNode( node, prop ) );\n\n\t\t\t} else if ( prop === 'width' || prop === 'height' ) {\n\n\t\t\t\t// accessing property\n\n\t\t\t\treturn nodeObject( new SplitNode( node, prop === 'width' ? 'x' : 'y' ) );\n\n\t\t\t} else if ( /^\\d+$/.test( prop ) === true ) {\n\n\t\t\t\t// accessing array\n\n\t\t\t\treturn nodeObject( new ArrayElementNode( node, new ConstNode( Number( prop ), 'uint' ) ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn node[ prop ];\n\n\t}\n\n};\n\nconst nodeObjectsCacheMap = new WeakMap();\n\nconst ShaderNodeObject = function ( obj ) {\n\n\tconst type = getValueType( obj );\n\n\tif ( type === 'node' ) {\n\n\t\tlet nodeObject = nodeObjectsCacheMap.get( obj );\n\n\t\tif ( nodeObject === undefined ) {\n\n\t\t\tnodeObject = new Proxy( obj, shaderNodeHandler );\n\t\t\tnodeObjectsCacheMap.set( obj, nodeObject );\n\t\t\tnodeObjectsCacheMap.set( nodeObject, nodeObject );\n\n\t\t}\n\n\t\treturn nodeObject;\n\n\t} else if ( ( type === 'float' ) || ( type === 'boolean' ) ) {\n\n\t\treturn nodeObject( getAutoTypedConstNode( obj ) );\n\n\t} else if ( type && type !== 'string' ) {\n\n\t\treturn nodeObject( new ConstNode( obj ) );\n\n\t}\n\n\treturn obj;\n\n};\n\nconst ShaderNodeObjects = function ( objects ) {\n\n\tfor ( const name in objects ) {\n\n\t\tobjects[ name ] = nodeObject( objects[ name ] );\n\n\t}\n\n\treturn objects;\n\n};\n\nconst ShaderNodeArray = function ( array ) {\n\n\tconst len = array.length;\n\n\tfor ( let i = 0; i < len; i ++ ) {\n\n\t\tarray[ i ] = nodeObject( array[ i ] );\n\n\t}\n\n\treturn array;\n\n};\n\nconst ShaderNodeProxy = function ( NodeClass, scope = null, factor = null, settings = null ) {\n\n\tconst assignNode = ( node ) => nodeObject( settings !== null ? Object.assign( node, settings ) : node );\n\n\tif ( scope === null ) {\n\n\t\treturn ( ...params ) => {\n\n\t\t\treturn assignNode( new NodeClass( ...nodeArray( params ) ) );\n\n\t\t};\n\n\t} else if ( factor !== null ) {\n\n\t\tfactor = nodeObject( factor );\n\n\t\treturn ( ...params ) => {\n\n\t\t\treturn assignNode( new NodeClass( scope, ...nodeArray( params ), factor ) );\n\n\t\t};\n\n\t} else {\n\n\t\treturn ( ...params ) => {\n\n\t\t\treturn assignNode( new NodeClass( scope, ...nodeArray( params ) ) );\n\n\t\t};\n\n\t}\n\n};\n\nconst ShaderNodeImmutable = function ( NodeClass, ...params ) {\n\n\treturn nodeObject( new NodeClass( ...nodeArray( params ) ) );\n\n};\n\nclass ShaderNodeInternal extends Node {\n\n\tconstructor( jsFunc ) {\n\n\t\tsuper();\n\n\t\tthis._jsFunc = jsFunc;\n\n\t}\n\n\tcall( inputs, stack, builder ) {\n\n\t\tinputs = nodeObjects( inputs );\n\n\t\treturn nodeObject( this._jsFunc( inputs, stack, builder ) );\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst { outputNode } = builder.getNodeProperties( this );\n\n\t\treturn outputNode ? outputNode.getNodeType( builder ) : super.getNodeType( builder );\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tbuilder.addStack();\n\n\t\tbuilder.stack.outputNode = nodeObject( this._jsFunc( builder.stack, builder ) );\n\n\t\treturn builder.removeStack();\n\n\t}\n\n}\n\nconst bools = [ false, true ];\nconst uints = [ 0, 1, 2, 3 ];\nconst ints = [ - 1, - 2 ];\nconst floats = [ 0.5, 1.5, 1 / 3, 1e-6, 1e6, Math.PI, Math.PI * 2, 1 / Math.PI, 2 / Math.PI, 1 / ( Math.PI * 2 ), Math.PI / 2 ];\n\nconst boolsCacheMap = new Map();\nfor ( const bool of bools ) boolsCacheMap.set( bool, new ConstNode( bool ) );\n\nconst uintsCacheMap = new Map();\nfor ( const uint of uints ) uintsCacheMap.set( uint, new ConstNode( uint, 'uint' ) );\n\nconst intsCacheMap = new Map( [ ...uintsCacheMap ].map( el => new ConstNode( el.value, 'int' ) ) );\nfor ( const int of ints ) intsCacheMap.set( int, new ConstNode( int, 'int' ) );\n\nconst floatsCacheMap = new Map( [ ...intsCacheMap ].map( el => new ConstNode( el.value ) ) );\nfor ( const float of floats ) floatsCacheMap.set( float, new ConstNode( float ) );\nfor ( const float of floats ) floatsCacheMap.set( - float, new ConstNode( - float ) );\n\nconst cacheMaps = { bool: boolsCacheMap, uint: uintsCacheMap, ints: intsCacheMap, float: floatsCacheMap };\n\nconst constNodesCacheMap = new Map( [ ...boolsCacheMap, ...floatsCacheMap ] );\n\nconst getAutoTypedConstNode = ( value ) => {\n\n\tif ( constNodesCacheMap.has( value ) ) {\n\n\t\treturn constNodesCacheMap.get( value );\n\n\t} else if ( value.isNode === true ) {\n\n\t\treturn value;\n\n\t} else {\n\n\t\treturn new ConstNode( value );\n\n\t}\n\n};\n\nconst ConvertType = function ( type, cacheMap = null ) {\n\n\treturn ( ...params ) => {\n\n\t\tif ( params.length === 0 ) {\n\n\t\t\treturn nodeObject( new ConstNode( getValueFromType( type ), type ) );\n\n\t\t} else {\n\n\t\t\tif ( type === 'color' && params[ 0 ].isNode !== true ) {\n\n\t\t\t\tparams = [ getValueFromType( type, ...params ) ];\n\n\t\t\t}\n\n\t\t\tif ( params.length === 1 && cacheMap !== null && cacheMap.has( params[ 0 ] ) ) {\n\n\t\t\t\treturn cacheMap.get( params[ 0 ] );\n\n\t\t\t}\n\n\t\t\tconst nodes = params.map( getAutoTypedConstNode );\n\n\t\t\tif ( nodes.length === 1 ) {\n\n\t\t\t\treturn nodeObject( nodes[ 0 ].nodeType === type || getValueType( nodes[ 0 ].value ) === type ? nodes[ 0 ] : new ConvertNode( nodes[ 0 ], type ) );\n\n\t\t\t}\n\n\t\t\treturn nodeObject( new JoinNode( nodes, type ) );\n\n\t\t}\n\n\t};\n\n};\n\n// exports\n\n// utils\n\nexport const getConstNodeType = ( value ) => ( value !== undefined && value !== null ) ? ( value.nodeType || value.convertTo || ( typeof value === 'string' ? value : null ) ) : null;\n\n// shader node base\n\nexport function ShaderNode( jsFunc ) {\n\n\treturn new Proxy( new ShaderNodeInternal( jsFunc ), shaderNodeHandler );\n\n}\n\nexport const nodeObject = ( val ) => /* new */ ShaderNodeObject( val );\nexport const nodeObjects = ( val ) => new ShaderNodeObjects( val );\nexport const nodeArray = ( val ) => new ShaderNodeArray( val );\nexport const nodeProxy = ( ...val ) => new ShaderNodeProxy( ...val );\nexport const nodeImmutable = ( ...val ) => new ShaderNodeImmutable( ...val );\n\nexport const shader = ( ...val ) => new ShaderNode( ...val );\n\naddNodeClass( ShaderNode );\n\n// types\n// @TODO: Maybe export from ConstNode.js?\n\nexport const color = new ConvertType( 'color' );\n\nexport const float = new ConvertType( 'float', cacheMaps.float );\nexport const int = new ConvertType( 'int', cacheMaps.int );\nexport const uint = new ConvertType( 'uint', cacheMaps.uint );\nexport const bool = new ConvertType( 'bool', cacheMaps.bool );\n\nexport const vec2 = new ConvertType( 'vec2' );\nexport const ivec2 = new ConvertType( 'ivec2' );\nexport const uvec2 = new ConvertType( 'uvec2' );\nexport const bvec2 = new ConvertType( 'bvec2' );\n\nexport const vec3 = new ConvertType( 'vec3' );\nexport const ivec3 = new ConvertType( 'ivec3' );\nexport const uvec3 = new ConvertType( 'uvec3' );\nexport const bvec3 = new ConvertType( 'bvec3' );\n\nexport const vec4 = new ConvertType( 'vec4' );\nexport const ivec4 = new ConvertType( 'ivec4' );\nexport const uvec4 = new ConvertType( 'uvec4' );\nexport const bvec4 = new ConvertType( 'bvec4' );\n\nexport const mat3 = new ConvertType( 'mat3' );\nexport const imat3 = new ConvertType( 'imat3' );\nexport const umat3 = new ConvertType( 'umat3' );\nexport const bmat3 = new ConvertType( 'bmat3' );\n\nexport const mat4 = new ConvertType( 'mat4' );\nexport const imat4 = new ConvertType( 'imat4' );\nexport const umat4 = new ConvertType( 'umat4' );\nexport const bmat4 = new ConvertType( 'bmat4' );\n\nexport const string = ( value = '' ) => nodeObject( new ConstNode( value, 'string' ) );\nexport const arrayBuffer = ( value ) => nodeObject( new ConstNode( value, 'ArrayBuffer' ) );\n\naddNodeElement( 'color', color );\naddNodeElement( 'float', float );\naddNodeElement( 'int', int );\naddNodeElement( 'uint', uint );\naddNodeElement( 'bool', bool );\naddNodeElement( 'vec2', vec2 );\naddNodeElement( 'ivec2', ivec2 );\naddNodeElement( 'uvec2', uvec2 );\naddNodeElement( 'bvec2', bvec2 );\naddNodeElement( 'vec3', vec3 );\naddNodeElement( 'ivec3', ivec3 );\naddNodeElement( 'uvec3', uvec3 );\naddNodeElement( 'bvec3', bvec3 );\naddNodeElement( 'vec4', vec4 );\naddNodeElement( 'ivec4', ivec4 );\naddNodeElement( 'uvec4', uvec4 );\naddNodeElement( 'bvec4', bvec4 );\naddNodeElement( 'mat3', mat3 );\naddNodeElement( 'imat3', imat3 );\naddNodeElement( 'umat3', umat3 );\naddNodeElement( 'bmat3', bmat3 );\naddNodeElement( 'mat4', mat4 );\naddNodeElement( 'imat4', imat4 );\naddNodeElement( 'umat4', umat4 );\naddNodeElement( 'bmat4', bmat4 );\naddNodeElement( 'string', string );\naddNodeElement( 'arrayBuffer', arrayBuffer );\n\n// basic nodes\n// HACK - we cannot export them from the corresponding files because of the cyclic dependency\nexport const element = nodeProxy( ArrayElementNode );\nexport const convert = ( node, types ) => nodeObject( new ConvertNode( nodeObject( node ), types ) );\nexport const split = ( node, channels ) => nodeObject( new SplitNode( nodeObject( node ), channels ) );\n\naddNodeElement( 'element', element );\naddNodeElement( 'convert', convert );\n","import InputNode from './InputNode.js';\nimport { addNodeClass } from './Node.js';\nimport { nodeObject, getConstNodeType } from '../shadernode/ShaderNode.js';\n\nclass UniformNode extends InputNode {\n\n\tconstructor( value, nodeType = null ) {\n\n\t\tsuper( value, nodeType );\n\n\t\tthis.isUniformNode = true;\n\n\t}\n\n\tgetUniformHash( builder ) {\n\n\t\treturn this.getHash( builder );\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst type = this.getNodeType( builder );\n\n\t\tconst hash = this.getUniformHash( builder );\n\n\t\tlet sharedNode = builder.getNodeFromHash( hash );\n\n\t\tif ( sharedNode === undefined ) {\n\n\t\t\tbuilder.setHashNode( this, hash );\n\n\t\t\tsharedNode = this;\n\n\t\t}\n\n\t\tconst sharedNodeType = sharedNode.getInputType( builder );\n\n\t\tconst nodeUniform = builder.getUniformFromNode( sharedNode, builder.shaderStage, sharedNodeType );\n\t\tconst propertyName = builder.getPropertyName( nodeUniform );\n\n\t\treturn builder.format( propertyName, type, output );\n\n\t}\n\n}\n\nexport default UniformNode;\n\nexport const uniform = ( arg1, arg2 ) => {\n\n\tconst nodeType = getConstNodeType( arg2 || arg1 );\n\n\t// @TODO: get ConstNode from .traverse() in the future\n\tconst value = ( arg1 && arg1.isNode === true ) ? ( arg1.node && arg1.node.value ) || arg1.value : arg1;\n\n\treturn nodeObject( new UniformNode( value, nodeType ) );\n\n};\n\naddNodeClass( UniformNode );\n","import Node, { addNodeClass } from './Node.js';\nimport { NodeShaderStage } from './constants.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass VaryingNode extends Node {\n\n\tconstructor( node, name = null ) {\n\n\t\tsuper();\n\n\t\tthis.node = node;\n\t\tthis.name = name;\n\n\t}\n\n\tisGlobal() {\n\n\t\treturn true;\n\n\t}\n\n\tgetHash( builder ) {\n\n\t\treturn this.name || super.getHash( builder );\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\t// VaryingNode is auto type\n\n\t\treturn this.node.getNodeType( builder );\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst { name, node } = this;\n\t\tconst type = this.getNodeType( builder );\n\n\t\tconst nodeVarying = builder.getVaryingFromNode( this, type );\n\n\t\t// this property can be used to check if the varying can be optimized for a var\n\t\tnodeVarying.needsInterpolation || ( nodeVarying.needsInterpolation = ( builder.shaderStage === 'fragment' ) );\n\n\t\tif ( name !== null ) {\n\n\t\t\tnodeVarying.name = name;\n\n\t\t}\n\n\t\tconst propertyName = builder.getPropertyName( nodeVarying, NodeShaderStage.VERTEX );\n\n\t\t// force node run in vertex stage\n\t\tbuilder.flowNodeFromShaderStage( NodeShaderStage.VERTEX, node, type, propertyName );\n\n\t\treturn builder.getPropertyName( nodeVarying );\n\n\t}\n\n}\n\nexport default VaryingNode;\n\nexport const varying = nodeProxy( VaryingNode );\n\naddNodeElement( 'varying', varying );\n\naddNodeClass( VaryingNode );\n","import Node, { addNodeClass } from './Node.js';\nimport { varying } from './VaryingNode.js';\nimport { nodeObject } from '../shadernode/ShaderNode.js';\n\nclass AttributeNode extends Node {\n\n\tconstructor( attributeName, nodeType = null ) {\n\n\t\tsuper( nodeType );\n\n\t\tthis._attributeName = attributeName;\n\n\t}\n\n\tgetHash( builder ) {\n\n\t\treturn this.getAttributeName( builder );\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst attributeName = this.getAttributeName( builder );\n\n\t\tlet nodeType = super.getNodeType( builder );\n\n\t\tif ( nodeType === null ) {\n\n\t\t\tif ( builder.hasGeometryAttribute( attributeName ) ) {\n\n\t\t\t\tconst attribute = builder.geometry.getAttribute( attributeName );\n\n\t\t\t\tnodeType = builder.getTypeFromAttribute( attribute );\n\n\t\t\t} else {\n\n\t\t\t\tnodeType = 'float';\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn nodeType;\n\n\t}\n\n\tsetAttributeName( attributeName ) {\n\n\t\tthis._attributeName = attributeName;\n\n\t\treturn this;\n\n\t}\n\n\tgetAttributeName( /*builder*/ ) {\n\n\t\treturn this._attributeName;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst attributeName = this.getAttributeName( builder );\n\t\tconst nodeType = this.getNodeType( builder );\n\t\tconst geometryAttribute = builder.hasGeometryAttribute( attributeName );\n\n\t\tif ( geometryAttribute === true ) {\n\n\t\t\tconst attribute = builder.geometry.getAttribute( attributeName );\n\t\t\tconst attributeType = builder.getTypeFromAttribute( attribute );\n\n\t\t\tconst nodeAttribute = builder.getAttribute( attributeName, attributeType );\n\n\t\t\tif ( builder.isShaderStage( 'vertex' ) ) {\n\n\t\t\t\treturn builder.format( nodeAttribute.name, attributeType, nodeType );\n\n\t\t\t} else {\n\n\t\t\t\tconst nodeVarying = varying( this );\n\n\t\t\t\treturn nodeVarying.build( builder, nodeType );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( `AttributeNode: Attribute \"${ attributeName }\" not found.` );\n\n\t\t\treturn builder.getConst( nodeType );\n\n\t\t}\n\n\t}\n\n}\n\nexport default AttributeNode;\n\nexport const attribute = ( name, nodeType ) => nodeObject( new AttributeNode( name, nodeType ) );\n\naddNodeClass( AttributeNode );\n","import Node, { addNodeClass } from './Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass BypassNode extends Node {\n\n\tconstructor( returnNode, callNode ) {\n\n\t\tsuper();\n\n\t\tthis.isBypassNode = true;\n\n\t\tthis.outputNode = returnNode;\n\t\tthis.callNode = callNode;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.outputNode.getNodeType( builder );\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst snippet = this.callNode.build( builder, 'void' );\n\n\t\tif ( snippet !== '' ) {\n\n\t\t\tbuilder.addLineFlowCode( snippet );\n\n\t\t}\n\n\t\treturn this.outputNode.build( builder, output );\n\n\t}\n\n}\n\nexport default BypassNode;\n\nexport const bypass = nodeProxy( BypassNode );\n\naddNodeElement( 'bypass', bypass );\n\naddNodeClass( BypassNode );\n","let id = 0;\n\nclass NodeCache {\n\n\tconstructor() {\n\n\t\tthis.id = id ++;\n\t\tthis.nodesData = new WeakMap();\n\n\t}\n\n\tgetNodeData( node ) {\n\n\t\treturn this.nodesData.get( node );\n\n\t}\n\n\tsetNodeData( node, data ) {\n\n\t\tthis.nodesData.set( node, data );\n\n\t}\n\n}\n\nexport default NodeCache;\n","import Node, { addNodeClass } from './Node.js';\nimport NodeCache from './NodeCache.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass CacheNode extends Node {\n\n\tconstructor( node, cache = new NodeCache() ) {\n\n\t\tsuper();\n\n\t\tthis.isCacheNode = true;\n\n\t\tthis.node = node;\n\t\tthis.cache = cache;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.node.getNodeType( builder );\n\n\t}\n\n\tbuild( builder, ...params ) {\n\n\t\tconst previousCache = builder.getCache();\n\n\t\tbuilder.setCache( this.cache );\n\n\t\tconst data = this.node.build( builder, ...params );\n\n\t\tbuilder.setCache( previousCache );\n\n\t\treturn data;\n\n\t}\n\n}\n\nexport default CacheNode;\n\nexport const cache = nodeProxy( CacheNode );\n\naddNodeElement( 'cache', cache );\n\naddNodeClass( CacheNode );\n","import Node, { addNodeClass } from './Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass ContextNode extends Node {\n\n\tconstructor( node, context = {} ) {\n\n\t\tsuper();\n\n\t\tthis.isContextNode = true;\n\n\t\tthis.node = node;\n\t\tthis.context = context;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.node.getNodeType( builder );\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst previousContext = builder.getContext();\n\n\t\tbuilder.setContext( { ...builder.context, ...this.context } );\n\n\t\tconst node = this.node.build( builder );\n\n\t\tbuilder.setContext( previousContext );\n\n\t\treturn node;\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst previousContext = builder.getContext();\n\n\t\tbuilder.setContext( { ...builder.context, ...this.context } );\n\n\t\tconst snippet = this.node.build( builder, output );\n\n\t\tbuilder.setContext( previousContext );\n\n\t\treturn snippet;\n\n\t}\n\n}\n\nexport default ContextNode;\n\nexport const context = nodeProxy( ContextNode );\n\naddNodeElement( 'context', context );\n\naddNodeClass( ContextNode );\n","import Node, { addNodeClass } from './Node.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass InstanceIndexNode extends Node {\n\n\tconstructor() {\n\n\t\tsuper( 'uint' );\n\n\t\tthis.isInstanceIndexNode = true;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\treturn builder.getInstanceIndex();\n\n\t}\n\n}\n\nexport default InstanceIndexNode;\n\nexport const instanceIndex = nodeImmutable( InstanceIndexNode );\n\naddNodeClass( InstanceIndexNode );\n","class NodeAttribute {\n\n\tconstructor( name, type ) {\n\n\t\tthis.isNodeAttribute = true;\n\n\t\tthis.name = name;\n\t\tthis.type = type;\n\n\t}\n\n}\n\nexport default NodeAttribute;\n","class NodeUniform {\n\n\tconstructor( name, type, node, needsUpdate = undefined ) {\n\n\t\tthis.isNodeUniform = true;\n\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.node = node;\n\t\tthis.needsUpdate = needsUpdate;\n\n\t}\n\n\tget value() {\n\n\t\treturn this.node.value;\n\n\t}\n\n\tset value( val ) {\n\n\t\tthis.node.value = val;\n\n\t}\n\n}\n\nexport default NodeUniform;\n","class NodeVar {\n\n\tconstructor( name, type ) {\n\n\t\tthis.isNodeVar = true;\n\n\t\tthis.name = name;\n\t\tthis.type = type;\n\n\t}\n\n}\n\nexport default NodeVar;\n","import NodeVar from './NodeVar.js';\n\nclass NodeVarying extends NodeVar {\n\n\tconstructor( name, type ) {\n\n\t\tsuper( name, type );\n\n\t\tthis.needsInterpolation = false;\n\n\t\tthis.isNodeVarying = true;\n\n\t}\n\n}\n\nexport default NodeVarying;\n","class NodeCode {\n\n\tconstructor( name, type, code = '' ) {\n\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.code = code;\n\n\t\tObject.defineProperty( this, 'isNodeCode', { value: true } );\n\n\t}\n\n}\n\nexport default NodeCode;\n","class NodeKeywords {\n\n\tconstructor() {\n\n\t\tthis.keywords = [];\n\t\tthis.nodes = [];\n\t\tthis.keywordsCallback = {};\n\n\t}\n\n\tgetNode( name ) {\n\n\t\tlet node = this.nodes[ name ];\n\n\t\tif ( node === undefined && this.keywordsCallback[ name ] !== undefined ) {\n\n\t\t\tnode = this.keywordsCallback[ name ]( name );\n\n\t\t\tthis.nodes[ name ] = node;\n\n\t\t}\n\n\t\treturn node;\n\n\t}\n\n\taddKeyword( name, callback ) {\n\n\t\tthis.keywords.push( name );\n\t\tthis.keywordsCallback[ name ] = callback;\n\n\t\treturn this;\n\n\t}\n\n\tparse( code ) {\n\n\t\tconst keywordNames = this.keywords;\n\n\t\tconst regExp = new RegExp( `\\\\b${keywordNames.join( '\\\\b|\\\\b' )}\\\\b`, 'g' );\n\n\t\tconst codeKeywords = code.match( regExp );\n\n\t\tconst keywordNodes = [];\n\n\t\tif ( codeKeywords !== null ) {\n\n\t\t\tfor ( const keyword of codeKeywords ) {\n\n\t\t\t\tconst node = this.getNode( keyword );\n\n\t\t\t\tif ( node !== undefined && keywordNodes.indexOf( node ) === - 1 ) {\n\n\t\t\t\t\tkeywordNodes.push( node );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn keywordNodes;\n\n\t}\n\n\tinclude( builder, code ) {\n\n\t\tconst keywordNodes = this.parse( code );\n\n\t\tfor ( const keywordNode of keywordNodes ) {\n\n\t\t\tkeywordNode.build( builder );\n\n\t\t}\n\n\t}\n\n}\n\nexport default NodeKeywords;\n","import TempNode from '../core/TempNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass OperatorNode extends TempNode {\n\n\tconstructor( op, aNode, bNode, ...params ) {\n\n\t\tsuper();\n\n\t\tthis.op = op;\n\n\t\tif ( params.length > 0 ) {\n\n\t\t\tlet finalBNode = bNode;\n\n\t\t\tfor ( let i = 0; i < params.length; i ++ ) {\n\n\t\t\t\tfinalBNode = new OperatorNode( op, finalBNode, params[ i ] );\n\n\t\t\t}\n\n\t\t\tbNode = finalBNode;\n\n\t\t}\n\n\t\tthis.aNode = aNode;\n\t\tthis.bNode = bNode;\n\n\t}\n\n\thasDependencies( builder ) {\n\n\t\treturn this.op !== '=' ? super.hasDependencies( builder ) : false;\n\n\t}\n\n\tgetNodeType( builder, output ) {\n\n\t\tconst op = this.op;\n\n\t\tconst aNode = this.aNode;\n\t\tconst bNode = this.bNode;\n\n\t\tconst typeA = aNode.getNodeType( builder );\n\t\tconst typeB = bNode.getNodeType( builder );\n\n\t\tif ( typeA === 'void' || typeB === 'void' ) {\n\n\t\t\treturn 'void';\n\n\t\t} else if ( op === '=' || op === '%' ) {\n\n\t\t\treturn typeA;\n\n\t\t} else if ( op === '&' || op === '|' || op === '^' || op === '>>' || op === '<<' ) {\n\n\t\t\treturn builder.getIntegerType( typeA );\n\n\t\t} else if ( op === '==' || op === '&&' || op === '||' || op === '^^' ) {\n\n\t\t\treturn 'bool';\n\n\t\t} else if ( op === '<' || op === '>' || op === '<=' || op === '>=' ) {\n\n\t\t\tconst typeLength = output ? builder.getTypeLength( output ) : Math.max( builder.getTypeLength( typeA ), builder.getTypeLength( typeB ) );\n\n\t\t\treturn typeLength > 1 ? `bvec${ typeLength }` : 'bool';\n\n\t\t} else {\n\n\t\t\tif ( typeA === 'float' && builder.isMatrix( typeB ) ) {\n\n\t\t\t\treturn typeB;\n\n\t\t\t} else if ( builder.isMatrix( typeA ) && builder.isVector( typeB ) ) {\n\n\t\t\t\t// matrix x vector\n\n\t\t\t\treturn builder.getVectorFromMatrix( typeA );\n\n\t\t\t} else if ( builder.isVector( typeA ) && builder.isMatrix( typeB ) ) {\n\n\t\t\t\t// vector x matrix\n\n\t\t\t\treturn builder.getVectorFromMatrix( typeB );\n\n\t\t\t} else if ( builder.getTypeLength( typeB ) > builder.getTypeLength( typeA ) ) {\n\n\t\t\t\t// anytype x anytype: use the greater length vector\n\n\t\t\t\treturn typeB;\n\n\t\t\t}\n\n\t\t\treturn typeA;\n\n\t\t}\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst op = this.op;\n\n\t\tconst aNode = this.aNode;\n\t\tconst bNode = this.bNode;\n\n\t\tconst type = this.getNodeType( builder, output );\n\n\t\tlet typeA = null;\n\t\tlet typeB = null;\n\n\t\tif ( type !== 'void' ) {\n\n\t\t\ttypeA = aNode.getNodeType( builder );\n\t\t\ttypeB = bNode.getNodeType( builder );\n\n\t\t\tif ( op === '=' ) {\n\n\t\t\t\ttypeB = typeA;\n\n\t\t\t} else if ( op === '<' || op === '>' || op === '<=' || op === '>=' ) {\n\n\t\t\t\tif ( builder.isVector( typeA ) ) {\n\n\t\t\t\t\ttypeB = typeA;\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttypeA = typeB = 'float';\n\n\t\t\t\t}\n\n\t\t\t} else if ( op === '>>' || op === '<<' ) {\n\n\t\t\t\ttypeA = type;\n\t\t\t\ttypeB = builder.changeComponentType( typeB, 'uint' );\n\n\t\t\t} else if ( builder.isMatrix( typeA ) && builder.isVector( typeB ) ) {\n\n\t\t\t\t// matrix x vector\n\n\t\t\t\ttypeB = builder.getVectorFromMatrix( typeA );\n\n\t\t\t} else if ( builder.isVector( typeA ) && builder.isMatrix( typeB ) ) {\n\n\t\t\t\t// vector x matrix\n\n\t\t\t\ttypeA = builder.getVectorFromMatrix( typeB );\n\n\t\t\t} else {\n\n\t\t\t\t// anytype x anytype\n\n\t\t\t\ttypeA = typeB = type;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\ttypeA = typeB = type;\n\n\t\t}\n\n\t\tconst a = aNode.build( builder, typeA );\n\t\tconst b = bNode.build( builder, typeB );\n\n\t\tconst outputLength = builder.getTypeLength( output );\n\n\t\tif ( output !== 'void' ) {\n\n\t\t\tif ( op === '=' ) {\n\n\t\t\t\tbuilder.addLineFlowCode( `${a} ${this.op} ${b}` );\n\n\t\t\t\treturn a;\n\n\t\t\t} else if ( op === '<' && outputLength > 1 ) {\n\n\t\t\t\treturn builder.format( `${ builder.getMethod( 'lessThan' ) }( ${a}, ${b} )`, type, output );\n\n\t\t\t} else if ( op === '<=' && outputLength > 1 ) {\n\n\t\t\t\treturn builder.format( `${ builder.getMethod( 'lessThanEqual' ) }( ${a}, ${b} )`, type, output );\n\n\t\t\t} else if ( op === '>' && outputLength > 1 ) {\n\n\t\t\t\treturn builder.format( `${ builder.getMethod( 'greaterThan' ) }( ${a}, ${b} )`, type, output );\n\n\t\t\t} else if ( op === '>=' && outputLength > 1 ) {\n\n\t\t\t\treturn builder.format( `${ builder.getMethod( 'greaterThanEqual' ) }( ${a}, ${b} )`, type, output );\n\n\t\t\t} else {\n\n\t\t\t\treturn builder.format( `( ${a} ${this.op} ${b} )`, type, output );\n\n\t\t\t}\n\n\t\t} else if ( typeA !== 'void' ) {\n\n\t\t\treturn builder.format( `${a} ${this.op} ${b}`, type, output );\n\n\t\t}\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.op = this.op;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.op = data.op;\n\n\t}\n\n}\n\nexport default OperatorNode;\n\nexport const add = nodeProxy( OperatorNode, '+' );\nexport const sub = nodeProxy( OperatorNode, '-' );\nexport const mul = nodeProxy( OperatorNode, '*' );\nexport const div = nodeProxy( OperatorNode, '/' );\nexport const remainder = nodeProxy( OperatorNode, '%' );\nexport const equal = nodeProxy( OperatorNode, '==' );\nexport const assign = nodeProxy( OperatorNode, '=' );\nexport const lessThan = nodeProxy( OperatorNode, '<' );\nexport const greaterThan = nodeProxy( OperatorNode, '>' );\nexport const lessThanEqual = nodeProxy( OperatorNode, '<=' );\nexport const greaterThanEqual = nodeProxy( OperatorNode, '>=' );\nexport const and = nodeProxy( OperatorNode, '&&' );\nexport const or = nodeProxy( OperatorNode, '||' );\nexport const xor = nodeProxy( OperatorNode, '^^' );\nexport const bitAnd = nodeProxy( OperatorNode, '&' );\nexport const bitOr = nodeProxy( OperatorNode, '|' );\nexport const bitXor = nodeProxy( OperatorNode, '^' );\nexport const shiftLeft = nodeProxy( OperatorNode, '<<' );\nexport const shiftRight = nodeProxy( OperatorNode, '>>' );\n\naddNodeElement( 'add', add );\naddNodeElement( 'sub', sub );\naddNodeElement( 'mul', mul );\naddNodeElement( 'div', div );\naddNodeElement( 'remainder', remainder );\naddNodeElement( 'equal', equal );\naddNodeElement( 'assign', assign );\naddNodeElement( 'lessThan', lessThan );\naddNodeElement( 'greaterThan', greaterThan );\naddNodeElement( 'lessThanEqual', lessThanEqual );\naddNodeElement( 'greaterThanEqual', greaterThanEqual );\naddNodeElement( 'and', and );\naddNodeElement( 'or', or );\naddNodeElement( 'xor', xor );\naddNodeElement( 'bitAnd', bitAnd );\naddNodeElement( 'bitOr', bitOr );\naddNodeElement( 'bitXor', bitXor );\naddNodeElement( 'shiftLeft', shiftLeft );\naddNodeElement( 'shiftRight', shiftRight );\n\naddNodeClass( OperatorNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass ExpressionNode extends Node {\n\n\tconstructor( snippet = '', nodeType = 'void' ) {\n\n\t\tsuper( nodeType );\n\n\t\tthis.snippet = snippet;\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst type = this.getNodeType( builder );\n\t\tconst snippet = this.snippet;\n\n\t\tif ( type === 'void' ) {\n\n\t\t\tbuilder.addLineFlowCode( snippet );\n\n\t\t} else {\n\n\t\t\treturn builder.format( `( ${ snippet } )`, type, output );\n\n\t\t}\n\n\t}\n\n}\n\nexport default ExpressionNode;\n\nexport const expression = nodeProxy( ExpressionNode );\n\naddNodeClass( ExpressionNode );\n","import Node, { addNodeClass } from './Node.js';\nimport { nodeImmutable, nodeObject, getConstNodeType } from '../shadernode/ShaderNode.js';\n\nclass PropertyNode extends Node {\n\n\tconstructor( nodeType, name = null ) {\n\n\t\tsuper( nodeType );\n\n\t\tthis.name = name;\n\n\t}\n\n\tgetHash( builder ) {\n\n\t\treturn this.name || super.getHash( builder );\n\n\t}\n\n\tisGlobal( /*builder*/ ) {\n\n\t\treturn true;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst nodeVary = builder.getVarFromNode( this, this.getNodeType( builder ) );\n\t\tconst name = this.name;\n\n\t\tif ( name !== null ) {\n\n\t\t\tnodeVary.name = name;\n\n\t\t}\n\n\t\treturn builder.getPropertyName( nodeVary );\n\n\t}\n\n}\n\nexport default PropertyNode;\n\nexport const property = ( name, nodeOrType ) => nodeObject( new PropertyNode( name, getConstNodeType( nodeOrType ) ) );\n\nexport const diffuseColor = nodeImmutable( PropertyNode, 'vec4', 'DiffuseColor' );\nexport const roughness = nodeImmutable( PropertyNode, 'float', 'Roughness' );\nexport const metalness = nodeImmutable( PropertyNode, 'float', 'Metalness' );\nexport const specularColor = nodeImmutable( PropertyNode, 'color', 'SpecularColor' );\nexport const shininess = nodeImmutable( PropertyNode, 'float', 'Shininess' );\n\naddNodeClass( PropertyNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { property } from '../core/PropertyNode.js';\nimport { context as contextNode } from '../core/ContextNode.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass CondNode extends Node {\n\n\tconstructor( condNode, ifNode, elseNode = null ) {\n\n\t\tsuper();\n\n\t\tthis.condNode = condNode;\n\n\t\tthis.ifNode = ifNode;\n\t\tthis.elseNode = elseNode;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst ifType = this.ifNode.getNodeType( builder );\n\n\t\tif ( this.elseNode !== null ) {\n\n\t\t\tconst elseType = this.elseNode.getNodeType( builder );\n\n\t\t\tif ( builder.getTypeLength( elseType ) > builder.getTypeLength( ifType ) ) {\n\n\t\t\t\treturn elseType;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn ifType;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst type = this.getNodeType( builder );\n\t\tconst context = { tempWrite: false };\n\n\t\tconst { ifNode, elseNode } = this;\n\n\t\tconst needsProperty = ifNode.getNodeType( builder ) !== 'void' || ( elseNode && elseNode.getNodeType( builder ) !== 'void' );\n\t\tconst nodeProperty = needsProperty ? property( type ).build( builder ) : '';\n\n\t\tconst nodeSnippet = contextNode( this.condNode/*, context*/ ).build( builder, 'bool' );\n\n\t\tbuilder.addFlowCode( `\\n${ builder.tab }if ( ${ nodeSnippet } ) {\\n\\n` ).addFlowTab();\n\n\t\tlet ifSnippet = contextNode( this.ifNode, context ).build( builder, type );\n\n\t\tifSnippet = needsProperty ? nodeProperty + ' = ' + ifSnippet + ';' : ifSnippet;\n\n\t\tbuilder.removeFlowTab().addFlowCode( builder.tab + '\\t' + ifSnippet + '\\n\\n' + builder.tab + '}' );\n\n\t\tif ( elseNode !== null ) {\n\n\t\t\tbuilder.addFlowCode( ' else {\\n\\n' ).addFlowTab();\n\n\t\t\tlet elseSnippet = contextNode( elseNode, context ).build( builder, type );\n\t\t\telseSnippet = nodeProperty ? nodeProperty + ' = ' + elseSnippet + ';' : elseSnippet;\n\n\t\t\tbuilder.removeFlowTab().addFlowCode( builder.tab + '\\t' + elseSnippet + '\\n\\n' + builder.tab + '}\\n\\n' );\n\n\t\t} else {\n\n\t\t\tbuilder.addFlowCode( '\\n\\n' );\n\n\t\t}\n\n\t\treturn nodeProperty;\n\n\t}\n\n}\n\nexport default CondNode;\n\nexport const cond = nodeProxy( CondNode );\n\naddNodeElement( 'cond', cond );\n\naddNodeClass( CondNode );\n","import Node, { addNodeClass } from './Node.js';\nimport { assign } from '../math/OperatorNode.js';\nimport { bypass } from '../core/BypassNode.js';\nimport { expression } from '../code/ExpressionNode.js';\nimport { cond } from '../math/CondNode.js';\nimport { nodeProxy, shader } from '../shadernode/ShaderNode.js';\n\nclass StackNode extends Node {\n\n\tconstructor( parent = null ) {\n\n\t\tsuper();\n\n\t\tthis.nodes = [];\n\t\tthis.outputNode = null;\n\n\t\tthis.parent = parent;\n\n\t\tthis._currentCond = null;\n\n\t\tthis.isStackNode = true;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.outputNode ? this.outputNode.getNodeType( builder ) : 'void';\n\n\t}\n\n\tadd( node ) {\n\n\t\tthis.nodes.push( bypass( expression(), node ) );\n\n\t\treturn this;\n\n\t}\n\n\tif( boolNode, method ) {\n\n\t\tconst methodNode = shader( method );\n\t\tthis._currentCond = cond( boolNode, methodNode );\n\n\t\treturn this.add( this._currentCond );\n\n\t}\n\n\telseif( boolNode, method ) {\n\n\t\tconst methodNode = shader( method );\n\t\tconst ifNode = cond( boolNode, methodNode );\n\n\t\tthis._currentCond.elseNode = ifNode;\n\t\tthis._currentCond = ifNode;\n\n\t\treturn this;\n\n\t}\n\n\telse( method ) {\n\n\t\tthis._currentCond.elseNode = shader( method );\n\n\t\treturn this;\n\n\t}\n\n\tassign( targetNode, sourceValue ) {\n\n\t\treturn this.add( assign( targetNode, sourceValue ) );\n\n\t}\n\n\tbuild( builder, ...params ) {\n\n\t\tfor ( const node of this.nodes ) {\n\n\t\t\tnode.build( builder );\n\n\t\t}\n\n\t\treturn this.outputNode ? this.outputNode.build( builder, ...params ) : super.build( builder, ...params );\n\n\t}\n\n}\n\nexport default StackNode;\n\nexport const stack = nodeProxy( StackNode );\n\naddNodeClass( StackNode );\n","import UniformNode from '../core/UniformNode.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\nimport { addNodeClass } from '../core/Node.js';\n\nclass MaxMipLevelNode extends UniformNode {\n\n\tconstructor( textureNode ) {\n\n\t\tsuper( 0 );\n\n\t\tthis.textureNode = textureNode;\n\n\t\tthis.updateType = NodeUpdateType.FRAME;\n\n\t}\n\n\tget texture() {\n\n\t\treturn this.textureNode.value;\n\n\t}\n\n\tupdate() {\n\n\t\tconst texture = this.texture;\n\t\tconst images = texture.images;\n\t\tconst image = ( images && images.length > 0 ) ? ( ( images[ 0 ] && images[ 0 ].image ) || images[ 0 ] ) : texture.image;\n\n\t\tif ( image && image.width !== undefined ) {\n\n\t\t\tconst { width, height } = image;\n\n\t\t\tthis.value = Math.log2( Math.max( width, height ) );\n\n\t\t}\n\n\t}\n\n}\n\nexport default MaxMipLevelNode;\n\nexport const maxMipLevel = nodeProxy( MaxMipLevelNode );\n\naddNodeClass( MaxMipLevelNode );\n","import NodeUniform from './NodeUniform.js';\nimport NodeAttribute from './NodeAttribute.js';\nimport NodeVarying from './NodeVarying.js';\nimport NodeVar from './NodeVar.js';\nimport NodeCode from './NodeCode.js';\nimport NodeKeywords from './NodeKeywords.js';\nimport NodeCache from './NodeCache.js';\nimport { NodeUpdateType, defaultBuildStages, shaderStages } from './constants.js';\n\nimport { REVISION, NoColorSpace, LinearEncoding, sRGBEncoding, SRGBColorSpace, Color, Vector2, Vector3, Vector4, Float16BufferAttribute } from 'three';\n\nimport { stack } from './StackNode.js';\nimport { maxMipLevel } from '../utils/MaxMipLevelNode.js';\n\nconst typeFromLength = new Map( [\n\t[ 2, 'vec2' ],\n\t[ 3, 'vec3' ],\n\t[ 4, 'vec4' ],\n\t[ 9, 'mat3' ],\n\t[ 16, 'mat4' ]\n] );\n\nconst typeFromArray = new Map( [\n\t[ Int8Array, 'int' ],\n\t[ Int16Array, 'int' ],\n\t[ Int32Array, 'int' ],\n\t[ Uint8Array, 'uint' ],\n\t[ Uint16Array, 'uint' ],\n\t[ Uint32Array, 'uint' ],\n\t[ Float32Array, 'float' ]\n] );\n\nconst isNonPaddingElementArray = new Set( [ Int32Array, Uint32Array, Float32Array ] );\n\nconst toFloat = ( value ) => {\n\n\tvalue = Number( value );\n\n\treturn value + ( value % 1 ? '' : '.0' );\n\n};\n\nclass NodeBuilder {\n\n\tconstructor( object, renderer, parser ) {\n\n\t\tthis.object = object;\n\t\tthis.material = object && ( object.material || null );\n\t\tthis.geometry = object && ( object.geometry || null );\n\t\tthis.renderer = renderer;\n\t\tthis.parser = parser;\n\n\t\tthis.nodes = [];\n\t\tthis.updateNodes = [];\n\t\tthis.updateBeforeNodes = [];\n\t\tthis.hashNodes = {};\n\n\t\tthis.lightsNode = null;\n\t\tthis.environmentNode = null;\n\t\tthis.fogNode = null;\n\t\tthis.toneMappingNode = null;\n\n\t\tthis.vertexShader = null;\n\t\tthis.fragmentShader = null;\n\t\tthis.computeShader = null;\n\n\t\tthis.flowNodes = { vertex: [], fragment: [], compute: [] };\n\t\tthis.flowCode = { vertex: '', fragment: '', compute: [] };\n\t\tthis.uniforms = { vertex: [], fragment: [], compute: [], index: 0 };\n\t\tthis.codes = { vertex: [], fragment: [], compute: [] };\n\t\tthis.attributes = [];\n\t\tthis.varyings = [];\n\t\tthis.vars = { vertex: [], fragment: [], compute: [] };\n\t\tthis.flow = { code: '' };\n\t\tthis.chaining = [];\n\t\tthis.stack = stack();\n\t\tthis.tab = '\\t';\n\n\t\tthis.context = {\n\t\t\tkeywords: new NodeKeywords(),\n\t\t\tmaterial: this.material,\n\t\t\tgetMIPLevelAlgorithmNode: ( textureNode, levelNode ) => levelNode.mul( maxMipLevel( textureNode ) )\n\t\t};\n\n\t\tthis.cache = new NodeCache();\n\t\tthis.globalCache = this.cache;\n\n\t\tthis.flowsData = new WeakMap();\n\n\t\tthis.shaderStage = null;\n\t\tthis.buildStage = null;\n\n\t}\n\n\tsetHashNode( node, hash ) {\n\n\t\tthis.hashNodes[ hash ] = node;\n\n\t}\n\n\taddNode( node ) {\n\n\t\tif ( this.nodes.indexOf( node ) === - 1 ) {\n\n\t\t\tconst updateType = node.getUpdateType();\n\t\t\tconst updateBeforeType = node.getUpdateBeforeType();\n\n\t\t\tif ( updateType !== NodeUpdateType.NONE ) {\n\n\t\t\t\tthis.updateNodes.push( node );\n\n\t\t\t}\n\n\t\t\tif ( updateBeforeType !== NodeUpdateType.NONE ) {\n\n\t\t\t\tthis.updateBeforeNodes.push( node );\n\n\t\t\t}\n\n\t\t\tthis.nodes.push( node );\n\n\t\t\tthis.setHashNode( node, node.getHash( this ) );\n\n\t\t}\n\n\t}\n\n\tget currentNode() {\n\n\t\treturn this.chaining[ this.chaining.length - 1 ];\n\n\t}\n\n\taddChain( node ) {\n\n\t\t/*\n\t\tif ( this.chaining.indexOf( node ) !== - 1 ) {\n\n\t\t\tconsole.warn( 'Recursive node: ', node );\n\n\t\t}\n\t\t*/\n\n\t\tthis.chaining.push( node );\n\n\t}\n\n\tremoveChain( node ) {\n\n\t\tconst lastChain = this.chaining.pop();\n\n\t\tif ( lastChain !== node ) {\n\n\t\t\tthrow new Error( 'NodeBuilder: Invalid node chaining!' );\n\n\t\t}\n\n\t}\n\n\tgetMethod( method ) {\n\n\t\treturn method;\n\n\t}\n\n\tgetNodeFromHash( hash ) {\n\n\t\treturn this.hashNodes[ hash ];\n\n\t}\n\n\taddFlow( shaderStage, node ) {\n\n\t\tthis.flowNodes[ shaderStage ].push( node );\n\n\t\treturn node;\n\n\t}\n\n\tsetContext( context ) {\n\n\t\tthis.context = context;\n\n\t}\n\n\tgetContext() {\n\n\t\treturn this.context;\n\n\t}\n\n\tsetCache( cache ) {\n\n\t\tthis.cache = cache;\n\n\t}\n\n\tgetCache() {\n\n\t\treturn this.cache;\n\n\t}\n\n\tisAvailable( /*name*/ ) {\n\n\t\treturn false;\n\n\t}\n\n\tgetInstanceIndex() {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tgetFrontFacing() {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tgetFragCoord() {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tisFlipY() {\n\n\t\treturn false;\n\n\t}\n\n\tgetTexture( /* texture, textureProperty, uvSnippet */ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tgetTextureLevel( /* texture, textureProperty, uvSnippet, levelSnippet */ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\t// @TODO: rename to .generateConst()\n\tgetConst( type, value = null ) {\n\n\t\tif ( value === null ) {\n\n\t\t\tif ( type === 'float' || type === 'int' || type === 'uint' ) value = 0;\n\t\t\telse if ( type === 'bool' ) value = false;\n\t\t\telse if ( type === 'color' ) value = new Color();\n\t\t\telse if ( type === 'vec2' ) value = new Vector2();\n\t\t\telse if ( type === 'vec3' ) value = new Vector3();\n\t\t\telse if ( type === 'vec4' ) value = new Vector4();\n\n\t\t}\n\n\t\tif ( type === 'float' ) return toFloat( value );\n\t\tif ( type === 'int' ) return `${ Math.round( value ) }`;\n\t\tif ( type === 'uint' ) return value >= 0 ? `${ Math.round( value ) }u` : '0u';\n\t\tif ( type === 'bool' ) return value ? 'true' : 'false';\n\t\tif ( type === 'color' ) return `${ this.getType( 'vec3' ) }( ${ toFloat( value.r ) }, ${ toFloat( value.g ) }, ${ toFloat( value.b ) } )`;\n\n\t\tconst typeLength = this.getTypeLength( type );\n\n\t\tconst componentType = this.getComponentType( type );\n\n\t\tconst getConst = value => this.getConst( componentType, value );\n\n\t\tif ( typeLength === 2 ) {\n\n\t\t\treturn `${ this.getType( type ) }( ${ getConst( value.x ) }, ${ getConst( value.y ) } )`;\n\n\t\t} else if ( typeLength === 3 ) {\n\n\t\t\treturn `${ this.getType( type ) }( ${ getConst( value.x ) }, ${ getConst( value.y ) }, ${ getConst( value.z ) } )`;\n\n\t\t} else if ( typeLength === 4 ) {\n\n\t\t\treturn `${ this.getType( type ) }( ${ getConst( value.x ) }, ${ getConst( value.y ) }, ${ getConst( value.z ) }, ${ getConst( value.w ) } )`;\n\n\t\t} else if ( typeLength > 4 ) {\n\n\t\t\treturn `${ this.getType( type ) }()`;\n\n\t\t}\n\n\t\tthrow new Error( `NodeBuilder: Type '${type}' not found in generate constant attempt.` );\n\n\t}\n\n\tgetType( type ) {\n\n\t\treturn type;\n\n\t}\n\n\tgenerateMethod( method ) {\n\n\t\treturn method;\n\n\t}\n\n\thasGeometryAttribute( name ) {\n\n\t\treturn this.geometry && this.geometry.getAttribute( name ) !== undefined;\n\n\t}\n\n\tgetAttribute( name, type ) {\n\n\t\tconst attributes = this.attributes;\n\n\t\t// find attribute\n\n\t\tfor ( const attribute of attributes ) {\n\n\t\t\tif ( attribute.name === name ) {\n\n\t\t\t\treturn attribute;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// create a new if no exist\n\n\t\tconst attribute = new NodeAttribute( name, type );\n\n\t\tattributes.push( attribute );\n\n\t\treturn attribute;\n\n\t}\n\n\tgetPropertyName( node/*, shaderStage*/ ) {\n\n\t\treturn node.name;\n\n\t}\n\n\tisVector( type ) {\n\n\t\treturn /vec\\d/.test( type );\n\n\t}\n\n\tisMatrix( type ) {\n\n\t\treturn /mat\\d/.test( type );\n\n\t}\n\n\tisReference( type ) {\n\n\t\treturn type === 'void' || type === 'property' || type === 'sampler' || type === 'texture' || type === 'cubeTexture';\n\n\t}\n\n\tisShaderStage( shaderStage ) {\n\n\t\treturn this.shaderStage === shaderStage;\n\n\t}\n\n\t/** @deprecated, r152 */\n\tgetTextureEncodingFromMap( map ) {\n\n\t\tconsole.warn( 'THREE.NodeBuilder: Method .getTextureEncodingFromMap replaced by .getTextureColorSpaceFromMap in r152+.' );\n\t\treturn this.getTextureColorSpaceFromMap( map ) === SRGBColorSpace ? sRGBEncoding : LinearEncoding;\n\n\t}\n\n\tgetTextureColorSpaceFromMap( map ) {\n\n\t\tlet colorSpace;\n\n\t\tif ( map && map.isTexture ) {\n\n\t\t\tcolorSpace = map.colorSpace;\n\n\t\t} else if ( map && map.isWebGLRenderTarget ) {\n\n\t\t\tcolorSpace = map.texture.colorSpace;\n\n\t\t} else {\n\n\t\t\tcolorSpace = NoColorSpace;\n\n\t\t}\n\n\t\treturn colorSpace;\n\n\t}\n\n\tgetComponentType( type ) {\n\n\t\ttype = this.getVectorType( type );\n\n\t\tif ( type === 'float' || type === 'bool' || type === 'int' || type === 'uint' ) return type;\n\n\t\tconst componentType = /(b|i|u|)(vec|mat)([2-4])/.exec( type );\n\n\t\tif ( componentType === null ) return null;\n\n\t\tif ( componentType[ 1 ] === 'b' ) return 'bool';\n\t\tif ( componentType[ 1 ] === 'i' ) return 'int';\n\t\tif ( componentType[ 1 ] === 'u' ) return 'uint';\n\n\t\treturn 'float';\n\n\t}\n\n\tgetVectorType( type ) {\n\n\t\tif ( type === 'color' ) return 'vec3';\n\t\tif ( type === 'texture' ) return 'vec4';\n\n\t\treturn type;\n\n\t}\n\n\tgetTypeFromLength( length, componentType = 'float' ) {\n\n\t\tif ( length === 1 ) return componentType;\n\n\t\tconst baseType = typeFromLength.get( length );\n\t\tconst prefix = componentType === 'float' ? '' : componentType[ 0 ];\n\n\t\treturn prefix + baseType;\n\n\t}\n\n\tgetTypeFromArray( array ) {\n\n\t\treturn typeFromArray.get( array.constructor );\n\n\t}\n\n\tgetTypeFromAttribute( attribute ) {\n\n\t\tlet dataAttribute = attribute;\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) dataAttribute = attribute.data;\n\n\t\tconst array = dataAttribute.array;\n\t\tconst itemSize = isNonPaddingElementArray.has( array.constructor ) ? attribute.itemSize : dataAttribute.stride || attribute.itemSize;\n\t\tconst normalized = attribute.normalized;\n\n\t\tlet arrayType;\n\n\t\tif ( ! ( attribute instanceof Float16BufferAttribute ) && normalized !== true ) {\n\n\t\t\tarrayType = this.getTypeFromArray( array );\n\n\t\t}\n\n\t\treturn this.getTypeFromLength( itemSize, arrayType );\n\n\t}\n\n\tgetTypeLength( type ) {\n\n\t\tconst vecType = this.getVectorType( type );\n\t\tconst vecNum = /vec([2-4])/.exec( vecType );\n\n\t\tif ( vecNum !== null ) return Number( vecNum[ 1 ] );\n\t\tif ( vecType === 'float' || vecType === 'bool' || vecType === 'int' || vecType === 'uint' ) return 1;\n\t\tif ( /mat3/.test( type ) === true ) return 9;\n\t\tif ( /mat4/.test( type ) === true ) return 16;\n\n\t\treturn 0;\n\n\t}\n\n\tgetVectorFromMatrix( type ) {\n\n\t\treturn type.replace( 'mat', 'vec' );\n\n\t}\n\n\tchangeComponentType( type, newComponentType ) {\n\n\t\treturn this.getTypeFromLength( this.getTypeLength( type ), newComponentType );\n\n\t}\n\n\tgetIntegerType( type ) {\n\n\t\tconst componentType = this.getComponentType( type );\n\n\t\tif ( componentType === 'int' || componentType === 'uint' ) return type;\n\n\t\treturn this.changeComponentType( type, 'int' );\n\n\t}\n\n\taddStack() {\n\n\t\tthis.stack = stack( this.stack );\n\n\t\treturn this.stack;\n\n\t}\n\n\tremoveStack() {\n\n\t\tconst currentStack = this.stack;\n\n\t\tthis.stack = currentStack.parent;\n\n\t\treturn currentStack;\n\n\t}\n\n\tgetDataFromNode( node, shaderStage = this.shaderStage ) {\n\n\t\tconst cache = node.isGlobal( this ) ? this.globalCache : this.cache;\n\n\t\tlet nodeData = cache.getNodeData( node );\n\n\t\tif ( nodeData === undefined ) {\n\n\t\t\tnodeData = { vertex: {}, fragment: {}, compute: {} };\n\n\t\t\tcache.setNodeData( node, nodeData );\n\n\t\t}\n\n\t\treturn shaderStage !== null ? nodeData[ shaderStage ] : nodeData;\n\n\t}\n\n\tgetNodeProperties( node, shaderStage = this.shaderStage ) {\n\n\t\tconst nodeData = this.getDataFromNode( node, shaderStage );\n\n\t\treturn nodeData.properties || ( nodeData.properties = { outputNode: null } );\n\n\t}\n\n\tgetUniformFromNode( node, shaderStage, type ) {\n\n\t\tconst nodeData = this.getDataFromNode( node, shaderStage );\n\n\t\tlet nodeUniform = nodeData.uniform;\n\n\t\tif ( nodeUniform === undefined ) {\n\n\t\t\tconst index = this.uniforms.index ++;\n\n\t\t\tnodeUniform = new NodeUniform( 'nodeUniform' + index, type, node );\n\n\t\t\tthis.uniforms[ shaderStage ].push( nodeUniform );\n\n\t\t\tnodeData.uniform = nodeUniform;\n\n\t\t}\n\n\t\treturn nodeUniform;\n\n\t}\n\n\tgetVarFromNode( node, type, shaderStage = this.shaderStage ) {\n\n\t\tconst nodeData = this.getDataFromNode( node, shaderStage );\n\n\t\tlet nodeVar = nodeData.variable;\n\n\t\tif ( nodeVar === undefined ) {\n\n\t\t\tconst vars = this.vars[ shaderStage ];\n\t\t\tconst index = vars.length;\n\n\t\t\tnodeVar = new NodeVar( 'nodeVar' + index, type );\n\n\t\t\tvars.push( nodeVar );\n\n\t\t\tnodeData.variable = nodeVar;\n\n\t\t}\n\n\t\treturn nodeVar;\n\n\t}\n\n\tgetVaryingFromNode( node, type ) {\n\n\t\tconst nodeData = this.getDataFromNode( node, null );\n\n\t\tlet nodeVarying = nodeData.varying;\n\n\t\tif ( nodeVarying === undefined ) {\n\n\t\t\tconst varyings = this.varyings;\n\t\t\tconst index = varyings.length;\n\n\t\t\tnodeVarying = new NodeVarying( 'nodeVarying' + index, type );\n\n\t\t\tvaryings.push( nodeVarying );\n\n\t\t\tnodeData.varying = nodeVarying;\n\n\t\t}\n\n\t\treturn nodeVarying;\n\n\t}\n\n\tgetCodeFromNode( node, type, shaderStage = this.shaderStage ) {\n\n\t\tconst nodeData = this.getDataFromNode( node );\n\n\t\tlet nodeCode = nodeData.code;\n\n\t\tif ( nodeCode === undefined ) {\n\n\t\t\tconst codes = this.codes[ shaderStage ];\n\t\t\tconst index = codes.length;\n\n\t\t\tnodeCode = new NodeCode( 'nodeCode' + index, type );\n\n\t\t\tcodes.push( nodeCode );\n\n\t\t\tnodeData.code = nodeCode;\n\n\t\t}\n\n\t\treturn nodeCode;\n\n\t}\n\n\taddLineFlowCode( code ) {\n\n\t\tif ( code === '' ) return this;\n\n\t\tcode = this.tab + code;\n\n\t\tif ( ! /;\\s*$/.test( code ) ) {\n\n\t\t\tcode = code + ';\\n';\n\n\t\t}\n\n\t\tthis.flow.code += code;\n\n\t\treturn this;\n\n\t}\n\n\taddFlowCode( code ) {\n\n\t\tthis.flow.code += code;\n\n\t\treturn this;\n\n\t}\n\n\taddFlowTab() {\n\n\t\tthis.tab += '\\t';\n\n\t\treturn this;\n\n\t}\n\n\tremoveFlowTab() {\n\n\t\tthis.tab = this.tab.slice( 0, - 1 );\n\n\t\treturn this;\n\n\t}\n\n\tgetFlowData( node/*, shaderStage*/ ) {\n\n\t\treturn this.flowsData.get( node );\n\n\t}\n\n\tflowNode( node ) {\n\n\t\tconst output = node.getNodeType( this );\n\n\t\tconst flowData = this.flowChildNode( node, output );\n\n\t\tthis.flowsData.set( node, flowData );\n\n\t\treturn flowData;\n\n\t}\n\n\tflowChildNode( node, output = null ) {\n\n\t\tconst previousFlow = this.flow;\n\n\t\tconst flow = {\n\t\t\tcode: '',\n\t\t};\n\n\t\tthis.flow = flow;\n\n\t\tflow.result = node.build( this, output );\n\n\t\tthis.flow = previousFlow;\n\n\t\treturn flow;\n\n\t}\n\n\tflowNodeFromShaderStage( shaderStage, node, output = null, propertyName = null ) {\n\n\t\tconst previousShaderStage = this.shaderStage;\n\n\t\tthis.setShaderStage( shaderStage );\n\n\t\tconst flowData = this.flowChildNode( node, output );\n\n\t\tif ( propertyName !== null ) {\n\n\t\t\tflowData.code += `${ this.tab + propertyName } = ${ flowData.result };\\n`;\n\n\t\t}\n\n\t\tthis.flowCode[ shaderStage ] = this.flowCode[ shaderStage ] + flowData.code;\n\n\t\tthis.setShaderStage( previousShaderStage );\n\n\t\treturn flowData;\n\n\t}\n\n\tgetAttributes( /*shaderStage*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tgetVaryings( /*shaderStage*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tgetVars( shaderStage ) {\n\n\t\tlet snippet = '';\n\n\t\tconst vars = this.vars[ shaderStage ];\n\n\t\tfor ( const variable of vars ) {\n\n\t\t\tsnippet += `${variable.type} ${variable.name}; `;\n\n\t\t}\n\n\t\treturn snippet;\n\n\t}\n\n\tgetUniforms( /*shaderStage*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tgetCodes( shaderStage ) {\n\n\t\tconst codes = this.codes[ shaderStage ];\n\n\t\tlet code = '';\n\n\t\tfor ( const nodeCode of codes ) {\n\n\t\t\tcode += nodeCode.code + '\\n';\n\n\t\t}\n\n\t\treturn code;\n\n\t}\n\n\tgetHash() {\n\n\t\treturn this.vertexShader + this.fragmentShader + this.computeShader;\n\n\t}\n\n\tsetShaderStage( shaderStage ) {\n\n\t\tthis.shaderStage = shaderStage;\n\n\t}\n\n\tgetShaderStage() {\n\n\t\treturn this.shaderStage;\n\n\t}\n\n\tsetBuildStage( buildStage ) {\n\n\t\tthis.buildStage = buildStage;\n\n\t}\n\n\tgetBuildStage() {\n\n\t\treturn this.buildStage;\n\n\t}\n\n\tbuildCode() {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n\tbuild() {\n\n\t\t// construct() -> stage 1: create possible new nodes and returns an output reference node\n\t\t// analyze()   -> stage 2: analyze nodes to possible optimization and validation\n\t\t// generate()  -> stage 3: generate shader\n\n\t\tfor ( const buildStage of defaultBuildStages ) {\n\n\t\t\tthis.setBuildStage( buildStage );\n\n\t\t\tif ( this.context.vertex && this.context.vertex.isNode ) {\n\n\t\t\t\tthis.flowNodeFromShaderStage( 'vertex', this.context.vertex );\n\n\t\t\t}\n\n\t\t\tfor ( const shaderStage of shaderStages ) {\n\n\t\t\t\tthis.setShaderStage( shaderStage );\n\n\t\t\t\tconst flowNodes = this.flowNodes[ shaderStage ];\n\n\t\t\t\tfor ( const node of flowNodes ) {\n\n\t\t\t\t\tif ( buildStage === 'generate' ) {\n\n\t\t\t\t\t\tthis.flowNode( node );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tnode.build( this );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setBuildStage( null );\n\t\tthis.setShaderStage( null );\n\n\t\t// stage 4: build code for a specific output\n\n\t\tthis.buildCode();\n\n\t\treturn this;\n\n\t}\n\n\tformat( snippet, fromType, toType ) {\n\n\t\tfromType = this.getVectorType( fromType );\n\t\ttoType = this.getVectorType( toType );\n\n\t\tif ( fromType === toType || toType === null || this.isReference( toType ) ) {\n\n\t\t\treturn snippet;\n\n\t\t}\n\n\t\tconst fromTypeLength = this.getTypeLength( fromType );\n\t\tconst toTypeLength = this.getTypeLength( toType );\n\n\t\tif ( fromTypeLength > 4 ) { // fromType is matrix-like\n\n\t\t\t// @TODO: ignore for now\n\n\t\t\treturn snippet;\n\n\t\t}\n\n\t\tif ( toTypeLength > 4 || toTypeLength === 0 ) { // toType is matrix-like or unknown\n\n\t\t\t// @TODO: ignore for now\n\n\t\t\treturn snippet;\n\n\t\t}\n\n\t\tif ( fromTypeLength === toTypeLength ) {\n\n\t\t\treturn `${ this.getType( toType ) }( ${ snippet } )`;\n\n\t\t}\n\n\t\tif ( fromTypeLength > toTypeLength ) {\n\n\t\t\treturn this.format( `${ snippet }.${ 'xyz'.slice( 0, toTypeLength ) }`, this.getTypeFromLength( toTypeLength, this.getComponentType( fromType ) ), toType );\n\n\t\t}\n\n\t\tif ( toTypeLength === 4 ) { // toType is vec4-like\n\n\t\t\treturn `${ this.getType( toType ) }( ${ this.format( snippet, fromType, 'vec3' ) }, 1.0 )`;\n\n\t\t}\n\n\t\tif ( fromTypeLength === 2 ) { // fromType is vec2-like and toType is vec3-like\n\n\t\t\treturn `${ this.getType( toType ) }( ${ this.format( snippet, fromType, 'vec2' ) }, 0.0 )`;\n\n\t\t}\n\n\t\treturn `${ this.getType( toType ) }( ${ snippet } )`; // fromType is float-like\n\n\t}\n\n\tgetSignature() {\n\n\t\treturn `// Three.js r${ REVISION } - NodeMaterial System\\n`;\n\n\t}\n\n}\n\nexport default NodeBuilder;\n","import { NodeUpdateType } from './constants.js';\n\nclass NodeFrame {\n\n\tconstructor() {\n\n\t\tthis.time = 0;\n\t\tthis.deltaTime = 0;\n\n\t\tthis.frameId = 0;\n\t\tthis.renderId = 0;\n\n\t\tthis.startTime = null;\n\n\t\tthis.frameMap = new WeakMap();\n\t\tthis.frameBeforeMap = new WeakMap();\n\t\tthis.renderMap = new WeakMap();\n\t\tthis.renderBeforeMap = new WeakMap();\n\n\t\tthis.renderer = null;\n\t\tthis.material = null;\n\t\tthis.camera = null;\n\t\tthis.object = null;\n\t\tthis.scene = null;\n\n\t}\n\n\tupdateBeforeNode( node ) {\n\n\t\tconst updateType = node.getUpdateBeforeType();\n\n\t\tif ( updateType === NodeUpdateType.FRAME ) {\n\n\t\t\tif ( this.frameBeforeMap.get( node ) !== this.frameId ) {\n\n\t\t\t\tthis.frameBeforeMap.set( node, this.frameId );\n\n\t\t\t\tnode.updateBefore( this );\n\n\t\t\t}\n\n\t\t} else if ( updateType === NodeUpdateType.RENDER ) {\n\n\t\t\tif ( this.renderBeforeMap.get( node ) !== this.renderId || this.frameBeforeMap.get( node ) !== this.frameId ) {\n\n\t\t\t\tthis.renderBeforeMap.set( node, this.renderId );\n\t\t\t\tthis.frameBeforeMap.set( node, this.frameId );\n\n\t\t\t\tnode.updateBefore( this );\n\n\t\t\t}\n\n\t\t} else if ( updateType === NodeUpdateType.OBJECT ) {\n\n\t\t\tnode.updateBefore( this );\n\n\t\t}\n\n\t}\n\n\tupdateNode( node ) {\n\n\t\tconst updateType = node.getUpdateType();\n\n\t\tif ( updateType === NodeUpdateType.FRAME ) {\n\n\t\t\tif ( this.frameMap.get( node ) !== this.frameId ) {\n\n\t\t\t\tthis.frameMap.set( node, this.frameId );\n\n\t\t\t\tnode.update( this );\n\n\t\t\t}\n\n\t\t} else if ( updateType === NodeUpdateType.RENDER ) {\n\n\t\t\tif ( this.renderMap.get( node ) !== this.renderId || this.frameMap.get( node ) !== this.frameId ) {\n\n\t\t\t\tthis.renderMap.set( node, this.renderId );\n\t\t\t\tthis.frameMap.set( node, this.frameId );\n\n\t\t\t\tnode.update( this );\n\n\t\t\t}\n\n\t\t} else if ( updateType === NodeUpdateType.OBJECT ) {\n\n\t\t\tnode.update( this );\n\n\t\t}\n\n\t}\n\n\tupdate() {\n\n\t\tthis.frameId ++;\n\n\t\tif ( this.lastTime === undefined ) this.lastTime = performance.now();\n\n\t\tthis.deltaTime = ( performance.now() - this.lastTime ) / 1000;\n\n\t\tthis.lastTime = performance.now();\n\n\t\tthis.time += this.deltaTime;\n\n\t}\n\n}\n\nexport default NodeFrame;\n","class NodeFunctionInput {\n\n\tconstructor( type, name, count = null, qualifier = '', isConst = false ) {\n\n\t\tthis.type = type;\n\t\tthis.name = name;\n\t\tthis.count = count;\n\t\tthis.qualifier = qualifier;\n\t\tthis.isConst = isConst;\n\n\t}\n\n}\n\nNodeFunctionInput.isNodeFunctionInput = true;\n\nexport default NodeFunctionInput;\n","import Node, { addNodeClass } from './Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass VarNode extends Node {\n\n\tconstructor( node, name = null ) {\n\n\t\tsuper();\n\n\t\tthis.node = node;\n\t\tthis.name = name;\n\n\t}\n\n\tassign( node ) {\n\n\t\tnode.traverse( ( childNode, replaceNode ) => {\n\n\t\t\tif ( replaceNode && childNode.uuid === this.uuid ) {\n\n\t\t\t\treplaceNode( this.node );\n\n\t\t\t}\n\n\t\t} );\n\t\tthis.node = node;\n\t\treturn this;\n\n\t}\n\n\tisGlobal() {\n\n\t\treturn true;\n\n\t}\n\n\tgetHash( builder ) {\n\n\t\treturn this.name || super.getHash( builder );\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.node.getNodeType( builder );\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst node = this.node;\n\t\tconst name = this.name;\n\n\t\tif ( name === null && node.isTempNode === true ) {\n\n\t\t\treturn node.build( builder );\n\n\t\t}\n\n\t\tconst type = builder.getVectorType( this.getNodeType( builder ) );\n\n\t\tconst snippet = node.build( builder, type );\n\t\tconst nodeVar = builder.getVarFromNode( this, type );\n\n\t\tif ( name !== null ) {\n\n\t\t\tnodeVar.name = name;\n\n\t\t}\n\n\t\tconst propertyName = builder.getPropertyName( nodeVar );\n\n\t\tbuilder.addLineFlowCode( `${propertyName} = ${snippet}` );\n\n\t\treturn propertyName;\n\n\t}\n\n}\n\nexport default VarNode;\n\nexport const label = nodeProxy( VarNode );\nexport const temp = label;\n\naddNodeElement( 'label', label );\naddNodeElement( 'temp', temp );\n\naddNodeClass( VarNode );\n","import TempNode from '../core/TempNode.js';\nimport { sub, mul, div } from './OperatorNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { addNodeElement, nodeObject, nodeProxy, float, vec3, vec4 } from '../shadernode/ShaderNode.js';\n\nclass MathNode extends TempNode {\n\n\tconstructor( method, aNode, bNode = null, cNode = null ) {\n\n\t\tsuper();\n\n\t\tthis.method = method;\n\n\t\tthis.aNode = aNode;\n\t\tthis.bNode = bNode;\n\t\tthis.cNode = cNode;\n\n\t}\n\n\tgetInputType( builder ) {\n\n\t\tconst aType = this.aNode.getNodeType( builder );\n\t\tconst bType = this.bNode ? this.bNode.getNodeType( builder ) : null;\n\t\tconst cType = this.cNode ? this.cNode.getNodeType( builder ) : null;\n\n\t\tconst aLen = builder.isMatrix( aType ) ? 0 : builder.getTypeLength( aType );\n\t\tconst bLen = builder.isMatrix( bType ) ? 0 : builder.getTypeLength( bType );\n\t\tconst cLen = builder.isMatrix( cType ) ? 0 : builder.getTypeLength( cType );\n\n\t\tif ( aLen > bLen && aLen > cLen ) {\n\n\t\t\treturn aType;\n\n\t\t} else if ( bLen > cLen ) {\n\n\t\t\treturn bType;\n\n\t\t} else if ( cLen > aLen ) {\n\n\t\t\treturn cType;\n\n\t\t}\n\n\t\treturn aType;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst method = this.method;\n\n\t\tif ( method === MathNode.LENGTH || method === MathNode.DISTANCE || method === MathNode.DOT ) {\n\n\t\t\treturn 'float';\n\n\t\t} else if ( method === MathNode.CROSS ) {\n\n\t\t\treturn 'vec3';\n\n\t\t} else {\n\n\t\t\treturn this.getInputType( builder );\n\n\t\t}\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst method = this.method;\n\n\t\tconst type = this.getNodeType( builder );\n\t\tconst inputType = this.getInputType( builder );\n\n\t\tconst a = this.aNode;\n\t\tconst b = this.bNode;\n\t\tconst c = this.cNode;\n\n\t\tconst isWebGL = builder.renderer.isWebGLRenderer === true;\n\n\t\tif ( method === MathNode.TRANSFORM_DIRECTION ) {\n\n\t\t\t// dir can be either a direction vector or a normal vector\n\t\t\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\t\t\tlet tA = a;\n\t\t\tlet tB = b;\n\n\t\t\tif ( builder.isMatrix( tA.getNodeType( builder ) ) ) {\n\n\t\t\t\ttB = vec4( vec3( tB ), 0.0 );\n\n\t\t\t} else {\n\n\t\t\t\ttA = vec4( vec3( tA ), 0.0 );\n\n\t\t\t}\n\n\t\t\tconst mulNode = mul( tA, tB ).xyz;\n\n\t\t\treturn normalize( mulNode ).build( builder, output );\n\n\t\t} else if ( method === MathNode.NEGATE ) {\n\n\t\t\treturn builder.format( '-' + a.build( builder, inputType ), type, output );\n\n\t\t} else if ( method === MathNode.ONE_MINUS ) {\n\n\t\t\treturn sub( 1.0, a ).build( builder, output );\n\n\t\t} else if ( method === MathNode.RECIPROCAL ) {\n\n\t\t\treturn div( 1.0, a ).build( builder, output );\n\n\t\t} else if ( method === MathNode.DIFFERENCE ) {\n\n\t\t\treturn abs( sub( a, b ) ).build( builder, output );\n\n\t\t} else {\n\n\t\t\tconst params = [];\n\n\t\t\tif ( method === MathNode.CROSS ) {\n\n\t\t\t\tparams.push(\n\t\t\t\t\ta.build( builder, type ),\n\t\t\t\t\tb.build( builder, type )\n\t\t\t\t);\n\n\t\t\t} else if ( method === MathNode.STEP ) {\n\n\t\t\t\tparams.push(\n\t\t\t\t\ta.build( builder, builder.getTypeLength( a.getNodeType( builder ) ) === 1 ? 'float' : inputType ),\n\t\t\t\t\tb.build( builder, inputType )\n\t\t\t\t);\n\n\t\t\t} else if ( ( isWebGL && ( method === MathNode.MIN || method === MathNode.MAX ) ) || method === MathNode.MOD ) {\n\n\t\t\t\tparams.push(\n\t\t\t\t\ta.build( builder, inputType ),\n\t\t\t\t\tb.build( builder, builder.getTypeLength( b.getNodeType( builder ) ) === 1 ? 'float' : inputType )\n\t\t\t\t);\n\n\t\t\t} else if ( method === MathNode.REFRACT ) {\n\n\t\t\t\tparams.push(\n\t\t\t\t\ta.build( builder, inputType ),\n\t\t\t\t\tb.build( builder, inputType ),\n\t\t\t\t\tc.build( builder, 'float' )\n\t\t\t\t);\n\n\t\t\t} else if ( method === MathNode.MIX ) {\n\n\t\t\t\tparams.push(\n\t\t\t\t\ta.build( builder, inputType ),\n\t\t\t\t\tb.build( builder, inputType ),\n\t\t\t\t\tc.build( builder, builder.getTypeLength( c.getNodeType( builder ) ) === 1 ? 'float' : inputType )\n\t\t\t\t);\n\n\t\t\t} else {\n\n\t\t\t\tparams.push( a.build( builder, inputType ) );\n\t\t\t\tif ( b !== null ) params.push( b.build( builder, inputType ) );\n\t\t\t\tif ( c !== null ) params.push( c.build( builder, inputType ) );\n\n\t\t\t}\n\n\t\t\treturn builder.format( `${ builder.getMethod( method ) }( ${params.join( ', ' )} )`, type, output );\n\n\t\t}\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.method = this.method;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.method = data.method;\n\n\t}\n\n}\n\n// 1 input\n\nMathNode.RADIANS = 'radians';\nMathNode.DEGREES = 'degrees';\nMathNode.EXP = 'exp';\nMathNode.EXP2 = 'exp2';\nMathNode.LOG = 'log';\nMathNode.LOG2 = 'log2';\nMathNode.SQRT = 'sqrt';\nMathNode.INVERSE_SQRT = 'inversesqrt';\nMathNode.FLOOR = 'floor';\nMathNode.CEIL = 'ceil';\nMathNode.NORMALIZE = 'normalize';\nMathNode.FRACT = 'fract';\nMathNode.SIN = 'sin';\nMathNode.COS = 'cos';\nMathNode.TAN = 'tan';\nMathNode.ASIN = 'asin';\nMathNode.ACOS = 'acos';\nMathNode.ATAN = 'atan';\nMathNode.ABS = 'abs';\nMathNode.SIGN = 'sign';\nMathNode.LENGTH = 'length';\nMathNode.NEGATE = 'negate';\nMathNode.ONE_MINUS = 'oneMinus';\nMathNode.DFDX = 'dFdx';\nMathNode.DFDY = 'dFdy';\nMathNode.ROUND = 'round';\nMathNode.RECIPROCAL = 'reciprocal';\n\n// 2 inputs\n\nMathNode.ATAN2 = 'atan2';\nMathNode.MIN = 'min';\nMathNode.MAX = 'max';\nMathNode.MOD = 'mod';\nMathNode.STEP = 'step';\nMathNode.REFLECT = 'reflect';\nMathNode.DISTANCE = 'distance';\nMathNode.DIFFERENCE = 'difference';\nMathNode.DOT = 'dot';\nMathNode.CROSS = 'cross';\nMathNode.POW = 'pow';\nMathNode.TRANSFORM_DIRECTION = 'transformDirection';\n\n// 3 inputs\n\nMathNode.MIX = 'mix';\nMathNode.CLAMP = 'clamp';\nMathNode.REFRACT = 'refract';\nMathNode.SMOOTHSTEP = 'smoothstep';\nMathNode.FACEFORWARD = 'faceforward';\n\nexport default MathNode;\n\nexport const EPSILON = float( 1e-6 );\nexport const INFINITY = float( 1e6 );\n\nexport const radians = nodeProxy( MathNode, MathNode.RADIANS );\nexport const degrees = nodeProxy( MathNode, MathNode.DEGREES );\nexport const exp = nodeProxy( MathNode, MathNode.EXP );\nexport const exp2 = nodeProxy( MathNode, MathNode.EXP2 );\nexport const log = nodeProxy( MathNode, MathNode.LOG );\nexport const log2 = nodeProxy( MathNode, MathNode.LOG2 );\nexport const sqrt = nodeProxy( MathNode, MathNode.SQRT );\nexport const inverseSqrt = nodeProxy( MathNode, MathNode.INVERSE_SQRT );\nexport const floor = nodeProxy( MathNode, MathNode.FLOOR );\nexport const ceil = nodeProxy( MathNode, MathNode.CEIL );\nexport const normalize = nodeProxy( MathNode, MathNode.NORMALIZE );\nexport const fract = nodeProxy( MathNode, MathNode.FRACT );\nexport const sin = nodeProxy( MathNode, MathNode.SIN );\nexport const cos = nodeProxy( MathNode, MathNode.COS );\nexport const tan = nodeProxy( MathNode, MathNode.TAN );\nexport const asin = nodeProxy( MathNode, MathNode.ASIN );\nexport const acos = nodeProxy( MathNode, MathNode.ACOS );\nexport const atan = nodeProxy( MathNode, MathNode.ATAN );\nexport const abs = nodeProxy( MathNode, MathNode.ABS );\nexport const sign = nodeProxy( MathNode, MathNode.SIGN );\nexport const length = nodeProxy( MathNode, MathNode.LENGTH );\nexport const negate = nodeProxy( MathNode, MathNode.NEGATE );\nexport const oneMinus = nodeProxy( MathNode, MathNode.ONE_MINUS );\nexport const dFdx = nodeProxy( MathNode, MathNode.DFDX );\nexport const dFdy = nodeProxy( MathNode, MathNode.DFDY );\nexport const round = nodeProxy( MathNode, MathNode.ROUND );\nexport const reciprocal = nodeProxy( MathNode, MathNode.RECIPROCAL );\n\nexport const atan2 = nodeProxy( MathNode, MathNode.ATAN2 );\nexport const min = nodeProxy( MathNode, MathNode.MIN );\nexport const max = nodeProxy( MathNode, MathNode.MAX );\nexport const mod = nodeProxy( MathNode, MathNode.MOD );\nexport const step = nodeProxy( MathNode, MathNode.STEP );\nexport const reflect = nodeProxy( MathNode, MathNode.REFLECT );\nexport const distance = nodeProxy( MathNode, MathNode.DISTANCE );\nexport const difference = nodeProxy( MathNode, MathNode.DIFFERENCE );\nexport const dot = nodeProxy( MathNode, MathNode.DOT );\nexport const cross = nodeProxy( MathNode, MathNode.CROSS );\nexport const pow = nodeProxy( MathNode, MathNode.POW );\nexport const pow2 = nodeProxy( MathNode, MathNode.POW, 2 );\nexport const pow3 = nodeProxy( MathNode, MathNode.POW, 3 );\nexport const pow4 = nodeProxy( MathNode, MathNode.POW, 4 );\nexport const transformDirection = nodeProxy( MathNode, MathNode.TRANSFORM_DIRECTION );\n\nexport const mix = nodeProxy( MathNode, MathNode.MIX );\nexport const clamp = ( value, low = 0, high = 1 ) => nodeObject( new MathNode( MathNode.CLAMP, nodeObject( value ), nodeObject( low ), nodeObject( high ) ) );\nexport const saturate = ( value ) => clamp( value );\nexport const refract = nodeProxy( MathNode, MathNode.REFRACT );\nexport const smoothstep = nodeProxy( MathNode, MathNode.SMOOTHSTEP );\nexport const faceForward = nodeProxy( MathNode, MathNode.FACEFORWARD );\n\nexport const mixElement = ( t, e1, e2 ) => mix( e1, e2, t );\nexport const smoothstepElement = ( x, low, high ) => smoothstep( low, high, x );\n\naddNodeElement( 'radians', radians );\naddNodeElement( 'degrees', degrees );\naddNodeElement( 'exp', exp );\naddNodeElement( 'exp2', exp2 );\naddNodeElement( 'log', log );\naddNodeElement( 'log2', log2 );\naddNodeElement( 'sqrt', sqrt );\naddNodeElement( 'inverseSqrt', inverseSqrt );\naddNodeElement( 'floor', floor );\naddNodeElement( 'ceil', ceil );\naddNodeElement( 'normalize', normalize );\naddNodeElement( 'fract', fract );\naddNodeElement( 'sin', sin );\naddNodeElement( 'cos', cos );\naddNodeElement( 'tan', tan );\naddNodeElement( 'asin', asin );\naddNodeElement( 'acos', acos );\naddNodeElement( 'atan', atan );\naddNodeElement( 'abs', abs );\naddNodeElement( 'sign', sign );\naddNodeElement( 'length', length );\naddNodeElement( 'negate', negate );\naddNodeElement( 'oneMinus', oneMinus );\naddNodeElement( 'dFdx', dFdx );\naddNodeElement( 'dFdy', dFdy );\naddNodeElement( 'round', round );\naddNodeElement( 'reciprocal', reciprocal );\naddNodeElement( 'atan2', atan2 );\naddNodeElement( 'min', min );\naddNodeElement( 'max', max );\naddNodeElement( 'mod', mod );\naddNodeElement( 'step', step );\naddNodeElement( 'reflect', reflect );\naddNodeElement( 'distance', distance );\naddNodeElement( 'dot', dot );\naddNodeElement( 'cross', cross );\naddNodeElement( 'pow', pow );\naddNodeElement( 'pow2', pow2 );\naddNodeElement( 'pow3', pow3 );\naddNodeElement( 'pow4', pow4 );\naddNodeElement( 'transformDirection', transformDirection );\naddNodeElement( 'mix', mixElement );\naddNodeElement( 'clamp', clamp );\naddNodeElement( 'refract', refract );\naddNodeElement( 'smoothstep', smoothstepElement );\naddNodeElement( 'faceForward', faceForward );\naddNodeElement( 'difference', difference );\naddNodeElement( 'saturate', saturate );\n\naddNodeClass( MathNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\n\nimport { Vector3 } from 'three';\n\nclass Object3DNode extends Node {\n\n\tconstructor( scope = Object3DNode.VIEW_MATRIX, object3d = null ) {\n\n\t\tsuper();\n\n\t\tthis.scope = scope;\n\t\tthis.object3d = object3d;\n\n\t\tthis.updateType = NodeUpdateType.OBJECT;\n\n\t\tthis._uniformNode = uniform( null );\n\n\t}\n\n\tgetNodeType() {\n\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === Object3DNode.WORLD_MATRIX || scope === Object3DNode.VIEW_MATRIX ) {\n\n\t\t\treturn 'mat4';\n\n\t\t} else if ( scope === Object3DNode.NORMAL_MATRIX ) {\n\n\t\t\treturn 'mat3';\n\n\t\t} else if ( scope === Object3DNode.POSITION || scope === Object3DNode.VIEW_POSITION || scope === Object3DNode.DIRECTION ) {\n\n\t\t\treturn 'vec3';\n\n\t\t}\n\n\t}\n\n\tupdate( frame ) {\n\n\t\tconst object = this.object3d;\n\t\tconst uniformNode = this._uniformNode;\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === Object3DNode.VIEW_MATRIX ) {\n\n\t\t\tuniformNode.value = object.modelViewMatrix;\n\n\t\t} else if ( scope === Object3DNode.NORMAL_MATRIX ) {\n\n\t\t\tuniformNode.value = object.normalMatrix;\n\n\t\t} else if ( scope === Object3DNode.WORLD_MATRIX ) {\n\n\t\t\tuniformNode.value = object.matrixWorld;\n\n\t\t} else if ( scope === Object3DNode.POSITION ) {\n\n\t\t\tuniformNode.value = uniformNode.value || new Vector3();\n\n\t\t\tuniformNode.value.setFromMatrixPosition( object.matrixWorld );\n\n\t\t} else if ( scope === Object3DNode.DIRECTION ) {\n\n\t\t\tuniformNode.value = uniformNode.value || new Vector3();\n\n\t\t\tobject.getWorldDirection( uniformNode.value );\n\n\t\t} else if ( scope === Object3DNode.VIEW_POSITION ) {\n\n\t\t\tconst camera = frame.camera;\n\n\t\t\tuniformNode.value = uniformNode.value || new Vector3();\n\t\t\tuniformNode.value.setFromMatrixPosition( object.matrixWorld );\n\n\t\t\tuniformNode.value.applyMatrix4( camera.matrixWorldInverse );\n\n\t\t}\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === Object3DNode.WORLD_MATRIX || scope === Object3DNode.VIEW_MATRIX ) {\n\n\t\t\tthis._uniformNode.nodeType = 'mat4';\n\n\t\t} else if ( scope === Object3DNode.NORMAL_MATRIX ) {\n\n\t\t\tthis._uniformNode.nodeType = 'mat3';\n\n\t\t} else if ( scope === Object3DNode.POSITION || scope === Object3DNode.VIEW_POSITION || scope === Object3DNode.DIRECTION ) {\n\n\t\t\tthis._uniformNode.nodeType = 'vec3';\n\n\t\t}\n\n\t\treturn this._uniformNode.build( builder );\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.scope = this.scope;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.scope = data.scope;\n\n\t}\n\n}\n\nObject3DNode.VIEW_MATRIX = 'viewMatrix';\nObject3DNode.NORMAL_MATRIX = 'normalMatrix';\nObject3DNode.WORLD_MATRIX = 'worldMatrix';\nObject3DNode.POSITION = 'position';\nObject3DNode.VIEW_POSITION = 'viewPosition';\nObject3DNode.DIRECTION = 'direction';\n\nexport default Object3DNode;\n\nexport const objectDirection = nodeProxy( Object3DNode, Object3DNode.DIRECTION );\nexport const objectViewMatrix = nodeProxy( Object3DNode, Object3DNode.VIEW_MATRIX );\nexport const objectNormalMatrix = nodeProxy( Object3DNode, Object3DNode.NORMAL_MATRIX );\nexport const objectWorldMatrix = nodeProxy( Object3DNode, Object3DNode.WORLD_MATRIX );\nexport const objectPosition = nodeProxy( Object3DNode, Object3DNode.POSITION );\nexport const objectViewPosition = nodeProxy( Object3DNode, Object3DNode.VIEW_POSITION );\n\naddNodeClass( Object3DNode );\n","import Object3DNode from './Object3DNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass ModelNode extends Object3DNode {\n\n\tconstructor( scope = ModelNode.VIEW_MATRIX ) {\n\n\t\tsuper( scope );\n\n\t}\n\n\tupdate( frame ) {\n\n\t\tthis.object3d = frame.object;\n\n\t\tsuper.update( frame );\n\n\t}\n\n}\n\nexport default ModelNode;\n\nexport const modelDirection = nodeImmutable( ModelNode, ModelNode.DIRECTION );\nexport const modelViewMatrix = nodeImmutable( ModelNode, ModelNode.VIEW_MATRIX );\nexport const modelNormalMatrix = nodeImmutable( ModelNode, ModelNode.NORMAL_MATRIX );\nexport const modelWorldMatrix = nodeImmutable( ModelNode, ModelNode.WORLD_MATRIX );\nexport const modelPosition = nodeImmutable( ModelNode, ModelNode.POSITION );\nexport const modelViewPosition = nodeImmutable( ModelNode, ModelNode.VIEW_POSITION );\n\naddNodeClass( ModelNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { varying } from '../core/VaryingNode.js';\nimport { normalize } from '../math/MathNode.js';\nimport { modelWorldMatrix, modelViewMatrix } from './ModelNode.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass PositionNode extends Node {\n\n\tconstructor( scope = PositionNode.LOCAL ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.scope = scope;\n\n\t}\n\n\tisGlobal() {\n\n\t\treturn true;\n\n\t}\n\n\tgetHash( /*builder*/ ) {\n\n\t\treturn `position-${this.scope}`;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tlet outputNode = null;\n\n\t\tif ( scope === PositionNode.GEOMETRY ) {\n\n\t\t\toutputNode = attribute( 'position', 'vec3' );\n\n\t\t} else if ( scope === PositionNode.LOCAL ) {\n\n\t\t\toutputNode = varying( positionGeometry );\n\n\t\t} else if ( scope === PositionNode.WORLD ) {\n\n\t\t\tconst vertexPositionNode = modelWorldMatrix.mul( positionLocal );\n\t\t\toutputNode = varying( vertexPositionNode );\n\n\t\t} else if ( scope === PositionNode.VIEW ) {\n\n\t\t\tconst vertexPositionNode = modelViewMatrix.mul( positionLocal );\n\t\t\toutputNode = varying( vertexPositionNode );\n\n\t\t} else if ( scope === PositionNode.VIEW_DIRECTION ) {\n\n\t\t\tconst vertexPositionNode = positionView.negate();\n\t\t\toutputNode = normalize( varying( vertexPositionNode ) );\n\n\t\t} else if ( scope === PositionNode.WORLD_DIRECTION ) {\n\n\t\t\tconst vertexPositionNode = positionLocal.transformDirection( modelWorldMatrix );\n\t\t\toutputNode = normalize( varying( vertexPositionNode ) );\n\n\t\t}\n\n\t\treturn outputNode.build( builder, this.getNodeType( builder ) );\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.scope = this.scope;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.scope = data.scope;\n\n\t}\n\n}\n\nPositionNode.GEOMETRY = 'geometry';\nPositionNode.LOCAL = 'local';\nPositionNode.WORLD = 'world';\nPositionNode.WORLD_DIRECTION = 'worldDirection';\nPositionNode.VIEW = 'view';\nPositionNode.VIEW_DIRECTION = 'viewDirection';\n\nexport default PositionNode;\n\nexport const positionGeometry = nodeImmutable( PositionNode, PositionNode.GEOMETRY );\nexport const positionLocal = nodeImmutable( PositionNode, PositionNode.LOCAL );\nexport const positionWorld = nodeImmutable( PositionNode, PositionNode.WORLD );\nexport const positionWorldDirection = nodeImmutable( PositionNode, PositionNode.WORLD_DIRECTION );\nexport const positionView = nodeImmutable( PositionNode, PositionNode.VIEW );\nexport const positionViewDirection = nodeImmutable( PositionNode, PositionNode.VIEW_DIRECTION );\n\naddNodeClass( PositionNode );\n","import TempNode from '../core/TempNode.js';\nimport { negate } from '../math/MathNode.js';\nimport { positionWorldDirection } from '../accessors/PositionNode.js';\nimport { nodeProxy, vec2 } from '../shadernode/ShaderNode.js';\nimport { addNodeClass } from '../core/Node.js';\n\nclass EquirectUVNode extends TempNode {\n\n\tconstructor( dirNode = positionWorldDirection ) {\n\n\t\tsuper( 'vec2' );\n\n\t\tthis.dirNode = dirNode;\n\n\t}\n\n\tconstruct() {\n\n\t\tconst dir = negate( this.dirNode );\n\n\t\tconst u = dir.z.atan2( dir.x ).mul( 1 / ( Math.PI * 2 ) ).add( 0.5 );\n\t\tconst v = dir.y.clamp( - 1.0, 1.0 ).asin().mul( 1 / Math.PI ).add( 0.5 );\n\n\t\treturn vec2( u, v );\n\n\t}\n\n}\n\nexport default EquirectUVNode;\n\nexport const equirectUV = nodeProxy( EquirectUVNode );\n\naddNodeClass( EquirectUVNode );\n","import Object3DNode from './Object3DNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass CameraNode extends Object3DNode {\n\n\tconstructor( scope = CameraNode.POSITION ) {\n\n\t\tsuper( scope );\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === CameraNode.PROJECTION_MATRIX ) {\n\n\t\t\treturn 'mat4';\n\n\t\t}\n\n\t\treturn super.getNodeType( builder );\n\n\t}\n\n\tupdate( frame ) {\n\n\t\tconst camera = frame.camera;\n\t\tconst uniformNode = this._uniformNode;\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === CameraNode.PROJECTION_MATRIX ) {\n\n\t\t\tuniformNode.value = camera.projectionMatrix;\n\n\t\t} else if ( scope === CameraNode.VIEW_MATRIX ) {\n\n\t\t\tuniformNode.value = camera.matrixWorldInverse;\n\n\t\t} else {\n\n\t\t\tthis.object3d = camera;\n\n\t\t\tsuper.update( frame );\n\n\t\t}\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === CameraNode.PROJECTION_MATRIX ) {\n\n\t\t\tthis._uniformNode.nodeType = 'mat4';\n\n\t\t}\n\n\t\treturn super.generate( builder );\n\n\t}\n\n}\n\nCameraNode.PROJECTION_MATRIX = 'projectionMatrix';\n\nexport default CameraNode;\n\nexport const cameraProjectionMatrix = nodeImmutable( CameraNode, CameraNode.PROJECTION_MATRIX );\nexport const cameraViewMatrix = nodeImmutable( CameraNode, CameraNode.VIEW_MATRIX );\nexport const cameraNormalMatrix = nodeImmutable( CameraNode, CameraNode.NORMAL_MATRIX );\nexport const cameraWorldMatrix = nodeImmutable( CameraNode, CameraNode.WORLD_MATRIX );\nexport const cameraPosition = nodeImmutable( CameraNode, CameraNode.POSITION );\n\naddNodeClass( CameraNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { label } from '../core/VarNode.js';\nimport { varying } from '../core/VaryingNode.js';\nimport { normalize } from '../math/MathNode.js';\nimport { cameraViewMatrix } from './CameraNode.js';\nimport { modelNormalMatrix } from './ModelNode.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass NormalNode extends Node {\n\n\tconstructor( scope = NormalNode.LOCAL ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.scope = scope;\n\n\t}\n\n\tisGlobal() {\n\n\t\treturn true;\n\n\t}\n\n\tgetHash( /*builder*/ ) {\n\n\t\treturn `normal-${this.scope}`;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tlet outputNode = null;\n\n\t\tif ( scope === NormalNode.GEOMETRY ) {\n\n\t\t\toutputNode = attribute( 'normal', 'vec3' );\n\n\t\t} else if ( scope === NormalNode.LOCAL ) {\n\n\t\t\toutputNode = varying( normalGeometry );\n\n\t\t} else if ( scope === NormalNode.VIEW ) {\n\n\t\t\tconst vertexNode = modelNormalMatrix.mul( normalLocal );\n\t\t\toutputNode = normalize( varying( vertexNode ) );\n\n\t\t} else if ( scope === NormalNode.WORLD ) {\n\n\t\t\t// To use inverseTransformDirection only inverse the param order like this: cameraViewMatrix.transformDirection( normalView )\n\t\t\tconst vertexNode = normalView.transformDirection( cameraViewMatrix );\n\t\t\toutputNode = normalize( varying( vertexNode ) );\n\n\t\t}\n\n\t\treturn outputNode.build( builder, this.getNodeType( builder ) );\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.scope = this.scope;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.scope = data.scope;\n\n\t}\n\n}\n\nNormalNode.GEOMETRY = 'geometry';\nNormalNode.LOCAL = 'local';\nNormalNode.VIEW = 'view';\nNormalNode.WORLD = 'world';\n\nexport default NormalNode;\n\nexport const normalGeometry = nodeImmutable( NormalNode, NormalNode.GEOMETRY );\nexport const normalLocal = nodeImmutable( NormalNode, NormalNode.LOCAL );\nexport const normalView = nodeImmutable( NormalNode, NormalNode.VIEW );\nexport const normalWorld = nodeImmutable( NormalNode, NormalNode.WORLD );\nexport const transformedNormalView = label( normalView, 'TransformedNormalView' );\nexport const transformedNormalWorld = transformedNormalView.transformDirection( cameraViewMatrix ).normalize();\n\naddNodeClass( NormalNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { maxMipLevel } from './MaxMipLevelNode.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass SpecularMIPLevelNode extends Node {\n\n\tconstructor( textureNode, roughnessNode = null ) {\n\n\t\tsuper( 'float' );\n\n\t\tthis.textureNode = textureNode;\n\t\tthis.roughnessNode = roughnessNode;\n\n\t}\n\n\tconstruct() {\n\n\t\tconst { textureNode, roughnessNode } = this;\n\n\t\t// taken from here: http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\n\t\tconst maxMIPLevelScalar = maxMipLevel( textureNode );\n\n\t\tconst sigma = roughnessNode.mul( roughnessNode ).mul( Math.PI ).div( roughnessNode.add( 1.0 ) );\n\t\tconst desiredMIPLevel = maxMIPLevelScalar.add( sigma.log2() );\n\n\t\treturn desiredMIPLevel.clamp( 0.0, maxMIPLevelScalar );\n\n\t}\n\n}\n\nexport default SpecularMIPLevelNode;\n\nexport const specularMIPLevel = nodeProxy( SpecularMIPLevelNode );\n\naddNodeClass( SpecularMIPLevelNode );\n","import { addNodeClass } from '../core/Node.js';\nimport AttributeNode from '../core/AttributeNode.js';\nimport { nodeObject } from '../shadernode/ShaderNode.js';\n\nclass UVNode extends AttributeNode {\n\n\tconstructor( index = 0 ) {\n\n\t\tsuper( null, 'vec2' );\n\n\t\tthis.isUVNode = true;\n\n\t\tthis.index = index;\n\n\t}\n\n\tgetAttributeName( /*builder*/ ) {\n\n\t\tconst index = this.index;\n\n\t\treturn 'uv' + ( index > 0 ? index + 1 : '' );\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.index = this.index;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.index = data.index;\n\n\t}\n\n}\n\nexport default UVNode;\n\nexport const uv = ( ...params ) => nodeObject( new UVNode( ...params ) );\n\naddNodeClass( UVNode );\n","import UniformNode from '../core/UniformNode.js';\nimport { uv } from './UVNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nlet defaultUV;\n\nclass TextureNode extends UniformNode {\n\n\tconstructor( value, uvNode = null, levelNode = null ) {\n\n\t\tsuper( value );\n\n\t\tthis.isTextureNode = true;\n\n\t\tthis.uvNode = uvNode;\n\t\tthis.levelNode = levelNode;\n\n\t}\n\n\tgetUniformHash( /*builder*/ ) {\n\n\t\treturn this.value.uuid;\n\n\t}\n\n\tgetNodeType( /*builder*/ ) {\n\n\t\tif ( this.value.isDepthTexture === true ) return 'float';\n\n\t\treturn 'vec4';\n\n\t}\n\n\tgetInputType( /*builder*/ ) {\n\n\t\treturn 'texture';\n\n\t}\n\n\tgetDefaultUV() {\n\n\t\treturn defaultUV || ( defaultUV = uv() );\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst properties = builder.getNodeProperties( this );\n\n\t\t//\n\n\t\tlet uvNode = this.uvNode;\n\n\t\tif ( uvNode === null && builder.context.getUVNode ) {\n\n\t\t\tuvNode = builder.context.getUVNode( this );\n\n\t\t}\n\n\t\tuvNode || ( uvNode = this.getDefaultUV() );\n\n\t\t//\n\n\t\tlet levelNode = this.levelNode;\n\n\t\tif ( levelNode === null && builder.context.getSamplerLevelNode ) {\n\n\t\t\tlevelNode = builder.context.getSamplerLevelNode( this );\n\n\t\t}\n\n\t\t//\n\n\t\tproperties.uvNode = uvNode;\n\t\tproperties.levelNode = levelNode ? builder.context.getMIPLevelAlgorithmNode( this, levelNode ) : null;\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst { uvNode, levelNode } = builder.getNodeProperties( this );\n\n\t\tconst texture = this.value;\n\n\t\tif ( ! texture || texture.isTexture !== true ) {\n\n\t\t\tthrow new Error( 'TextureNode: Need a three.js texture.' );\n\n\t\t}\n\n\t\tconst textureProperty = super.generate( builder, 'property' );\n\n\t\tif ( output === 'sampler' ) {\n\n\t\t\treturn textureProperty + '_sampler';\n\n\t\t} else if ( builder.isReference( output ) ) {\n\n\t\t\treturn textureProperty;\n\n\t\t} else {\n\n\t\t\tconst nodeType = this.getNodeType( builder );\n\t\t\tconst nodeData = builder.getDataFromNode( this );\n\n\t\t\tlet propertyName = nodeData.propertyName;\n\n\t\t\tif ( propertyName === undefined ) {\n\n\t\t\t\tconst uvSnippet = uvNode.build( builder, 'vec2' );\n\t\t\t\tconst nodeVar = builder.getVarFromNode( this, nodeType );\n\n\t\t\t\tpropertyName = builder.getPropertyName( nodeVar );\n\n\t\t\t\tlet snippet = null;\n\n\t\t\t\tif ( levelNode && levelNode.isNode === true ) {\n\n\t\t\t\t\tconst levelSnippet = levelNode.build( builder, 'float' );\n\n\t\t\t\t\tsnippet = builder.getTextureLevel( texture, textureProperty, uvSnippet, levelSnippet );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsnippet = builder.getTexture( texture, textureProperty, uvSnippet );\n\n\t\t\t\t}\n\n\t\t\t\tbuilder.addLineFlowCode( `${propertyName} = ${snippet}` );\n\n\t\t\t\tnodeData.snippet = snippet;\n\t\t\t\tnodeData.propertyName = propertyName;\n\n\t\t\t}\n\n\t\t\treturn builder.format( propertyName, nodeType, output );\n\n\t\t}\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.value = this.value.toJSON( data.meta ).uuid;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.value = data.meta.textures[ data.value ];\n\n\t}\n\n}\n\nexport default TextureNode;\n\nexport const texture = nodeProxy( TextureNode );\nexport const sampler = ( aTexture ) => ( aTexture.isNode === true ? aTexture : texture( aTexture ) ).convert( 'sampler' );\n\naddNodeElement( 'texture', texture );\n\naddNodeClass( TextureNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { label } from '../core/VarNode.js';\nimport { varying } from '../core/VaryingNode.js';\nimport { normalize } from '../math/MathNode.js';\nimport { cameraViewMatrix } from './CameraNode.js';\nimport { modelViewMatrix } from './ModelNode.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass TangentNode extends Node {\n\n\tconstructor( scope = TangentNode.LOCAL ) {\n\n\t\tsuper();\n\n\t\tthis.scope = scope;\n\n\t}\n\n\tgetHash( /*builder*/ ) {\n\n\t\treturn `tangent-${this.scope}`;\n\n\t}\n\n\tgetNodeType() {\n\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === TangentNode.GEOMETRY ) {\n\n\t\t\treturn 'vec4';\n\n\t\t}\n\n\t\treturn 'vec3';\n\n\t}\n\n\n\tgenerate( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tlet outputNode = null;\n\n\t\tif ( scope === TangentNode.GEOMETRY ) {\n\n\t\t\toutputNode = attribute( 'tangent', 'vec4' );\n\n\t\t} else if ( scope === TangentNode.LOCAL ) {\n\n\t\t\toutputNode = varying( tangentGeometry.xyz );\n\n\t\t} else if ( scope === TangentNode.VIEW ) {\n\n\t\t\tconst vertexNode = modelViewMatrix.mul( tangentLocal ).xyz;\n\t\t\toutputNode = normalize( varying( vertexNode ) );\n\n\t\t} else if ( scope === TangentNode.WORLD ) {\n\n\t\t\tconst vertexNode = tangentView.transformDirection( cameraViewMatrix );\n\t\t\toutputNode = normalize( varying( vertexNode ) );\n\n\t\t}\n\n\t\treturn outputNode.build( builder, this.getNodeType( builder ) );\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.scope = this.scope;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.scope = data.scope;\n\n\t}\n\n}\n\nTangentNode.GEOMETRY = 'geometry';\nTangentNode.LOCAL = 'local';\nTangentNode.VIEW = 'view';\nTangentNode.WORLD = 'world';\n\nexport default TangentNode;\n\nexport const tangentGeometry = nodeImmutable( TangentNode, TangentNode.GEOMETRY );\nexport const tangentLocal = nodeImmutable( TangentNode, TangentNode.LOCAL );\nexport const tangentView = nodeImmutable( TangentNode, TangentNode.VIEW );\nexport const tangentWorld = nodeImmutable( TangentNode, TangentNode.WORLD );\nexport const transformedTangentView = label( tangentView, 'TransformedTangentView' );\nexport const transformedTangentWorld = normalize( transformedTangentView.transformDirection( cameraViewMatrix ) );\n\naddNodeClass( TangentNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { varying } from '../core/VaryingNode.js';\nimport { normalize } from '../math/MathNode.js';\nimport { cameraViewMatrix } from './CameraNode.js';\nimport { normalGeometry, normalLocal, normalView, normalWorld, transformedNormalView } from './NormalNode.js';\nimport { tangentGeometry, tangentLocal, tangentView, tangentWorld, transformedTangentView } from './TangentNode.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass BitangentNode extends Node {\n\n\tconstructor( scope = BitangentNode.LOCAL ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.scope = scope;\n\n\t}\n\n\tgetHash( /*builder*/ ) {\n\n\t\treturn `bitangent-${this.scope}`;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tlet crossNormalTangent;\n\n\t\tif ( scope === BitangentNode.GEOMETRY ) {\n\n\t\t\tcrossNormalTangent = normalGeometry.cross( tangentGeometry );\n\n\t\t} else if ( scope === BitangentNode.LOCAL ) {\n\n\t\t\tcrossNormalTangent = normalLocal.cross( tangentLocal );\n\n\t\t} else if ( scope === BitangentNode.VIEW ) {\n\n\t\t\tcrossNormalTangent = normalView.cross( tangentView );\n\n\t\t} else if ( scope === BitangentNode.WORLD ) {\n\n\t\t\tcrossNormalTangent = normalWorld.cross( tangentWorld );\n\n\t\t}\n\n\t\tconst vertexNode = crossNormalTangent.mul( tangentGeometry.w ).xyz;\n\n\t\tconst outputNode = normalize( varying( vertexNode ) );\n\n\t\treturn outputNode.build( builder, this.getNodeType( builder ) );\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.scope = this.scope;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.scope = data.scope;\n\n\t}\n\n}\n\nBitangentNode.GEOMETRY = 'geometry';\nBitangentNode.LOCAL = 'local';\nBitangentNode.VIEW = 'view';\nBitangentNode.WORLD = 'world';\n\nexport default BitangentNode;\n\nexport const bitangentGeometry = nodeImmutable( BitangentNode, BitangentNode.GEOMETRY );\nexport const bitangentLocal = nodeImmutable( BitangentNode, BitangentNode.LOCAL );\nexport const bitangentView = nodeImmutable( BitangentNode, BitangentNode.VIEW );\nexport const bitangentWorld = nodeImmutable( BitangentNode, BitangentNode.WORLD );\nexport const transformedBitangentView = normalize( transformedNormalView.cross( transformedTangentView ).mul( tangentGeometry.w ) );\nexport const transformedBitangentWorld = normalize( transformedBitangentView.transformDirection( cameraViewMatrix ) );\n\naddNodeClass( BitangentNode );\n","import UniformNode from '../core/UniformNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { nodeObject, getConstNodeType } from '../shadernode/ShaderNode.js';\n\nclass BufferNode extends UniformNode {\n\n\tconstructor( value, bufferType, bufferCount = 0 ) {\n\n\t\tsuper( value, bufferType );\n\n\t\tthis.isBufferNode = true;\n\n\t\tthis.bufferType = bufferType;\n\t\tthis.bufferCount = bufferCount;\n\n\t}\n\n\tgetInputType( /*builder*/ ) {\n\n\t\treturn 'buffer';\n\n\t}\n\n}\n\nexport default BufferNode;\n\nexport const buffer = ( value, nodeOrType, count ) => nodeObject( new BufferNode( value, getConstNodeType( nodeOrType ), count ) );\n\naddNodeClass( BufferNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { cameraViewMatrix } from './CameraNode.js';\nimport { transformedNormalView } from './NormalNode.js';\nimport { positionViewDirection } from './PositionNode.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass ReflectVectorNode extends Node {\n\n\tconstructor() {\n\n\t\tsuper( 'vec3' );\n\n\t}\n\n\tgetHash( /*builder*/ ) {\n\n\t\treturn 'reflectVector';\n\n\t}\n\n\tconstruct() {\n\n\t\tconst reflectView = positionViewDirection.negate().reflect( transformedNormalView );\n\n\t\treturn reflectView.transformDirection( cameraViewMatrix );\n\n\t}\n\n}\n\nexport default ReflectVectorNode;\n\nexport const reflectVector = nodeImmutable( ReflectVectorNode );\n\naddNodeClass( ReflectVectorNode );\n","import TextureNode from './TextureNode.js';\nimport UniformNode from '../core/UniformNode.js';\nimport { reflectVector } from './ReflectVectorNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { addNodeElement, nodeProxy, vec3 } from '../shadernode/ShaderNode.js';\n\nclass CubeTextureNode extends TextureNode {\n\n\tconstructor( value, uvNode = null, levelNode = null ) {\n\n\t\tsuper( value, uvNode, levelNode );\n\n\t\tthis.isCubeTextureNode = true;\n\n\t}\n\n\tgetInputType( /*builder*/ ) {\n\n\t\treturn 'cubeTexture';\n\n\t}\n\n\tgetDefaultUV() {\n\n\t\treturn reflectVector;\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tconst { uvNode, levelNode } = builder.getNodeProperties( this );\n\n\t\tconst texture = this.value;\n\n\t\tif ( ! texture || texture.isCubeTexture !== true ) {\n\n\t\t\tthrow new Error( 'CubeTextureNode: Need a three.js cube texture.' );\n\n\t\t}\n\n\t\tconst textureProperty = UniformNode.prototype.generate.call( this, builder, 'cubeTexture' );\n\n\t\tif ( output === 'sampler' ) {\n\n\t\t\treturn textureProperty + '_sampler';\n\n\t\t} else if ( builder.isReference( output ) ) {\n\n\t\t\treturn textureProperty;\n\n\t\t} else {\n\n\t\t\tconst nodeData = builder.getDataFromNode( this );\n\n\t\t\tlet propertyName = nodeData.propertyName;\n\n\t\t\tif ( propertyName === undefined ) {\n\n\t\t\t\tconst cubeUV = vec3( uvNode.x.negate(), uvNode.yz );\n\t\t\t\tconst uvSnippet = cubeUV.build( builder, 'vec3' );\n\n\t\t\t\tconst nodeVar = builder.getVarFromNode( this, 'vec4' );\n\n\t\t\t\tpropertyName = builder.getPropertyName( nodeVar );\n\n\t\t\t\tlet snippet = null;\n\n\t\t\t\tif ( levelNode && levelNode.isNode === true ) {\n\n\t\t\t\t\tconst levelSnippet = levelNode.build( builder, 'float' );\n\n\t\t\t\t\tsnippet = builder.getTextureLevel( this, textureProperty, uvSnippet, levelSnippet );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsnippet = builder.getTexture( this, textureProperty, uvSnippet );\n\n\t\t\t\t}\n\n\t\t\t\tbuilder.addLineFlowCode( `${propertyName} = ${snippet}` );\n\n\t\t\t\tnodeData.snippet = snippet;\n\t\t\t\tnodeData.propertyName = propertyName;\n\n\t\t\t}\n\n\t\t\treturn builder.format( propertyName, 'vec4', output );\n\n\t\t}\n\n\t}\n\n}\n\nexport default CubeTextureNode;\n\nexport const cubeTexture = nodeProxy( CubeTextureNode );\n\naddNodeElement( 'cubeTexture', cubeTexture );\n\naddNodeClass( CubeTextureNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { texture } from './TextureNode.js';\nimport { nodeObject, getConstNodeType } from '../shadernode/ShaderNode.js';\n\nclass ReferenceNode extends Node {\n\n\tconstructor( property, uniformType, object = null ) {\n\n\t\tsuper();\n\n\t\tthis.property = property;\n\n\t\tthis.uniformType = uniformType;\n\n\t\tthis.object = object;\n\n\t\tthis.node = null;\n\n\t\tthis.updateType = NodeUpdateType.OBJECT;\n\n\t\tthis.setNodeType( uniformType );\n\n\t}\n\n\tsetNodeType( uniformType ) {\n\n\t\tlet node = null;\n\n\t\tif ( uniformType === 'texture' ) {\n\n\t\t\tnode = texture( null );\n\n\t\t} else {\n\n\t\t\tnode = uniform( uniformType );\n\n\t\t}\n\n\t\tthis.node = node;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\treturn this.node.getNodeType( builder );\n\n\t}\n\n\tupdate( frame ) {\n\n\t\tconst object = this.object !== null ? this.object : frame.object;\n\t\tconst property = this.property;\n\n\t\tthis.node.value = object[ property ];\n\n\t}\n\n\tconstruct( /*builder*/ ) {\n\n\t\treturn this.node;\n\n\t}\n\n}\n\nexport default ReferenceNode;\n\nexport const reference = ( name, nodeOrType, object ) => nodeObject( new ReferenceNode( name, getConstNodeType( nodeOrType ), object ) );\n\naddNodeClass( ReferenceNode );\n","import ReferenceNode from './ReferenceNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { nodeObject, getConstNodeType } from '../shadernode/ShaderNode.js';\n\nclass MaterialReferenceNode extends ReferenceNode {\n\n\tconstructor( property, inputType, material = null ) {\n\n\t\tsuper( property, inputType, material );\n\n\t\tthis.material = material;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst material = this.material !== null ? this.material : builder.material;\n\n\t\tthis.node.value = material[ this.property ];\n\n\t\treturn super.construct( builder );\n\n\t}\n\n\tupdate( frame ) {\n\n\t\tthis.object = this.material !== null ? this.material : frame.material;\n\n\t\tsuper.update( frame );\n\n\t}\n\n}\n\nexport default MaterialReferenceNode;\n\nexport const materialReference = ( name, nodeOrType, material ) => nodeObject( new MaterialReferenceNode( name, getConstNodeType( nodeOrType ), material ) );\n\naddNodeClass( MaterialReferenceNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { materialReference } from './MaterialReferenceNode.js';\nimport { uv } from './UVNode.js';\nimport { nodeImmutable, vec3 } from '../shadernode/ShaderNode.js';\n\nclass MaterialNode extends Node {\n\n\tconstructor( scope ) {\n\n\t\tsuper();\n\n\t\tthis.scope = scope;\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst scope = this.scope;\n\t\tconst material = builder.context.material;\n\n\t\tif ( scope === MaterialNode.COLOR ) {\n\n\t\t\treturn material.map !== null ? 'vec4' : 'vec3';\n\n\t\t} else if ( scope === MaterialNode.OPACITY || scope === MaterialNode.ROTATION ) {\n\n\t\t\treturn 'float';\n\n\t\t} else if ( scope === MaterialNode.UV ) {\n\n\t\t\treturn 'vec2';\n\n\t\t} else if ( scope === MaterialNode.EMISSIVE ) {\n\n\t\t\treturn 'vec3';\n\n\t\t} else if ( scope === MaterialNode.ROUGHNESS || scope === MaterialNode.METALNESS || scope === MaterialNode.SPECULAR || scope === MaterialNode.SHININESS ) {\n\n\t\t\treturn 'float';\n\n\t\t}\n\n\t}\n\n\tgetFloat( property ) {\n\n\t\t//@TODO: Check if it can be cached by property name.\n\n\t\treturn materialReference( property, 'float' );\n\n\t}\n\n\tgetColor( property ) {\n\n\t\t//@TODO: Check if it can be cached by property name.\n\n\t\treturn materialReference( property, 'color' );\n\n\t}\n\n\tgetTexture( property ) {\n\n\t\t//@TODO: Check if it can be cached by property name.\n\n\t\tconst textureRefNode = materialReference( property, 'texture' );\n\t\ttextureRefNode.node.uvNode = materialUV;\n\n\t\treturn textureRefNode;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst material = builder.context.material;\n\t\tconst scope = this.scope;\n\n\t\tlet node = null;\n\n\t\tif ( scope === MaterialNode.ALPHA_TEST ) {\n\n\t\t\tnode = this.getFloat( 'alphaTest' );\n\n\t\t} else if ( scope === MaterialNode.COLOR ) {\n\n\t\t\tconst colorNode = this.getColor( 'color' );\n\n\t\t\tif ( material.map && material.map.isTexture === true ) {\n\n\t\t\t\tnode = colorNode.mul( this.getTexture( 'map' ) );\n\n\t\t\t} else {\n\n\t\t\t\tnode = colorNode;\n\n\t\t\t}\n\n\t\t} else if ( scope === MaterialNode.OPACITY ) {\n\n\t\t\tconst opacityNode = this.getFloat( 'opacity' );\n\n\t\t\tif ( material.alphaMap && material.alphaMap.isTexture === true ) {\n\n\t\t\t\tnode = opacityNode.mul( this.getTexture( 'alphaMap' ) );\n\n\t\t\t} else {\n\n\t\t\t\tnode = opacityNode;\n\n\t\t\t}\n\n\t\t} else if ( scope === MaterialNode.SHININESS ) {\n\n\t\t\tnode = this.getFloat( 'shininess' );\n\n\t\t} else if ( scope === MaterialNode.SPECULAR_COLOR ) {\n\n\t\t\tnode = this.getColor( 'specular' );\n\n\t\t} else if ( scope === MaterialNode.REFLECTIVITY ) {\n\n\t\t\tconst reflectivityNode = this.getFloat( 'reflectivity' );\n\n\t\t\tif ( material.specularMap && material.specularMap.isTexture === true ) {\n\n\t\t\t\tnode = reflectivityNode.mul( this.getTexture( 'specularMap' ).r );\n\n\t\t\t} else {\n\n\t\t\t\tnode = reflectivityNode;\n\n\t\t\t}\n\n\t\t} else if ( scope === MaterialNode.ROUGHNESS ) {\n\n\t\t\tconst roughnessNode = this.getFloat( 'roughness' );\n\n\t\t\tif ( material.roughnessMap && material.roughnessMap.isTexture === true ) {\n\n\t\t\t\tnode = roughnessNode.mul( this.getTexture( 'roughnessMap' ).g );\n\n\t\t\t} else {\n\n\t\t\t\tnode = roughnessNode;\n\n\t\t\t}\n\n\t\t} else if ( scope === MaterialNode.METALNESS ) {\n\n\t\t\tconst metalnessNode = this.getFloat( 'metalness' );\n\n\t\t\tif ( material.metalnessMap && material.metalnessMap.isTexture === true ) {\n\n\t\t\t\tnode = metalnessNode.mul( this.getTexture( 'metalnessMap' ).b );\n\n\t\t\t} else {\n\n\t\t\t\tnode = metalnessNode;\n\n\t\t\t}\n\n\t\t} else if ( scope === MaterialNode.EMISSIVE ) {\n\n\t\t\tconst emissiveNode = this.getColor( 'emissive' );\n\n\t\t\tif ( material.emissiveMap && material.emissiveMap.isTexture === true ) {\n\n\t\t\t\tnode = emissiveNode.mul( this.getTexture( 'emissiveMap' ) );\n\n\t\t\t} else {\n\n\t\t\t\tnode = emissiveNode;\n\n\t\t\t}\n\n\t\t} else if ( scope === MaterialNode.ROTATION ) {\n\n\t\t\tnode = this.getFloat( 'rotation' );\n\n\t\t} else if ( scope === MaterialNode.UV ) {\n\n\t\t\t// uv repeat and offset setting priorities\n\n\t\t\tlet uvScaleMap =\n\t\t\t\tmaterial.map ||\n\t\t\t\tmaterial.specularMap ||\n\t\t\t\tmaterial.displacementMap ||\n\t\t\t\tmaterial.normalMap ||\n\t\t\t\tmaterial.bumpMap ||\n\t\t\t\tmaterial.roughnessMap ||\n\t\t\t\tmaterial.metalnessMap ||\n\t\t\t\tmaterial.alphaMap ||\n\t\t\t\tmaterial.emissiveMap ||\n\t\t\t\tmaterial.clearcoatMap ||\n\t\t\t\tmaterial.clearcoatNormalMap ||\n\t\t\t\tmaterial.clearcoatRoughnessMap ||\n\t\t\t\tmaterial.iridescenceMap ||\n\t\t\t\tmaterial.iridescenceThicknessMap ||\n\t\t\t\tmaterial.specularIntensityMap ||\n\t\t\t\tmaterial.specularColorMap ||\n\t\t\t\tmaterial.transmissionMap ||\n\t\t\t\tmaterial.thicknessMap ||\n\t\t\t\tmaterial.sheenColorMap ||\n\t\t\t\tmaterial.sheenRoughnessMap;\n\n\t\t\tif ( uvScaleMap ) {\n\n\t\t\t\t// backwards compatibility\n\t\t\t\tif ( uvScaleMap.isWebGLRenderTarget ) {\n\n\t\t\t\t\tuvScaleMap = uvScaleMap.texture;\n\n\t\t\t\t}\n\n\t\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\n\n\t\t\t\t\tuvScaleMap.updateMatrix();\n\n\t\t\t\t}\n\n\t\t\t\tnode = uniform( uvScaleMap.matrix ).mul( vec3( uv(), 1 ) );\n\n\t\t\t} else {\n\n\t\t\t\tnode = uv();\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst outputType = this.getNodeType( builder );\n\n\t\t\tnode = materialReference( scope, outputType );\n\n\t\t}\n\n\t\treturn node;\n\n\t}\n\n}\n\nMaterialNode.ALPHA_TEST = 'alphaTest';\nMaterialNode.COLOR = 'color';\nMaterialNode.OPACITY = 'opacity';\nMaterialNode.SHININESS = 'shininess';\nMaterialNode.SPECULAR_COLOR = 'specularColor';\nMaterialNode.REFLECTIVITY = 'reflectivity';\nMaterialNode.ROUGHNESS = 'roughness';\nMaterialNode.METALNESS = 'metalness';\nMaterialNode.EMISSIVE = 'emissive';\nMaterialNode.ROTATION = 'rotation';\nMaterialNode.UV = 'uv';\n\nexport default MaterialNode;\n\nexport const materialUV = nodeImmutable( MaterialNode, MaterialNode.UV );\nexport const materialAlphaTest = nodeImmutable( MaterialNode, MaterialNode.ALPHA_TEST );\nexport const materialColor = nodeImmutable( MaterialNode, MaterialNode.COLOR );\nexport const materialShininess = nodeImmutable( MaterialNode, MaterialNode.SHININESS );\nexport const materialEmissive = nodeImmutable( MaterialNode, MaterialNode.EMISSIVE );\nexport const materialOpacity = nodeImmutable( MaterialNode, MaterialNode.OPACITY );\nexport const materialSpecularColor = nodeImmutable( MaterialNode, MaterialNode.SPECULAR_COLOR );\nexport const materialReflectivity = nodeImmutable( MaterialNode, MaterialNode.REFLECTIVITY );\nexport const materialRoughness = nodeImmutable( MaterialNode, MaterialNode.ROUGHNESS );\nexport const materialMetalness = nodeImmutable( MaterialNode, MaterialNode.METALNESS );\nexport const materialRotation = nodeImmutable( MaterialNode, MaterialNode.ROTATION );\n\naddNodeClass( MaterialNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable, float } from '../shadernode/ShaderNode.js';\n\nclass FrontFacingNode extends Node {\n\n\tconstructor() {\n\n\t\tsuper( 'bool' );\n\n\t\tthis.isFrontFacingNode = true;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\treturn builder.getFrontFacing();\n\n\t}\n\n}\n\nexport default FrontFacingNode;\n\nexport const frontFacing = nodeImmutable( FrontFacingNode );\nexport const faceDirection = float( frontFacing ).mul( 2.0 ).sub( 1.0 );\n\naddNodeClass( FrontFacingNode );\n","import TempNode from '../core/TempNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { bitangentView } from '../accessors/BitangentNode.js';\nimport { modelNormalMatrix } from '../accessors/ModelNode.js';\nimport { normalView } from '../accessors/NormalNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { tangentView } from '../accessors/TangentNode.js';\nimport { uv } from '../accessors/UVNode.js';\nimport { faceDirection } from './FrontFacingNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { ShaderNode, nodeProxy, vec3, mat3 } from '../shadernode/ShaderNode.js';\n\nimport { TangentSpaceNormalMap, ObjectSpaceNormalMap } from 'three';\n\n// Normal Mapping Without Precomputed Tangents\n// http://www.thetenthplanet.de/archives/1180\n\nconst perturbNormal2ArbNode = new ShaderNode( ( inputs ) => {\n\n\tconst { eye_pos, surf_norm, mapN, uv } = inputs;\n\n\tconst q0 = eye_pos.dFdx();\n\tconst q1 = eye_pos.dFdy();\n\tconst st0 = uv.dFdx();\n\tconst st1 = uv.dFdy();\n\n\tconst N = surf_norm; // normalized\n\n\tconst q1perp = q1.cross( N );\n\tconst q0perp = N.cross( q0 );\n\n\tconst T = q1perp.mul( st0.x ).add( q0perp.mul( st1.x ) );\n\tconst B = q1perp.mul( st0.y ).add( q0perp.mul( st1.y ) );\n\n\tconst det = T.dot( T ).max( B.dot( B ) );\n\tconst scale = faceDirection.mul( det.inverseSqrt() );\n\n\treturn add( T.mul( mapN.x, scale ), B.mul( mapN.y, scale ), N.mul( mapN.z ) ).normalize();\n\n} );\n\nclass NormalMapNode extends TempNode {\n\n\tconstructor( node, scaleNode = null ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.node = node;\n\t\tthis.scaleNode = scaleNode;\n\n\t\tthis.normalMapType = TangentSpaceNormalMap;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst { normalMapType, scaleNode } = this;\n\n\t\tlet normalMap = this.node.mul( 2.0 ).sub( 1.0 );\n\n\t\tif ( scaleNode !== null ) {\n\n\t\t\tnormalMap = vec3( normalMap.xy.mul( scaleNode ), normalMap.z );\n\n\t\t}\n\n\t\tlet outputNode = null;\n\n\t\tif ( normalMapType === ObjectSpaceNormalMap ) {\n\n\t\t\toutputNode = modelNormalMatrix.mul( normalMap ).normalize();\n\n\t\t} else if ( normalMapType === TangentSpaceNormalMap ) {\n\n\t\t\tconst tangent = builder.hasGeometryAttribute( 'tangent' );\n\n\t\t\tif ( tangent === true ) {\n\n\t\t\t\toutputNode = TBNViewMatrix.mul( normalMap ).normalize();\n\n\t\t\t} else {\n\n\t\t\t\toutputNode = perturbNormal2ArbNode.call( {\n\t\t\t\t\teye_pos: positionView,\n\t\t\t\t\tsurf_norm: normalView,\n\t\t\t\t\tmapN: normalMap,\n\t\t\t\t\tuv: uv()\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn outputNode;\n\n\t}\n\n}\n\nexport default NormalMapNode;\n\nexport const normalMap = nodeProxy( NormalMapNode );\n\nexport const TBNViewMatrix = mat3( tangentView, bitangentView, normalView );\n\naddNodeClass( NormalMapNode );\n","// @TODO: Is this needed? Can it be moved in MaterialNode?\n\nimport MaterialNode from './MaterialNode.js';\nimport { materialReference } from './MaterialReferenceNode.js';\nimport { normalView } from './NormalNode.js';\nimport { normalMap } from '../display/NormalMapNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable } from '../shadernode/ShaderNode.js';\n\nclass ExtendedMaterialNode extends MaterialNode {\n\n\tconstructor( scope ) {\n\n\t\tsuper( scope );\n\n\t}\n\n\tgetNodeType( builder ) {\n\n\t\tconst scope = this.scope;\n\t\tlet type = null;\n\n\t\tif ( scope === ExtendedMaterialNode.NORMAL ) {\n\n\t\t\ttype = 'vec3';\n\n\t\t}\n\n\t\treturn type || super.getNodeType( builder );\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst material = builder.material;\n\t\tconst scope = this.scope;\n\n\t\tlet node = null;\n\n\t\tif ( scope === ExtendedMaterialNode.NORMAL ) {\n\n\t\t\tnode = material.normalMap ? normalMap( this.getTexture( 'normalMap' ), materialReference( 'normalScale', 'vec2' ) ) : normalView;\n\n\t\t}\n\n\t\treturn node || super.construct( builder );\n\n\t}\n\n}\n\nExtendedMaterialNode.NORMAL = 'normal';\n\nexport default ExtendedMaterialNode;\n\nexport const materialNormal = nodeImmutable( ExtendedMaterialNode, ExtendedMaterialNode.NORMAL );\n\naddNodeClass( ExtendedMaterialNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { instanceIndex } from '../core/InstanceIndexNode.js';\nimport { temp } from '../core/VarNode.js';\nimport { buffer } from './BufferNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { nodeProxy, vec3, mat3 } from '../shadernode/ShaderNode.js';\n\nclass InstanceNode extends Node {\n\n\tconstructor( instanceMesh ) {\n\n\t\tsuper( 'void' );\n\n\t\tthis.instanceMesh = instanceMesh;\n\n\t\t//\n\n\t\tconst instanceBufferNode = buffer( instanceMesh.instanceMatrix.array, 'mat4', instanceMesh.count );\n\n\t\tthis.instanceMatrixNode = temp( instanceBufferNode.element( instanceIndex ) ); // @TODO: a possible caching issue here?\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst { instanceMatrixNode } = this;\n\n\t\t// POSITION\n\n\t\tconst instancePosition = instanceMatrixNode.mul( positionLocal ).xyz;\n\n\t\t// NORMAL\n\n\t\tconst m = mat3( instanceMatrixNode[ 0 ].xyz, instanceMatrixNode[ 1 ].xyz, instanceMatrixNode[ 2 ].xyz );\n\n\t\tconst transformedNormal = normalLocal.div( vec3( m[ 0 ].dot( m[ 0 ] ), m[ 1 ].dot( m[ 1 ] ), m[ 2 ].dot( m[ 2 ] ) ) );\n\n\t\tconst instanceNormal = m.mul( transformedNormal ).xyz;\n\n\t\t// ASSIGNS\n\n\t\tpositionLocal.assign( instancePosition ).build( builder );\n\t\tnormalLocal.assign( instanceNormal ).build( builder );\n\n\t}\n\n}\n\nexport default InstanceNode;\n\nexport const instance = nodeProxy( InstanceNode );\n\naddNodeClass( InstanceNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { cameraProjectionMatrix } from './CameraNode.js';\nimport { modelViewMatrix } from './ModelNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass ModelViewProjectionNode extends Node {\n\n\tconstructor( position = positionLocal ) {\n\n\t\tsuper( 'vec4' );\n\n\t\tthis.position = position;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst position = this.position;\n\n\t\tconst mvpMatrix = cameraProjectionMatrix.mul( modelViewMatrix );\n\t\tconst mvpNode = mvpMatrix.mul( position );\n\n\t\treturn mvpNode.build( builder );\n\n\t}\n\n}\n\nexport default ModelViewProjectionNode;\n\nexport const modelViewProjection = nodeProxy( ModelViewProjectionNode );\n\naddNodeClass( ModelViewProjectionNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { ShaderNode, nodeProxy } from '../shadernode/ShaderNode.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { buffer } from './BufferNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { tangentLocal } from './TangentNode.js';\n\nconst Skinning = new ShaderNode( ( inputs, {}, builder ) => {\n\n\tconst { index, weight, bindMatrix, bindMatrixInverse, boneMatrices } = inputs;\n\n\tconst boneMatX = boneMatrices.element( index.x );\n\tconst boneMatY = boneMatrices.element( index.y );\n\tconst boneMatZ = boneMatrices.element( index.z );\n\tconst boneMatW = boneMatrices.element( index.w );\n\n\t// POSITION\n\n\tconst skinVertex = bindMatrix.mul( positionLocal );\n\n\tconst skinned = add(\n\t\tboneMatX.mul( skinVertex ).mul( weight.x ),\n\t\tboneMatY.mul( skinVertex ).mul( weight.y ),\n\t\tboneMatZ.mul( skinVertex ).mul( weight.z ),\n\t\tboneMatW.mul( skinVertex ).mul( weight.w )\n\t);\n\n\tconst skinPosition = bindMatrixInverse.mul( skinned ).xyz;\n\n\t// NORMAL\n\n\tlet skinMatrix = add(\n\t\tweight.x.mul( boneMatX ),\n\t\tweight.y.mul( boneMatY ),\n\t\tweight.z.mul( boneMatZ ),\n\t\tweight.w.mul( boneMatW )\n\t);\n\n\tskinMatrix = bindMatrixInverse.mul( skinMatrix ).mul( bindMatrix );\n\n\tconst skinNormal = skinMatrix.transformDirection( normalLocal ).xyz;\n\n\t// ASSIGNS\n\n\tpositionLocal.assign( skinPosition ).build( builder ); // @TODO: For some reason this doesn't work as stack.assign( positionLocal, skinPosition )?\n\tnormalLocal.assign( skinNormal ).build( builder );\n\n\tif ( builder.hasGeometryAttribute( 'tangent' ) ) {\n\n\t\ttangentLocal.assign( skinNormal ).build( builder );\n\n\t}\n\n} );\n\nclass SkinningNode extends Node {\n\n\tconstructor( skinnedMesh ) {\n\n\t\tsuper( 'void' );\n\n\t\tthis.skinnedMesh = skinnedMesh;\n\n\t\tthis.updateType = NodeUpdateType.OBJECT;\n\n\t\t//\n\n\t\tthis.skinIndexNode = attribute( 'skinIndex', 'uvec4' );\n\t\tthis.skinWeightNode = attribute( 'skinWeight', 'vec4' );\n\n\t\tthis.bindMatrixNode = uniform( skinnedMesh.bindMatrix, 'mat4' );\n\t\tthis.bindMatrixInverseNode = uniform( skinnedMesh.bindMatrixInverse, 'mat4' );\n\t\tthis.boneMatricesNode = buffer( skinnedMesh.skeleton.boneMatrices, 'mat4', skinnedMesh.skeleton.bones.length );\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\t/*return new ShaderNode( ( {}, stack, builder ) => Skinning.call( {\n\t\t\tindex: this.skinIndexNode,\n\t\t\tweight: this.skinWeightNode,\n\t\t\tbindMatrix: this.bindMatrixNode,\n\t\t\tbindMatrixInverse: this.bindMatrixInverseNode,\n\t\t\tboneMatrices: this.boneMatricesNode\n\t\t}, stack, builder ) ).build( builder );*/\n\t\tSkinning.call( {\n\t\t\tindex: this.skinIndexNode,\n\t\t\tweight: this.skinWeightNode,\n\t\t\tbindMatrix: this.bindMatrixNode,\n\t\t\tbindMatrixInverse: this.bindMatrixInverseNode,\n\t\t\tboneMatrices: this.boneMatricesNode\n\t\t}, {}, builder );\n\n\t}\n\n\tupdate() {\n\n\t\tthis.skinnedMesh.skeleton.update();\n\n\t}\n\n}\n\nexport default SkinningNode;\n\nexport const skinning = nodeProxy( SkinningNode );\n\naddNodeClass( SkinningNode );\n","import TempNode from '../core/TempNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { ShaderNode, nodeObject, float, vec3, mat3 } from '../shadernode/ShaderNode.js';\n\nimport { NoToneMapping, LinearToneMapping, ReinhardToneMapping, CineonToneMapping, ACESFilmicToneMapping } from 'three';\n\n// exposure only\nconst LinearToneMappingNode = new ShaderNode( ( { color, exposure } ) => {\n\n\treturn color.mul( exposure );\n\n} );\n\n// source: https://www.cs.utah.edu/docs/techreports/2002/pdf/UUCS-02-001.pdf\nconst ReinhardToneMappingNode = new ShaderNode( ( { color, exposure } ) => {\n\n\tcolor = color.mul( exposure );\n\n\treturn color.div( color.add( 1.0 ) ).clamp();\n\n} );\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nconst OptimizedCineonToneMappingNode = new ShaderNode( ( { color, exposure } ) => {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor = color.mul( exposure );\n\tcolor = color.sub( 0.004 ).max( 0.0 );\n\n\tconst a = color.mul( color.mul( 6.2 ).add( 0.5 ) );\n\tconst b = color.mul( color.mul( 6.2 ).add( 1.7 ) ).add( 0.06 );\n\n\treturn a.div( b ).pow( 2.2 );\n\n} );\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nconst RRTAndODTFit = new ShaderNode( ( { color } ) => {\n\n\tconst a = color.mul( color.add( 0.0245786 ) ).sub( 0.000090537 );\n\tconst b = color.mul( color.add( 0.4329510 ).mul( 0.983729 ) ).add( 0.238081 );\n\n\treturn a.div( b );\n\n} );\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nconst ACESFilmicToneMappingNode = new ShaderNode( ( { color, exposure } ) => {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst ACESOutputMat = mat3(\n\t\tvec3( 1.60475, - 0.10208, - 0.00327 ), // transposed from source\n\t\tvec3( - 0.53108, 1.10813, - 0.07276 ),\n\t\tvec3( - 0.07367, - 0.00605, 1.07602 )\n\t);\n\n\tcolor = color.mul( exposure ).div( 0.6 );\n\n\tcolor = ACESInputMat.mul( color );\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit.call( { color } );\n\n\tcolor = ACESOutputMat.mul( color );\n\n\t// Clamp to [0, 1]\n\treturn color.clamp();\n\n} );\n\nconst toneMappingLib = {\n\t[ LinearToneMapping ]: LinearToneMappingNode,\n\t[ ReinhardToneMapping ]: ReinhardToneMappingNode,\n\t[ CineonToneMapping ]: OptimizedCineonToneMappingNode,\n\t[ ACESFilmicToneMapping ]: ACESFilmicToneMappingNode\n};\n\nclass ToneMappingNode extends TempNode {\n\n\tconstructor( toneMapping = NoToneMapping, exposureNode = float( 1 ), colorNode = null ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.toneMapping = toneMapping;\n\n\t\tthis.exposureNode = exposureNode;\n\t\tthis.colorNode = colorNode;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst colorNode = this.colorNode || builder.context.color;\n\t\tconst toneMapping = this.toneMapping;\n\n\t\tif ( toneMapping === NoToneMapping ) return colorNode;\n\n\t\tconst toneMappingParams = { exposure: this.exposureNode, color: colorNode };\n\t\tconst toneMappingNode = toneMappingLib[ toneMapping ];\n\n\t\tlet outputNode = null;\n\n\t\tif ( toneMappingNode ) {\n\n\t\t\toutputNode = toneMappingNode.call( toneMappingParams );\n\n\t\t} else {\n\n\t\t\tconsole.error( 'ToneMappingNode: Unsupported Tone Mapping configuration.', toneMapping );\n\n\t\t\toutputNode = colorNode;\n\n\t\t}\n\n\t\treturn outputNode;\n\n\t}\n\n}\n\nexport default ToneMappingNode;\n\nexport const toneMapping = ( mapping, exposure, color ) => nodeObject( new ToneMappingNode( mapping, nodeObject( exposure ), nodeObject( color ) ) );\n\naddNodeClass( ToneMappingNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { nodeImmutable, vec2 } from '../shadernode/ShaderNode.js';\n\nimport { Vector2 } from 'three';\n\nlet resolution;\n\nclass ViewportNode extends Node {\n\n\tconstructor( scope ) {\n\n\t\tsuper();\n\n\t\tthis.scope = scope;\n\n\t\tthis.isViewportNode = true;\n\n\t}\n\n\tgetNodeType() {\n\n\t\treturn this.scope === ViewportNode.COORDINATE ? 'vec4' : 'vec2';\n\n\t}\n\n\tgetUpdateType() {\n\n\t\tlet updateType = NodeUpdateType.NONE;\n\n\t\tif ( this.scope === ViewportNode.RESOLUTION ) {\n\n\t\t\tupdateType = NodeUpdateType.FRAME;\n\n\t\t}\n\n\t\tthis.updateType = updateType;\n\n\t\treturn updateType;\n\n\t}\n\n\tupdate( { renderer } ) {\n\n\t\trenderer.getDrawingBufferSize( resolution );\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst scope = this.scope;\n\n\t\tif ( scope === ViewportNode.COORDINATE ) return;\n\n\t\tlet output = null;\n\n\t\tif ( scope === ViewportNode.RESOLUTION ) {\n\n\t\t\toutput = uniform( resolution || ( resolution = new Vector2() ) );\n\n\t\t} else {\n\n\t\t\tconst coordinateNode = vec2( new ViewportNode( ViewportNode.COORDINATE ) );\n\t\t\tconst resolutionNode = new ViewportNode( ViewportNode.RESOLUTION );\n\n\t\t\toutput = coordinateNode.div( resolutionNode );\n\n\t\t\tlet outX = output.x;\n\t\t\tlet outY = output.y;\n\n\t\t\tif ( /top/i.test( scope ) && builder.isFlipY() ) outY = outY.oneMinus();\n\t\t\telse if ( /bottom/i.test( scope ) && builder.isFlipY() === false ) outY = outY.oneMinus();\n\n\t\t\tif ( /right/i.test( scope ) ) outX = outX.oneMinus();\n\n\t\t\toutput = vec2( outX, outY );\n\n\t\t}\n\n\t\treturn output;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tif ( this.scope === ViewportNode.COORDINATE ) {\n\n\t\t\treturn builder.getFragCoord();\n\n\t\t}\n\n\t\treturn super.generate( builder );\n\n\t}\n\n}\n\nViewportNode.COORDINATE = 'coordinate';\nViewportNode.RESOLUTION = 'resolution';\nViewportNode.TOP_LEFT = 'topLeft';\nViewportNode.BOTTOM_LEFT = 'bottomLeft';\nViewportNode.TOP_RIGHT = 'topRight';\nViewportNode.BOTTOM_RIGHT = 'bottomRight';\n\nexport default ViewportNode;\n\nexport const viewportCoordinate = nodeImmutable( ViewportNode, ViewportNode.COORDINATE );\nexport const viewportResolution = nodeImmutable( ViewportNode, ViewportNode.RESOLUTION );\nexport const viewportTopLeft = nodeImmutable( ViewportNode, ViewportNode.TOP_LEFT );\nexport const viewportBottomLeft = nodeImmutable( ViewportNode, ViewportNode.BOTTOM_LEFT );\nexport const viewportTopRight = nodeImmutable( ViewportNode, ViewportNode.TOP_RIGHT );\nexport const viewportBottomRight = nodeImmutable( ViewportNode, ViewportNode.BOTTOM_RIGHT );\n\naddNodeClass( ViewportNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass CodeNode extends Node {\n\n\tconstructor( code = '', includes = [], language = '' ) {\n\n\t\tsuper( 'code' );\n\n\t\tthis.isCodeNode = true;\n\n\t\tthis.code = code;\n\t\tthis.language = language;\n\n\t\tthis._includes = includes;\n\n\t}\n\n\tsetIncludes( includes ) {\n\n\t\tthis._includes = includes;\n\n\t\treturn this;\n\n\t}\n\n\tgetIncludes( /*builder*/ ) {\n\n\t\treturn this._includes;\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst includes = this.getIncludes( builder );\n\n\t\tfor ( const include of includes ) {\n\n\t\t\tinclude.build( builder );\n\n\t\t}\n\n\t\tconst nodeCode = builder.getCodeFromNode( this, this.getNodeType( builder ) );\n\t\tnodeCode.code = this.code;\n\n\t\treturn nodeCode.code;\n\n\t}\n\n\tserialize( data ) {\n\n\t\tsuper.serialize( data );\n\n\t\tdata.code = this.code;\n\t\tdata.language = this.language;\n\n\t}\n\n\tdeserialize( data ) {\n\n\t\tsuper.deserialize( data );\n\n\t\tthis.code = data.code;\n\t\tthis.language = data.language;\n\n\t}\n\n}\n\nexport default CodeNode;\n\nexport const code = nodeProxy( CodeNode );\nexport const js = ( src, includes ) => code( src, includes, 'js' );\n\naddNodeClass( CodeNode );\n","import Node, { addNodeClass } from '../core/Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass FogNode extends Node {\n\n\tconstructor( colorNode, factorNode ) {\n\n\t\tsuper( 'float' );\n\n\t\tthis.isFogNode = true;\n\n\t\tthis.colorNode = colorNode;\n\t\tthis.factorNode = factorNode;\n\n\t}\n\n\tmixAssign( outputNode ) {\n\n\t\treturn this.mix( outputNode, this.colorNode );\n\n\t}\n\n\tconstruct() {\n\n\t\treturn this.factorNode;\n\n\t}\n\n}\n\nexport default FogNode;\n\nexport const fog = nodeProxy( FogNode );\n\naddNodeElement( 'fog', fog );\n\naddNodeClass( FogNode );\n","import FogNode from './FogNode.js';\nimport { smoothstep } from '../math/MathNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass FogRangeNode extends FogNode {\n\n\tconstructor( colorNode, nearNode, farNode ) {\n\n\t\tsuper( colorNode );\n\n\t\tthis.isFogRangeNode = true;\n\n\t\tthis.nearNode = nearNode;\n\t\tthis.farNode = farNode;\n\n\t}\n\n\tconstruct() {\n\n\t\treturn smoothstep( this.nearNode, this.farNode, positionView.z.negate() );\n\n\t}\n\n}\n\nexport default FogRangeNode;\n\nexport const rangeFog = nodeProxy( FogRangeNode );\n\naddNodeElement( 'rangeFog', rangeFog );\n\naddNodeClass( FogRangeNode );\n","import FogNode from './FogNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { addNodeElement, nodeProxy } from '../shadernode/ShaderNode.js';\n\nclass FogExp2Node extends FogNode {\n\n\tconstructor( colorNode, densityNode ) {\n\n\t\tsuper( colorNode );\n\n\t\tthis.isFogExp2Node = true;\n\n\t\tthis.densityNode = densityNode;\n\n\t}\n\n\tconstruct() {\n\n\t\tconst depthNode = positionView.z.negate();\n\t\tconst densityNode = this.densityNode;\n\n\t\treturn densityNode.mul( densityNode, depthNode, depthNode ).negate().exp().oneMinus();\n\n\t}\n\n}\n\nexport default FogExp2Node;\n\nexport const densityFog = nodeProxy( FogExp2Node );\n\naddNodeElement( 'densityFog', densityFog );\n\naddNodeClass( FogExp2Node );\n","import Node, { addNodeClass } from '../core/Node.js';\n\nclass LightingNode extends Node {\n\n\tconstructor() {\n\n\t\tsuper( 'vec3' );\n\n\t}\n\n\tgenerate( /*builder*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n}\n\nexport default LightingNode;\n\naddNodeClass( LightingNode );\n","import Node from '../core/Node.js';\nimport AnalyticLightNode from './AnalyticLightNode.js';\nimport { nodeObject, nodeProxy } from '../shadernode/ShaderNode.js';\n\nconst LightNodes = new WeakMap();\n\nconst sortLights = ( lights ) => {\n\n\treturn lights.sort( ( a, b ) => a.id - b.id );\n\n};\n\nclass LightsNode extends Node {\n\n\tconstructor( lightNodes = [] ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.lightNodes = lightNodes;\n\n\t\tthis._hash = null;\n\n\t}\n\n\tget hasLight() {\n\n\t\treturn this.lightNodes.length > 0;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst lightNodes = this.lightNodes;\n\n\t\tfor ( const lightNode of lightNodes ) {\n\n\t\t\tlightNode.build( builder );\n\n\t\t}\n\n\t}\n\n\tgetHash( builder ) {\n\n\t\tif ( this._hash === null ) {\n\n\t\t\tlet hash = '';\n\n\t\t\tconst lightNodes = this.lightNodes;\n\n\t\t\tfor ( const lightNode of lightNodes ) {\n\n\t\t\t\thash += lightNode.getHash( builder ) + ' ';\n\n\t\t\t}\n\n\t\t\tthis._hash = hash;\n\n\t\t}\n\n\t\treturn this._hash;\n\n\t}\n\n\tgetLightNodeByHash( hash ) {\n\n\t\tconst lightNodes = this.lightNodes;\n\n\t\tfor ( const lightNode of lightNodes ) {\n\n\t\t\tif ( lightNode.light.uuid === hash ) {\n\n\t\t\t\treturn lightNode;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\tfromLights( lights = [] ) {\n\n\t\tconst lightNodes = [];\n\n\t\tlights = sortLights( lights );\n\n\t\tfor ( const light of lights ) {\n\n\t\t\tlet lightNode = this.getLightNodeByHash( light.uuid );\n\n\t\t\tif ( lightNode === null ) {\n\n\t\t\t\tconst lightClass = light.constructor;\n\t\t\t\tconst lightNodeClass = LightNodes.has( lightClass ) ? LightNodes.get( lightClass ) : AnalyticLightNode;\n\n\t\t\t\tlightNode = nodeObject( new lightNodeClass( light ) );\n\n\t\t\t}\n\n\t\t\tlightNodes.push( lightNode );\n\n\t\t}\n\n\t\tthis.lightNodes = lightNodes;\n\t\tthis._hash = null;\n\n\t\treturn this;\n\n\t}\n\n}\n\nexport default LightsNode;\n\nexport const lights = ( lights ) => nodeObject( new LightsNode().fromLights( lights ) );\nexport const lightsWithoutWrap = nodeProxy( LightsNode );\n\nexport function addLightNode( lightClass, lightNodeClass ) {\n\n\tif ( LightNodes.has( lightClass ) ) throw new Error( `Redefinition of light node ${ lightNodeClass.name }` );\n\tif ( typeof lightClass !== 'function' || ! lightClass.name ) throw new Error( `Light ${ lightClass.name } is not a class` );\n\tif ( typeof lightNodeClass !== 'function' || ! lightNodeClass.name ) throw new Error( `Light node ${ lightNodeClass.name } is not a class` );\n\n\tLightNodes.set( lightClass, lightNodeClass );\n\n}\n","import LightingNode from './LightingNode.js';\nimport { addNodeClass } from '../core/Node.js';\n\nclass AONode extends LightingNode {\n\n\tconstructor( aoNode = null ) {\n\n\t\tsuper();\n\n\t\tthis.aoNode = aoNode;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst aoIntensity = 1;\n\t\tconst aoNode = this.aoNode.sub( 1.0 ).mul( aoIntensity ).add( 1.0 );\n\n\t\tbuilder.context.ambientOcclusion.mulAssign( aoNode );\n\n\t}\n\n}\n\nexport default AONode;\n\naddNodeClass( AONode );\n","import LightingNode from './LightingNode.js';\nimport { cache } from '../core/CacheNode.js';\nimport { context } from '../core/ContextNode.js';\nimport { roughness } from '../core/PropertyNode.js';\nimport { equirectUV } from '../utils/EquirectUVNode.js';\nimport { specularMIPLevel } from '../utils/SpecularMIPLevelNode.js';\nimport { cameraViewMatrix } from '../accessors/CameraNode.js';\nimport { transformedNormalView, transformedNormalWorld } from '../accessors/NormalNode.js';\nimport { positionViewDirection } from '../accessors/PositionNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { float, vec2 } from '../shadernode/ShaderNode.js';\n\nclass EnvironmentNode extends LightingNode {\n\n\tconstructor( envNode = null ) {\n\n\t\tsuper();\n\n\t\tthis.envNode = envNode;\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst envNode = this.envNode;\n\t\tconst properties = builder.getNodeProperties( this );\n\n\t\tlet reflectVec;\n\t\tlet radianceTextureUVNode;\n\t\tlet irradianceTextureUVNode;\n\n\t\tconst radianceContext = context( envNode, {\n\t\t\tgetUVNode: ( textureNode ) => {\n\n\t\t\t\tlet node = null;\n\n\t\t\t\tif ( reflectVec === undefined ) {\n\n\t\t\t\t\treflectVec = positionViewDirection.negate().reflect( transformedNormalView );\n\t\t\t\t\treflectVec = roughness.mul( roughness ).mix( reflectVec, transformedNormalView ).normalize();\n\t\t\t\t\treflectVec = reflectVec.transformDirection( cameraViewMatrix );\n\n\t\t\t\t}\n\n\t\t\t\tif ( textureNode.isCubeTextureNode ) {\n\n\t\t\t\t\tnode = reflectVec;\n\n\t\t\t\t} else if ( textureNode.isTextureNode ) {\n\n\t\t\t\t\tif ( radianceTextureUVNode === undefined ) {\n\n\t\t\t\t\t\t// @TODO: Needed PMREM\n\n\t\t\t\t\t\tradianceTextureUVNode = equirectUV( reflectVec );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = radianceTextureUVNode;\n\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\n\t\t\t},\n\t\t\tgetSamplerLevelNode: () => {\n\n\t\t\t\treturn roughness;\n\n\t\t\t},\n\t\t\tgetMIPLevelAlgorithmNode: ( textureNode, levelNode ) => {\n\n\t\t\t\treturn specularMIPLevel( textureNode, levelNode );\n\n\t\t\t}\n\t\t} );\n\n\t\tconst irradianceContext = context( envNode, {\n\t\t\tgetUVNode: ( textureNode ) => {\n\n\t\t\t\tlet node = null;\n\n\t\t\t\tif ( textureNode.isCubeTextureNode ) {\n\n\t\t\t\t\tnode = transformedNormalWorld;\n\n\t\t\t\t} else if ( textureNode.isTextureNode ) {\n\n\t\t\t\t\tif ( irradianceTextureUVNode === undefined ) {\n\n\t\t\t\t\t\t// @TODO: Needed PMREM\n\n\t\t\t\t\t\tirradianceTextureUVNode = equirectUV( transformedNormalWorld );\n\t\t\t\t\t\tirradianceTextureUVNode = vec2( irradianceTextureUVNode.x, irradianceTextureUVNode.y.oneMinus() );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = irradianceTextureUVNode;\n\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\n\t\t\t},\n\t\t\tgetSamplerLevelNode: () => {\n\n\t\t\t\treturn float( 1 );\n\n\t\t\t},\n\t\t\tgetMIPLevelAlgorithmNode: ( textureNode, levelNode ) => {\n\n\t\t\t\treturn specularMIPLevel( textureNode, levelNode );\n\n\t\t\t}\n\t\t} );\n\n\t\t//\n\n\t\tconst isolateRadianceFlowContext = cache( radianceContext );\n\n\t\t//\n\n\t\tbuilder.context.radiance.addAssign( isolateRadianceFlowContext );\n\n\t\tbuilder.context.iblIrradiance.addAssign( irradianceContext.mul( Math.PI ) );\n\n\t\tproperties.radianceContext = isolateRadianceFlowContext;\n\t\tproperties.irradianceContext = irradianceContext;\n\n\t}\n\n}\n\nexport default EnvironmentNode;\n\naddNodeClass( EnvironmentNode );\n","import { Material, ShaderMaterial } from 'three';\nimport { getNodeChildren, getCacheKey } from '../core/NodeUtils.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { diffuseColor } from '../core/PropertyNode.js';\nimport { materialNormal } from '../accessors/ExtendedMaterialNode.js';\nimport { materialAlphaTest, materialColor, materialOpacity, materialEmissive } from '../accessors/MaterialNode.js';\nimport { modelViewProjection } from '../accessors/ModelViewProjectionNode.js';\nimport { transformedNormalView } from '../accessors/NormalNode.js';\nimport { instance } from '../accessors/InstanceNode.js';\nimport { positionLocal } from '../accessors/PositionNode.js';\nimport { skinning } from '../accessors/SkinningNode.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { lightsWithoutWrap } from '../lighting/LightsNode.js';\nimport { mix } from '../math/MathNode.js';\nimport { float, vec3, vec4 } from '../shadernode/ShaderNode.js';\nimport AONode from '../lighting/AONode.js';\nimport EnvironmentNode from '../lighting/EnvironmentNode.js';\n\nconst NodeMaterials = new Map();\n\nclass NodeMaterial extends ShaderMaterial {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.isNodeMaterial = true;\n\n\t\tthis.type = this.constructor.name;\n\n\t\tthis.lights = true;\n\t\tthis.normals = true;\n\n\t\tthis.lightsNode = null;\n\t\tthis.envNode = null;\n\n\t\tthis.colorNode = null;\n\t\tthis.normalNode = null;\n\t\tthis.opacityNode = null;\n\t\tthis.backdropNode = null;\n\t\tthis.backdropAlphaNode = null;\n\t\tthis.alphaTestNode = null;\n\n\t\tthis.positionNode = null;\n\n\t}\n\n\tcustomProgramCacheKey() {\n\n\t\treturn getCacheKey( this );\n\n\t}\n\n\tbuild( builder ) {\n\n\t\tthis.construct( builder );\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\t// < VERTEX STAGE >\n\n\t\tbuilder.addStack();\n\n\t\tbuilder.stack.outputNode = this.constructPosition( builder );\n\n\t\tbuilder.addFlow( 'vertex', builder.removeStack() );\n\n\t\t// < FRAGMENT STAGE >\n\n\t\tbuilder.addStack();\n\n\t\tif ( this.normals === true ) this.constructNormal( builder );\n\n\t\tthis.constructDiffuseColor( builder );\n\t\tthis.constructVariants( builder );\n\n\t\tconst outgoingLightNode = this.constructLighting( builder );\n\n\t\tbuilder.stack.outputNode = this.constructOutput( builder, outgoingLightNode, diffuseColor.a );\n\n\t\tbuilder.addFlow( 'fragment', builder.removeStack() );\n\n\t}\n\n\tconstructPosition( builder ) {\n\n\t\tconst object = builder.object;\n\n\t\tlet vertex = positionLocal;\n\n\t\tif ( this.positionNode !== null ) {\n\n\t\t\tvertex = vertex.bypass( positionLocal.assign( this.positionNode ) );\n\n\t\t}\n\n\t\tif ( ( object.instanceMatrix && object.instanceMatrix.isInstancedBufferAttribute === true ) && builder.isAvailable( 'instance' ) === true ) {\n\n\t\t\tvertex = vertex.bypass( instance( object ) );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh === true ) {\n\n\t\t\tvertex = vertex.bypass( skinning( object ) );\n\n\t\t}\n\n\t\tbuilder.context.vertex = vertex;\n\n\t\treturn modelViewProjection();\n\n\t}\n\n\tconstructDiffuseColor( { stack, geometry } ) {\n\n\t\tlet colorNode = this.colorNode ? vec4( this.colorNode ) : materialColor;\n\n\t\t// VERTEX COLORS\n\n\t\tif ( this.vertexColors === true && geometry.hasAttribute( 'color' ) ) {\n\n\t\t\tcolorNode = vec4( colorNode.xyz.mul( attribute( 'color' ) ), colorNode.a );\n\n\t\t}\n\n\t\t// COLOR\n\n\t\tstack.assign( diffuseColor, colorNode );\n\n\t\t// OPACITY\n\n\t\tconst opacityNode = this.opacityNode ? float( this.opacityNode ) : materialOpacity;\n\t\tstack.assign( diffuseColor.a, diffuseColor.a.mul( opacityNode ) );\n\n\t\t// ALPHA TEST\n\n\t\tif ( this.alphaTestNode || this.alphaTest > 0 ) {\n\n\t\t\tconst alphaTestNode = this.alphaTestNode ? float( this.alphaTestNode ) : materialAlphaTest;\n\n\t\t\tstack.add( diffuseColor.a.lessThanEqual( alphaTestNode ).discard() );\n\n\t\t}\n\n\t}\n\n\tconstructVariants( /*builder*/ ) {\n\n\t\t// Interface function.\n\n\t}\n\n\tconstructNormal( { stack } ) {\n\n\t\t// NORMAL VIEW\n\n\t\tconst normalNode = this.normalNode ? vec3( this.normalNode ) : materialNormal;\n\n\t\tstack.assign( transformedNormalView, normalNode );\n\n\t\treturn normalNode;\n\n\t}\n\n\tconstructLights( builder ) {\n\n\t\tconst envNode = this.envNode || builder.environmentNode;\n\n\t\tconst materialLightsNode = [];\n\n\t\tif ( envNode ) {\n\n\t\t\tmaterialLightsNode.push( new EnvironmentNode( envNode ) );\n\n\t\t}\n\n\t\tif ( builder.material.aoMap ) {\n\n\t\t\tmaterialLightsNode.push( new AONode( texture( builder.material.aoMap ) ) );\n\n\t\t}\n\n\t\tlet lightsNode = this.lightsNode || builder.lightsNode;\n\n\t\tif ( materialLightsNode.length > 0 ) {\n\n\t\t\tlightsNode = lightsWithoutWrap( [ ...lightsNode.lightNodes, ...materialLightsNode ] );\n\n\t\t}\n\n\t\treturn lightsNode;\n\n\t}\n\n\tconstructLightingModel( /*builder*/ ) {\n\n\t\t// Interface function.\n\n\t}\n\n\tconstructLighting( builder ) {\n\n\t\tconst { material } = builder;\n\t\tconst { backdropNode, backdropAlphaNode, emissiveNode } = this;\n\n\t\t// OUTGOING LIGHT\n\n\t\tconst lights = this.lights === true || this.lightsNode !== null;\n\n\t\tconst lightsNode = lights ? this.constructLights( builder ) : null;\n\t\tconst lightingModelNode = lightsNode ? this.constructLightingModel( builder ) : null;\n\n\t\tlet outgoingLightNode = diffuseColor.rgb;\n\n\t\tif ( lightsNode && lightsNode.hasLight !== false ) {\n\n\t\t\toutgoingLightNode = lightsNode.lightingContext( lightingModelNode, backdropNode, backdropAlphaNode );\n\n\t\t} else if ( backdropNode !== null ) {\n\n\t\t\toutgoingLightNode = vec3( backdropAlphaNode !== null ? mix( outgoingLightNode, backdropNode, backdropAlphaNode ) : backdropNode );\n\n\t\t}\n\n\t\t// EMISSIVE\n\n\t\tif ( ( emissiveNode && emissiveNode.isNode === true ) || ( material.emissive && material.emissive.isColor === true ) ) {\n\n\t\t\toutgoingLightNode = outgoingLightNode.add( emissiveNode ? vec3( emissiveNode ) : materialEmissive );\n\n\t\t}\n\n\t\treturn outgoingLightNode;\n\n\t}\n\n\tconstructOutput( builder, outgoingLight, opacity ) {\n\n\t\tconst renderer = builder.renderer;\n\n\t\t// TONE MAPPING\n\n\t\tconst toneMappingNode = builder.toneMappingNode;\n\n\t\tif ( toneMappingNode ) {\n\n\t\t\toutgoingLight = toneMappingNode.context( { color: outgoingLight } );\n\n\t\t}\n\n\t\t// @TODO: Optimize outputNode to vec3.\n\n\t\tlet outputNode = vec4( outgoingLight, opacity );\n\n\t\t// ENCODING\n\n\t\toutputNode = outputNode.colorSpace( renderer.outputColorSpace );\n\n\t\t// FOG\n\n\t\tconst fogNode = builder.fogNode;\n\n\t\tif ( fogNode ) outputNode = vec4( fogNode.mixAssign( outputNode.rgb ), outputNode.a );\n\n\t\treturn outputNode;\n\n\t}\n\n\tsetDefaultValues( material ) {\n\n\t\t// This approach is to reuse the native refreshUniforms*\n\t\t// and turn available the use of features like transmission and environment in core\n\n\t\tfor ( const property in material ) {\n\n\t\t\tconst value = material[ property ];\n\n\t\t\tif ( this[ property ] === undefined ) {\n\n\t\t\t\tthis[ property ] = value;\n\n\t\t\t\tif ( value && value.clone ) this[ property ] = value.clone();\n\n\t\t\t}\n\n\t\t}\n\n\t\tObject.assign( this.defines, material.defines );\n\n\t\tconst descriptors = Object.getOwnPropertyDescriptors( material.constructor.prototype );\n\n\t\tfor ( const key in descriptors ) {\n\n\t\t\tif ( Object.getOwnPropertyDescriptor( this.constructor.prototype, key ) === undefined &&\n\t\t\t     descriptors[ key ].get !== undefined ) {\n\n\t\t\t\tObject.defineProperty( this.constructor.prototype, key, descriptors[ key ] );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttoJSON( meta ) {\n\n\t\tconst isRoot = ( meta === undefined || typeof meta === 'string' );\n\n\t\tif ( isRoot ) {\n\n\t\t\tmeta = {\n\t\t\t\ttextures: {},\n\t\t\t\timages: {},\n\t\t\t\tnodes: {}\n\t\t\t};\n\n\t\t}\n\n\t\tconst data = Material.prototype.toJSON.call( this, meta );\n\t\tconst nodeChildren = getNodeChildren( this );\n\n\t\tdata.inputNodes = {};\n\n\t\tfor ( const { property, childNode } of nodeChildren ) {\n\n\t\t\tdata.inputNodes[ property ] = childNode.toJSON( meta ).uuid;\n\n\t\t}\n\n\t\t// TODO: Copied from Object3D.toJSON\n\n\t\tfunction extractFromCache( cache ) {\n\n\t\t\tconst values = [];\n\n\t\t\tfor ( const key in cache ) {\n\n\t\t\t\tconst data = cache[ key ];\n\t\t\t\tdelete data.metadata;\n\t\t\t\tvalues.push( data );\n\n\t\t\t}\n\n\t\t\treturn values;\n\n\t\t}\n\n\t\tif ( isRoot ) {\n\n\t\t\tconst textures = extractFromCache( meta.textures );\n\t\t\tconst images = extractFromCache( meta.images );\n\t\t\tconst nodes = extractFromCache( meta.nodes );\n\n\t\t\tif ( textures.length > 0 ) data.textures = textures;\n\t\t\tif ( images.length > 0 ) data.images = images;\n\t\t\tif ( nodes.length > 0 ) data.nodes = nodes;\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n\tstatic fromMaterial( material ) {\n\n\t\tif ( material.isNodeMaterial === true ) { // is already a node material\n\n\t\t\treturn material;\n\n\t\t}\n\n\t\tconst type = material.type.replace( 'Material', 'NodeMaterial' );\n\n\t\tconst nodeMaterial = createNodeMaterialFromType( type );\n\n\t\tif ( nodeMaterial === undefined ) {\n\n\t\t\tthrow new Error( `NodeMaterial: Material \"${ material.type }\" is not compatible.` );\n\n\t\t}\n\n\t\tfor ( const key in material ) {\n\n\t\t\tnodeMaterial[ key ] = material[ key ];\n\n\t\t}\n\n\t\treturn nodeMaterial;\n\n\t}\n\n}\n\nexport default NodeMaterial;\n\nexport function addNodeMaterial( nodeMaterial ) {\n\n\tif ( typeof nodeMaterial !== 'function' || ! nodeMaterial.name ) throw new Error( `Node material ${ nodeMaterial.name } is not a class` );\n\tif ( NodeMaterials.has( nodeMaterial.name ) ) throw new Error( `Redefinition of node material ${ nodeMaterial.name }` );\n\n\tNodeMaterials.set( nodeMaterial.name, nodeMaterial );\n\n}\n\nexport function createNodeMaterialFromType( type ) {\n\n\tconst Material = NodeMaterials.get( type );\n\n\tif ( Material !== undefined ) {\n\n\t\treturn new Material();\n\n\t}\n\n}\n\naddNodeMaterial( NodeMaterial );\n","import NodeMaterial, { addNodeMaterial } from './NodeMaterial.js';\n\nimport { MeshBasicMaterial } from 'three';\n\nconst defaultValues = new MeshBasicMaterial();\n\nclass MeshBasicNodeMaterial extends NodeMaterial {\n\n\tconstructor( parameters ) {\n\n\t\tsuper();\n\n\t\tthis.isMeshBasicNodeMaterial = true;\n\n\t\tthis.lights = false;\n\n\t\tthis.setDefaultValues( defaultValues );\n\n\t\tthis.setValues( parameters );\n\n\t}\n\n\tcopy( source ) {\n\n\t\tthis.colorNode = source.colorNode;\n\t\tthis.opacityNode = source.opacityNode;\n\n\t\tthis.alphaTestNode = source.alphaTestNode;\n\n\t\tthis.lightNode = source.lightNode;\n\n\t\tthis.positionNode = source.positionNode;\n\n\t\treturn super.copy( source );\n\n\t}\n\n}\n\nexport default MeshBasicNodeMaterial;\n\naddNodeMaterial( MeshBasicNodeMaterial );\n","import LightingNode from './LightingNode.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { vec3 } from '../shadernode/ShaderNode.js';\nimport { reference } from '../accessors/ReferenceNode.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { positionWorld } from '../accessors/PositionNode.js';\nimport { cond } from '../math/CondNode.js';\nimport MeshBasicNodeMaterial from '../materials/MeshBasicNodeMaterial.js';\n\nimport { Color, DepthTexture, NearestFilter } from 'three';\n\nlet depthMaterial = null;\n\nclass AnalyticLightNode extends LightingNode {\n\n\tconstructor( light = null ) {\n\n\t\tsuper();\n\n\t\tthis.updateType = NodeUpdateType.FRAME;\n\n\t\tthis.light = light;\n\n\t\tthis.rtt = null;\n\t\tthis.shadowNode = null;\n\n\t\tthis.color = new Color();\n\t\tthis.colorNode = uniform( this.color );\n\n\t}\n\n\tgetHash( /*builder*/ ) {\n\n\t\treturn this.light.uuid;\n\n\t}\n\n\tconstructShadow( builder ) {\n\n\t\tlet shadowNode = this.shadowNode;\n\n\t\tif ( shadowNode === null ) {\n\n\t\t\tif ( depthMaterial === null ) depthMaterial = new MeshBasicNodeMaterial();\n\n\t\t\tconst shadow = this.light.shadow;\n\t\t\tconst rtt = builder.getRenderTarget( shadow.mapSize.width, shadow.mapSize.height );\n\n\t\t\tconst depthTexture = new DepthTexture();\n\t\t\tdepthTexture.minFilter = NearestFilter;\n\t\t\tdepthTexture.magFilter = NearestFilter;\n\n\t\t\trtt.depthTexture = depthTexture;\n\n\t\t\tshadow.camera.updateProjectionMatrix();\n\n\t\t\t//\n\n\t\t\tconst bias = reference( 'bias', 'float', shadow );\n\n\t\t\t//const diffuseFactor = normalView.dot( objectViewPosition( this.light ).sub( positionView ).normalize().negate() );\n\t\t\t//bias = mix( bias, 0, diffuseFactor );\n\n\t\t\tlet shadowCoord = uniform( shadow.matrix ).mul( positionWorld );\n\t\t\tshadowCoord = shadowCoord.xyz.div( shadowCoord.w );\n\n\t\t\tshadowCoord = vec3(\n\t\t\t\tshadowCoord.x,\n\t\t\t\tshadowCoord.y.oneMinus(),\n\t\t\t\tshadowCoord.z\n\t\t\t);\n\n\t\t\t// @TODO: Optimize using WebGPU compare-sampler\n\n\t\t\tlet depth = texture( depthTexture, shadowCoord.xy );\n\t\t\tdepth = depth.mul( .5 ).add( .5 ).add( bias );\n\n\t\t\tshadowNode = cond( shadowCoord.z.lessThan( depth ).or( shadowCoord.y.lessThan( .000001 ) /*@TODO: find the cause and remove it soon */ ), 1, 0 );\n\t\t\t//shadowNode = step( shadowCoord.z, depth );\n\n\t\t\t//\n\n\t\t\tthis.rtt = rtt;\n\t\t\tthis.colorNode = this.colorNode.mul( shadowNode );\n\n\t\t\tthis.shadowNode = shadowNode;\n\n\t\t\t//\n\n\t\t\tthis.updateBeforeType = NodeUpdateType.RENDER;\n\n\t\t}\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tif ( this.light.castShadow ) this.constructShadow( builder );\n\n\t}\n\n\tupdateShadow( frame ) {\n\n\t\tconst { rtt, light } = this;\n\t\tconst { renderer, scene } = frame;\n\n\t\tscene.overrideMaterial = depthMaterial;\n\n\t\trtt.setSize( light.shadow.mapSize.width, light.shadow.mapSize.height );\n\n\t\tlight.shadow.updateMatrices( light );\n\n\t\trenderer.setRenderTarget( rtt );\n\t\trenderer.render( scene, light.shadow.camera );\n\t\trenderer.setRenderTarget( null );\n\n\t\tscene.overrideMaterial = null;\n\n\t}\n\n\tupdateBefore( frame ) {\n\n\t\tconst { light } = this;\n\n\t\tif ( light.castShadow ) this.updateShadow( frame );\n\n\t}\n\n\tupdate( frame ) {\n\n\t\tconst { light } = this;\n\n\t\tthis.color.copy( light.color ).multiplyScalar( light.intensity );\n\n\t}\n\n}\n\nexport default AnalyticLightNode;\n\naddNodeClass( AnalyticLightNode );\n","class NodeParser {\n\n\tparseFunction( /*source*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n}\n\nexport default NodeParser;\n","class NodeFunction {\n\n\tconstructor( type, inputs, name = '', presicion = '' ) {\n\n\t\tthis.type = type;\n\t\tthis.inputs = inputs;\n\t\tthis.name = name;\n\t\tthis.presicion = presicion;\n\n\t}\n\n\tgetCode( /*name = this.name*/ ) {\n\n\t\tconsole.warn( 'Abstract function.' );\n\n\t}\n\n}\n\nNodeFunction.isNodeFunction = true;\n\nexport default NodeFunction;\n","import NodeFunction from '../core/NodeFunction.js';\nimport NodeFunctionInput from '../core/NodeFunctionInput.js';\n\nconst declarationRegexp = /^[fn]*\\s*([a-z_0-9]+)?\\s*\\(([\\s\\S]*?)\\)\\s*[\\-\\>]*\\s*([a-z_0-9]+)?/i;\nconst propertiesRegexp = /[a-z_0-9]+/ig;\n\nconst wgslTypeLib = {\n\tf32: 'float'\n};\n\nconst parse = ( source ) => {\n\n\tsource = source.trim();\n\n\tconst declaration = source.match( declarationRegexp );\n\n\tif ( declaration !== null && declaration.length === 4 ) {\n\n\t\t// tokenizer\n\n\t\tconst inputsCode = declaration[ 2 ];\n\t\tconst propsMatches = [];\n\n\t\tlet nameMatch = null;\n\n\t\twhile ( ( nameMatch = propertiesRegexp.exec( inputsCode ) ) !== null ) {\n\n\t\t\tpropsMatches.push( nameMatch );\n\n\t\t}\n\n\t\t// parser\n\n\t\tconst inputs = [];\n\n\t\tlet i = 0;\n\n\t\twhile ( i < propsMatches.length ) {\n\n\t\t\t// default\n\n\t\t\tconst name = propsMatches[ i ++ ][ 0 ];\n\t\t\tlet type = propsMatches[ i ++ ][ 0 ];\n\n\t\t\ttype = wgslTypeLib[ type ] || type;\n\n\t\t\t// precision\n\n\t\t\tif ( i < propsMatches.length && /^[fui]\\d{2}$/.test( propsMatches[ i ][ 0 ] ) === true )\n\t\t\t\ti ++;\n\n\t\t\t// add input\n\n\t\t\tinputs.push( new NodeFunctionInput( type, name ) );\n\n\t\t}\n\n\t\t//\n\n\t\tconst blockCode = source.substring( declaration[ 0 ].length );\n\n\t\tconst name = declaration[ 1 ] !== undefined ? declaration[ 1 ] : '';\n\t\tconst type = declaration[ 3 ] || 'void';\n\n\t\treturn {\n\t\t\ttype,\n\t\t\tinputs,\n\t\t\tname,\n\t\t\tinputsCode,\n\t\t\tblockCode\n\t\t};\n\n\t} else {\n\n\t\tthrow new Error( 'FunctionNode: Function is not a WGSL code.' );\n\n\t}\n\n};\n\nclass WGSLNodeFunction extends NodeFunction {\n\n\tconstructor( source ) {\n\n\t\tconst { type, inputs, name, inputsCode, blockCode } = parse( source );\n\n\t\tsuper( type, inputs, name );\n\n\t\tthis.inputsCode = inputsCode;\n\t\tthis.blockCode = blockCode;\n\n\t}\n\n\tgetCode( name = this.name ) {\n\n\t\tconst type = this.type !== 'void' ? '-> ' + this.type : '';\n\n\t\treturn `fn ${ name } ( ${ this.inputsCode.trim() } ) ${ type }` + this.blockCode;\n\n\t}\n\n}\n\nexport default WGSLNodeFunction;\n","import NodeParser from '../core/NodeParser.js';\nimport WGSLNodeFunction from './WGSLNodeFunction.js';\n\nclass WGSLNodeParser extends NodeParser {\n\n\tparseFunction( source ) {\n\n\t\treturn new WGSLNodeFunction( source );\n\n\t}\n\n}\n\nexport default WGSLNodeParser;\n","import WebGPUWeakMap from './WebGPUWeakMap.js';\nimport { lights } from '../../nodes/Nodes.js';\n\nfunction painterSortStable( a, b ) {\n\n\tif ( a.groupOrder !== b.groupOrder ) {\n\n\t\treturn a.groupOrder - b.groupOrder;\n\n\t} else if ( a.renderOrder !== b.renderOrder ) {\n\n\t\treturn a.renderOrder - b.renderOrder;\n\n\t} else if ( a.material.id !== b.material.id ) {\n\n\t\treturn a.material.id - b.material.id;\n\n\t} else if ( a.z !== b.z ) {\n\n\t\treturn a.z - b.z;\n\n\t} else {\n\n\t\treturn a.id - b.id;\n\n\t}\n\n}\n\nfunction reversePainterSortStable( a, b ) {\n\n\tif ( a.groupOrder !== b.groupOrder ) {\n\n\t\treturn a.groupOrder - b.groupOrder;\n\n\t} else if ( a.renderOrder !== b.renderOrder ) {\n\n\t\treturn a.renderOrder - b.renderOrder;\n\n\t} else if ( a.z !== b.z ) {\n\n\t\treturn b.z - a.z;\n\n\t} else {\n\n\t\treturn a.id - b.id;\n\n\t}\n\n}\n\nclass WebGPURenderList {\n\n\tconstructor() {\n\n\t\tthis.renderItems = [];\n\t\tthis.renderItemsIndex = 0;\n\n\t\tthis.opaque = [];\n\t\tthis.transparent = [];\n\n\t\tthis.lightsNode = lights( [] );\n\t\tthis.lightsArray = [];\n\n\t}\n\n\tinit() {\n\n\t\tthis.renderItemsIndex = 0;\n\n\t\tthis.opaque.length = 0;\n\t\tthis.transparent.length = 0;\n\t\tthis.lightsArray.length = 0;\n\n\t\treturn this;\n\n\t}\n\n\tgetNextRenderItem( object, geometry, material, groupOrder, z, group ) {\n\n\t\tlet renderItem = this.renderItems[ this.renderItemsIndex ];\n\n\t\tif ( renderItem === undefined ) {\n\n\t\t\trenderItem = {\n\t\t\t\tid: object.id,\n\t\t\t\tobject: object,\n\t\t\t\tgeometry: geometry,\n\t\t\t\tmaterial: material,\n\t\t\t\tgroupOrder: groupOrder,\n\t\t\t\trenderOrder: object.renderOrder,\n\t\t\t\tz: z,\n\t\t\t\tgroup: group\n\t\t\t};\n\n\t\t\tthis.renderItems[ this.renderItemsIndex ] = renderItem;\n\n\t\t} else {\n\n\t\t\trenderItem.id = object.id;\n\t\t\trenderItem.object = object;\n\t\t\trenderItem.geometry = geometry;\n\t\t\trenderItem.material = material;\n\t\t\trenderItem.groupOrder = groupOrder;\n\t\t\trenderItem.renderOrder = object.renderOrder;\n\t\t\trenderItem.z = z;\n\t\t\trenderItem.group = group;\n\n\t\t}\n\n\t\tthis.renderItemsIndex ++;\n\n\t\treturn renderItem;\n\n\t}\n\n\tpush( object, geometry, material, groupOrder, z, group ) {\n\n\t\tconst renderItem = this.getNextRenderItem( object, geometry, material, groupOrder, z, group );\n\n\t\t( material.transparent === true ? this.transparent : this.opaque ).push( renderItem );\n\n\t}\n\n\tunshift( object, geometry, material, groupOrder, z, group ) {\n\n\t\tconst renderItem = this.getNextRenderItem( object, geometry, material, groupOrder, z, group );\n\n\t\t( material.transparent === true ? this.transparent : this.opaque ).unshift( renderItem );\n\n\t}\n\n\tpushLight( light ) {\n\n\t\tthis.lightsArray.push( light );\n\n\t}\n\n\tgetLightsNode() {\n\n\t\treturn this.lightsNode.fromLights( this.lightsArray );\n\n\t}\n\n\tsort( customOpaqueSort, customTransparentSort ) {\n\n\t\tif ( this.opaque.length > 1 ) this.opaque.sort( customOpaqueSort || painterSortStable );\n\t\tif ( this.transparent.length > 1 ) this.transparent.sort( customTransparentSort || reversePainterSortStable );\n\n\t}\n\n\tfinish() {\n\n\t\t// update lights\n\n\t\tthis.lightsNode.fromLights( this.lightsArray );\n\n\t\t// Clear references from inactive renderItems in the list\n\n\t\tfor ( let i = this.renderItemsIndex, il = this.renderItems.length; i < il; i ++ ) {\n\n\t\t\tconst renderItem = this.renderItems[ i ];\n\n\t\t\tif ( renderItem.id === null ) break;\n\n\t\t\trenderItem.id = null;\n\t\t\trenderItem.object = null;\n\t\t\trenderItem.geometry = null;\n\t\t\trenderItem.material = null;\n\t\t\trenderItem.program = null;\n\t\t\trenderItem.group = null;\n\n\t\t}\n\n\t}\n\n}\n\nclass WebGPURenderLists {\n\n\tconstructor() {\n\n\t\tthis.lists = new WeakMap();\n\t\tthis.lists = new WebGPUWeakMap();\n\n\t}\n\n\tget( scene, camera ) {\n\n\t\tconst lists = this.lists;\n\t\tconst keys = [ scene, camera ];\n\n\t\tlet list = lists.get( keys );\n\n\t\tif ( list === undefined ) {\n\n\t\t\tlist = new WebGPURenderList();\n\t\t\tlists.set( keys, list );\n\n\n\t\t}\n\n\t\treturn list;\n\n\t}\n\n\tdispose() {\n\n\t\tthis.lists = new WeakMap();\n\n\t}\n\n}\n\nexport default WebGPURenderLists;\n","import WebGPUWeakMap from './WebGPUWeakMap.js';\n\nclass WebGPURenderState {\n\n\tconstructor() {\n\n\t\tthis.depth = true;\n\t\tthis.stencil = true;\n\n\t\t// defined by renderer(backend)\n\n\t\tthis.descriptorGPU = null;\n\t\tthis.encoderGPU = null;\n\t\tthis.currentPassGPU = null;\n\n\t}\n\n}\n\nclass WebGPURenderStates {\n\n\tconstructor() {\n\n\t\tthis.renderStates = new WebGPUWeakMap();\n\n\t}\n\n\tget( scene, camera ) {\n\n\t\tconst chainKey = [ scene, camera ];\n\n\t\tlet renderState = this.renderStates.get( chainKey );\n\n\t\tif ( renderState === undefined ) {\n\n\t\t\trenderState = new WebGPURenderState();\n\n\t\t\tthis.renderStates.set( chainKey, renderState );\n\n\t\t}\n\n\t\treturn renderState;\n\n\t}\n\n\tdispose() {\n\n\t\tthis.renderStates = new WebGPUWeakMap();\n\n\t}\n\n}\n\nexport default WebGPURenderStates;\n","// Copyright 2020 Brandon Jones\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { GPUTextureViewDimension, GPUIndexFormat, GPUFilterMode, GPUPrimitiveTopology, GPULoadOp, GPUStoreOp } from './constants.js';\n\n// ported from https://github.com/toji/web-texture-tool/blob/master/src/webgpu-mipmap-generator.js\n\nclass WebGPUTextureUtils {\n\n\tconstructor( device ) {\n\n\t\tthis.device = device;\n\n\t\tconst mipmapVertexSource = `\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n`;\n\n\t\tconst mipmapFragmentSource = `\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n`;\n\n\t\tthis.sampler = device.createSampler( { minFilter: GPUFilterMode.Linear } );\n\n\t\t// We'll need a new pipeline for every texture format used.\n\t\tthis.pipelines = {};\n\n\t\tthis.mipmapVertexShaderModule = device.createShaderModule( {\n\t\t\tlabel: 'mipmapVertex',\n\t\t\tcode: mipmapVertexSource\n\t\t} );\n\n\t\tthis.mipmapFragmentShaderModule = device.createShaderModule( {\n\t\t\tlabel: 'mipmapFragment',\n\t\t\tcode: mipmapFragmentSource\n\t\t} );\n\n\t}\n\n\tgetMipmapPipeline( format ) {\n\n\t\tlet pipeline = this.pipelines[ format ];\n\n\t\tif ( pipeline === undefined ) {\n\n\t\t\tpipeline = this.device.createRenderPipeline( {\n\t\t\t\tvertex: {\n\t\t\t\t\tmodule: this.mipmapVertexShaderModule,\n\t\t\t\t\tentryPoint: 'main'\n\t\t\t\t},\n\t\t\t\tfragment: {\n\t\t\t\t\tmodule: this.mipmapFragmentShaderModule,\n\t\t\t\t\tentryPoint: 'main',\n\t\t\t\t\ttargets: [ { format } ]\n\t\t\t\t},\n\t\t\t\tprimitive: {\n\t\t\t\t\ttopology: GPUPrimitiveTopology.TriangleStrip,\n\t\t\t\t\tstripIndexFormat: GPUIndexFormat.Uint32\n\t\t\t\t},\n\t\t\t\tlayout: 'auto'\n\t\t\t} );\n\n\t\t\tthis.pipelines[ format ] = pipeline;\n\n\t\t}\n\n\t\treturn pipeline;\n\n\t}\n\n\tgenerateMipmaps( textureGPU, textureGPUDescriptor, baseArrayLayer = 0 ) {\n\n\t\tconst pipeline = this.getMipmapPipeline( textureGPUDescriptor.format );\n\n\t\tconst commandEncoder = this.device.createCommandEncoder( {} );\n\t\tconst bindGroupLayout = pipeline.getBindGroupLayout( 0 ); // @TODO: Consider making this static.\n\n\t\tlet srcView = textureGPU.createView( {\n\t\t\tbaseMipLevel: 0,\n\t\t\tmipLevelCount: 1,\n\t\t\tdimension: GPUTextureViewDimension.TwoD,\n\t\t\tbaseArrayLayer\n\t\t} );\n\n\t\tfor ( let i = 1; i < textureGPUDescriptor.mipLevelCount; i ++ ) {\n\n\t\t\tconst dstView = textureGPU.createView( {\n\t\t\t\tbaseMipLevel: i,\n\t\t\t\tmipLevelCount: 1,\n\t\t\t\tdimension: GPUTextureViewDimension.TwoD,\n\t\t\t\tbaseArrayLayer\n\t\t\t} );\n\n\t\t\tconst passEncoder = commandEncoder.beginRenderPass( {\n\t\t\t\tcolorAttachments: [ {\n\t\t\t\t\tview: dstView,\n\t\t\t\t\tloadOp: GPULoadOp.Clear,\n\t\t\t\t\tstoreOp: GPUStoreOp.Store,\n\t\t\t\t\tclearValue: [ 0, 0, 0, 0 ]\n\t\t\t\t} ]\n\t\t\t} );\n\n\t\t\tconst bindGroup = this.device.createBindGroup( {\n\t\t\t\tlayout: bindGroupLayout,\n\t\t\t\tentries: [ {\n\t\t\t\t\tbinding: 0,\n\t\t\t\t\tresource: this.sampler\n\t\t\t\t}, {\n\t\t\t\t\tbinding: 1,\n\t\t\t\t\tresource: srcView\n\t\t\t\t} ]\n\t\t\t} );\n\n\t\t\tpassEncoder.setPipeline( pipeline );\n\t\t\tpassEncoder.setBindGroup( 0, bindGroup );\n\t\t\tpassEncoder.draw( 4, 1, 0, 0 );\n\t\t\tpassEncoder.end();\n\n\t\t\tsrcView = dstView;\n\n\t\t}\n\n\t\tthis.device.queue.submit( [ commandEncoder.finish() ] );\n\n\t}\n\n}\n\nexport default WebGPUTextureUtils;\n","import { GPUTextureFormat, GPUAddressMode, GPUFilterMode, GPUTextureDimension, GPUFeatureName } from './constants.js';\nimport { VideoTexture, CubeTexture, Texture, NearestFilter, NearestMipmapNearestFilter, NearestMipmapLinearFilter, LinearFilter, RepeatWrapping, MirroredRepeatWrapping, RGB_ETC2_Format, RGBA_ETC2_EAC_Format,\n\tRGBAFormat, RedFormat, RGFormat, RGBA_S3TC_DXT1_Format, RGBA_S3TC_DXT3_Format, RGBA_S3TC_DXT5_Format, UnsignedByteType, FloatType, HalfFloatType, SRGBColorSpace, DepthFormat, DepthStencilFormat, DepthTexture,\n\tRGBA_ASTC_4x4_Format, RGBA_ASTC_5x4_Format, RGBA_ASTC_5x5_Format, RGBA_ASTC_6x5_Format, RGBA_ASTC_6x6_Format, RGBA_ASTC_8x5_Format, RGBA_ASTC_8x6_Format, RGBA_ASTC_8x8_Format, RGBA_ASTC_10x5_Format,\n\tRGBA_ASTC_10x6_Format, RGBA_ASTC_10x8_Format, RGBA_ASTC_10x10_Format, RGBA_ASTC_12x10_Format, RGBA_ASTC_12x12_Format, UnsignedIntType, UnsignedShortType, UnsignedInt248Type\n} from 'three';\nimport WebGPUTextureUtils from './WebGPUTextureUtils.js';\n\nclass WebGPUTextures {\n\n\tconstructor( device, properties, info ) {\n\n\t\tthis.device = device;\n\t\tthis.properties = properties;\n\t\tthis.info = info;\n\n\t\tthis.defaultTexture = null;\n\t\tthis.depthDefaultTexture = null;\n\t\tthis.defaultVideoTexture = null;\n\t\tthis.defaultCubeTexture = null;\n\t\tthis.defaultSampler = null;\n\n\t\tthis.samplerCache = new Map();\n\t\tthis.utils = null;\n\n\t}\n\n\tgetDefaultSampler() {\n\n\t\tif ( this.defaultSampler === null ) {\n\n\t\t\tthis.defaultSampler = this.device.createSampler( {} );\n\n\t\t}\n\n\t\treturn this.defaultSampler;\n\n\t}\n\n\tgetDefaultDepthTexture() {\n\n\t\tif ( this.depthDefaultTexture === null ) {\n\n\t\t\tconst depthTexture = new DepthTexture();\n\t\t\tdepthTexture.image.width = 1;\n\t\t\tdepthTexture.image.height = 1;\n\n\t\t\tthis._uploadTexture( depthTexture );\n\n\t\t\tthis.depthDefaultTexture = this.getTextureGPU( depthTexture );\n\n\t\t}\n\n\t\treturn this.depthDefaultTexture;\n\n\t}\n\n\tgetDefaultTexture() {\n\n\t\tif ( this.defaultTexture === null ) {\n\n\t\t\tconst texture = new Texture();\n\t\t\ttexture.minFilter = NearestFilter;\n\t\t\ttexture.magFilter = NearestFilter;\n\n\t\t\tthis._uploadTexture( texture );\n\n\t\t\tthis.defaultTexture = this.getTextureGPU( texture );\n\n\t\t}\n\n\t\treturn this.defaultTexture;\n\n\t}\n\n\tgetDefaultVideoTexture() {\n\n\t\tif ( this.defaultVideoTexture === null ) {\n\n\t\t\tconst video = document.getElementById( 'video' );\n\n\t\t\tconst texture = new VideoTexture( video );\n\t\t\ttexture.minFilter = NearestFilter;\n\t\t\ttexture.magFilter = NearestFilter;\n\n\t\t\tthis._uploadVideoTexture( texture );\n\n\t\t\tthis.defaultVideoTexture = this.getTextureGPU( texture );\n\n\t\t}\n\n\t\treturn this.defaultVideoTexture;\n\n\t}\n\n\tgetDefaultCubeTexture() {\n\n\t\tif ( this.defaultCubeTexture === null ) {\n\n\t\t\tconst texture = new CubeTexture();\n\t\t\ttexture.minFilter = NearestFilter;\n\t\t\ttexture.magFilter = NearestFilter;\n\n\t\t\tthis._uploadTexture( texture );\n\n\t\t\tthis.defaultCubeTexture = this.getTextureGPU( texture );\n\n\t\t}\n\n\t\treturn this.defaultCubeTexture;\n\n\t}\n\n\tgetTextureGPU( texture ) {\n\n\t\tconst textureProperties = this.properties.get( texture );\n\n\t\treturn textureProperties.textureGPU;\n\n\t}\n\n\tgetSampler( texture ) {\n\n\t\tconst textureProperties = this.properties.get( texture );\n\n\t\treturn textureProperties.samplerGPU;\n\n\t}\n\n\tupdateTexture( texture ) {\n\n\t\tlet needsUpdate = false;\n\n\t\tconst textureProperties = this.properties.get( texture );\n\n\t\tif ( texture.version > 0 && textureProperties.version !== texture.version ) {\n\n\t\t\tconst image = texture.image;\n\n\t\t\tif ( image === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGPURenderer: Texture marked for update but image is undefined.' );\n\n\t\t\t} else if ( image.complete === false ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGPURenderer: Texture marked for update but image is incomplete.' );\n\n\t\t\t} else {\n\n\t\t\t\t// texture init\n\n\t\t\t\tif ( textureProperties.initialized === undefined ) {\n\n\t\t\t\t\ttextureProperties.initialized = true;\n\n\t\t\t\t\tconst disposeCallback = onTextureDispose.bind( this );\n\t\t\t\t\ttextureProperties.disposeCallback = disposeCallback;\n\n\t\t\t\t\ttexture.addEventListener( 'dispose', disposeCallback );\n\n\t\t\t\t\tthis.info.memory.textures ++;\n\n\t\t\t\t}\n\n\t\t\t\t//\n\n\t\t\t\tif ( texture.isVideoTexture ) {\n\n\t\t\t\t\tneedsUpdate = this._uploadVideoTexture( texture );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tneedsUpdate = this._uploadTexture( texture );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// if the texture is used for RTT, it's necessary to init it once so the binding\n\t\t// group's resource definition points to the respective GPUTexture\n\n\t\tif ( textureProperties.initializedRTT === false ) {\n\n\t\t\ttextureProperties.initializedRTT = true;\n\t\t\tneedsUpdate = true;\n\n\t\t}\n\n\t\treturn needsUpdate;\n\n\t}\n\n\tupdateSampler( texture ) {\n\n\t\tconst array = [];\n\n\t\tarray.push( texture.wrapS );\n\t\tarray.push( texture.wrapT );\n\t\tarray.push( texture.wrapR );\n\t\tarray.push( texture.magFilter );\n\t\tarray.push( texture.minFilter );\n\t\tarray.push( texture.anisotropy );\n\n\t\tconst key = array.join();\n\t\tlet samplerGPU = this.samplerCache.get( key );\n\n\t\tif ( samplerGPU === undefined ) {\n\n\t\t\tsamplerGPU = this.device.createSampler( {\n\t\t\t\taddressModeU: this._convertAddressMode( texture.wrapS ),\n\t\t\t\taddressModeV: this._convertAddressMode( texture.wrapT ),\n\t\t\t\taddressModeW: this._convertAddressMode( texture.wrapR ),\n\t\t\t\tmagFilter: this._convertFilterMode( texture.magFilter ),\n\t\t\t\tminFilter: this._convertFilterMode( texture.minFilter ),\n\t\t\t\tmipmapFilter: this._convertFilterMode( texture.minFilter ),\n\t\t\t\tmaxAnisotropy: texture.anisotropy\n\t\t\t} );\n\n\t\t\tthis.samplerCache.set( key, samplerGPU );\n\n\t\t}\n\n\t\tconst textureProperties = this.properties.get( texture );\n\t\ttextureProperties.samplerGPU = samplerGPU;\n\n\t}\n\n\tinitRenderTarget( renderTarget ) {\n\n\t\tconst properties = this.properties;\n\t\tconst renderTargetProperties = properties.get( renderTarget );\n\n\t\tif ( renderTargetProperties.initialized === undefined ) {\n\n\t\t\tconst device = this.device;\n\n\t\t\tconst width = renderTarget.width;\n\t\t\tconst height = renderTarget.height;\n\n\t\t\tconst texture = renderTarget.texture;\n\n\t\t\tconst colorTextureFormat = texture.internalFormat || this._getFormat( texture );\n\t\t\tconst label = texture.name ? '_' + texture.name : '';\n\t\t\tconst needsMipmaps = this._needsMipmaps( texture );\n\t\t\tconst mipLevelCount = this._getMipLevelCount( texture, width, height, needsMipmaps );\n\n\t\t\tconst colorTextureGPU = device.createTexture( {\n\t\t\t\tlabel: 'renderTarget' + label,\n\t\t\t\tsize: {\n\t\t\t\t\twidth: width,\n\t\t\t\t\theight: height,\n\t\t\t\t\tdepthOrArrayLayers: 1\n\t\t\t\t},\n\t\t\t\tmipLevelCount: mipLevelCount,\n\t\t\t\tformat: colorTextureFormat,\n\t\t\t\tusage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST\n\t\t\t} );\n\n\t\t\tthis.info.memory.textures ++;\n\n\t\t\trenderTargetProperties.colorTextureGPU = colorTextureGPU;\n\t\t\trenderTargetProperties.colorTextureFormat = colorTextureFormat;\n\n\t\t\t// When the \".texture\" or \".depthTexture\" property of a render target is used as a map,\n\t\t\t// the renderer has to find the respective GPUTexture objects to setup the bind groups.\n\t\t\t// Since it's not possible to see just from a texture object whether it belongs to a render\n\t\t\t// target or not, we need the initializedRTT flag.\n\n\t\t\tconst textureProperties = properties.get( texture );\n\t\t\ttextureProperties.textureGPU = colorTextureGPU;\n\t\t\ttextureProperties.initializedRTT = false;\n\n\t\t\tif ( renderTarget.depthBuffer === true ) {\n\n\t\t\t\tconst depthTextureFormat = renderTarget.depthTexture !== null ? this._getFormat( renderTarget.depthTexture ) : GPUTextureFormat.Depth24PlusStencil8;\n\n\t\t\t\tconst depthTextureGPU = device.createTexture( {\n\t\t\t\t\tlabel: 'renderTarget' + label + '_depthBuffer',\n\t\t\t\t\tsize: {\n\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\theight: height,\n\t\t\t\t\t\tdepthOrArrayLayers: 1\n\t\t\t\t\t},\n\t\t\t\t\tformat: depthTextureFormat,\n\t\t\t\t\tusage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST\n\t\t\t\t} );\n\n\t\t\t\tthis.info.memory.textures ++;\n\n\t\t\t\trenderTargetProperties.depthTextureGPU = depthTextureGPU;\n\t\t\t\trenderTargetProperties.depthTextureFormat = depthTextureFormat;\n\n\t\t\t\tif ( renderTarget.depthTexture !== null ) {\n\n\t\t\t\t\tconst depthTextureProperties = properties.get( renderTarget.depthTexture );\n\t\t\t\t\tdepthTextureProperties.textureGPU = depthTextureGPU;\n\t\t\t\t\tdepthTextureProperties.initializedRTT = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tconst disposeCallback = onRenderTargetDispose.bind( this );\n\t\t\trenderTargetProperties.disposeCallback = disposeCallback;\n\n\t\t\trenderTarget.addEventListener( 'dispose', disposeCallback );\n\n\t\t\t//\n\n\t\t\trenderTargetProperties.initialized = true;\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.samplerCache.clear();\n\n\t}\n\n\t_convertAddressMode( value ) {\n\n\t\tlet addressMode = GPUAddressMode.ClampToEdge;\n\n\t\tif ( value === RepeatWrapping ) {\n\n\t\t\taddressMode = GPUAddressMode.Repeat;\n\n\t\t} else if ( value === MirroredRepeatWrapping ) {\n\n\t\t\taddressMode = GPUAddressMode.MirrorRepeat;\n\n\t\t}\n\n\t\treturn addressMode;\n\n\t}\n\n\t_convertFilterMode( value ) {\n\n\t\tlet filterMode = GPUFilterMode.Linear;\n\n\t\tif ( value === NearestFilter || value === NearestMipmapNearestFilter || value === NearestMipmapLinearFilter ) {\n\n\t\t\tfilterMode = GPUFilterMode.Nearest;\n\n\t\t}\n\n\t\treturn filterMode;\n\n\t}\n\n\t_uploadVideoTexture( texture ) {\n\n\t\tconst device = this.device;\n\n\t\tconst textureProperties = this.properties.get( texture );\n\n\t\tconst textureGPU = device.importExternalTexture( {\n\t\t\tsource: texture.source.data\n\t\t} );\n\n\t\ttextureProperties.textureGPU = textureGPU;\n\t\t//textureProperties.version = texture.version; // @TODO: Force update for now, study a better solution soon using native VideoTexture.update() to fix warns\n\n\t\treturn true;\n\n\t}\n\n\t_uploadTexture( texture ) {\n\n\t\tlet needsUpdate = false;\n\n\t\tconst device = this.device;\n\t\tconst image = texture.image;\n\n\t\tconst textureProperties = this.properties.get( texture );\n\n\t\tconst { width, height, depth } = this._getSize( texture );\n\t\tconst needsMipmaps = this._needsMipmaps( texture );\n\t\tconst dimension = this._getDimension( texture );\n\t\tconst mipLevelCount = this._getMipLevelCount( texture, width, height, needsMipmaps );\n\t\tconst format = texture.internalFormat || this._getFormat( texture );\n\n\t\tlet usage = GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST;\n\n\t\tif ( needsMipmaps ) {\n\n\t\t\t// current mipmap generation requires RENDER_ATTACHMENT\n\n\t\t\tusage |= GPUTextureUsage.RENDER_ATTACHMENT;\n\n\t\t}\n\n\t\tconst textureGPUDescriptor = {\n\t\t\tlabel: texture.name,\n\t\t\tsize: {\n\t\t\t\twidth: width,\n\t\t\t\theight: height,\n\t\t\t\tdepthOrArrayLayers: depth,\n\t\t\t},\n\t\t\tmipLevelCount: mipLevelCount,\n\t\t\tsampleCount: 1,\n\t\t\tdimension: dimension,\n\t\t\tformat: format,\n\t\t\tusage: usage\n\t\t};\n\n\t\t// texture creation\n\n\t\tlet textureGPU = textureProperties.textureGPU;\n\n\t\tif ( textureGPU === undefined ) {\n\n\t\t\ttextureGPU = device.createTexture( textureGPUDescriptor );\n\n\t\t\tneedsUpdate = true;\n\n\t\t}\n\n\t\t// transfer texture data\n\n\t\tif ( texture.isDataTexture || texture.isDataArrayTexture || texture.isData3DTexture ) {\n\n\t\t\tthis._copyBufferToTexture( image, textureGPU, textureGPUDescriptor, needsMipmaps );\n\n\t\t} else if ( texture.isCompressedTexture ) {\n\n\t\t\tthis._copyCompressedBufferToTexture( texture.mipmaps, textureGPU, textureGPUDescriptor );\n\n\t\t} else if ( texture.isCubeTexture ) {\n\n\t\t\tif ( image.length === 6 ) {\n\n\t\t\t\tthis._copyCubeMapToTexture( image, texture, textureGPU, textureGPUDescriptor, needsMipmaps );\n\n\t\t\t}\n\n\t\t} else if ( texture.isRenderTargetTexture ) {\n\n\t\t\tif ( needsMipmaps === true ) this._generateMipmaps( textureGPU, textureGPUDescriptor );\n\n\t\t} else if ( texture.isDepthTexture !== true && image !== null ) {\n\n\t\t\tthis._copyImageToTexture( image, texture, textureGPU, textureGPUDescriptor, needsMipmaps );\n\n\t\t}\n\n\t\t//\n\n\t\ttextureProperties.textureGPU = textureGPU;\n\t\ttextureProperties.version = texture.version;\n\n\t\treturn needsUpdate;\n\n\t}\n\n\t_copyBufferToTexture( image, textureGPU, textureGPUDescriptor, needsMipmaps, originDepth = 0 ) {\n\n\t\t// @TODO: Consider to use GPUCommandEncoder.copyBufferToTexture()\n\t\t// @TODO: Consider to support valid buffer layouts with other formats like RGB\n\n\t\tconst data = image.data;\n\n\t\tconst bytesPerTexel = this._getBytesPerTexel( textureGPUDescriptor.format );\n\t\tconst bytesPerRow = image.width * bytesPerTexel;\n\n\t\tthis.device.queue.writeTexture(\n\t\t\t{\n\t\t\t\ttexture: textureGPU,\n\t\t\t\tmipLevel: 0,\n\t\t\t\torigin: { x: 0, y: 0, z: originDepth }\n\t\t\t},\n\t\t\tdata,\n\t\t\t{\n\t\t\t\toffset: 0,\n\t\t\t\tbytesPerRow\n\t\t\t},\n\t\t\t{\n\t\t\t\twidth: image.width,\n\t\t\t\theight: image.height,\n\t\t\t\tdepthOrArrayLayers: ( image.depth !== undefined ) ? image.depth : 1\n\t\t\t} );\n\n\t\tif ( needsMipmaps === true ) this._generateMipmaps( textureGPU, textureGPUDescriptor, originDepth );\n\n\t}\n\n\t_copyCubeMapToTexture( images, texture, textureGPU, textureGPUDescriptor, needsMipmaps ) {\n\n\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\tconst image = images[ i ];\n\n\t\t\tif ( image.isDataTexture ) {\n\n\t\t\t\tthis._copyBufferToTexture( image.image, textureGPU, textureGPUDescriptor, needsMipmaps, i );\n\n\t\t\t} else {\n\n\t\t\t\tthis._copyImageToTexture( image, texture, textureGPU, textureGPUDescriptor, needsMipmaps, i );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_copyExternalImageToTexture( image, textureGPU, textureGPUDescriptor, needsMipmaps, originDepth = 0 ) {\n\n\t\tthis.device.queue.copyExternalImageToTexture(\n\t\t\t{\n\t\t\t\tsource: image\n\t\t\t}, {\n\t\t\t\ttexture: textureGPU,\n\t\t\t\tmipLevel: 0,\n\t\t\t\torigin: { x: 0, y: 0, z: originDepth }\n\t\t\t}, {\n\t\t\t\twidth: image.width,\n\t\t\t\theight: image.height,\n\t\t\t\tdepthOrArrayLayers: 1\n\t\t\t}\n\t\t);\n\n\t\tif ( needsMipmaps ) this._generateMipmaps( textureGPU, textureGPUDescriptor, originDepth );\n\n\t}\n\n\t_copyCompressedBufferToTexture( mipmaps, textureGPU, textureGPUDescriptor ) {\n\n\t\t// @TODO: Consider to use GPUCommandEncoder.copyBufferToTexture()\n\n\t\tconst blockData = this._getBlockData( textureGPUDescriptor.format );\n\n\t\tfor ( let i = 0; i < mipmaps.length; i ++ ) {\n\n\t\t\tconst mipmap = mipmaps[ i ];\n\n\t\t\tconst width = mipmap.width;\n\t\t\tconst height = mipmap.height;\n\n\t\t\tconst bytesPerRow = Math.ceil( width / blockData.width ) * blockData.byteLength;\n\n\t\t\tthis.device.queue.writeTexture(\n\t\t\t\t{\n\t\t\t\t\ttexture: textureGPU,\n\t\t\t\t\tmipLevel: i\n\t\t\t\t},\n\t\t\t\tmipmap.data,\n\t\t\t\t{\n\t\t\t\t\toffset: 0,\n\t\t\t\t\tbytesPerRow\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\twidth: Math.ceil( width / blockData.width ) * blockData.width,\n\t\t\t\t\theight: Math.ceil( height / blockData.width ) * blockData.width,\n\t\t\t\t\tdepthOrArrayLayers: 1\n\t\t\t\t}\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t_generateMipmaps( textureGPU, textureGPUDescriptor, baseArrayLayer ) {\n\n\t\tif ( this.utils === null ) {\n\n\t\t\tthis.utils = new WebGPUTextureUtils( this.device ); // only create this helper if necessary\n\n\t\t}\n\n\t\tthis.utils.generateMipmaps( textureGPU, textureGPUDescriptor, baseArrayLayer );\n\n\t}\n\n\t_getBlockData( format ) {\n\n\t\t// this method is only relevant for compressed texture formats\n\n\t\tif ( format === GPUTextureFormat.BC1RGBAUnorm || format === GPUTextureFormat.BC1RGBAUnormSRGB ) return { byteLength: 8, width: 4, height: 4 }; // DXT1\n\t\tif ( format === GPUTextureFormat.BC2RGBAUnorm || format === GPUTextureFormat.BC2RGBAUnormSRGB ) return { byteLength: 16, width: 4, height: 4 }; // DXT3\n\t\tif ( format === GPUTextureFormat.BC3RGBAUnorm || format === GPUTextureFormat.BC3RGBAUnormSRGB ) return { byteLength: 16, width: 4, height: 4 }; // DXT5\n\t\tif ( format === GPUTextureFormat.BC4RUnorm || format === GPUTextureFormat.BC4RSNorm ) return { byteLength: 8, width: 4, height: 4 }; // RGTC1\n\t\tif ( format === GPUTextureFormat.BC5RGUnorm || format === GPUTextureFormat.BC5RGSnorm ) return { byteLength: 16, width: 4, height: 4 }; // RGTC2\n\t\tif ( format === GPUTextureFormat.BC6HRGBUFloat || format === GPUTextureFormat.BC6HRGBFloat ) return { byteLength: 16, width: 4, height: 4 }; // BPTC (float)\n\t\tif ( format === GPUTextureFormat.BC7RGBAUnorm || format === GPUTextureFormat.BC7RGBAUnormSRGB ) return { byteLength: 16, width: 4, height: 4 }; // BPTC (unorm)\n\n\t\tif ( format === GPUTextureFormat.ETC2RGB8Unorm || format === GPUTextureFormat.ETC2RGB8UnormSRGB ) return { byteLength: 8, width: 4, height: 4 };\n\t\tif ( format === GPUTextureFormat.ETC2RGB8A1Unorm || format === GPUTextureFormat.ETC2RGB8A1UnormSRGB ) return { byteLength: 8, width: 4, height: 4 };\n\t\tif ( format === GPUTextureFormat.ETC2RGBA8Unorm || format === GPUTextureFormat.ETC2RGBA8UnormSRGB ) return { byteLength: 16, width: 4, height: 4 };\n\t\tif ( format === GPUTextureFormat.EACR11Unorm ) return { byteLength: 8, width: 4, height: 4 };\n\t\tif ( format === GPUTextureFormat.EACR11Snorm ) return { byteLength: 8, width: 4, height: 4 };\n\t\tif ( format === GPUTextureFormat.EACRG11Unorm ) return { byteLength: 16, width: 4, height: 4 };\n\t\tif ( format === GPUTextureFormat.EACRG11Snorm ) return { byteLength: 16, width: 4, height: 4 };\n\n\t\tif ( format === GPUTextureFormat.ASTC4x4Unorm || format === GPUTextureFormat.ASTC4x4UnormSRGB ) return { byteLength: 16, width: 4, height: 4 };\n\t\tif ( format === GPUTextureFormat.ASTC5x4Unorm || format === GPUTextureFormat.ASTC5x4UnormSRGB ) return { byteLength: 16, width: 5, height: 4 };\n\t\tif ( format === GPUTextureFormat.ASTC5x5Unorm || format === GPUTextureFormat.ASTC5x5UnormSRGB ) return { byteLength: 16, width: 5, height: 5 };\n\t\tif ( format === GPUTextureFormat.ASTC6x5Unorm || format === GPUTextureFormat.ASTC6x5UnormSRGB ) return { byteLength: 16, width: 6, height: 5 };\n\t\tif ( format === GPUTextureFormat.ASTC6x6Unorm || format === GPUTextureFormat.ASTC6x6UnormSRGB ) return { byteLength: 16, width: 6, height: 6 };\n\t\tif ( format === GPUTextureFormat.ASTC8x5Unorm || format === GPUTextureFormat.ASTC8x5UnormSRGB ) return { byteLength: 16, width: 8, height: 5 };\n\t\tif ( format === GPUTextureFormat.ASTC8x6Unorm || format === GPUTextureFormat.ASTC8x6UnormSRGB ) return { byteLength: 16, width: 8, height: 6 };\n\t\tif ( format === GPUTextureFormat.ASTC8x8Unorm || format === GPUTextureFormat.ASTC8x8UnormSRGB ) return { byteLength: 16, width: 8, height: 8 };\n\t\tif ( format === GPUTextureFormat.ASTC10x5Unorm || format === GPUTextureFormat.ASTC10x5UnormSRGB ) return { byteLength: 16, width: 10, height: 5 };\n\t\tif ( format === GPUTextureFormat.ASTC10x6Unorm || format === GPUTextureFormat.ASTC10x6UnormSRGB ) return { byteLength: 16, width: 10, height: 6 };\n\t\tif ( format === GPUTextureFormat.ASTC10x8Unorm || format === GPUTextureFormat.ASTC10x8UnormSRGB ) return { byteLength: 16, width: 10, height: 8 };\n\t\tif ( format === GPUTextureFormat.ASTC10x10Unorm || format === GPUTextureFormat.ASTC10x10UnormSRGB ) return { byteLength: 16, width: 10, height: 10 };\n\t\tif ( format === GPUTextureFormat.ASTC12x10Unorm || format === GPUTextureFormat.ASTC12x10UnormSRGB ) return { byteLength: 16, width: 12, height: 10 };\n\t\tif ( format === GPUTextureFormat.ASTC12x12Unorm || format === GPUTextureFormat.ASTC12x12UnormSRGB ) return { byteLength: 16, width: 12, height: 12 };\n\n\t}\n\n\t_getBytesPerTexel( format ) {\n\n\t\tif ( format === GPUTextureFormat.R8Unorm ) return 1;\n\t\tif ( format === GPUTextureFormat.R16Float ) return 2;\n\t\tif ( format === GPUTextureFormat.RG8Unorm ) return 2;\n\t\tif ( format === GPUTextureFormat.RG16Float ) return 4;\n\t\tif ( format === GPUTextureFormat.R32Float ) return 4;\n\t\tif ( format === GPUTextureFormat.RGBA8Unorm || format === GPUTextureFormat.RGBA8UnormSRGB ) return 4;\n\t\tif ( format === GPUTextureFormat.RG32Float ) return 8;\n\t\tif ( format === GPUTextureFormat.RGBA16Float ) return 8;\n\t\tif ( format === GPUTextureFormat.RGBA32Float ) return 16;\n\n\t}\n\n\t_getDimension( texture ) {\n\n\t\tlet dimension;\n\n\t\tif ( texture.isData3DTexture ) {\n\n\t\t\tdimension = GPUTextureDimension.ThreeD;\n\n\t\t} else {\n\n\t\t\tdimension = GPUTextureDimension.TwoD;\n\n\t\t}\n\n\t\treturn dimension;\n\n\t}\n\n\t_getFormat( texture ) {\n\n\t\tconst format = texture.format;\n\t\tconst type = texture.type;\n\t\tconst colorSpace = texture.colorSpace;\n\n\t\tlet formatGPU;\n\n\t\tif ( texture.isCompressedTexture === true ) {\n\n\t\t\tswitch ( format ) {\n\n\t\t\t\tcase RGBA_S3TC_DXT1_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.BC1RGBAUnormSRGB : GPUTextureFormat.BC1RGBAUnorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_S3TC_DXT3_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.BC2RGBAUnormSRGB : GPUTextureFormat.BC2RGBAUnorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_S3TC_DXT5_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.BC3RGBAUnormSRGB : GPUTextureFormat.BC3RGBAUnorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGB_ETC2_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ETC2RGB8UnormSRGB : GPUTextureFormat.ETC2RGB8Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ETC2_EAC_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ETC2RGBA8UnormSRGB : GPUTextureFormat.ETC2RGBA8Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_4x4_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC4x4UnormSRGB : GPUTextureFormat.ASTC4x4Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_5x4_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC5x4UnormSRGB : GPUTextureFormat.ASTC5x4Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_5x5_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC5x5UnormSRGB : GPUTextureFormat.ASTC5x5Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_6x5_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC6x5UnormSRGB : GPUTextureFormat.ASTC6x5Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_6x6_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC6x6UnormSRGB : GPUTextureFormat.ASTC6x6Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_8x5_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC8x5UnormSRGB : GPUTextureFormat.ASTC8x5Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_8x6_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC8x6UnormSRGB : GPUTextureFormat.ASTC8x6Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_8x8_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC8x8UnormSRGB : GPUTextureFormat.ASTC8x8Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_10x5_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC10x5UnormSRGB : GPUTextureFormat.ASTC10x5Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_10x6_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC10x6UnormSRGB : GPUTextureFormat.ASTC10x6Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_10x8_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC10x8UnormSRGB : GPUTextureFormat.ASTC10x8Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_10x10_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC10x10UnormSRGB : GPUTextureFormat.ASTC10x10Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_12x10_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC12x10UnormSRGB : GPUTextureFormat.ASTC12x10Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGBA_ASTC_12x12_Format:\n\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.ASTC12x12UnormSRGB : GPUTextureFormat.ASTC12x12Unorm;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error( 'WebGPURenderer: Unsupported texture format.', format );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tswitch ( format ) {\n\n\t\t\t\tcase RGBAFormat:\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase UnsignedByteType:\n\t\t\t\t\t\t\tformatGPU = ( colorSpace === SRGBColorSpace ) ? GPUTextureFormat.RGBA8UnormSRGB : GPUTextureFormat.RGBA8Unorm;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase HalfFloatType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.RGBA16Float;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase FloatType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.RGBA32Float;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'WebGPURenderer: Unsupported texture type with RGBAFormat.', type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RedFormat:\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase UnsignedByteType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.R8Unorm;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase HalfFloatType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.R16Float;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase FloatType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.R32Float;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'WebGPURenderer: Unsupported texture type with RedFormat.', type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RGFormat:\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase UnsignedByteType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.RG8Unorm;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase HalfFloatType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.RG16Float;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase FloatType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.RG32Float;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'WebGPURenderer: Unsupported texture type with RGFormat.', type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase DepthFormat:\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase UnsignedShortType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.Depth16Unorm;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase UnsignedIntType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.Depth24Plus;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase FloatType:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.Depth32Float;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'WebGPURenderer: Unsupported texture type with DepthFormat.', type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase DepthStencilFormat:\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase UnsignedInt248Type:\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.Depth24PlusStencil8;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase FloatType:\n\n\t\t\t\t\t\t\tif ( this.device.features.has( GPUFeatureName.Depth32FloatStencil8 ) === false ) {\n\n\t\t\t\t\t\t\t\tconsole.error( 'WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the \"depth32float-stencil8\" GPU feature.' );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tformatGPU = GPUTextureFormat.Depth32FloatStencil8;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'WebGPURenderer: Unsupported texture type with DepthStencilFormat.', type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error( 'WebGPURenderer: Unsupported texture format.', format );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn formatGPU;\n\n\t}\n\n\t_isHTMLImage( image ) {\n\n\t\treturn ( typeof HTMLImageElement !== 'undefined' && image instanceof HTMLImageElement ) || ( typeof HTMLCanvasElement !== 'undefined' && image instanceof HTMLCanvasElement );\n\n\t}\n\n\t_copyImageToTexture( image, texture, textureGPU, textureGPUDescriptor, needsMipmaps, originDepth ) {\n\n\t\tif ( this._isHTMLImage( image ) ) {\n\n\t\t\tthis._getImageBitmapFromHTML( image, texture ).then( imageBitmap => {\n\n\t\t\t\tthis._copyExternalImageToTexture( imageBitmap, textureGPU, textureGPUDescriptor, needsMipmaps, originDepth );\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\t// assume ImageBitmap\n\n\t\t\tthis._copyExternalImageToTexture( image, textureGPU, textureGPUDescriptor, needsMipmaps, originDepth );\n\n\t\t}\n\n\t}\n\n\t_getImageBitmapFromHTML( image, texture ) {\n\n\t\tconst width = image.width;\n\t\tconst height = image.height;\n\n\t\tconst options = {};\n\n\t\toptions.imageOrientation = ( texture.flipY === true ) ? 'flipY' : 'none';\n\t\toptions.premultiplyAlpha = ( texture.premultiplyAlpha === true ) ? 'premultiply' : 'default';\n\n\t\treturn createImageBitmap( image, 0, 0, width, height, options );\n\n\t}\n\n\t_getImageBitmap( image, texture ) {\n\n\t\tconst width = image.width;\n\t\tconst height = image.height;\n\n\t\tif ( ( typeof HTMLImageElement !== 'undefined' && image instanceof HTMLImageElement ) ||\n\t\t\t( typeof HTMLCanvasElement !== 'undefined' && image instanceof HTMLCanvasElement ) ) {\n\n\t\t\tconst options = {};\n\n\t\t\toptions.imageOrientation = ( texture.flipY === true ) ? 'flipY' : 'none';\n\t\t\toptions.premultiplyAlpha = ( texture.premultiplyAlpha === true ) ? 'premultiply' : 'default';\n\n\t\t\treturn createImageBitmap( image, 0, 0, width, height, options );\n\n\t\t} else {\n\n\t\t\t// assume ImageBitmap\n\n\t\t\treturn Promise.resolve( image );\n\n\t\t}\n\n\t}\n\n\t_getMipLevelCount( texture, width, height, needsMipmaps ) {\n\n\t\tlet mipLevelCount;\n\n\t\tif ( texture.isCompressedTexture ) {\n\n\t\t\tmipLevelCount = texture.mipmaps.length;\n\n\t\t} else if ( needsMipmaps ) {\n\n\t\t\tmipLevelCount = Math.floor( Math.log2( Math.max( width, height ) ) ) + 1;\n\n\t\t} else {\n\n\t\t\tmipLevelCount = 1; // a texture without mipmaps has a base mip (mipLevel 0)\n\n\t\t}\n\n\t\treturn mipLevelCount;\n\n\t}\n\n\t_getSize( texture ) {\n\n\t\tconst image = texture.image;\n\n\t\tlet width, height, depth;\n\n\t\tif ( texture.isCubeTexture ) {\n\n\t\t\tconst faceImage = image.length > 0 ? image[ 0 ].image || image[ 0 ] : null;\n\n\t\t\twidth = faceImage ? faceImage.width : 1;\n\t\t\theight = faceImage ? faceImage.height : 1;\n\t\t\tdepth = 6; // one image for each side of the cube map\n\n\t\t} else if ( image !== null ) {\n\n\t\t\twidth = image.width;\n\t\t\theight = image.height;\n\t\t\tdepth = ( image.depth !== undefined ) ? image.depth : 1;\n\n\t\t} else {\n\n\t\t\twidth = height = depth = 1;\n\n\t\t}\n\n\t\treturn { width, height, depth };\n\n\t}\n\n\t_needsMipmaps( texture ) {\n\n\t\treturn ( texture.isCompressedTexture !== true ) && ( texture.generateMipmaps === true ) && ( texture.minFilter !== NearestFilter ) && ( texture.minFilter !== LinearFilter );\n\n\t}\n\n}\n\nfunction onRenderTargetDispose( event ) {\n\n\tconst renderTarget = event.target;\n\tconst properties = this.properties;\n\n\tconst renderTargetProperties = properties.get( renderTarget );\n\n\trenderTarget.removeEventListener( 'dispose', renderTargetProperties.disposeCallback );\n\n\trenderTargetProperties.colorTextureGPU.destroy();\n\tproperties.remove( renderTarget.texture );\n\n\tthis.info.memory.textures --;\n\n\tif ( renderTarget.depthBuffer === true ) {\n\n\t\trenderTargetProperties.depthTextureGPU.destroy();\n\n\t\tthis.info.memory.textures --;\n\n\t\tif ( renderTarget.depthTexture !== null ) {\n\n\t\t\tproperties.remove( renderTarget.depthTexture );\n\n\t\t}\n\n\t}\n\n\tproperties.remove( renderTarget );\n\n}\n\nfunction onTextureDispose( event ) {\n\n\tconst texture = event.target;\n\n\tconst textureProperties = this.properties.get( texture );\n\ttextureProperties.textureGPU.destroy();\n\n\ttexture.removeEventListener( 'dispose', textureProperties.disposeCallback );\n\n\tthis.properties.remove( texture );\n\n\tthis.info.memory.textures --;\n\n}\n\nexport default WebGPUTextures;\n","import { GPULoadOp, GPUStoreOp } from './constants.js';\nimport { Color, Mesh, BoxGeometry, BackSide } from 'three';\nimport { context, positionWorldDirection, MeshBasicNodeMaterial } from '../../nodes/Nodes.js';\n\nlet _clearAlpha;\nconst _clearColor = new Color();\n\nclass WebGPUBackground {\n\n\tconstructor( renderer, properties ) {\n\n\t\tthis.renderer = renderer;\n\t\tthis.properties = properties;\n\n\t\tthis.boxMesh = null;\n\t\tthis.boxMeshNode = null;\n\n\t\tthis.forceClear = false;\n\n\t}\n\n\tclear() {\n\n\t\tthis.forceClear = true;\n\n\t}\n\n\tupdate( scene, renderList, renderState ) {\n\n\t\tconst renderer = this.renderer;\n\t\tconst background = ( scene.isScene === true ) ? scene.backgroundNode || this.properties.get( scene ).backgroundNode || scene.background : null;\n\n\t\tlet forceClear = this.forceClear;\n\n\t\tif ( background === null ) {\n\n\t\t\t// no background settings, use clear color configuration from the renderer\n\n\t\t\t_clearColor.copy( renderer._clearColor );\n\t\t\t_clearAlpha = renderer._clearAlpha;\n\n\t\t} else if ( background.isColor === true ) {\n\n\t\t\t// background is an opaque color\n\n\t\t\t_clearColor.copy( background );\n\t\t\t_clearAlpha = 1;\n\t\t\tforceClear = true;\n\n\t\t} else if ( background.isNode === true ) {\n\n\t\t\tconst sceneProperties = this.properties.get( scene );\n\t\t\tconst backgroundNode = background;\n\n\t\t\t_clearColor.copy( renderer._clearColor );\n\t\t\t_clearAlpha = renderer._clearAlpha;\n\n\t\t\tlet boxMesh = this.boxMesh;\n\n\t\t\tif ( boxMesh === null ) {\n\n\t\t\t\tthis.boxMeshNode = context( backgroundNode, {\n\t\t\t\t\t// @TODO: Add Texture2D support using node context\n\t\t\t\t\tgetUVNode: () => positionWorldDirection\n\t\t\t\t} );\n\n\t\t\t\tconst nodeMaterial = new MeshBasicNodeMaterial();\n\t\t\t\tnodeMaterial.colorNode = this.boxMeshNode;\n\t\t\t\tnodeMaterial.side = BackSide;\n\t\t\t\tnodeMaterial.depthTest = false;\n\t\t\t\tnodeMaterial.depthWrite = false;\n\t\t\t\tnodeMaterial.fog = false;\n\n\t\t\t\tthis.boxMesh = boxMesh = new Mesh( new BoxGeometry( 1, 1, 1 ), nodeMaterial );\n\t\t\t\tboxMesh.frustumCulled = false;\n\n\t\t\t\tboxMesh.onBeforeRender = function ( renderer, scene, camera ) {\n\n\t\t\t\t\tconst scale = camera.far;\n\n\t\t\t\t\tthis.matrixWorld.makeScale( scale, scale, scale ).copyPosition( camera.matrixWorld );\n\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tconst backgroundCacheKey = backgroundNode.getCacheKey();\n\n\t\t\tif ( sceneProperties.backgroundCacheKey !== backgroundCacheKey ) {\n\n\t\t\t\tthis.boxMeshNode.node = backgroundNode;\n\n\t\t\t\tboxMesh.material.needsUpdate = true;\n\n\t\t\t\tsceneProperties.backgroundCacheKey = backgroundCacheKey;\n\n\t\t\t}\n\n\t\t\trenderList.unshift( boxMesh, boxMesh.geometry, boxMesh.material, 0, 0, null );\n\n\t\t} else {\n\n\t\t\tconsole.error( 'THREE.WebGPURenderer: Unsupported background configuration.', background );\n\n\t\t}\n\n\t\t// configure render pass descriptor\n\n\t\tconst colorAttachment = renderState.descriptorGPU.colorAttachments[ 0 ];\n\t\tconst depthStencilAttachment = renderState.descriptorGPU.depthStencilAttachment;\n\n\t\tif ( renderer.autoClear === true || forceClear === true ) {\n\n\t\t\tif ( renderer.autoClearColor === true ) {\n\n\t\t\t\t_clearColor.multiplyScalar( _clearAlpha );\n\n\t\t\t\tcolorAttachment.clearValue = { r: _clearColor.r, g: _clearColor.g, b: _clearColor.b, a: _clearAlpha };\n\t\t\t\tcolorAttachment.loadOp = GPULoadOp.Clear;\n\t\t\t\tcolorAttachment.storeOp = GPUStoreOp.Store;\n\n\t\t\t} else {\n\n\t\t\t\tcolorAttachment.loadOp = GPULoadOp.Load;\n\t\t\t\tcolorAttachment.storeOp = GPUStoreOp.Store;\n\n\t\t\t}\n\n\t\t\tif ( renderState.depth ) {\n\n\t\t\t\tif ( renderer.autoClearDepth === true ) {\n\n\t\t\t\t\tdepthStencilAttachment.depthClearValue = renderer._clearDepth;\n\t\t\t\t\tdepthStencilAttachment.depthLoadOp = GPULoadOp.Clear;\n\t\t\t\t\tdepthStencilAttachment.depthStoreOp = GPUStoreOp.Store;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdepthStencilAttachment.depthLoadOp = GPULoadOp.Load;\n\t\t\t\t\tdepthStencilAttachment.depthStoreOp = GPUStoreOp.Store;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( renderState.stencil ) {\n\n\t\t\t\tif ( renderer.autoClearStencil === true ) {\n\n\t\t\t\t\tdepthStencilAttachment.stencilClearValue = renderer._clearStencil;\n\t\t\t\t\tdepthStencilAttachment.stencilLoadOp = GPULoadOp.Clear;\n\t\t\t\t\tdepthStencilAttachment.stencilStoreOp = GPUStoreOp.Store;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdepthStencilAttachment.stencilLoadOp = GPULoadOp.Load;\n\t\t\t\t\tdepthStencilAttachment.stencilStoreOp = GPUStoreOp.Store;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tcolorAttachment.loadOp = GPULoadOp.Load;\n\t\t\tcolorAttachment.storeOp = GPUStoreOp.Store;\n\n\t\t\tif ( renderState.depth ) {\n\n\t\t\t\tdepthStencilAttachment.depthLoadOp = GPULoadOp.Load;\n\t\t\t\tdepthStencilAttachment.depthStoreOp = GPUStoreOp.Store;\n\n\t\t\t}\n\n\t\t\tif ( renderState.stencil ) {\n\n\t\t\t\tdepthStencilAttachment.stencilLoadOp = GPULoadOp.Load;\n\t\t\t\tdepthStencilAttachment.stencilStoreOp = GPUStoreOp.Store;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.forceClear = false;\n\n\t}\n\n}\n\nexport default WebGPUBackground;\n","class WebGPUBinding {\n\n\tconstructor( name = '' ) {\n\n\t\tthis.name = name;\n\t\tthis.visibility = null;\n\n\t\tthis.type = null; // read-only\n\n\t\tthis.isShared = false;\n\n\t}\n\n\tsetVisibility( visibility ) {\n\n\t\tthis.visibility = visibility;\n\n\t}\n\n}\n\nexport default WebGPUBinding;\n","import { GPUChunkSize } from './constants.js';\n\nfunction getFloatLength( floatLength ) {\n\n\t// ensure chunk size alignment (STD140 layout)\n\n\treturn floatLength + ( ( GPUChunkSize - ( floatLength % GPUChunkSize ) ) % GPUChunkSize );\n\n}\n\nfunction getVectorLength( count, vectorLength = 4 ) {\n\n\tconst strideLength = getStrideLength( vectorLength );\n\n\tconst floatLength = strideLength * count;\n\n\treturn getFloatLength( floatLength );\n\n}\n\nfunction getStrideLength( vectorLength ) {\n\n\tconst strideLength = 4;\n\n\treturn vectorLength + ( ( strideLength - ( vectorLength % strideLength ) ) % strideLength );\n\n}\n\nexport {\n\tgetFloatLength,\n\tgetVectorLength,\n\tgetStrideLength\n};\n","import WebGPUBinding from './WebGPUBinding.js';\nimport { getFloatLength } from './WebGPUBufferUtils.js';\n\nclass WebGPUBuffer extends WebGPUBinding {\n\n\tconstructor( name, type, buffer = null ) {\n\n\t\tsuper( name );\n\n\t\tthis.isBuffer = true;\n\n\t\tthis.bytesPerElement = Float32Array.BYTES_PER_ELEMENT;\n\t\tthis.type = type;\n\t\tthis.visibility = GPUShaderStage.VERTEX;\n\n\t\tthis.usage = GPUBufferUsage.COPY_DST;\n\n\t\tthis.buffer = buffer;\n\t\tthis.bufferGPU = null; // set by the renderer\n\n\t}\n\n\tgetByteLength() {\n\n\t\treturn getFloatLength( this.buffer.byteLength );\n\n\t}\n\n\tgetBuffer() {\n\n\t\treturn this.buffer;\n\n\t}\n\n\tupdate() {\n\n\t\treturn true;\n\n\t}\n\n}\n\nexport default WebGPUBuffer;\n","import WebGPUBuffer from './WebGPUBuffer.js';\nimport { GPUBindingType } from './constants.js';\n\nclass WebGPUUniformBuffer extends WebGPUBuffer {\n\n\tconstructor( name, buffer = null ) {\n\n\t\tsuper( name, GPUBindingType.UniformBuffer, buffer );\n\n\t\tthis.isUniformBuffer = true;\n\n\t\tthis.usage |= GPUBufferUsage.UNIFORM;\n\n\t}\n\n}\n\nexport default WebGPUUniformBuffer;\n","import WebGPUUniformBuffer from './WebGPUUniformBuffer.js';\nimport { GPUChunkSize } from './constants.js';\n\nclass WebGPUUniformsGroup extends WebGPUUniformBuffer {\n\n\tconstructor( name ) {\n\n\t\tsuper( name );\n\n\t\tthis.isUniformsGroup = true;\n\n\t\t// the order of uniforms in this array must match the order of uniforms in the shader\n\n\t\tthis.uniforms = [];\n\n\t}\n\n\taddUniform( uniform ) {\n\n\t\tthis.uniforms.push( uniform );\n\n\t\treturn this;\n\n\t}\n\n\tremoveUniform( uniform ) {\n\n\t\tconst index = this.uniforms.indexOf( uniform );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tthis.uniforms.splice( index, 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tgetBuffer() {\n\n\t\tlet buffer = this.buffer;\n\n\t\tif ( buffer === null ) {\n\n\t\t\tconst byteLength = this.getByteLength();\n\n\t\t\tbuffer = new Float32Array( new ArrayBuffer( byteLength ) );\n\n\t\t\tthis.buffer = buffer;\n\n\t\t}\n\n\t\treturn buffer;\n\n\t}\n\n\tgetByteLength() {\n\n\t\tlet offset = 0; // global buffer offset in bytes\n\n\t\tfor ( let i = 0, l = this.uniforms.length; i < l; i ++ ) {\n\n\t\t\tconst uniform = this.uniforms[ i ];\n\n\t\t\t// offset within a single chunk in bytes\n\n\t\t\tconst chunkOffset = offset % GPUChunkSize;\n\t\t\tconst remainingSizeInChunk = GPUChunkSize - chunkOffset;\n\n\t\t\t// conformance tests\n\n\t\t\tif ( chunkOffset !== 0 && ( remainingSizeInChunk - uniform.boundary ) < 0 ) {\n\n\t\t\t\t// check for chunk overflow\n\n\t\t\t\toffset += ( GPUChunkSize - chunkOffset );\n\n\t\t\t} else if ( chunkOffset % uniform.boundary !== 0 ) {\n\n\t\t\t\t// check for correct alignment\n\n\t\t\t\toffset += ( chunkOffset % uniform.boundary );\n\n\t\t\t}\n\n\t\t\tuniform.offset = ( offset / this.bytesPerElement );\n\n\t\t\toffset += ( uniform.itemSize * this.bytesPerElement );\n\n\t\t}\n\n\t\treturn Math.ceil( offset / GPUChunkSize ) * GPUChunkSize;\n\n\t}\n\n\tupdate() {\n\n\t\tlet updated = false;\n\n\t\tfor ( const uniform of this.uniforms ) {\n\n\t\t\tif ( this.updateByType( uniform ) === true ) {\n\n\t\t\t\tupdated = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n\tupdateByType( uniform ) {\n\n\t\tif ( uniform.isFloatUniform ) return this.updateNumber( uniform );\n\t\tif ( uniform.isVector2Uniform ) return this.updateVector2( uniform );\n\t\tif ( uniform.isVector3Uniform ) return this.updateVector3( uniform );\n\t\tif ( uniform.isVector4Uniform ) return this.updateVector4( uniform );\n\t\tif ( uniform.isColorUniform ) return this.updateColor( uniform );\n\t\tif ( uniform.isMatrix3Uniform ) return this.updateMatrix3( uniform );\n\t\tif ( uniform.isMatrix4Uniform ) return this.updateMatrix4( uniform );\n\n\t\tconsole.error( 'THREE.WebGPUUniformsGroup: Unsupported uniform type.', uniform );\n\n\t}\n\n\tupdateNumber( uniform ) {\n\n\t\tlet updated = false;\n\n\t\tconst a = this.buffer;\n\t\tconst v = uniform.getValue();\n\t\tconst offset = uniform.offset;\n\n\t\tif ( a[ offset ] !== v ) {\n\n\t\t\ta[ offset ] = v;\n\t\t\tupdated = true;\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n\tupdateVector2( uniform ) {\n\n\t\tlet updated = false;\n\n\t\tconst a = this.buffer;\n\t\tconst v = uniform.getValue();\n\t\tconst offset = uniform.offset;\n\n\t\tif ( a[ offset + 0 ] !== v.x || a[ offset + 1 ] !== v.y ) {\n\n\t\t\ta[ offset + 0 ] = v.x;\n\t\t\ta[ offset + 1 ] = v.y;\n\n\t\t\tupdated = true;\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n\tupdateVector3( uniform ) {\n\n\t\tlet updated = false;\n\n\t\tconst a = this.buffer;\n\t\tconst v = uniform.getValue();\n\t\tconst offset = uniform.offset;\n\n\t\tif ( a[ offset + 0 ] !== v.x || a[ offset + 1 ] !== v.y || a[ offset + 2 ] !== v.z ) {\n\n\t\t\ta[ offset + 0 ] = v.x;\n\t\t\ta[ offset + 1 ] = v.y;\n\t\t\ta[ offset + 2 ] = v.z;\n\n\t\t\tupdated = true;\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n\tupdateVector4( uniform ) {\n\n\t\tlet updated = false;\n\n\t\tconst a = this.buffer;\n\t\tconst v = uniform.getValue();\n\t\tconst offset = uniform.offset;\n\n\t\tif ( a[ offset + 0 ] !== v.x || a[ offset + 1 ] !== v.y || a[ offset + 2 ] !== v.z || a[ offset + 4 ] !== v.w ) {\n\n\t\t\ta[ offset + 0 ] = v.x;\n\t\t\ta[ offset + 1 ] = v.y;\n\t\t\ta[ offset + 2 ] = v.z;\n\t\t\ta[ offset + 3 ] = v.w;\n\n\t\t\tupdated = true;\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n\tupdateColor( uniform ) {\n\n\t\tlet updated = false;\n\n\t\tconst a = this.buffer;\n\t\tconst c = uniform.getValue();\n\t\tconst offset = uniform.offset;\n\n\t\tif ( a[ offset + 0 ] !== c.r || a[ offset + 1 ] !== c.g || a[ offset + 2 ] !== c.b ) {\n\n\t\t\ta[ offset + 0 ] = c.r;\n\t\t\ta[ offset + 1 ] = c.g;\n\t\t\ta[ offset + 2 ] = c.b;\n\n\t\t\tupdated = true;\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n\tupdateMatrix3( uniform ) {\n\n\t\tlet updated = false;\n\n\t\tconst a = this.buffer;\n\t\tconst e = uniform.getValue().elements;\n\t\tconst offset = uniform.offset;\n\n\t\tif ( a[ offset + 0 ] !== e[ 0 ] || a[ offset + 1 ] !== e[ 1 ] || a[ offset + 2 ] !== e[ 2 ] ||\n\t\t\ta[ offset + 4 ] !== e[ 3 ] || a[ offset + 5 ] !== e[ 4 ] || a[ offset + 6 ] !== e[ 5 ] ||\n\t\t\ta[ offset + 8 ] !== e[ 6 ] || a[ offset + 9 ] !== e[ 7 ] || a[ offset + 10 ] !== e[ 8 ] ) {\n\n\t\t\ta[ offset + 0 ] = e[ 0 ];\n\t\t\ta[ offset + 1 ] = e[ 1 ];\n\t\t\ta[ offset + 2 ] = e[ 2 ];\n\t\t\ta[ offset + 4 ] = e[ 3 ];\n\t\t\ta[ offset + 5 ] = e[ 4 ];\n\t\t\ta[ offset + 6 ] = e[ 5 ];\n\t\t\ta[ offset + 8 ] = e[ 6 ];\n\t\t\ta[ offset + 9 ] = e[ 7 ];\n\t\t\ta[ offset + 10 ] = e[ 8 ];\n\n\t\t\tupdated = true;\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n\tupdateMatrix4( uniform ) {\n\n\t\tlet updated = false;\n\n\t\tconst a = this.buffer;\n\t\tconst e = uniform.getValue().elements;\n\t\tconst offset = uniform.offset;\n\n\t\tif ( arraysEqual( a, e, offset ) === false ) {\n\n\t\t\ta.set( e, offset );\n\t\t\tupdated = true;\n\n\t\t}\n\n\t\treturn updated;\n\n\t}\n\n}\n\nfunction arraysEqual( a, b, offset ) {\n\n\tfor ( let i = 0, l = b.length; i < l; i ++ ) {\n\n\t\tif ( a[ offset + i ] !== b[ i ] ) return false;\n\n\t}\n\n\treturn true;\n\n}\n\nexport default WebGPUUniformsGroup;\n","import { Color, Matrix3, Matrix4, Vector2, Vector3, Vector4 } from 'three';\n\nclass WebGPUUniform {\n\n\tconstructor( name, value = null ) {\n\n\t\tthis.name = name;\n\t\tthis.value = value;\n\n\t\tthis.boundary = 0; // used to build the uniform buffer according to the STD140 layout\n\t\tthis.itemSize = 0;\n\n\t\tthis.offset = 0; // this property is set by WebGPUUniformsGroup and marks the start position in the uniform buffer\n\n\t}\n\n\tsetValue( value ) {\n\n\t\tthis.value = value;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.value;\n\n\t}\n\n}\n\nclass FloatUniform extends WebGPUUniform {\n\n\tconstructor( name, value = 0 ) {\n\n\t\tsuper( name, value );\n\n\t\tthis.isFloatUniform = true;\n\n\t\tthis.boundary = 4;\n\t\tthis.itemSize = 1;\n\n\t}\n\n}\n\nclass Vector2Uniform extends WebGPUUniform {\n\n\tconstructor( name, value = new Vector2() ) {\n\n\t\tsuper( name, value );\n\n\t\tthis.isVector2Uniform = true;\n\n\t\tthis.boundary = 8;\n\t\tthis.itemSize = 2;\n\n\t}\n\n}\n\nclass Vector3Uniform extends WebGPUUniform {\n\n\tconstructor( name, value = new Vector3() ) {\n\n\t\tsuper( name, value );\n\n\t\tthis.isVector3Uniform = true;\n\n\t\tthis.boundary = 16;\n\t\tthis.itemSize = 3;\n\n\t}\n\n}\n\nclass Vector4Uniform extends WebGPUUniform {\n\n\tconstructor( name, value = new Vector4() ) {\n\n\t\tsuper( name, value );\n\n\t\tthis.isVector4Uniform = true;\n\n\t\tthis.boundary = 16;\n\t\tthis.itemSize = 4;\n\n\t}\n\n}\n\nclass ColorUniform extends WebGPUUniform {\n\n\tconstructor( name, value = new Color() ) {\n\n\t\tsuper( name, value );\n\n\t\tthis.isColorUniform = true;\n\n\t\tthis.boundary = 16;\n\t\tthis.itemSize = 3;\n\n\t}\n\n}\n\nclass Matrix3Uniform extends WebGPUUniform {\n\n\tconstructor( name, value = new Matrix3() ) {\n\n\t\tsuper( name, value );\n\n\t\tthis.isMatrix3Uniform = true;\n\n\t\tthis.boundary = 48;\n\t\tthis.itemSize = 12;\n\n\t}\n\n}\n\nclass Matrix4Uniform extends WebGPUUniform {\n\n\tconstructor( name, value = new Matrix4() ) {\n\n\t\tsuper( name, value );\n\n\t\tthis.isMatrix4Uniform = true;\n\n\t\tthis.boundary = 64;\n\t\tthis.itemSize = 16;\n\n\t}\n\n}\n\nexport { FloatUniform, Vector2Uniform, Vector3Uniform, Vector4Uniform, ColorUniform, Matrix3Uniform, Matrix4Uniform };\n","import {\n\tFloatUniform, Vector2Uniform, Vector3Uniform, Vector4Uniform,\n\tColorUniform, Matrix3Uniform, Matrix4Uniform\n} from '../WebGPUUniform.js';\n\nclass FloatNodeUniform extends FloatUniform {\n\n\tconstructor( nodeUniform ) {\n\n\t\tsuper( nodeUniform.name, nodeUniform.value );\n\n\t\tthis.nodeUniform = nodeUniform;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.nodeUniform.value;\n\n\t}\n\n}\n\nclass Vector2NodeUniform extends Vector2Uniform {\n\n\tconstructor( nodeUniform ) {\n\n\t\tsuper( nodeUniform.name, nodeUniform.value );\n\n\t\tthis.nodeUniform = nodeUniform;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.nodeUniform.value;\n\n\t}\n\n}\n\nclass Vector3NodeUniform extends Vector3Uniform {\n\n\tconstructor( nodeUniform ) {\n\n\t\tsuper( nodeUniform.name, nodeUniform.value );\n\n\t\tthis.nodeUniform = nodeUniform;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.nodeUniform.value;\n\n\t}\n\n}\n\nclass Vector4NodeUniform extends Vector4Uniform {\n\n\tconstructor( nodeUniform ) {\n\n\t\tsuper( nodeUniform.name, nodeUniform.value );\n\n\t\tthis.nodeUniform = nodeUniform;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.nodeUniform.value;\n\n\t}\n\n}\n\nclass ColorNodeUniform extends ColorUniform {\n\n\tconstructor( nodeUniform ) {\n\n\t\tsuper( nodeUniform.name, nodeUniform.value );\n\n\t\tthis.nodeUniform = nodeUniform;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.nodeUniform.value;\n\n\t}\n\n}\n\nclass Matrix3NodeUniform extends Matrix3Uniform {\n\n\tconstructor( nodeUniform ) {\n\n\t\tsuper( nodeUniform.name, nodeUniform.value );\n\n\t\tthis.nodeUniform = nodeUniform;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.nodeUniform.value;\n\n\t}\n\n}\n\nclass Matrix4NodeUniform extends Matrix4Uniform {\n\n\tconstructor( nodeUniform ) {\n\n\t\tsuper( nodeUniform.name, nodeUniform.value );\n\n\t\tthis.nodeUniform = nodeUniform;\n\n\t}\n\n\tgetValue() {\n\n\t\treturn this.nodeUniform.value;\n\n\t}\n\n}\n\nexport {\n\tFloatNodeUniform, Vector2NodeUniform, Vector3NodeUniform, Vector4NodeUniform,\n\tColorNodeUniform, Matrix3NodeUniform, Matrix4NodeUniform\n};\n","import WebGPUBinding from './WebGPUBinding.js';\nimport { GPUBindingType } from './constants.js';\n\nclass WebGPUSampler extends WebGPUBinding {\n\n\tconstructor( name, texture ) {\n\n\t\tsuper( name );\n\n\t\tthis.isSampler = true;\n\n\t\tthis.texture = texture;\n\n\t\tthis.type = GPUBindingType.Sampler;\n\t\tthis.visibility = GPUShaderStage.FRAGMENT;\n\n\t\tthis.samplerGPU = null; // set by the renderer\n\n\t}\n\n\tgetTexture() {\n\n\t\treturn this.texture;\n\n\t}\n\n}\n\nexport default WebGPUSampler;\n","import WebGPUSampler from '../WebGPUSampler.js';\n\nclass WebGPUNodeSampler extends WebGPUSampler {\n\n\tconstructor( name, textureNode ) {\n\n\t\tsuper( name, textureNode.value );\n\n\t\tthis.textureNode = textureNode;\n\n\t}\n\n\tgetTexture() {\n\n\t\treturn this.textureNode.value;\n\n\t}\n\n}\n\nexport default WebGPUNodeSampler;\n","import WebGPUBinding from './WebGPUBinding.js';\nimport { GPUBindingType, GPUTextureViewDimension, GPUTextureAspect } from './constants.js';\n\nclass WebGPUSampledTexture extends WebGPUBinding {\n\n\tconstructor( name, texture ) {\n\n\t\tsuper( name );\n\n\t\tthis.isSampledTexture = true;\n\n\t\tthis.texture = texture;\n\n\t\tthis.dimension = GPUTextureViewDimension.TwoD;\n\n\t\tthis.type = GPUBindingType.SampledTexture;\n\t\tthis.visibility = GPUShaderStage.FRAGMENT;\n\n\t\tthis.aspect = texture.isDepthTexture ? GPUTextureAspect.DepthOnly : GPUTextureAspect.All;\n\n\t\tthis.textureGPU = null; // set by the renderer\n\n\t}\n\n\tgetTexture() {\n\n\t\treturn this.texture;\n\n\t}\n\n}\n\nclass WebGPUSampledArrayTexture extends WebGPUSampledTexture {\n\n\tconstructor( name, texture ) {\n\n\t\tsuper( name, texture );\n\n\t\tthis.isSampledArrayTexture = true;\n\n\t\tthis.dimension = GPUTextureViewDimension.TwoDArray;\n\n\t}\n\n}\n\nclass WebGPUSampled3DTexture extends WebGPUSampledTexture {\n\n\tconstructor( name, texture ) {\n\n\t\tsuper( name, texture );\n\n\t\tthis.isSampled3DTexture = true;\n\n\t\tthis.dimension = GPUTextureViewDimension.ThreeD;\n\n\t}\n\n}\n\nclass WebGPUSampledCubeTexture extends WebGPUSampledTexture {\n\n\tconstructor( name, texture ) {\n\n\t\tsuper( name, texture );\n\n\t\tthis.isSampledCubeTexture = true;\n\n\t\tthis.dimension = GPUTextureViewDimension.Cube;\n\n\t}\n\n}\n\nexport { WebGPUSampledTexture, WebGPUSampledArrayTexture, WebGPUSampled3DTexture, WebGPUSampledCubeTexture };\n","import { WebGPUSampledTexture, WebGPUSampledCubeTexture } from '../WebGPUSampledTexture.js';\n\nclass WebGPUNodeSampledTexture extends WebGPUSampledTexture {\n\n\tconstructor( name, textureNode ) {\n\n\t\tsuper( name, textureNode.value );\n\n\t\tthis.textureNode = textureNode;\n\n\t}\n\n\tgetTexture() {\n\n\t\treturn this.textureNode.value;\n\n\t}\n\n}\n\nclass WebGPUNodeSampledCubeTexture extends WebGPUSampledCubeTexture {\n\n\tconstructor( name, textureNode ) {\n\n\t\tsuper( name, textureNode.value );\n\n\t\tthis.textureNode = textureNode;\n\n\t}\n\n\tgetTexture() {\n\n\t\treturn this.textureNode.value;\n\n\t}\n\n}\n\nexport { WebGPUNodeSampledTexture, WebGPUNodeSampledCubeTexture };\n","import WebGPUBuffer from './WebGPUBuffer.js';\nimport { GPUBindingType } from './constants.js';\n\nclass WebGPUStorageBuffer extends WebGPUBuffer {\n\n\tconstructor( name, attribute ) {\n\n\t\tsuper( name, GPUBindingType.StorageBuffer, attribute.array );\n\n\t\tthis.isStorageBuffer = true;\n\n\t\tthis.usage |= GPUBufferUsage.VERTEX | GPUBufferUsage.STORAGE;\n\n\t\tthis.attribute = attribute;\n\n\t}\n\n}\n\nexport default WebGPUStorageBuffer;\n","import { WebGLRenderTarget } from 'three';\n\n// @TODO: Consider rename WebGLRenderTarget to just RenderTarget\n\nclass WebGPURenderTarget extends WebGLRenderTarget {\n\n\tconstructor( width, height, options = {} ) {\n\n\t\tsuper( width, height, options );\n\n\t}\n\n}\n\nexport default WebGPURenderTarget;\n","import WebGPUUniformsGroup from '../WebGPUUniformsGroup.js';\nimport {\n\tFloatNodeUniform, Vector2NodeUniform, Vector3NodeUniform, Vector4NodeUniform,\n\tColorNodeUniform, Matrix3NodeUniform, Matrix4NodeUniform\n} from './WebGPUNodeUniform.js';\nimport WebGPUNodeSampler from './WebGPUNodeSampler.js';\nimport { WebGPUNodeSampledTexture, WebGPUNodeSampledCubeTexture } from './WebGPUNodeSampledTexture.js';\n\nimport WebGPUUniformBuffer from '../WebGPUUniformBuffer.js';\nimport WebGPUStorageBuffer from '../WebGPUStorageBuffer.js';\nimport { getVectorLength, getStrideLength } from '../WebGPUBufferUtils.js';\n\nimport WebGPURenderTarget from '../WebGPURenderTarget.js';\n\nimport { NodeBuilder, WGSLNodeParser, CodeNode, NodeMaterial } from '../../../nodes/Nodes.js';\n\nconst gpuShaderStageLib = {\n\t'vertex': GPUShaderStage.VERTEX,\n\t'fragment': GPUShaderStage.FRAGMENT,\n\t'compute': GPUShaderStage.COMPUTE\n};\n\nconst supports = {\n\tinstance: true\n};\n\nconst wgslTypeLib = {\n\tfloat: 'f32',\n\tint: 'i32',\n\tuint: 'u32',\n\tbool: 'bool',\n\tcolor: 'vec3<f32>',\n\n\tvec2: 'vec2<f32>',\n\tivec2: 'vec2<i32>',\n\tuvec2: 'vec2<u32>',\n\tbvec2: 'vec2<bool>',\n\n\tvec3: 'vec3<f32>',\n\tivec3: 'vec3<i32>',\n\tuvec3: 'vec3<u32>',\n\tbvec3: 'vec3<bool>',\n\n\tvec4: 'vec4<f32>',\n\tivec4: 'vec4<i32>',\n\tuvec4: 'vec4<u32>',\n\tbvec4: 'vec4<bool>',\n\n\tmat3: 'mat3x3<f32>',\n\timat3: 'mat3x3<i32>',\n\tumat3: 'mat3x3<u32>',\n\tbmat3: 'mat3x3<bool>',\n\n\tmat4: 'mat4x4<f32>',\n\timat4: 'mat4x4<i32>',\n\tumat4: 'mat4x4<u32>',\n\tbmat4: 'mat4x4<bool>'\n};\n\nconst wgslMethods = {\n\tdFdx: 'dpdx',\n\tdFdy: 'dpdy',\n\tmod: 'threejs_mod',\n\tlessThanEqual: 'threejs_lessThanEqual',\n\tinversesqrt: 'inverseSqrt'\n};\n\nconst wgslPolyfill = {\n\tlessThanEqual: new CodeNode( `\nfn threejs_lessThanEqual( a : vec3<f32>, b : vec3<f32> ) -> vec3<bool> {\n\n\treturn vec3<bool>( a.x <= b.x, a.y <= b.y, a.z <= b.z );\n\n}\n` ),\n\tmod: new CodeNode( `\nfn threejs_mod( x : f32, y : f32 ) -> f32 {\n\n\treturn x - y * floor( x / y );\n\n}\n` ),\n\trepeatWrapping: new CodeNode( `\nfn threejs_repeatWrapping( uv : vec2<f32>, dimension : vec2<u32> ) -> vec2<u32> {\n\n\tlet uvScaled = vec2<u32>( uv * vec2<f32>( dimension ) );\n\n\treturn ( ( uvScaled % dimension ) + dimension ) % dimension;\n\n}\n` )\n};\n\nclass WebGPUNodeBuilder extends NodeBuilder {\n\n\tconstructor( object, renderer ) {\n\n\t\tsuper( object, renderer, new WGSLNodeParser() );\n\n\t\tthis.bindings = { vertex: [], fragment: [], compute: [] };\n\t\tthis.bindingsOffset = { vertex: 0, fragment: 0, compute: 0 };\n\n\t\tthis.uniformsGroup = {};\n\n\t\tthis.builtins = {\n\t\t\tvertex: new Map(),\n\t\t\tfragment: new Map(),\n\t\t\tcompute: new Map(),\n\t\t\tattribute: new Map()\n\t\t};\n\n\t}\n\n\tbuild() {\n\n\t\tconst { object, material } = this;\n\n\t\tif ( material !== null ) {\n\n\t\t\tNodeMaterial.fromMaterial( material ).build( this );\n\n\t\t} else {\n\n\t\t\tthis.addFlow( 'compute', object );\n\n\t\t}\n\n\t\treturn super.build();\n\n\t}\n\n\tgetSampler( textureProperty, uvSnippet, shaderStage = this.shaderStage ) {\n\n\t\tif ( shaderStage === 'fragment' ) {\n\n\t\t\treturn `textureSample( ${textureProperty}, ${textureProperty}_sampler, ${uvSnippet} )`;\n\n\t\t} else {\n\n\t\t\tthis._include( 'repeatWrapping' );\n\n\t\t\tconst dimension = `textureDimensions( ${textureProperty}, 0 )`;\n\n\t\t\treturn `textureLoad( ${textureProperty}, threejs_repeatWrapping( ${uvSnippet}, ${dimension} ), 0 )`;\n\n\t\t}\n\n\t}\n\n\tgetVideoSampler( textureProperty, uvSnippet, shaderStage = this.shaderStage ) {\n\n\t\tif ( shaderStage === 'fragment' ) {\n\n\t\t\treturn `textureSampleBaseClampToEdge( ${textureProperty}, ${textureProperty}_sampler, vec2<f32>( ${uvSnippet}.x, 1.0 - ${uvSnippet}.y ) )`;\n\n\t\t} else {\n\n\t\t\tconsole.error( `WebGPURenderer: THREE.VideoTexture does not support ${ shaderStage } shader.` );\n\n\t\t}\n\n\t}\n\n\tgetSamplerLevel( textureProperty, uvSnippet, biasSnippet, shaderStage = this.shaderStage ) {\n\n\t\tif ( shaderStage === 'fragment' ) {\n\n\t\t\treturn `textureSampleLevel( ${textureProperty}, ${textureProperty}_sampler, ${uvSnippet}, ${biasSnippet} )`;\n\n\t\t} else {\n\n\t\t\tthis._include( 'repeatWrapping' );\n\n\t\t\tconst dimension = `textureDimensions( ${textureProperty}, 0 )`;\n\n\t\t\treturn `textureLoad( ${textureProperty}, threejs_repeatWrapping( ${uvSnippet}, ${dimension} ), i32( ${biasSnippet} ) )`;\n\n\t\t}\n\n\t}\n\n\tgetTexture( texture, textureProperty, uvSnippet, shaderStage = this.shaderStage ) {\n\n\t\tlet snippet = null;\n\n\t\tif ( texture.isVideoTexture === true ) {\n\n\t\t\tsnippet = this.getVideoSampler( textureProperty, uvSnippet, shaderStage );\n\n\t\t} else {\n\n\t\t\tsnippet = this.getSampler( textureProperty, uvSnippet, shaderStage );\n\n\t\t}\n\n\t\treturn snippet;\n\n\t}\n\n\tgetTextureLevel( texture, textureProperty, uvSnippet, biasSnippet, shaderStage = this.shaderStage ) {\n\n\t\tlet snippet = null;\n\n\t\tif ( texture.isVideoTexture === true ) {\n\n\t\t\tsnippet = this.getVideoSampler( textureProperty, uvSnippet, shaderStage );\n\n\t\t} else {\n\n\t\t\tsnippet = this.getSamplerLevel( textureProperty, uvSnippet, biasSnippet, shaderStage );\n\n\t\t}\n\n\t\treturn snippet;\n\n\t}\n\n\tgetPropertyName( node, shaderStage = this.shaderStage ) {\n\n\t\tif ( node.isNodeVarying === true && node.needsInterpolation === true ) {\n\n\t\t\tif ( shaderStage === 'vertex' ) {\n\n\t\t\t\treturn `NodeVaryings.${ node.name }`;\n\n\t\t\t}\n\n\t\t} else if ( node.isNodeUniform === true ) {\n\n\t\t\tconst name = node.name;\n\t\t\tconst type = node.type;\n\n\t\t\tif ( type === 'texture' || type === 'cubeTexture' ) {\n\n\t\t\t\treturn name;\n\n\t\t\t} else if ( type === 'buffer' || type === 'storageBuffer' ) {\n\n\t\t\t\treturn `NodeBuffer_${node.node.id}.${name}`;\n\n\t\t\t} else {\n\n\t\t\t\treturn `NodeUniforms.${name}`;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn super.getPropertyName( node );\n\n\t}\n\n\tgetBindings() {\n\n\t\tconst bindings = this.bindings;\n\n\t\treturn this.material !== null ? [ ...bindings.vertex, ...bindings.fragment ] : bindings.compute;\n\n\t}\n\n\tgetUniformFromNode( node, shaderStage, type ) {\n\n\t\tconst uniformNode = super.getUniformFromNode( node, shaderStage, type );\n\t\tconst nodeData = this.getDataFromNode( node, shaderStage );\n\n\t\tif ( nodeData.uniformGPU === undefined ) {\n\n\t\t\tlet uniformGPU;\n\n\t\t\tconst bindings = this.bindings[ shaderStage ];\n\n\t\t\tif ( type === 'texture' || type === 'cubeTexture' ) {\n\n\t\t\t\tconst sampler = new WebGPUNodeSampler( `${uniformNode.name}_sampler`, uniformNode.node );\n\n\t\t\t\tlet texture = null;\n\n\t\t\t\tif ( type === 'texture' ) {\n\n\t\t\t\t\ttexture = new WebGPUNodeSampledTexture( uniformNode.name, uniformNode.node );\n\n\t\t\t\t} else if ( type === 'cubeTexture' ) {\n\n\t\t\t\t\ttexture = new WebGPUNodeSampledCubeTexture( uniformNode.name, uniformNode.node );\n\n\t\t\t\t}\n\n\t\t\t\t// add first textures in sequence and group for last\n\t\t\t\tconst lastBinding = bindings[ bindings.length - 1 ];\n\t\t\t\tconst index = lastBinding && lastBinding.isUniformsGroup ? bindings.length - 1 : bindings.length;\n\n\t\t\t\tif ( shaderStage === 'fragment' ) {\n\n\t\t\t\t\tbindings.splice( index, 0, sampler, texture );\n\n\t\t\t\t\tuniformGPU = [ sampler, texture ];\n\n\t\t\t\t} else {\n\n\t\t\t\t\tbindings.splice( index, 0, texture );\n\n\t\t\t\t\tuniformGPU = [ texture ];\n\n\t\t\t\t}\n\n\t\t\t} else if ( type === 'buffer' || type === 'storageBuffer' ) {\n\n\t\t\t\tconst bufferClass = type === 'storageBuffer' ? WebGPUStorageBuffer : WebGPUUniformBuffer;\n\t\t\t\tconst buffer = new bufferClass( 'NodeBuffer_' + node.id, node.value );\n\t\t\t\tbuffer.setVisibility( gpuShaderStageLib[ shaderStage ] );\n\n\t\t\t\t// add first textures in sequence and group for last\n\t\t\t\tconst lastBinding = bindings[ bindings.length - 1 ];\n\t\t\t\tconst index = lastBinding && lastBinding.isUniformsGroup ? bindings.length - 1 : bindings.length;\n\n\t\t\t\tbindings.splice( index, 0, buffer );\n\n\t\t\t\tuniformGPU = buffer;\n\n\t\t\t} else {\n\n\t\t\t\tlet uniformsGroup = this.uniformsGroup[ shaderStage ];\n\n\t\t\t\tif ( uniformsGroup === undefined ) {\n\n\t\t\t\t\tuniformsGroup = new WebGPUUniformsGroup( 'nodeUniforms' );\n\t\t\t\t\tuniformsGroup.setVisibility( gpuShaderStageLib[ shaderStage ] );\n\n\t\t\t\t\tthis.uniformsGroup[ shaderStage ] = uniformsGroup;\n\n\t\t\t\t\tbindings.push( uniformsGroup );\n\n\t\t\t\t}\n\n\t\t\t\tif ( node.isArrayUniformNode === true ) {\n\n\t\t\t\t\tuniformGPU = [];\n\n\t\t\t\t\tfor ( const uniformNode of node.nodes ) {\n\n\t\t\t\t\t\tconst uniformNodeGPU = this._getNodeUniform( uniformNode, type );\n\n\t\t\t\t\t\t// fit bounds to buffer\n\t\t\t\t\t\tuniformNodeGPU.boundary = getVectorLength( uniformNodeGPU.itemSize );\n\t\t\t\t\t\tuniformNodeGPU.itemSize = getStrideLength( uniformNodeGPU.itemSize );\n\n\t\t\t\t\t\tuniformsGroup.addUniform( uniformNodeGPU );\n\n\t\t\t\t\t\tuniformGPU.push( uniformNodeGPU );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tuniformGPU = this._getNodeUniform( uniformNode, type );\n\n\t\t\t\t\tuniformsGroup.addUniform( uniformGPU );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tnodeData.uniformGPU = uniformGPU;\n\n\t\t\tif ( shaderStage === 'vertex' ) {\n\n\t\t\t\tthis.bindingsOffset[ 'fragment' ] = bindings.length;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn uniformNode;\n\n\t}\n\n\tisReference( type ) {\n\n\t\treturn super.isReference( type ) || type === 'texture_2d' || type === 'texture_cube';\n\n\t}\n\n\tgetBuiltin( name, property, type, shaderStage = this.shaderStage ) {\n\n\t\tconst map = this.builtins[ shaderStage ];\n\n\t\tif ( map.has( name ) === false ) {\n\n\t\t\tmap.set( name, {\n\t\t\t\tname,\n\t\t\t\tproperty,\n\t\t\t\ttype\n\t\t\t} );\n\n\t\t}\n\n\t\treturn property;\n\n\t}\n\n\tgetInstanceIndex() {\n\n\t\tif ( this.shaderStage === 'vertex' ) {\n\n\t\t\treturn this.getBuiltin( 'instance_index', 'instanceIndex', 'u32', 'attribute' );\n\n\t\t}\n\n\t\treturn 'instanceIndex';\n\n\t}\n\n\tgetFrontFacing() {\n\n\t\treturn this.getBuiltin( 'front_facing', 'isFront', 'bool' );\n\n\t}\n\n\tgetFragCoord() {\n\n\t\treturn this.getBuiltin( 'position', 'fragCoord', 'vec4<f32>', 'fragment' );\n\n\t}\n\n\tisFlipY() {\n\n\t\treturn false;\n\n\t}\n\n\tgetAttributes( shaderStage ) {\n\n\t\tconst snippets = [];\n\n\t\tif ( shaderStage === 'compute' ) {\n\n\t\t\tthis.getBuiltin( 'global_invocation_id', 'id', 'vec3<u32>', 'attribute' );\n\n\t\t}\n\n\t\tif ( shaderStage === 'vertex' || shaderStage === 'compute' ) {\n\n\t\t\tfor ( const { name, property, type } of this.builtins.attribute.values() ) {\n\n\t\t\t\tsnippets.push( `@builtin( ${name} ) ${property} : ${type}` );\n\n\t\t\t}\n\n\t\t\tconst attributes = this.attributes;\n\t\t\tconst length = attributes.length;\n\n\t\t\tfor ( let index = 0; index < length; index ++ ) {\n\n\t\t\t\tconst attribute = attributes[ index ];\n\t\t\t\tconst name = attribute.name;\n\t\t\t\tconst type = this.getType( attribute.type );\n\n\t\t\t\tsnippets.push( `@location( ${index} ) ${ name } : ${ type }` );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn snippets.join( ',\\n\\t' );\n\n\t}\n\n\tgetVars( shaderStage ) {\n\n\t\tconst snippets = [];\n\t\tconst vars = this.vars[ shaderStage ];\n\n\t\tfor ( const variable of vars ) {\n\n\t\t\tconst name = variable.name;\n\t\t\tconst type = this.getType( variable.type );\n\n\t\t\tsnippets.push( `\\tvar ${name} : ${type};` );\n\n\t\t}\n\n\t\treturn `\\n${ snippets.join( '\\n' ) }\\n`;\n\n\t}\n\n\tgetVaryings( shaderStage ) {\n\n\t\tconst snippets = [];\n\n\t\tif ( shaderStage === 'vertex' ) {\n\n\t\t\tthis.getBuiltin( 'position', 'Vertex', 'vec4<f32>', 'vertex' );\n\n\t\t}\n\n\t\tif ( shaderStage === 'vertex' || shaderStage === 'fragment' ) {\n\n\t\t\tconst varyings = this.varyings;\n\t\t\tconst vars = this.vars[ shaderStage ];\n\n\t\t\tfor ( let index = 0; index < varyings.length; index ++ ) {\n\n\t\t\t\tconst varying = varyings[ index ];\n\n\t\t\t\tif ( varying.needsInterpolation ) {\n\n\t\t\t\t\tsnippets.push( `@location( ${index} ) ${ varying.name } : ${ this.getType( varying.type ) }` );\n\n\t\t\t\t} else if ( vars.includes( varying ) === false ) {\n\n\t\t\t\t\tvars.push( varying );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( const { name, property, type } of this.builtins[ shaderStage ].values() ) {\n\n\t\t\tsnippets.push( `@builtin( ${name} ) ${property} : ${type}` );\n\n\t\t}\n\n\t\tconst code = snippets.join( ',\\n\\t' );\n\n\t\treturn shaderStage === 'vertex' ? this._getWGSLStruct( 'NodeVaryingsStruct', '\\t' + code ) : code;\n\n\t}\n\n\tgetUniforms( shaderStage ) {\n\n\t\tconst uniforms = this.uniforms[ shaderStage ];\n\n\t\tconst bindingSnippets = [];\n\t\tconst bufferSnippets = [];\n\t\tconst groupSnippets = [];\n\n\t\tlet index = this.bindingsOffset[ shaderStage ];\n\n\t\tfor ( const uniform of uniforms ) {\n\n\t\t\tif ( uniform.type === 'texture' || uniform.type === 'cubeTexture' ) {\n\n\t\t\t\tif ( shaderStage === 'fragment' ) {\n\n\t\t\t\t\tbindingSnippets.push( `@group( 0 ) @binding( ${index ++} ) var ${uniform.name}_sampler : sampler;` );\n\n\t\t\t\t}\n\n\t\t\t\tconst texture = uniform.node.value;\n\n\t\t\t\tlet textureType;\n\n\t\t\t\tif ( texture.isCubeTexture === true ) {\n\n\t\t\t\t\ttextureType = 'texture_cube<f32>';\n\n\t\t\t\t} else if ( texture.isDepthTexture === true ) {\n\n\t\t\t\t\ttextureType = 'texture_depth_2d';\n\n\t\t\t\t} else if ( texture.isVideoTexture === true ) {\n\n\t\t\t\t\ttextureType = 'texture_external';\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttextureType = 'texture_2d<f32>';\n\n\t\t\t\t}\n\n\t\t\t\tbindingSnippets.push( `@group( 0 ) @binding( ${index ++} ) var ${uniform.name} : ${textureType};` );\n\n\t\t\t} else if ( uniform.type === 'buffer' || uniform.type === 'storageBuffer' ) {\n\n\t\t\t\tconst bufferNode = uniform.node;\n\t\t\t\tconst bufferType = this.getType( bufferNode.bufferType );\n\t\t\t\tconst bufferCount = bufferNode.bufferCount;\n\n\t\t\t\tconst bufferCountSnippet = bufferCount > 0 ? ', ' + bufferCount : '';\n\t\t\t\tconst bufferSnippet = `\\t${uniform.name} : array< ${bufferType}${bufferCountSnippet} >\\n`;\n\t\t\t\tconst bufferAccessMode = bufferNode.isStorageBufferNode ? 'storage,read_write' : 'uniform';\n\n\t\t\t\tbufferSnippets.push( this._getWGSLStructBinding( 'NodeBuffer_' + bufferNode.id, bufferSnippet, bufferAccessMode, index ++ ) );\n\n\t\t\t} else {\n\n\t\t\t\tconst vectorType = this.getType( this.getVectorType( uniform.type ) );\n\n\t\t\t\tif ( Array.isArray( uniform.value ) === true ) {\n\n\t\t\t\t\tconst length = uniform.value.length;\n\n\t\t\t\t\tgroupSnippets.push( `uniform ${vectorType}[ ${length} ] ${uniform.name}` );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tgroupSnippets.push( `\\t${uniform.name} : ${ vectorType}` );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tlet code = bindingSnippets.join( '\\n' );\n\t\tcode += bufferSnippets.join( '\\n' );\n\n\t\tif ( groupSnippets.length > 0 ) {\n\n\t\t\tcode += this._getWGSLStructBinding( 'NodeUniforms', groupSnippets.join( ',\\n' ), 'uniform', index ++ );\n\n\t\t}\n\n\t\treturn code;\n\n\t}\n\n\tbuildCode() {\n\n\t\tconst shadersData = this.material !== null ? { fragment: {}, vertex: {} } : { compute: {} };\n\n\t\tfor ( const shaderStage in shadersData ) {\n\n\t\t\tlet flow = '// code\\n\\n';\n\t\t\tflow += this.flowCode[ shaderStage ];\n\n\t\t\tconst flowNodes = this.flowNodes[ shaderStage ];\n\t\t\tconst mainNode = flowNodes[ flowNodes.length - 1 ];\n\n\t\t\tfor ( const node of flowNodes ) {\n\n\t\t\t\tconst flowSlotData = this.getFlowData( node/*, shaderStage*/ );\n\t\t\t\tconst slotName = node.name;\n\n\t\t\t\tif ( slotName ) {\n\n\t\t\t\t\tif ( flow.length > 0 ) flow += '\\n';\n\n\t\t\t\t\tflow += `\\t// flow -> ${ slotName }\\n\\t`;\n\n\t\t\t\t}\n\n\t\t\t\tflow += `${ flowSlotData.code }\\n\\t`;\n\n\t\t\t\tif ( node === mainNode && shaderStage !== 'compute' ) {\n\n\t\t\t\t\tflow += '// result\\n\\t';\n\n\t\t\t\t\tif ( shaderStage === 'vertex' ) {\n\n\t\t\t\t\t\tflow += 'NodeVaryings.Vertex = ';\n\n\t\t\t\t\t} else if ( shaderStage === 'fragment' ) {\n\n\t\t\t\t\t\tflow += 'return ';\n\n\t\t\t\t\t}\n\n\t\t\t\t\tflow += `${ flowSlotData.result };`;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst stageData = shadersData[ shaderStage ];\n\n\t\t\tstageData.uniforms = this.getUniforms( shaderStage );\n\t\t\tstageData.attributes = this.getAttributes( shaderStage );\n\t\t\tstageData.varyings = this.getVaryings( shaderStage );\n\t\t\tstageData.vars = this.getVars( shaderStage );\n\t\t\tstageData.codes = this.getCodes( shaderStage );\n\t\t\tstageData.flow = flow;\n\n\t\t}\n\n\t\tif ( this.material !== null ) {\n\n\t\t\tthis.vertexShader = this._getWGSLVertexCode( shadersData.vertex );\n\t\t\tthis.fragmentShader = this._getWGSLFragmentCode( shadersData.fragment );\n\n\t\t} else {\n\n\t\t\tthis.computeShader = this._getWGSLComputeCode( shadersData.compute, ( this.object.workgroupSize || [ 64 ] ).join( ', ' ) );\n\n\t\t}\n\n\t}\n\n\tgetRenderTarget( width, height, options ) {\n\n\t\treturn new WebGPURenderTarget( width, height, options );\n\n\t}\n\n\tgetMethod( method ) {\n\n\t\tif ( wgslPolyfill[ method ] !== undefined ) {\n\n\t\t\tthis._include( method );\n\n\t\t}\n\n\t\treturn wgslMethods[ method ] || method;\n\n\t}\n\n\tgetType( type ) {\n\n\t\treturn wgslTypeLib[ type ] || type;\n\n\t}\n\n\tisAvailable( name ) {\n\n\t\treturn supports[ name ] === true;\n\n\t}\n\n\t_include( name ) {\n\n\t\twgslPolyfill[ name ].build( this );\n\n\t}\n\n\t_getNodeUniform( uniformNode, type ) {\n\n\t\tif ( type === 'float' ) return new FloatNodeUniform( uniformNode );\n\t\tif ( type === 'vec2' ) return new Vector2NodeUniform( uniformNode );\n\t\tif ( type === 'vec3' ) return new Vector3NodeUniform( uniformNode );\n\t\tif ( type === 'vec4' ) return new Vector4NodeUniform( uniformNode );\n\t\tif ( type === 'color' ) return new ColorNodeUniform( uniformNode );\n\t\tif ( type === 'mat3' ) return new Matrix3NodeUniform( uniformNode );\n\t\tif ( type === 'mat4' ) return new Matrix4NodeUniform( uniformNode );\n\n\t\tthrow new Error( `Uniform \"${type}\" not declared.` );\n\n\t}\n\n\t_getWGSLVertexCode( shaderData ) {\n\n\t\treturn `${ this.getSignature() }\n\n// uniforms\n${shaderData.uniforms}\n\n// varyings\n${shaderData.varyings}\n\n// codes\n${shaderData.codes}\n\n@vertex\nfn main( ${shaderData.attributes} ) -> NodeVaryingsStruct {\n\n\t// system\n\tvar NodeVaryings: NodeVaryingsStruct;\n\n\t// vars\n\t${shaderData.vars}\n\n\t// flow\n\t${shaderData.flow}\n\n\treturn NodeVaryings;\n\n}\n`;\n\n\t}\n\n\t_getWGSLFragmentCode( shaderData ) {\n\n\t\treturn `${ this.getSignature() }\n\n// uniforms\n${shaderData.uniforms}\n\n// codes\n${shaderData.codes}\n\n@fragment\nfn main( ${shaderData.varyings} ) -> @location( 0 ) vec4<f32> {\n\n\t// vars\n\t${shaderData.vars}\n\n\t// flow\n\t${shaderData.flow}\n\n}\n`;\n\n\t}\n\n\t_getWGSLComputeCode( shaderData, workgroupSize ) {\n\n\t\treturn `${ this.getSignature() }\n// system\nvar<private> instanceIndex : u32;\n\n// uniforms\n${shaderData.uniforms}\n\n// codes\n${shaderData.codes}\n\n@compute @workgroup_size( ${workgroupSize} )\nfn main( ${shaderData.attributes} ) {\n\n\t// system\n\tinstanceIndex = id.x;\n\n\t// vars\n\t${shaderData.vars}\n\n\t// flow\n\t${shaderData.flow}\n\n}\n`;\n\n\t}\n\n\t_getWGSLStruct( name, vars ) {\n\n\t\treturn `\nstruct ${name} {\n${vars}\n};`;\n\n\t}\n\n\t_getWGSLStructBinding( name, vars, access, binding = 0, group = 0 ) {\n\n\t\tconst structName = name + 'Struct';\n\t\tconst structSnippet = this._getWGSLStruct( structName, vars );\n\n\t\treturn `${structSnippet}\n@binding( ${binding} ) @group( ${group} )\nvar<${access}> ${name} : ${structName};`;\n\n\t}\n\n}\n\nexport default WebGPUNodeBuilder;\n","import WebGPUNodeBuilder from './WebGPUNodeBuilder.js';\nimport { NoToneMapping, EquirectangularReflectionMapping, EquirectangularRefractionMapping } from 'three';\nimport { NodeFrame, cubeTexture, texture, rangeFog, densityFog, reference, toneMapping, positionWorld, modelWorldMatrix, transformDirection, equirectUV, viewportBottomLeft } from '../../../nodes/Nodes.js';\n\nclass WebGPUNodes {\n\n\tconstructor( renderer, properties ) {\n\n\t\tthis.renderer = renderer;\n\t\tthis.properties = properties;\n\n\t\tthis.nodeFrame = new NodeFrame();\n\n\t}\n\n\tget( renderObject ) {\n\n\t\tconst renderObjectProperties = this.properties.get( renderObject );\n\n\t\tlet nodeBuilder = renderObjectProperties.nodeBuilder;\n\n\t\tif ( nodeBuilder === undefined ) {\n\n\t\t\tnodeBuilder = new WebGPUNodeBuilder( renderObject.object, this.renderer );\n\t\t\tnodeBuilder.material = renderObject.material;\n\t\t\tnodeBuilder.lightsNode = renderObject.lightsNode;\n\t\t\tnodeBuilder.environmentNode = this.getEnvironmentNode( renderObject.scene );\n\t\t\tnodeBuilder.fogNode = this.getFogNode( renderObject.scene );\n\t\t\tnodeBuilder.toneMappingNode = this.getToneMappingNode();\n\t\t\tnodeBuilder.build();\n\n\t\t\trenderObjectProperties.nodeBuilder = nodeBuilder;\n\n\t\t}\n\n\t\treturn nodeBuilder;\n\n\t}\n\n\tgetForCompute( computeNode ) {\n\n\t\tconst computeProperties = this.properties.get( computeNode );\n\n\t\tlet nodeBuilder = computeProperties.nodeBuilder;\n\n\t\tif ( nodeBuilder === undefined ) {\n\n\t\t\tnodeBuilder = new WebGPUNodeBuilder( computeNode, this.renderer );\n\t\t\tnodeBuilder.build();\n\n\t\t\tcomputeProperties.nodeBuilder = nodeBuilder;\n\n\t\t}\n\n\t\treturn nodeBuilder;\n\n\t}\n\n\tremove( renderObject ) {\n\n\t\tconst objectProperties = this.properties.get( renderObject );\n\n\t\tdelete objectProperties.nodeBuilder;\n\n\t}\n\n\tgetEnvironmentNode( scene ) {\n\n\t\treturn scene.environmentNode || this.properties.get( scene ).environmentNode || null;\n\n\t}\n\n\tgetFogNode( scene ) {\n\n\t\treturn scene.fogNode || this.properties.get( scene ).fogNode || null;\n\n\t}\n\n\tgetToneMappingNode() {\n\n\t\treturn this.renderer.toneMappingNode || this.properties.get( this.renderer ).toneMappingNode || null;\n\n\t}\n\n\tgetCacheKey( scene, lightsNode ) {\n\n\t\tconst environmentNode = this.getEnvironmentNode( scene );\n\t\tconst fogNode = this.getFogNode( scene );\n\t\tconst toneMappingNode = this.getToneMappingNode();\n\n\t\tconst cacheKey = [];\n\n\t\tif ( lightsNode ) cacheKey.push( 'lightsNode:' + lightsNode.getCacheKey() );\n\t\tif ( environmentNode ) cacheKey.push( 'environmentNode:' + environmentNode.getCacheKey() );\n\t\tif ( fogNode ) cacheKey.push( 'fogNode:' + fogNode.getCacheKey() );\n\t\tif ( toneMappingNode ) cacheKey.push( 'toneMappingNode:' + toneMappingNode.getCacheKey() );\n\n\t\treturn '{' + cacheKey.join( ',' ) + '}';\n\n\t}\n\n\tupdateToneMapping() {\n\n\t\tconst renderer = this.renderer;\n\t\tconst rendererProperties = this.properties.get( renderer );\n\t\tconst rendererToneMapping = renderer.toneMapping;\n\n\t\tif ( rendererToneMapping !== NoToneMapping ) {\n\n\t\t\tif ( rendererProperties.toneMapping !== rendererToneMapping ) {\n\n\t\t\t\trendererProperties.toneMappingNode = toneMapping( rendererToneMapping, reference( 'toneMappingExposure', 'float', renderer ) );\n\t\t\t\trendererProperties.toneMapping = rendererToneMapping;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tdelete rendererProperties.toneMappingNode;\n\t\t\tdelete rendererProperties.toneMapping;\n\n\t\t}\n\n\t}\n\n\tupdateBackground( scene ) {\n\n\t\tconst sceneProperties = this.properties.get( scene );\n\t\tconst background = scene.background;\n\n\t\tif ( background ) {\n\n\t\t\tif ( sceneProperties.background !== background ) {\n\n\t\t\t\tlet backgroundNode = null;\n\n\t\t\t\tif ( background.isCubeTexture === true ) {\n\n\t\t\t\t\tbackgroundNode = cubeTexture( background, transformDirection( positionWorld, modelWorldMatrix ) );\n\n\t\t\t\t} else if ( background.isTexture === true ) {\n\n\t\t\t\t\tlet nodeUV = null;\n\n\t\t\t\t\tif ( background.mapping === EquirectangularReflectionMapping || background.mapping === EquirectangularRefractionMapping ) {\n\n\t\t\t\t\t\tnodeUV = equirectUV();\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tnodeUV = viewportBottomLeft;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbackgroundNode = texture( background, nodeUV );\n\n\t\t\t\t} else if ( background.isColor !== true ) {\n\n\t\t\t\t\tconsole.error( 'WebGPUNodes: Unsupported background configuration.', background );\n\n\t\t\t\t}\n\n\t\t\t\tsceneProperties.backgroundNode = backgroundNode;\n\t\t\t\tsceneProperties.background = background;\n\n\t\t\t}\n\n\t\t} else if ( sceneProperties.backgroundNode ) {\n\n\t\t\tdelete sceneProperties.backgroundNode;\n\t\t\tdelete sceneProperties.background;\n\n\t\t}\n\n\t}\n\n\tupdateFog( scene ) {\n\n\t\tconst sceneProperties = this.properties.get( scene );\n\t\tconst fog = scene.fog;\n\n\t\tif ( fog ) {\n\n\t\t\tif ( sceneProperties.fog !== fog ) {\n\n\t\t\t\tlet fogNode = null;\n\n\t\t\t\tif ( fog.isFogExp2 ) {\n\n\t\t\t\t\tfogNode = densityFog( reference( 'color', 'color', fog ), reference( 'density', 'float', fog ) );\n\n\t\t\t\t} else if ( fog.isFog ) {\n\n\t\t\t\t\tfogNode = rangeFog( reference( 'color', 'color', fog ), reference( 'near', 'float', fog ), reference( 'far', 'float', fog ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'WebGPUNodes: Unsupported fog configuration.', fog );\n\n\t\t\t\t}\n\n\t\t\t\tsceneProperties.fogNode = fogNode;\n\t\t\t\tsceneProperties.fog = fog;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tdelete sceneProperties.fogNode;\n\t\t\tdelete sceneProperties.fog;\n\n\t\t}\n\n\t}\n\n\tupdateEnvironment( scene ) {\n\n\t\tconst sceneProperties = this.properties.get( scene );\n\t\tconst environment = scene.environment;\n\n\t\tif ( environment ) {\n\n\t\t\tif ( sceneProperties.environment !== environment ) {\n\n\t\t\t\tlet environmentNode = null;\n\n\t\t\t\tif ( environment.isCubeTexture === true ) {\n\n\t\t\t\t\tenvironmentNode = cubeTexture( environment );\n\n\t\t\t\t} else if ( environment.isTexture === true ) {\n\n\t\t\t\t\tenvironmentNode = texture( environment );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'WebGPUNodes: Unsupported environment configuration.', environment );\n\n\t\t\t\t}\n\n\t\t\t\tsceneProperties.environmentNode = environmentNode;\n\t\t\t\tsceneProperties.environment = environment;\n\n\t\t\t}\n\n\t\t} else if ( sceneProperties.environmentNode ) {\n\n\t\t\tdelete sceneProperties.environmentNode;\n\t\t\tdelete sceneProperties.environment;\n\n\t\t}\n\n\t}\n\n\tgetNodeFrame( renderObject ) {\n\n\t\tconst nodeFrame = this.nodeFrame;\n\t\tnodeFrame.scene = renderObject.scene;\n\t\tnodeFrame.object = renderObject.object;\n\t\tnodeFrame.camera = renderObject.camera;\n\t\tnodeFrame.renderer = renderObject.renderer;\n\t\tnodeFrame.material = renderObject.material;\n\n\t\treturn nodeFrame;\n\n\t}\n\n\tupdateBefore( renderObject ) {\n\n\t\tconst nodeFrame = this.getNodeFrame( renderObject );\n\t\tconst nodeBuilder = this.get( renderObject );\n\n\t\tfor ( const node of nodeBuilder.updateBeforeNodes ) {\n\n\t\t\tnodeFrame.updateBeforeNode( node );\n\n\t\t}\n\n\t}\n\n\tupdate( renderObject ) {\n\n\t\tconst nodeFrame = this.getNodeFrame( renderObject );\n\t\tconst nodeBuilder = this.get( renderObject );\n\n\t\tfor ( const node of nodeBuilder.updateNodes ) {\n\n\t\t\tnodeFrame.updateNode( node );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.nodeFrame = new NodeFrame();\n\n\t}\n\n}\n\nexport default WebGPUNodes;\n","import { GPUPrimitiveTopology, GPUTextureFormat } from './constants.js';\n\nclass WebGPUUtils {\n\n\tconstructor( renderer ) {\n\n\t\tthis.renderer = renderer;\n\n\t}\n\n\tgetCurrentColorSpace() {\n\n\t\tconst renderer = this.renderer;\n\n\t\tconst renderTarget = renderer.getRenderTarget();\n\n\t\tif ( renderTarget !== null ) {\n\n\t\t\treturn renderTarget.texture.colorSpace;\n\n\t\t}\n\n\t\treturn renderer.outputColorSpace;\n\n\t}\n\n\tgetCurrentColorFormat() {\n\n\t\tlet format;\n\n\t\tconst renderer = this.renderer;\n\t\tconst renderTarget = renderer.getRenderTarget();\n\n\t\tif ( renderTarget !== null ) {\n\n\t\t\tconst renderTargetProperties = renderer._properties.get( renderTarget );\n\t\t\tformat = renderTargetProperties.colorTextureFormat;\n\n\t\t} else {\n\n\t\t\tformat = GPUTextureFormat.BGRA8Unorm; // default context format\n\n\t\t}\n\n\t\treturn format;\n\n\t}\n\n\tgetCurrentDepthStencilFormat() {\n\n\t\tlet format;\n\n\t\tconst renderer = this.renderer;\n\t\tconst renderTarget = renderer.getRenderTarget();\n\n\t\tif ( renderTarget !== null ) {\n\n\t\t\tconst renderTargetProperties = renderer._properties.get( renderTarget );\n\t\t\tformat = renderTargetProperties.depthTextureFormat;\n\n\t\t} else {\n\n\t\t\tformat = GPUTextureFormat.Depth24PlusStencil8;\n\n\t\t}\n\n\t\treturn format;\n\n\t}\n\n\tgetPrimitiveTopology( object, material ) {\n\n\t\tif ( object.isPoints ) return GPUPrimitiveTopology.PointList;\n\t\telse if ( object.isLineSegments || ( object.isMesh && material.wireframe === true ) ) return GPUPrimitiveTopology.LineList;\n\t\telse if ( object.isLine ) return GPUPrimitiveTopology.LineStrip;\n\t\telse if ( object.isMesh ) return GPUPrimitiveTopology.TriangleList;\n\n\t}\n\n\tgetSampleCount() {\n\n\t\treturn this.renderer._parameters.sampleCount;\n\n\t}\n\n}\n\nexport default WebGPUUtils;\n","import { GPUIndexFormat, GPUTextureFormat, GPUFeatureName, GPULoadOp } from './constants.js';\nimport WebGPUAnimation from './WebGPUAnimation.js';\nimport WebGPURenderObjects from './WebGPURenderObjects.js';\nimport WebGPUAttributes from './WebGPUAttributes.js';\nimport WebGPUGeometries from './WebGPUGeometries.js';\nimport WebGPUInfo from './WebGPUInfo.js';\nimport WebGPUProperties from './WebGPUProperties.js';\nimport WebGPURenderPipelines from './WebGPURenderPipelines.js';\nimport WebGPUComputePipelines from './WebGPUComputePipelines.js';\nimport WebGPUBindings from './WebGPUBindings.js';\nimport WebGPURenderLists from './WebGPURenderLists.js';\nimport WebGPURenderStates from './WebGPURenderStates.js';\nimport WebGPUTextures from './WebGPUTextures.js';\nimport WebGPUBackground from './WebGPUBackground.js';\nimport WebGPUNodes from './nodes/WebGPUNodes.js';\nimport WebGPUUtils from './WebGPUUtils.js';\nimport { Frustum, Matrix4, Vector3, Color, SRGBColorSpace, NoToneMapping, DepthFormat } from 'three';\n\nconsole.info( 'THREE.WebGPURenderer: Modified Matrix4.makePerspective() and Matrix4.makeOrtographic() to work with WebGPU, see https://github.com/mrdoob/three.js/issues/20276.' );\n\nMatrix4.prototype.makePerspective = function ( left, right, top, bottom, near, far ) {\n\n\tconst te = this.elements;\n\tconst x = 2 * near / ( right - left );\n\tconst y = 2 * near / ( top - bottom );\n\n\tconst a = ( right + left ) / ( right - left );\n\tconst b = ( top + bottom ) / ( top - bottom );\n\tconst c = - far / ( far - near );\n\tconst d = - far * near / ( far - near );\n\n\tte[ 0 ] = x;\tte[ 4 ] = 0;\tte[ 8 ] = a;\tte[ 12 ] = 0;\n\tte[ 1 ] = 0;\tte[ 5 ] = y;\tte[ 9 ] = b;\tte[ 13 ] = 0;\n\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = c;\tte[ 14 ] = d;\n\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = - 1;\tte[ 15 ] = 0;\n\n\treturn this;\n\n};\n\nMatrix4.prototype.makeOrthographic = function ( left, right, top, bottom, near, far ) {\n\n\tconst te = this.elements;\n\tconst w = 1.0 / ( right - left );\n\tconst h = 1.0 / ( top - bottom );\n\tconst p = 1.0 / ( far - near );\n\n\tconst x = ( right + left ) * w;\n\tconst y = ( top + bottom ) * h;\n\tconst z = near * p;\n\n\tte[ 0 ] = 2 * w;\tte[ 4 ] = 0;\t\tte[ 8 ] = 0;\t\tte[ 12 ] = - x;\n\tte[ 1 ] = 0;\t\tte[ 5 ] = 2 * h;\tte[ 9 ] = 0;\t\tte[ 13 ] = - y;\n\tte[ 2 ] = 0;\t\tte[ 6 ] = 0;\t\tte[ 10 ] = - 1 * p;\tte[ 14 ] = - z;\n\tte[ 3 ] = 0;\t\tte[ 7 ] = 0;\t\tte[ 11 ] = 0;\t\tte[ 15 ] = 1;\n\n\treturn this;\n\n};\n\nFrustum.prototype.setFromProjectionMatrix = function ( m ) {\n\n\tconst planes = this.planes;\n\tconst me = m.elements;\n\tconst me0 = me[ 0 ], me1 = me[ 1 ], me2 = me[ 2 ], me3 = me[ 3 ];\n\tconst me4 = me[ 4 ], me5 = me[ 5 ], me6 = me[ 6 ], me7 = me[ 7 ];\n\tconst me8 = me[ 8 ], me9 = me[ 9 ], me10 = me[ 10 ], me11 = me[ 11 ];\n\tconst me12 = me[ 12 ], me13 = me[ 13 ], me14 = me[ 14 ], me15 = me[ 15 ];\n\n\tplanes[ 0 ].setComponents( me3 - me0, me7 - me4, me11 - me8, me15 - me12 ).normalize();\n\tplanes[ 1 ].setComponents( me3 + me0, me7 + me4, me11 + me8, me15 + me12 ).normalize();\n\tplanes[ 2 ].setComponents( me3 + me1, me7 + me5, me11 + me9, me15 + me13 ).normalize();\n\tplanes[ 3 ].setComponents( me3 - me1, me7 - me5, me11 - me9, me15 - me13 ).normalize();\n\tplanes[ 4 ].setComponents( me3 - me2, me7 - me6, me11 - me10, me15 - me14 ).normalize();\n\tplanes[ 5 ].setComponents( me2, me6, me10, me14 ).normalize();\n\n\treturn this;\n\n};\n\nconst _frustum = new Frustum();\nconst _projScreenMatrix = new Matrix4();\nconst _vector3 = new Vector3();\n\nclass WebGPURenderer {\n\n\tconstructor( parameters = {} ) {\n\n\t\tthis.isWebGPURenderer = true;\n\n\t\t// public\n\n\t\tthis.domElement = ( parameters.canvas !== undefined ) ? parameters.canvas : this._createCanvasElement();\n\n\t\tthis.autoClear = true;\n\t\tthis.autoClearColor = true;\n\t\tthis.autoClearDepth = true;\n\t\tthis.autoClearStencil = true;\n\n\t\tthis.outputColorSpace = SRGBColorSpace;\n\n\t\tthis.toneMapping = NoToneMapping;\n\t\tthis.toneMappingExposure = 1.0;\n\n\t\tthis.sortObjects = true;\n\n\t\t// internals\n\n\t\tthis._parameters = Object.assign( {}, parameters );\n\n\t\tthis._pixelRatio = 1;\n\t\tthis._width = this.domElement.width;\n\t\tthis._height = this.domElement.height;\n\n\t\tthis._viewport = null;\n\t\tthis._scissor = null;\n\n\t\tthis._adapter = null;\n\t\tthis._device = null;\n\t\tthis._context = null;\n\t\tthis._colorBuffer = null;\n\t\tthis._depthBuffer = null;\n\n\t\tthis._info = null;\n\t\tthis._properties = null;\n\t\tthis._attributes = null;\n\t\tthis._geometries = null;\n\t\tthis._nodes = null;\n\t\tthis._bindings = null;\n\t\tthis._objects = null;\n\t\tthis._renderPipelines = null;\n\t\tthis._computePipelines = null;\n\t\tthis._renderLists = null;\n\t\tthis._renderStates = null;\n\t\tthis._textures = null;\n\t\tthis._background = null;\n\n\t\tthis._animation = new WebGPUAnimation();\n\n\t\tthis._currentRenderState = null;\n\n\t\tthis._opaqueSort = null;\n\t\tthis._transparentSort = null;\n\n\t\tthis._clearAlpha = 1;\n\t\tthis._clearColor = new Color( 0x000000 );\n\t\tthis._clearDepth = 1;\n\t\tthis._clearStencil = 0;\n\n\t\tthis._renderTarget = null;\n\n\t\tthis._initialized = false;\n\n\t\t// some parameters require default values other than \"undefined\"\n\n\t\tthis._parameters.antialias = ( parameters.antialias === true );\n\n\t\tif ( this._parameters.antialias === true ) {\n\n\t\t\tthis._parameters.sampleCount = ( parameters.sampleCount === undefined ) ? 4 : parameters.sampleCount;\n\n\t\t} else {\n\n\t\t\tthis._parameters.sampleCount = 1;\n\n\t\t}\n\n\t\tthis._parameters.requiredLimits = ( parameters.requiredLimits === undefined ) ? {} : parameters.requiredLimits;\n\n\t\t// backwards compatibility\n\n\t\tthis.shadow = {\n\t\t\tshadowMap: {}\n\t\t};\n\n\t}\n\n\tasync init() {\n\n\t\tif ( this._initialized === true ) {\n\n\t\t\tthrow new Error( 'WebGPURenderer: Device has already been initialized.' );\n\n\t\t}\n\n\t\tconst parameters = this._parameters;\n\n\t\tconst adapterOptions = {\n\t\t\tpowerPreference: parameters.powerPreference\n\t\t};\n\n\t\tconst adapter = await navigator.gpu.requestAdapter( adapterOptions );\n\n\t\tif ( adapter === null ) {\n\n\t\t\tthrow new Error( 'WebGPURenderer: Unable to create WebGPU adapter.' );\n\n\t\t}\n\n\t\t// feature support\n\n\t\tconst features = Object.values( GPUFeatureName );\n\n\t\tconst supportedFeatures = [];\n\n\t\tfor ( const name of features ) {\n\n\t\t\tif ( adapter.features.has( name ) ) {\n\n\t\t\t\tsupportedFeatures.push( name );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst deviceDescriptor = {\n\t\t\trequiredFeatures: supportedFeatures,\n\t\t\trequiredLimits: parameters.requiredLimits\n\t\t};\n\n\t\tconst device = await adapter.requestDevice( deviceDescriptor );\n\n\t\tconst context = ( parameters.context !== undefined ) ? parameters.context : this.domElement.getContext( 'webgpu' );\n\n\t\tthis._adapter = adapter;\n\t\tthis._device = device;\n\t\tthis._context = context;\n\n\t\tthis._configureContext();\n\n\t\tthis._info = new WebGPUInfo();\n\t\tthis._properties = new WebGPUProperties();\n\t\tthis._attributes = new WebGPUAttributes( device );\n\t\tthis._geometries = new WebGPUGeometries( this._attributes, this._properties, this._info );\n\t\tthis._textures = new WebGPUTextures( device, this._properties, this._info );\n\t\tthis._utils = new WebGPUUtils( this );\n\t\tthis._nodes = new WebGPUNodes( this, this._properties );\n\t\tthis._objects = new WebGPURenderObjects( this, this._nodes, this._geometries, this._info );\n\t\tthis._computePipelines = new WebGPUComputePipelines( device, this._nodes );\n\t\tthis._renderPipelines = new WebGPURenderPipelines( device, this._nodes, this._utils );\n\t\tthis._bindings = this._renderPipelines.bindings = new WebGPUBindings( device, this._info, this._properties, this._textures, this._renderPipelines, this._computePipelines, this._attributes, this._nodes );\n\t\tthis._renderLists = new WebGPURenderLists();\n\t\tthis._renderStates = new WebGPURenderStates();\n\t\tthis._background = new WebGPUBackground( this, this._properties );\n\n\t\t//\n\n\t\tthis._setupColorBuffer();\n\t\tthis._setupDepthBuffer();\n\n\t\tthis._animation.setNodes( this._nodes );\n\t\tthis._animation.start();\n\n\t\tthis._initialized = true;\n\n\t}\n\n\tasync render( scene, camera ) {\n\n\t\tif ( this._initialized === false ) await this.init();\n\n\t\t// preserve render tree\n\n\t\tconst nodeFrame = this._nodes.nodeFrame;\n\n\t\tconst previousRenderId = nodeFrame.renderId;\n\t\tconst previousRenderState = this._currentRenderState;\n\n\t\t//\n\n\t\tconst renderState = this._renderStates.get( scene, camera );\n\t\tconst renderTarget = this._renderTarget;\n\n\t\tthis._currentRenderState = renderState;\n\n\t\tnodeFrame.renderId ++;\n\n\t\t//\n\n\t\tif ( this._animation.isAnimating === false ) nodeFrame.update();\n\n\t\tif ( scene.matrixWorldAutoUpdate === true ) scene.updateMatrixWorld();\n\n\t\tif ( camera.parent === null && camera.matrixWorldAutoUpdate === true ) camera.updateMatrixWorld();\n\n\t\tif ( this._info.autoReset === true ) this._info.reset();\n\n\t\t_projScreenMatrix.multiplyMatrices( camera.projectionMatrix, camera.matrixWorldInverse );\n\t\t_frustum.setFromProjectionMatrix( _projScreenMatrix );\n\n\t\tconst renderList = this._renderLists.get( scene, camera );\n\t\trenderList.init();\n\n\t\tthis._projectObject( scene, camera, 0, renderList );\n\n\t\trenderList.finish();\n\n\t\tif ( this.sortObjects === true ) {\n\n\t\t\trenderList.sort( this._opaqueSort, this._transparentSort );\n\n\t\t}\n\n\t\t// prepare render pass descriptor\n\n\t\trenderState.descriptorGPU = {\n\t\t\tcolorAttachments: [ {\n\t\t\t\tview: null\n\t\t\t} ],\n\t\t\tdepthStencilAttachment: {\n\t\t\t\tview: null\n\t\t\t}\n\t\t};\n\n\t\tconst colorAttachment = renderState.descriptorGPU.colorAttachments[ 0 ];\n\t\tconst depthStencilAttachment = renderState.descriptorGPU.depthStencilAttachment;\n\n\t\tif ( renderTarget !== null ) {\n\n\t\t\tthis._textures.initRenderTarget( renderTarget );\n\n\t\t\t// @TODO: Support RenderTarget with antialiasing.\n\n\t\t\tconst renderTargetProperties = this._properties.get( renderTarget );\n\n\t\t\tcolorAttachment.view = renderTargetProperties.colorTextureGPU.createView();\n\t\t\tdepthStencilAttachment.view = renderTargetProperties.depthTextureGPU.createView();\n\n\t\t\trenderState.stencil = renderTarget.depthTexture ? renderTarget.depthTexture.format !== DepthFormat : true;\n\n\t\t} else {\n\n\t\t\tif ( this._parameters.antialias === true ) {\n\n\t\t\t\tcolorAttachment.view = this._colorBuffer.createView();\n\t\t\t\tcolorAttachment.resolveTarget = this._context.getCurrentTexture().createView();\n\n\t\t\t} else {\n\n\t\t\t\tcolorAttachment.view = this._context.getCurrentTexture().createView();\n\t\t\t\tcolorAttachment.resolveTarget = undefined;\n\n\t\t\t}\n\n\t\t\tdepthStencilAttachment.view = this._depthBuffer.createView();\n\n\t\t}\n\n\t\t//\n\n\t\tthis._nodes.updateEnvironment( scene );\n\t\tthis._nodes.updateFog( scene );\n\t\tthis._nodes.updateBackground( scene );\n\t\tthis._nodes.updateToneMapping();\n\n\t\t//\n\n\t\tthis._background.update( scene, renderList, renderState );\n\n\t\t// start render pass\n\n\t\tconst device = this._device;\n\n\t\trenderState.encoderGPU = device.createCommandEncoder( {} );\n\t\trenderState.currentPassGPU = renderState.encoderGPU.beginRenderPass( renderState.descriptorGPU );\n\n\t\t// global rasterization settings for all renderable objects\n\n\t\tconst vp = this._viewport;\n\n\t\tif ( vp !== null ) {\n\n\t\t\tconst width = Math.floor( vp.width * this._pixelRatio );\n\t\t\tconst height = Math.floor( vp.height * this._pixelRatio );\n\n\t\t\trenderState.currentPassGPU.setViewport( vp.x, vp.y, width, height, vp.minDepth, vp.maxDepth );\n\n\t\t}\n\n\t\tconst sc = this._scissor;\n\n\t\tif ( sc !== null ) {\n\n\t\t\tconst width = Math.floor( sc.width * this._pixelRatio );\n\t\t\tconst height = Math.floor( sc.height * this._pixelRatio );\n\n\t\t\trenderState.currentPassGPU.setScissorRect( sc.x, sc.y, width, height );\n\n\t\t}\n\n\t\t// process render lists\n\n\t\tconst opaqueObjects = renderList.opaque;\n\t\tconst transparentObjects = renderList.transparent;\n\t\tconst lightsNode = renderList.lightsNode;\n\n\t\tif ( opaqueObjects.length > 0 ) this._renderObjects( opaqueObjects, camera, scene, lightsNode, renderState );\n\t\tif ( transparentObjects.length > 0 ) this._renderObjects( transparentObjects, camera, scene, lightsNode, renderState );\n\n\t\t// finish render pass\n\n\t\trenderState.currentPassGPU.end();\n\n\t\tdevice.queue.submit( [ renderState.encoderGPU.finish() ] );\n\n\t\t// restore render tree\n\n\t\tnodeFrame.renderId = previousRenderId;\n\t\tthis._currentRenderState = previousRenderState;\n\n\t}\n\n\tsetAnimationLoop( callback ) {\n\n\t\tif ( this._initialized === false ) this.init();\n\n\t\tconst animation = this._animation;\n\n\t\tanimation.setAnimationLoop( callback );\n\n\t\t( callback === null ) ? animation.stop() : animation.start();\n\n\t}\n\n\tasync getArrayBuffer( attribute ) {\n\n\t\treturn await this._attributes.getArrayBuffer( attribute );\n\n\t}\n\n\tgetContext() {\n\n\t\treturn this._context;\n\n\t}\n\n\tgetPixelRatio() {\n\n\t\treturn this._pixelRatio;\n\n\t}\n\n\tgetDrawingBufferSize( target ) {\n\n\t\treturn target.set( this._width * this._pixelRatio, this._height * this._pixelRatio ).floor();\n\n\t}\n\n\tgetSize( target ) {\n\n\t\treturn target.set( this._width, this._height );\n\n\t}\n\n\tsetPixelRatio( value = 1 ) {\n\n\t\tthis._pixelRatio = value;\n\n\t\tthis.setSize( this._width, this._height, false );\n\n\t}\n\n\tsetDrawingBufferSize( width, height, pixelRatio ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tthis._pixelRatio = pixelRatio;\n\n\t\tthis.domElement.width = Math.floor( width * pixelRatio );\n\t\tthis.domElement.height = Math.floor( height * pixelRatio );\n\n\t\tthis._configureContext();\n\t\tthis._setupColorBuffer();\n\t\tthis._setupDepthBuffer();\n\n\t}\n\n\tsetSize( width, height, updateStyle = true ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tthis.domElement.width = Math.floor( width * this._pixelRatio );\n\t\tthis.domElement.height = Math.floor( height * this._pixelRatio );\n\n\t\tif ( updateStyle === true ) {\n\n\t\t\tthis.domElement.style.width = width + 'px';\n\t\t\tthis.domElement.style.height = height + 'px';\n\n\t\t}\n\n\t\tthis._configureContext();\n\t\tthis._setupColorBuffer();\n\t\tthis._setupDepthBuffer();\n\n\t}\n\n\tsetOpaqueSort( method ) {\n\n\t\tthis._opaqueSort = method;\n\n\t}\n\n\tsetTransparentSort( method ) {\n\n\t\tthis._transparentSort = method;\n\n\t}\n\n\tgetScissor( target ) {\n\n\t\tconst scissor = this._scissor;\n\n\t\ttarget.x = scissor.x;\n\t\ttarget.y = scissor.y;\n\t\ttarget.width = scissor.width;\n\t\ttarget.height = scissor.height;\n\n\t\treturn target;\n\n\t}\n\n\tsetScissor( x, y, width, height ) {\n\n\t\tif ( x === null ) {\n\n\t\t\tthis._scissor = null;\n\n\t\t} else {\n\n\t\t\tthis._scissor = {\n\t\t\t\tx: x,\n\t\t\t\ty: y,\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t};\n\n\t\t}\n\n\t}\n\n\tcopyFramebufferToRenderTarget( renderTarget ) {\n\n\t\tconst renderState = this._currentRenderState;\n\t\tconst { encoderGPU, descriptorGPU } = renderState;\n\n\t\tconst texture = renderTarget.texture;\n\t\ttexture.internalFormat = GPUTextureFormat.BGRA8Unorm;\n\n\t\tthis._textures.initRenderTarget( renderTarget );\n\n\t\tconst sourceGPU = this._context.getCurrentTexture();\n\t\tconst destinationGPU = this._textures.getTextureGPU( texture );\n\n\t\trenderState.currentPassGPU.end();\n\n\t\tencoderGPU.copyTextureToTexture(\n\t\t\t{\n\t\t\t  texture: sourceGPU\n\t\t\t},\n\t\t\t{\n\t\t\t  texture: destinationGPU\n\t\t\t},\n\t\t\t[\n\t\t\t\ttexture.image.width,\n\t\t\t\ttexture.image.height\n\t\t\t]\n\t\t);\n\n\t\tdescriptorGPU.colorAttachments[ 0 ].loadOp = GPULoadOp.Load;\n\t\tif ( renderState.depth ) descriptorGPU.depthStencilAttachment.depthLoadOp = GPULoadOp.Load;\n\t\tif ( renderState.stencil ) descriptorGPU.depthStencilAttachment.stencilLoadOp = GPULoadOp.Load;\n\n\t\trenderState.currentPassGPU = encoderGPU.beginRenderPass( descriptorGPU );\n\n\t}\n\n\tgetViewport( target ) {\n\n\t\tconst viewport = this._viewport;\n\n\t\ttarget.x = viewport.x;\n\t\ttarget.y = viewport.y;\n\t\ttarget.width = viewport.width;\n\t\ttarget.height = viewport.height;\n\t\ttarget.minDepth = viewport.minDepth;\n\t\ttarget.maxDepth = viewport.maxDepth;\n\n\t\treturn target;\n\n\t}\n\n\tsetViewport( x, y, width, height, minDepth = 0, maxDepth = 1 ) {\n\n\t\tif ( x === null ) {\n\n\t\t\tthis._viewport = null;\n\n\t\t} else {\n\n\t\t\tthis._viewport = {\n\t\t\t\tx: x,\n\t\t\t\ty: y,\n\t\t\t\twidth: width,\n\t\t\t\theight: height,\n\t\t\t\tminDepth: minDepth,\n\t\t\t\tmaxDepth: maxDepth\n\t\t\t};\n\n\t\t}\n\n\t}\n\n\tgetClearColor( target ) {\n\n\t\treturn target.copy( this._clearColor );\n\n\t}\n\n\tsetClearColor( color, alpha = 1 ) {\n\n\t\tthis._clearColor.set( color );\n\t\tthis._clearAlpha = alpha;\n\n\t}\n\n\tgetClearAlpha() {\n\n\t\treturn this._clearAlpha;\n\n\t}\n\n\tsetClearAlpha( alpha ) {\n\n\t\tthis._clearAlpha = alpha;\n\n\t}\n\n\tgetClearDepth() {\n\n\t\treturn this._clearDepth;\n\n\t}\n\n\tsetClearDepth( depth ) {\n\n\t\tthis._clearDepth = depth;\n\n\t}\n\n\tgetClearStencil() {\n\n\t\treturn this._clearStencil;\n\n\t}\n\n\tsetClearStencil( stencil ) {\n\n\t\tthis._clearStencil = stencil;\n\n\t}\n\n\tclear() {\n\n\t\tif ( this._background ) this._background.clear();\n\n\t}\n\n\tdispose() {\n\n\t\tthis._objects.dispose();\n\t\tthis._properties.dispose();\n\t\tthis._renderPipelines.dispose();\n\t\tthis._computePipelines.dispose();\n\t\tthis._nodes.dispose();\n\t\tthis._bindings.dispose();\n\t\tthis._info.dispose();\n\t\tthis._renderLists.dispose();\n\t\tthis._renderStates.dispose();\n\t\tthis._textures.dispose();\n\n\t\tthis.setRenderTarget( null );\n\t\tthis.setAnimationLoop( null );\n\n\t}\n\n\tsetRenderTarget( renderTarget ) {\n\n\t\tthis._renderTarget = renderTarget;\n\n\t}\n\n\tasync compute( ...computeNodes ) {\n\n\t\tif ( this._initialized === false ) await this.init();\n\n\t\tconst device = this._device;\n\t\tconst computePipelines = this._computePipelines;\n\n\t\tconst cmdEncoder = device.createCommandEncoder( {} );\n\t\tconst passEncoder = cmdEncoder.beginComputePass();\n\n\t\tfor ( const computeNode of computeNodes ) {\n\n\t\t\t// onInit\n\n\t\t\tif ( computePipelines.has( computeNode ) === false ) {\n\n\t\t\t\tcomputeNode.onInit( { renderer: this } );\n\n\t\t\t}\n\n\t\t\t// pipeline\n\n\t\t\tconst pipeline = computePipelines.get( computeNode );\n\t\t\tpassEncoder.setPipeline( pipeline );\n\n\t\t\t// node\n\n\t\t\t//this._nodes.update( computeNode );\n\n\t\t\t// bind group\n\n\t\t\tconst bindGroup = this._bindings.getForCompute( computeNode ).group;\n\t\t\tthis._bindings.update( computeNode );\n\t\t\tpassEncoder.setBindGroup( 0, bindGroup );\n\n\t\t\tpassEncoder.dispatchWorkgroups( computeNode.dispatchCount );\n\n\t\t}\n\n\t\tpassEncoder.end();\n\t\tdevice.queue.submit( [ cmdEncoder.finish() ] );\n\n\t}\n\n\tgetRenderTarget() {\n\n\t\treturn this._renderTarget;\n\n\t}\n\n\thasFeature( name ) {\n\n\t\tif ( this._initialized === false ) {\n\n\t\t\tthrow new Error( 'THREE.WebGPURenderer: Renderer must be initialized before testing features.' );\n\n\t\t}\n\n\t\t//\n\n\t\tconst features = Object.values( GPUFeatureName );\n\n\t\tif ( features.includes( name ) === false ) {\n\n\t\t\tthrow new Error( 'THREE.WebGPURenderer: Unknown WebGPU GPU feature: ' + name );\n\n\t\t}\n\n\t\t//\n\n\t\treturn this._adapter.features.has( name );\n\n\t}\n\n\t_projectObject( object, camera, groupOrder, renderList ) {\n\n\t\tif ( object.visible === false ) return;\n\n\t\tconst visible = object.layers.test( camera.layers );\n\n\t\tif ( visible ) {\n\n\t\t\tif ( object.isGroup ) {\n\n\t\t\t\tgroupOrder = object.renderOrder;\n\n\t\t\t} else if ( object.isLOD ) {\n\n\t\t\t\tif ( object.autoUpdate === true ) object.update( camera );\n\n\t\t\t} else if ( object.isLight ) {\n\n\t\t\t\trenderList.pushLight( object );\n\n\t\t\t} else if ( object.isSprite ) {\n\n\t\t\t\tif ( ! object.frustumCulled || _frustum.intersectsSprite( object ) ) {\n\n\t\t\t\t\tif ( this.sortObjects === true ) {\n\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld ).applyMatrix4( _projScreenMatrix );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst geometry = object.geometry;\n\t\t\t\t\tconst material = object.material;\n\n\t\t\t\t\tif ( material.visible ) {\n\n\t\t\t\t\t\trenderList.push( object, geometry, material, groupOrder, _vector3.z, null );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( object.isLineLoop ) {\n\n\t\t\t\tconsole.error( 'THREE.WebGPURenderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.' );\n\n\t\t\t} else if ( object.isMesh || object.isLine || object.isPoints ) {\n\n\t\t\t\tif ( ! object.frustumCulled || _frustum.intersectsObject( object ) ) {\n\n\t\t\t\t\tconst geometry = object.geometry;\n\t\t\t\t\tconst material = object.material;\n\n\t\t\t\t\tif ( this.sortObjects === true ) {\n\n\t\t\t\t\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\n\n\t\t\t\t\t\t_vector3\n\t\t\t\t\t\t\t.copy( geometry.boundingSphere.center )\n\t\t\t\t\t\t\t.applyMatrix4( object.matrixWorld )\n\t\t\t\t\t\t\t.applyMatrix4( _projScreenMatrix );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( Array.isArray( material ) ) {\n\n\t\t\t\t\t\tconst groups = geometry.groups;\n\n\t\t\t\t\t\tfor ( let i = 0, l = groups.length; i < l; i ++ ) {\n\n\t\t\t\t\t\t\tconst group = groups[ i ];\n\t\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\n\n\t\t\t\t\t\t\tif ( groupMaterial && groupMaterial.visible ) {\n\n\t\t\t\t\t\t\t\trenderList.push( object, geometry, groupMaterial, groupOrder, _vector3.z, group );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( material.visible ) {\n\n\t\t\t\t\t\trenderList.push( object, geometry, material, groupOrder, _vector3.z, null );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst children = object.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\tthis._projectObject( children[ i ], camera, groupOrder, renderList );\n\n\t\t}\n\n\t}\n\n\t_renderObjects( renderList, camera, scene, lightsNode ) {\n\n\t\t// process renderable objects\n\n\t\tfor ( let i = 0, il = renderList.length; i < il; i ++ ) {\n\n\t\t\tconst renderItem = renderList[ i ];\n\n\t\t\t// @TODO: Add support for multiple materials per object. This will require to extract\n\t\t\t// the material from the renderItem object and pass it with its group data to _renderObject().\n\n\t\t\tconst { object, geometry, material, group } = renderItem;\n\n\t\t\tif ( camera.isArrayCamera ) {\n\n\t\t\t\tconst cameras = camera.cameras;\n\n\t\t\t\tfor ( let j = 0, jl = cameras.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst camera2 = cameras[ j ];\n\n\t\t\t\t\tif ( object.layers.test( camera2.layers ) ) {\n\n\t\t\t\t\t\tconst vp = camera2.viewport;\n\t\t\t\t\t\tconst minDepth = ( vp.minDepth === undefined ) ? 0 : vp.minDepth;\n\t\t\t\t\t\tconst maxDepth = ( vp.maxDepth === undefined ) ? 1 : vp.maxDepth;\n\n\t\t\t\t\t\tthis._currentRenderState.currentPassGPU.setViewport( vp.x, vp.y, vp.width, vp.height, minDepth, maxDepth );\n\n\t\t\t\t\t\tthis._renderObject( object, scene, camera2, geometry, material, group, lightsNode );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tthis._renderObject( object, scene, camera, geometry, material, group, lightsNode );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_renderObject( object, scene, camera, geometry, material, group, lightsNode ) {\n\n\t\tmaterial = scene.overrideMaterial !== null ? scene.overrideMaterial : material;\n\n\t\t//\n\n\t\tobject.onBeforeRender( this, scene, camera, geometry, material, group );\n\n\t\t//\n\n\t\tconst renderObject = this._getRenderObject( object, material, scene, camera, lightsNode );\n\n\t\t//\n\n\t\tthis._nodes.updateBefore( renderObject );\n\n\t\t//\n\n\t\tconst passEncoder = this._currentRenderState.currentPassGPU;\n\t\tconst info = this._info;\n\n\t\t//\n\n\t\tobject.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );\n\t\tobject.normalMatrix.getNormalMatrix( object.modelViewMatrix );\n\n\t\t// updates\n\n\t\tthis._nodes.update( renderObject );\n\t\tthis._geometries.update( renderObject );\n\t\tthis._bindings.update( renderObject );\n\n\t\t// pipeline\n\n\t\tconst renderPipeline = this._renderPipelines.get( renderObject );\n\t\tpassEncoder.setPipeline( renderPipeline.pipeline );\n\n\t\t// bind group\n\n\t\tconst bindGroup = this._bindings.get( renderObject ).group;\n\t\tpassEncoder.setBindGroup( 0, bindGroup );\n\n\t\t// index\n\n\t\tconst index = this._geometries.getIndex( renderObject );\n\n\t\tconst hasIndex = ( index !== null );\n\n\t\tif ( hasIndex === true ) {\n\n\t\t\tthis._setupIndexBuffer( index, passEncoder );\n\n\t\t}\n\n\t\t// vertex buffers\n\n\t\tthis._setupVertexBuffers( geometry.attributes, passEncoder, renderPipeline );\n\n\t\t// draw\n\n\t\tconst drawRange = geometry.drawRange;\n\t\tconst firstVertex = drawRange.start;\n\n\t\tconst instanceCount = geometry.isInstancedBufferGeometry ? geometry.instanceCount : ( object.isInstancedMesh ? object.count : 1 );\n\n\t\tif ( hasIndex === true ) {\n\n\t\t\tconst indexCount = ( drawRange.count !== Infinity ) ? drawRange.count : index.count;\n\n\t\t\tpassEncoder.drawIndexed( indexCount, instanceCount, firstVertex, 0, 0 );\n\n\t\t\tinfo.update( object, indexCount, instanceCount );\n\n\t\t} else {\n\n\t\t\tconst positionAttribute = geometry.attributes.position;\n\t\t\tconst vertexCount = ( drawRange.count !== Infinity ) ? drawRange.count : positionAttribute.count;\n\n\t\t\tpassEncoder.draw( vertexCount, instanceCount, firstVertex, 0 );\n\n\t\t\tinfo.update( object, vertexCount, instanceCount );\n\n\t\t}\n\n\t}\n\n\t_getRenderObject( object, material, scene, camera, lightsNode ) {\n\n\t\tconst renderObject = this._objects.get( object, material, scene, camera, lightsNode );\n\t\tconst renderObjectProperties = this._properties.get( renderObject );\n\n\t\tif ( renderObjectProperties.initialized !== true ) {\n\n\t\t\trenderObjectProperties.initialized = true;\n\n\t\t\tconst dispose = () => {\n\n\t\t\t\tthis._renderPipelines.remove( renderObject );\n\t\t\t\tthis._nodes.remove( renderObject );\n\t\t\t\tthis._properties.remove( renderObject );\n\n\t\t\t\tthis._objects.remove( object, material, scene, camera, lightsNode );\n\n\t\t\t\trenderObject.material.removeEventListener( 'dispose', dispose );\n\n\t\t\t};\n\n\t\t\trenderObject.material.addEventListener( 'dispose', dispose );\n\n\t\t}\n\n\t\tconst cacheKey = renderObject.getCacheKey();\n\n\t\tif ( renderObjectProperties.cacheKey !== cacheKey ) {\n\n\t\t\trenderObjectProperties.cacheKey = cacheKey;\n\n\t\t\tthis._renderPipelines.remove( renderObject );\n\t\t\tthis._nodes.remove( renderObject );\n\n\t\t}\n\n\t\treturn renderObject;\n\n\t}\n\n\t_setupIndexBuffer( index, encoder ) {\n\n\t\tconst buffer = this._attributes.get( index ).buffer;\n\t\tconst indexFormat = ( index.array instanceof Uint16Array ) ? GPUIndexFormat.Uint16 : GPUIndexFormat.Uint32;\n\n\t\tencoder.setIndexBuffer( buffer, indexFormat );\n\n\t}\n\n\t_setupVertexBuffers( geometryAttributes, encoder, renderPipeline ) {\n\n\t\tconst shaderAttributes = renderPipeline.shaderAttributes;\n\n\t\tfor ( const shaderAttribute of shaderAttributes ) {\n\n\t\t\tconst name = shaderAttribute.name;\n\t\t\tconst slot = shaderAttribute.slot;\n\n\t\t\tconst attribute = geometryAttributes[ name ];\n\n\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\tconst buffer = this._attributes.get( attribute ).buffer;\n\t\t\t\tencoder.setVertexBuffer( slot, buffer );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_setupColorBuffer() {\n\n\t\tconst device = this._device;\n\n\t\tif ( device ) {\n\n\t\t\tif ( this._colorBuffer ) this._colorBuffer.destroy();\n\n\t\t\tthis._colorBuffer = this._device.createTexture( {\n\t\t\t\tlabel: 'colorBuffer',\n\t\t\t\tsize: {\n\t\t\t\t\twidth: Math.floor( this._width * this._pixelRatio ),\n\t\t\t\t\theight: Math.floor( this._height * this._pixelRatio ),\n\t\t\t\t\tdepthOrArrayLayers: 1\n\t\t\t\t},\n\t\t\t\tsampleCount: this._parameters.sampleCount,\n\t\t\t\tformat: GPUTextureFormat.BGRA8Unorm,\n\t\t\t\tusage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t_setupDepthBuffer() {\n\n\t\tconst device = this._device;\n\n\t\tif ( device ) {\n\n\t\t\tif ( this._depthBuffer ) this._depthBuffer.destroy();\n\n\t\t\tthis._depthBuffer = this._device.createTexture( {\n\t\t\t\tlabel: 'depthBuffer',\n\t\t\t\tsize: {\n\t\t\t\t\twidth: Math.floor( this._width * this._pixelRatio ),\n\t\t\t\t\theight: Math.floor( this._height * this._pixelRatio ),\n\t\t\t\t\tdepthOrArrayLayers: 1\n\t\t\t\t},\n\t\t\t\tsampleCount: this._parameters.sampleCount,\n\t\t\t\tformat: GPUTextureFormat.Depth24PlusStencil8,\n\t\t\t\tusage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t_configureContext() {\n\n\t\tconst device = this._device;\n\n\t\tif ( device ) {\n\n\t\t\tthis._context.configure( {\n\t\t\t\tdevice: device,\n\t\t\t\tformat: GPUTextureFormat.BGRA8Unorm,\n\t\t\t\tusage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC,\n\t\t\t\talphaMode: 'premultiplied'\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t_createCanvasElement() {\n\n\t\tconst canvas = document.createElementNS( 'http://www.w3.org/1999/xhtml', 'canvas' );\n\t\tcanvas.style.display = 'block';\n\t\treturn canvas;\n\n\t}\n\n}\n\nexport default WebGPURenderer;\n","export default \"import { three } from 'trzy'\\nimport WebGPU from 'three/examples/jsm/capabilities/WebGPU'\\nimport WebGPURenderer from 'three/examples/jsm/renderers/webgpu/WebGPURenderer'\\n\\nconst renderer = WebGPU.isAvailable() ? new WebGPURenderer() : undefined\\nconst { update } = three({ renderer })\\n\\nupdate(() => {\\n  \\n})\\n\""],"names":["WebGPU","message","element","WebGPU$1","GPUPrimitiveTopology","GPUCompareFunction","GPUStoreOp","GPULoadOp","GPUFrontFace","GPUCullMode","GPUIndexFormat","GPUTextureFormat","GPUAddressMode","GPUFilterMode","GPUBlendFactor","GPUBlendOperation","GPUColorWriteFlags","GPUStencilOperation","GPUBindingType","GPUTextureDimension","GPUTextureViewDimension","GPUTextureAspect","GPUInputStepMode","GPUFeatureName","GPUChunkSize","BlendColorFactor","OneMinusBlendColorFactor","WebGPUAnimation","update","time","frame","callback","nodes","WebGPUAnimation$1","WebGPUWeakMap","keys","map","i","value","key","WebGPURenderObject","renderer","object","material","scene","camera","lightsNode","cacheKey","WebGPURenderObjects","geometries","info","chainKey","renderObject","WebGPURenderObjects$1","WebGPUAttributes","device","attribute","data","isIndex","usage","gpuBuffer","size","gpuReadBuffer","needsUnmap","cmdEncoder","gpuCommands","array","buffer","updateRange","readBuffer","WebGPUAttributes$1","arrayNeedsUint32","getWireframeVersion","geometry","getWireframeIndex","indices","geometryIndex","geometryPosition","l","a","b","c","Uint32BufferAttribute","Uint16BufferAttribute","WebGPUGeometries","attributes","properties","geometryProperties","dispose","index","geometryAttributes","name","wireframeAttribute","wireframes","WebGPUGeometries$1","WebGPUInfo","count","instanceCount","WebGPUInfo$1","WebGPUProperties","WebGPUProperties$1","typedArraysToVertexFormatPrefix","typedAttributeToVertexFormatPrefix","Float16BufferAttribute","typeArraysToVertexFormatPrefixForItemSize1","WebGPURenderPipeline","utils","stageVertex","stageFragment","nodeBuilder","shaderAttributes","vertexBuffers","geometryAttribute","stepMode","alphaBlend","colorBlend","NoBlending","stencilFront","primitiveState","colorWriteMask","depthCompare","colorFormat","depthStencilFormat","sampleCount","blending","premultipliedAlpha","NormalBlending","AdditiveBlending","SubtractiveBlending","MultiplyBlending","CustomBlending","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","blend","blendFactor","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstColorFactor","OneMinusDstColorFactor","DstAlphaFactor","OneMinusDstAlphaFactor","SrcAlphaSaturateFactor","blendEquation","blendOperation","AddEquation","SubtractEquation","ReverseSubtractEquation","MinEquation","MaxEquation","depthFunc","NeverDepth","AlwaysDepth","LessDepth","LessEqualDepth","EqualDepth","GreaterEqualDepth","GreaterDepth","NotEqualDepth","descriptor","FrontSide","BackSide","DoubleSide","stencilCompare","stencilFunc","NeverStencilFunc","AlwaysStencilFunc","LessStencilFunc","LessEqualStencilFunc","EqualStencilFunc","GreaterEqualStencilFunc","GreaterStencilFunc","NotEqualStencilFunc","op","stencilOperation","KeepStencilOp","ZeroStencilOp","ReplaceStencilOp","InvertStencilOp","IncrementStencilOp","DecrementStencilOp","IncrementWrapStencilOp","DecrementWrapStencilOp","itemSize","normalized","ArrayType","AttributeType","format","prefix","bytesPerUnit","paddedItemSize","nodeAttributes","slot","bytesPerElement","arrayStride","offset","WebGPURenderPipeline$1","_id","WebGPUProgrammableStage","code","type","WebGPUProgrammableStage$1","WebGPURenderPipelines","cache","currentPipeline","pipeline","pipelines","il","preexistingPipeline","stage","needsUpdate","colorSpace","WebGPURenderPipelines$1","WebGPUComputePipelines","computeNode","computeShader","shader","stageCompute","WebGPUComputePipelines$1","WebGPUBindings","textures","renderPipelines","computePipelines","bindings","bindLayout","bindGroup","updateMap","needsBindGroupRefresh","binding","isShared","isUpdated","bufferGPU","texture","samplerGPU","needsTextureRefresh","textureGPU","layout","bindingPoint","entries","byteLength","resource","WebGPUBindings$1","NodeShaderStage","NodeUpdateType","defaultShaderStages","defaultBuildStages","shaderStages","vectorComponents","getCacheKey","property","childNode","getNodeChildren","childCacheKey","node","toJSON","child","subProperty","getValueType","typeOf","getValueFromType","params","last4","Color","Vector2","Vector3","Vector4","Matrix3","Matrix4","base64ToArrayBuffer","arrayBufferToBase64","arrayBuffer","chars","base64","NodeClasses","_nodeId","Node","nodeType","MathUtils","self","replaceNode","builder","hash","nodeProperties","nodeData","output","outputNode","refNode","result","buildStage","json","nodeChildren","inputNodes","inputArray","uuid","inputObject","meta","isRoot","extractFromCache","values","images","Node$1","addNodeClass","nodeClass","InputNode","precision","InputNode$1","ArrayElementNode","indexNode","nodeSnippet","indexSnippet","ArrayElementNode$1","ConvertNode","convertTo","requestType","overloadingType","snippet","ConvertNode$1","TempNode","nodeVar","propertyName","TempNode$1","JoinNode","cur","snippetValues","input","inputSnippet","JoinNode$1","stringVectorComponents","SplitNode","components","vectorLength","nodeTypeLength","SplitNode$1","ConstNode","ConstNode$1","NodeElements","addNodeElement","nodeElement","shaderNodeHandler","NodeClosure","inputs","nodeObjects","prop","nodeObj","nodeObject","nodeObjectsCacheMap","ShaderNodeObject","obj","getAutoTypedConstNode","ShaderNodeObjects","objects","ShaderNodeArray","len","ShaderNodeProxy","NodeClass","scope","factor","settings","assignNode","nodeArray","ShaderNodeImmutable","ShaderNodeInternal","jsFunc","stack","bools","uints","ints","floats","boolsCacheMap","bool","uintsCacheMap","uint","intsCacheMap","el","int","floatsCacheMap","float","cacheMaps","constNodesCacheMap","ConvertType","cacheMap","getConstNodeType","ShaderNode","val","nodeProxy","nodeImmutable","color","vec2","ivec2","uvec2","bvec2","vec3","ivec3","uvec3","bvec3","vec4","ivec4","uvec4","bvec4","mat3","imat3","umat3","bmat3","mat4","imat4","umat4","bmat4","string","convert","types","UniformNode","sharedNode","sharedNodeType","nodeUniform","UniformNode$1","uniform","arg1","arg2","VaryingNode","nodeVarying","varying","AttributeNode","attributeName","attributeType","nodeAttribute","BypassNode","returnNode","callNode","bypass","id","NodeCache","NodeCache$1","CacheNode","previousCache","ContextNode","context","previousContext","InstanceIndexNode","instanceIndex","NodeAttribute","NodeAttribute$1","NodeUniform","NodeUniform$1","NodeVar","NodeVar$1","NodeVarying","NodeVarying$1","NodeCode","NodeCode$1","NodeKeywords","keywordNames","regExp","codeKeywords","keywordNodes","keyword","keywordNode","NodeKeywords$1","OperatorNode","aNode","bNode","finalBNode","typeA","typeB","typeLength","outputLength","add","sub","mul","div","remainder","equal","assign","lessThan","greaterThan","lessThanEqual","greaterThanEqual","and","or","xor","bitAnd","bitOr","bitXor","shiftLeft","shiftRight","ExpressionNode","expression","PropertyNode","nodeVary","nodeOrType","diffuseColor","roughness","CondNode","condNode","ifNode","elseNode","ifType","elseType","needsProperty","nodeProperty","contextNode","ifSnippet","elseSnippet","cond","StackNode","parent","boolNode","method","methodNode","targetNode","sourceValue","MaxMipLevelNode","textureNode","image","width","height","maxMipLevel","typeFromLength","typeFromArray","isNonPaddingElementArray","toFloat","NodeBuilder","parser","levelNode","updateType","updateBeforeType","shaderStage","componentType","getConst","SRGBColorSpace","sRGBEncoding","LinearEncoding","NoColorSpace","length","baseType","dataAttribute","arrayType","vecType","vecNum","newComponentType","currentStack","vars","varyings","nodeCode","codes","flowData","previousFlow","flow","previousShaderStage","variable","flowNodes","fromType","toType","fromTypeLength","toTypeLength","REVISION","NodeBuilder$1","NodeFrame","NodeFrame$1","NodeFunctionInput","qualifier","isConst","NodeFunctionInput$1","VarNode","label","temp","MathNode","cNode","aType","bType","cType","aLen","bLen","cLen","inputType","isWebGL","tA","tB","mulNode","normalize","abs","radians","degrees","exp","exp2","log","log2","sqrt","inverseSqrt","floor","ceil","fract","sin","cos","tan","asin","acos","atan","sign","negate","oneMinus","dFdx","dFdy","round","reciprocal","atan2","min","max","mod","step","reflect","distance","difference","dot","cross","pow","pow2","pow3","pow4","transformDirection","mix","clamp","low","high","saturate","refract","smoothstep","faceForward","mixElement","t","e1","e2","smoothstepElement","x","Object3DNode","object3d","uniformNode","Object3DNode$1","ModelNode","modelViewMatrix","modelNormalMatrix","modelWorldMatrix","PositionNode","positionGeometry","vertexPositionNode","positionLocal","positionView","positionWorld","positionWorldDirection","positionViewDirection","EquirectUVNode","dirNode","dir","u","v","equirectUV","CameraNode","cameraProjectionMatrix","cameraViewMatrix","NormalNode","normalGeometry","vertexNode","normalLocal","normalView","normalWorld","transformedNormalView","transformedNormalWorld","SpecularMIPLevelNode","roughnessNode","maxMIPLevelScalar","sigma","specularMIPLevel","UVNode","uv","defaultUV","TextureNode","uvNode","textureProperty","uvSnippet","levelSnippet","TangentNode","tangentGeometry","tangentLocal","tangentView","tangentWorld","transformedTangentView","BitangentNode","crossNormalTangent","bitangentView","transformedBitangentView","BufferNode","bufferType","bufferCount","ReflectVectorNode","reflectVector","CubeTextureNode","cubeTexture","ReferenceNode","uniformType","reference","MaterialReferenceNode","materialReference","MaterialNode","textureRefNode","materialUV","colorNode","opacityNode","reflectivityNode","metalnessNode","emissiveNode","uvScaleMap","outputType","materialAlphaTest","materialColor","materialEmissive","materialOpacity","FrontFacingNode","frontFacing","faceDirection","perturbNormal2ArbNode","eye_pos","surf_norm","mapN","q0","q1","st0","st1","N","q1perp","q0perp","T","B","det","scale","NormalMapNode","scaleNode","TangentSpaceNormalMap","normalMapType","normalMap","ObjectSpaceNormalMap","TBNViewMatrix","ExtendedMaterialNode","materialNormal","InstanceNode","instanceMesh","instanceBufferNode","instanceMatrixNode","instancePosition","m","transformedNormal","instanceNormal","instance","ModelViewProjectionNode","position","modelViewProjection","Skinning","weight","bindMatrix","bindMatrixInverse","boneMatrices","boneMatX","boneMatY","boneMatZ","boneMatW","skinVertex","skinned","skinPosition","skinMatrix","skinNormal","SkinningNode","skinnedMesh","skinning","LinearToneMappingNode","exposure","ReinhardToneMappingNode","OptimizedCineonToneMappingNode","RRTAndODTFit","ACESFilmicToneMappingNode","ACESInputMat","ACESOutputMat","toneMappingLib","LinearToneMapping","ReinhardToneMapping","CineonToneMapping","ACESFilmicToneMapping","ToneMappingNode","toneMapping","NoToneMapping","exposureNode","toneMappingParams","toneMappingNode","mapping","resolution","ViewportNode","coordinateNode","resolutionNode","outX","outY","viewportBottomLeft","CodeNode","includes","language","include","CodeNode$1","FogNode","factorNode","FogNode$1","fog","FogRangeNode","nearNode","farNode","rangeFog","FogExp2Node","densityNode","depthNode","densityFog","LightingNode","LightingNode$1","LightNodes","sortLights","lights","LightsNode","lightNodes","lightNode","light","lightClass","lightNodeClass","AnalyticLightNode","lightsWithoutWrap","AONode","aoNode","AONode$1","EnvironmentNode","envNode","reflectVec","radianceTextureUVNode","irradianceTextureUVNode","radianceContext","irradianceContext","isolateRadianceFlowContext","EnvironmentNode$1","NodeMaterials","NodeMaterial","ShaderMaterial","outgoingLightNode","vertex","alphaTestNode","normalNode","materialLightsNode","backdropNode","backdropAlphaNode","lightingModelNode","outgoingLight","opacity","fogNode","descriptors","Material","nodeMaterial","createNodeMaterialFromType","NodeMaterial$1","addNodeMaterial","defaultValues","MeshBasicMaterial","MeshBasicNodeMaterial","parameters","source","MeshBasicNodeMaterial$1","depthMaterial","shadowNode","shadow","rtt","depthTexture","DepthTexture","NearestFilter","bias","shadowCoord","depth","AnalyticLightNode$1","NodeParser","NodeParser$1","NodeFunction","presicion","NodeFunction$1","declarationRegexp","propertiesRegexp","wgslTypeLib","parse","declaration","inputsCode","propsMatches","nameMatch","blockCode","WGSLNodeFunction","WGSLNodeFunction$1","WGSLNodeParser","WGSLNodeParser$1","painterSortStable","reversePainterSortStable","WebGPURenderList","groupOrder","z","group","renderItem","customOpaqueSort","customTransparentSort","WebGPURenderLists","lists","list","WebGPURenderLists$1","WebGPURenderState","WebGPURenderStates","renderState","WebGPURenderStates$1","WebGPUTextureUtils","mipmapVertexSource","mipmapFragmentSource","textureGPUDescriptor","baseArrayLayer","commandEncoder","bindGroupLayout","srcView","dstView","passEncoder","WebGPUTextureUtils$1","WebGPUTextures","Texture","video","VideoTexture","CubeTexture","textureProperties","disposeCallback","onTextureDispose","renderTarget","renderTargetProperties","colorTextureFormat","needsMipmaps","mipLevelCount","colorTextureGPU","depthTextureFormat","depthTextureGPU","depthTextureProperties","onRenderTargetDispose","addressMode","RepeatWrapping","MirroredRepeatWrapping","filterMode","NearestMipmapNearestFilter","NearestMipmapLinearFilter","dimension","originDepth","bytesPerTexel","bytesPerRow","mipmaps","blockData","mipmap","formatGPU","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT3_Format","RGBA_S3TC_DXT5_Format","RGB_ETC2_Format","RGBA_ETC2_EAC_Format","RGBA_ASTC_4x4_Format","RGBA_ASTC_5x4_Format","RGBA_ASTC_5x5_Format","RGBA_ASTC_6x5_Format","RGBA_ASTC_6x6_Format","RGBA_ASTC_8x5_Format","RGBA_ASTC_8x6_Format","RGBA_ASTC_8x8_Format","RGBA_ASTC_10x5_Format","RGBA_ASTC_10x6_Format","RGBA_ASTC_10x8_Format","RGBA_ASTC_10x10_Format","RGBA_ASTC_12x10_Format","RGBA_ASTC_12x12_Format","RGBAFormat","UnsignedByteType","HalfFloatType","FloatType","RedFormat","RGFormat","DepthFormat","UnsignedShortType","UnsignedIntType","DepthStencilFormat","UnsignedInt248Type","imageBitmap","options","faceImage","LinearFilter","event","WebGPUTextures$1","_clearAlpha","_clearColor","WebGPUBackground","renderList","background","forceClear","sceneProperties","backgroundNode","boxMesh","Mesh","BoxGeometry","backgroundCacheKey","colorAttachment","depthStencilAttachment","WebGPUBackground$1","WebGPUBinding","visibility","WebGPUBinding$1","getFloatLength","floatLength","getVectorLength","getStrideLength","WebGPUBuffer","WebGPUBuffer$1","WebGPUUniformBuffer","WebGPUUniformBuffer$1","WebGPUUniformsGroup","chunkOffset","remainingSizeInChunk","updated","e","arraysEqual","WebGPUUniformsGroup$1","WebGPUUniform","FloatUniform","Vector2Uniform","Vector3Uniform","Vector4Uniform","ColorUniform","Matrix3Uniform","Matrix4Uniform","FloatNodeUniform","Vector2NodeUniform","Vector3NodeUniform","Vector4NodeUniform","ColorNodeUniform","Matrix3NodeUniform","Matrix4NodeUniform","WebGPUSampler","WebGPUSampler$1","WebGPUNodeSampler","WebGPUNodeSampler$1","WebGPUSampledTexture","WebGPUSampledCubeTexture","WebGPUNodeSampledTexture","WebGPUNodeSampledCubeTexture","WebGPUStorageBuffer","WebGPUStorageBuffer$1","WebGPURenderTarget","WebGLRenderTarget","WebGPURenderTarget$1","gpuShaderStageLib","supports","wgslMethods","wgslPolyfill","WebGPUNodeBuilder","biasSnippet","uniformGPU","sampler","lastBinding","bufferClass","uniformsGroup","uniformNodeGPU","snippets","uniforms","bindingSnippets","bufferSnippets","groupSnippets","textureType","bufferNode","bufferCountSnippet","bufferSnippet","bufferAccessMode","vectorType","shadersData","mainNode","flowSlotData","slotName","stageData","shaderData","workgroupSize","access","structName","WebGPUNodeBuilder$1","WebGPUNodes","renderObjectProperties","computeProperties","objectProperties","environmentNode","rendererProperties","rendererToneMapping","nodeUV","EquirectangularReflectionMapping","EquirectangularRefractionMapping","environment","nodeFrame","WebGPUNodes$1","WebGPUUtils","WebGPUUtils$1","left","right","top","bottom","near","far","te","y","d","w","h","p","Frustum","planes","me","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","_frustum","_projScreenMatrix","_vector3","WebGPURenderer","adapterOptions","adapter","features","supportedFeatures","deviceDescriptor","previousRenderId","previousRenderState","vp","sc","opaqueObjects","transparentObjects","animation","target","pixelRatio","updateStyle","scissor","encoderGPU","descriptorGPU","sourceGPU","destinationGPU","viewport","minDepth","maxDepth","alpha","stencil","computeNodes","groups","groupMaterial","children","cameras","j","jl","camera2","renderPipeline","hasIndex","drawRange","firstVertex","indexCount","positionAttribute","vertexCount","encoder","indexFormat","shaderAttribute","canvas","WebGPURenderer$1"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112]}