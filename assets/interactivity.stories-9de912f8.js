import{n as t,q as x,r as I,u as k,s as P,M as z,B as H,b as L,c as E,d as R}from"./setup-bf23c97c.js";import{s as C}from"./shadows-fc355632.js";const T=()=>{let e=0,n=0;return new ResizeObserver(([s])=>{e=(s==null?void 0:s.contentRect.width)??0,n=(s==null?void 0:s.contentRect.height)??0}).observe(t.target),s=>{t.pointer.set(s.offsetX/e*2-1,-(s.offsetY/n*2)+1),t.raycaster.setFromCamera(t.pointer,t.camera)}},D=e=>{t.interactiveMap[e.uuid]===void 0&&(t.interactiveObjects.push(e),t.interactiveMap[e.uuid]=e)},S=e=>{const n=t.interactiveObjects.indexOf(e);t.interactiveObjects.splice(n,1),delete t.interactiveMap[e.uuid]},B=()=>{const e=x(r=>D(r)),n=I(r=>S(r));return()=>{e(),n()}},h=e=>`${(e.eventObject||e.object).uuid}/${e.index}${e.instanceId}`,g=[["click",!1],["contextmenu",!1],["dblclick",!1],["wheel",!1],["pointerdown",!0],["pointerup",!0],["pointerleave",!0],["pointerenter",!0],["pointermove",!0],["pointercancel",!0]],F=e=>{const n=e.offsetX-(t.initialClick[0]??0),r=e.offsetY-(t.initialClick[1]??0);return Math.round(Math.hypot(n,r))},m=e=>{t.hovered.forEach(n=>{if(e.length===0||!e.some(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const{eventObject:r}=n;t.hovered.delete(h(n)),r.dispatchEvent({type:"pointerout",...n,intersections:e}),r.dispatchEvent({type:"pointerleave",...n,intersections:e})}})},X=()=>{const e=new Set,n=[];let r=t.raycaster.intersectObjects(t.interactiveObjects).sort((s,i)=>s.distance-i.distance).filter(s=>{const i=h(s);return e.has(i)?!1:(e.add(i),!0)});return t.filter&&(r=t.filter(r,t)),r.forEach(s=>{let i=s.object;for(;i;)n.push({...s,eventObject:i}),i=i.parent}),n},b=(e,n)=>{n.forEach(r=>{r.dispatchEvent({type:"pointermissed",event:e})})},y=e=>e==="pointerleave"||e==="pointercancel"?()=>{t.pointerOverTarget=!1,m([])}:e==="pointerenter"?()=>{t.pointerOverTarget=!0}:n=>{const r=e==="pointermove",s=e==="click"||e==="contextmenu"||e==="dblclick";t.compute(n,t);const i=t.enabled?X():[],v=s?F(n):0;e==="pointerdown"&&(t.initialClick=[n.offsetX,n.offsetY],t.initialHits=i.map(d=>d.eventObject)),s&&i.length===0&&v<=2&&b(n,t.interactiveObjects),r&&m(i);let u=!1;const o=()=>{u=!0};for(let d=0,j=i.length;d<j;d+=1){const a=i[d],c={stopped:u,...a,intersections:i,stopPropagation(){o(),c.stopped=!0;const l=[...t.hovered.values()];if(t.hovered.size>0&&l.some(p=>p.eventObject===a.eventObject)){const p=i.slice(0,i.indexOf(a));m([...p,a])}},camera:t.raycaster.camera,delta:v,nativeEvent:n,pointer:t.pointer,ray:t.raycaster.ray};if(r){const l=h(c),p=t.hovered.get(l);p?p.stopped&&c.stopPropagation():(t.hovered.set(l,c),a.eventObject.dispatchEvent({type:"pointerover",...c}),a.eventObject.dispatchEvent({type:"pointerenter",...c})),a.eventObject.dispatchEvent({type:"pointermove",...c})}else(!s||t.initialHits.includes(a.eventObject))&&(b(n,t.interactiveObjects.filter(l=>!t.initialHits.includes(l))),a.eventObject.dispatchEvent({type:e,...c}));if(u)break}},Y=()=>(g.forEach(([e,n])=>{t.target.addEventListener(e,y(e),{passive:n})}),()=>{g.forEach(([e])=>{t.target.removeEventListener(e,y(e))})}),$=e=>{t.camera=e.camera,t.enabled=e.enabled??!0,t.target=e.target,t.filter=e.filter,t.compute=e.compute??T();const n=B(),r=Y();return{context:t,dispose:()=>{n(),r()}}},A=`import * as THREE from 'three'
import { interactivity } from 'trzy'

interactivity()

const mesh = new THREE.Mesh(
  new THREE.BoxGeometry(),
  new THREE.MeshStandardMaterial()
)

mesh.addEventListener('pointerenter', (event) => console.log(event))
mesh.addEventListener('pointerleave', (event) => console.log(event))
mesh.addEventListener('click', (event) => console.log(event))

mesh.addEventListener('pointerenter', (event) => {
  // Call stop propagation to stop events from firing on other intersections.
  event.stopPropagation()
})
`,U={title:"Interactivity",parameters:{docs:{source:{code:A}}}},G=()=>{const{scene:e,camera:n,renderer:r}=k();$({target:r.domElement,camera:n.current}),P();const s=[];for(let i=0;i<20;i+=1){const v=new z({color:"yellow"}),u=new H,o=new L(u,v);o.position.set(E.randInt(-2,2),-.25,E.randInt(-2,2)),o.userData.rotation={y:(Math.random()-.5)*.1,z:(Math.random()-.5)*.1},e.add(o),s.push(o),o.addEventListener("pointerenter",d=>{d.stopPropagation(),o.material.color.set("hotpink")}),o.addEventListener("pointerleave",()=>o.material.color.set("yellow")),o.addEventListener("click",()=>o.material.color.set("blue"))}return C(e),R(()=>{s.forEach(i=>{i.rotation.y+=i.userData.rotation.y,i.rotation.z+=i.userData.rotation.z})}),r.domElement},f={render:G};var O,w,M;f.parameters={...f.parameters,docs:{...(O=f.parameters)==null?void 0:O.docs,source:{originalSource:`{
  render
}`,...(M=(w=f.parameters)==null?void 0:w.docs)==null?void 0:M.source}}};const J=["Primary"];export{f as Primary,J as __namedExportsOrder,U as default};
//# sourceMappingURL=interactivity.stories-9de912f8.js.map
