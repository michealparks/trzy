{"version":3,"file":"mouse-raycaster.stories-aac5edcf.js","sources":["../../src/mouse-raycaster/index.ts"],"sourcesContent":["import {\n  type Object3D,\n  type OrthographicCamera,\n  type PerspectiveCamera,\n  type Scene,\n  Raycaster,\n  Vector2,\n  EventDispatcher\n} from 'three'\n\nexport class MouseRaycaster extends EventDispatcher {\n  camera: PerspectiveCamera | OrthographicCamera\n  canvas: HTMLCanvasElement\n  raycaster: Raycaster\n  objects: Object3D[] = []\n  pointerDown = new Vector2()\n  pointerUp = new Vector2()\n  pointerMove = new Vector2()\n  recursive = true\n\n  constructor (props: {\n    camera: PerspectiveCamera | OrthographicCamera\n    canvas: HTMLCanvasElement\n    raycaster?: Raycaster\n    objects?: Object3D[]\n    scene?: Scene\n    recursive?: boolean\n    move?: boolean\n  }) {\n    super()\n    this.camera = props.camera\n    this.canvas = props.canvas\n    this.raycaster = props.raycaster ?? new Raycaster()\n    this.objects = props.objects ?? (props.scene ? [props.scene] : [])\n    this.recursive = props.recursive ?? true\n\n    this.canvas.addEventListener('pointerdown', this.onPointerDown, { passive: true })\n    this.canvas.addEventListener('pointerup', this.onPointerUp, { passive: true })\n    \n    if (props.move) {\n      this.canvas.addEventListener('pointermove', this.onPointerMove, { passive: true })\n    }\n  }\n\n  getNormalizedCoordinates (event: PointerEvent, vec: Vector2) {\n    const rect = this.canvas.getBoundingClientRect()\n\n    /*\n     * Calculate pointer position in normalized device coordinates\n     * (-1 to +1) for both components\n     */\n    vec.x = (((event.clientX - rect.x) / this.canvas.clientWidth) * 2) - 1\n    vec.y = -(((event.clientY - rect.y) / this.canvas.clientHeight) * 2) + 1\n  }\n\n  onPointerDown = (event: PointerEvent) => {\n    this.getNormalizedCoordinates(event, this.pointerDown)\n  }\n\n  onPointerUp = (event: PointerEvent) => {\n    this.getNormalizedCoordinates(event, this.pointerUp)\n\n    if (this.pointerDown.sub(this.pointerUp).lengthSq() > 0.001) {\n      return\n    }\n\n    // Update the picking ray with the camera and pointer position\n    this.raycaster.setFromCamera(this.pointerUp, this.camera)\n\n    const intersections = this.raycaster.intersectObjects(this.objects, this.recursive)\n\n    this.dispatchEvent({ type: 'click', intersections })\n  }\n\n  onPointerMove = (event: PointerEvent) => {\n    this.getNormalizedCoordinates(event, this.pointerMove)\n\n    this.raycaster.setFromCamera(this.pointerMove, this.camera)\n\n    const intersections = this.raycaster.intersectObjects(this.objects, this.recursive)\n\n    this.dispatchEvent({ type: 'move', intersections })\n  }\n\n  dispose () {\n    this.canvas.removeEventListener('pointerdown', this.onPointerDown)\n    this.canvas.removeEventListener('pointerup', this.onPointerUp)\n  }\n}\n"],"names":["MouseRaycaster","EventDispatcher","props","__publicField","Vector2","event","intersections","Raycaster","vec","rect"],"mappings":"mRAUO,MAAMA,UAAuBC,CAAgB,CAUlD,YAAaC,EAQV,CACK,QAlBRC,EAAA,eACAA,EAAA,eACAA,EAAA,kBACAA,EAAA,eAAsB,CAAA,GACtBA,EAAA,mBAAc,IAAIC,GAClBD,EAAA,iBAAY,IAAIC,GAChBD,EAAA,mBAAc,IAAIC,GAClBD,EAAA,iBAAY,IAqCZA,EAAA,qBAAiBE,GAAwB,CAClC,KAAA,yBAAyBA,EAAO,KAAK,WAAW,CAAA,GAGvDF,EAAA,mBAAeE,GAAwB,CAGjC,GAFC,KAAA,yBAAyBA,EAAO,KAAK,SAAS,EAE/C,KAAK,YAAY,IAAI,KAAK,SAAS,EAAE,WAAa,KACpD,OAIF,KAAK,UAAU,cAAc,KAAK,UAAW,KAAK,MAAM,EAExD,MAAMC,EAAgB,KAAK,UAAU,iBAAiB,KAAK,QAAS,KAAK,SAAS,EAElF,KAAK,cAAc,CAAE,KAAM,QAAS,cAAAA,CAAe,CAAA,CAAA,GAGrDH,EAAA,qBAAiBE,GAAwB,CAClC,KAAA,yBAAyBA,EAAO,KAAK,WAAW,EAErD,KAAK,UAAU,cAAc,KAAK,YAAa,KAAK,MAAM,EAE1D,MAAMC,EAAgB,KAAK,UAAU,iBAAiB,KAAK,QAAS,KAAK,SAAS,EAElF,KAAK,cAAc,CAAE,KAAM,OAAQ,cAAAA,CAAe,CAAA,CAAA,GAnDlD,KAAK,OAASJ,EAAM,OACpB,KAAK,OAASA,EAAM,OACpB,KAAK,UAAYA,EAAM,WAAa,IAAIK,EACnC,KAAA,QAAUL,EAAM,UAAYA,EAAM,MAAQ,CAACA,EAAM,KAAK,EAAI,CAAA,GAC1D,KAAA,UAAYA,EAAM,WAAa,GAE/B,KAAA,OAAO,iBAAiB,cAAe,KAAK,cAAe,CAAE,QAAS,GAAM,EAC5E,KAAA,OAAO,iBAAiB,YAAa,KAAK,YAAa,CAAE,QAAS,GAAM,EAEzEA,EAAM,MACH,KAAA,OAAO,iBAAiB,cAAe,KAAK,cAAe,CAAE,QAAS,GAAM,CAErF,CAEA,yBAA0BG,EAAqBG,EAAc,CACrD,MAAAC,EAAO,KAAK,OAAO,sBAAsB,EAM3CD,EAAA,GAAOH,EAAM,QAAUI,EAAK,GAAK,KAAK,OAAO,YAAe,EAAK,EACjED,EAAA,EAAI,GAAIH,EAAM,QAAUI,EAAK,GAAK,KAAK,OAAO,aAAgB,GAAK,CACzE,CA+BA,SAAW,CACT,KAAK,OAAO,oBAAoB,cAAe,KAAK,aAAa,EACjE,KAAK,OAAO,oBAAoB,YAAa,KAAK,WAAW,CAC/D,CACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}